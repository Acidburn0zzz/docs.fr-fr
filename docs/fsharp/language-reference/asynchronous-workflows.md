---
title: Flux de travail asynchrones (F#)
description: "En savoir plus sur la prise en charge dans le langage de programmation pour effectuer des calculs de façon asynchrone, F # qui s’exécutent sans bloquer l’exécution d’autres tâches."
keywords: visual f#, f#, programmation fonctionnelle
author: cartermp
ms.author: phcart
ms.date: 05/16/2016
ms.topic: language-reference
ms.prod: .net
ms.technology: devlang-fsharp
ms.devlang: fsharp
ms.assetid: ee2bb9bf-e04a-4fbe-bf58-46d07229e981
ms.openlocfilehash: e1cbdb452c8f77d97a0231a5ec75d752a98d2ed6
ms.sourcegitcommit: 655fd4f78741967f80c409cef98347fdcf77857d
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/28/2018
---
# <a name="asynchronous-workflows"></a><span data-ttu-id="87792-104">Flux de travail asynchrones</span><span class="sxs-lookup"><span data-stu-id="87792-104">Asynchronous Workflows</span></span>

> [!NOTE]
<span data-ttu-id="87792-105">Le lien des informations de référence sur les API pointe vers MSDN.</span><span class="sxs-lookup"><span data-stu-id="87792-105">The API reference link will take you to MSDN.</span></span>  <span data-ttu-id="87792-106">Les informations de référence sur les API docs.microsoft.com ne sont pas terminées.</span><span class="sxs-lookup"><span data-stu-id="87792-106">The docs.microsoft.com API reference is not complete.</span></span>

<span data-ttu-id="87792-107">Cette rubrique décrit la prise en charge en F # pour effectuer des calculs de façon asynchrone, autrement dit, sans se bloquer l’exécution d’autres tâches.</span><span class="sxs-lookup"><span data-stu-id="87792-107">This topic describes support in F# for performing computations asynchronously, that is, without blocking execution of other work.</span></span> <span data-ttu-id="87792-108">Par exemple, calculs asynchrones peuvent être utilisés pour écrire des applications qui ont des interfaces utilisateur en réagissant aux utilisateurs que l’application effectue un autre travail.</span><span class="sxs-lookup"><span data-stu-id="87792-108">For example, asynchronous computations can be used to write applications that have UIs that remain responsive to users as the application performs other work.</span></span>

## <a name="syntax"></a><span data-ttu-id="87792-109">Syntaxe</span><span class="sxs-lookup"><span data-stu-id="87792-109">Syntax</span></span>

```fsharp
async { expression }
```

## <a name="remarks"></a><span data-ttu-id="87792-110">Notes</span><span class="sxs-lookup"><span data-stu-id="87792-110">Remarks</span></span>

<span data-ttu-id="87792-111">Dans la syntaxe précédente, le calcul représenté par `expression` est configuré pour s’exécuter de façon asynchrone, c'est-à-dire sans bloquer le thread actuel de calcul lorsque des opérations asynchrones de veille, d’e/s et d’autres opérations asynchrones sont effectuées.</span><span class="sxs-lookup"><span data-stu-id="87792-111">In the previous syntax, the computation represented by `expression` is set up to run asynchronously, that is, without blocking the current computation thread when asynchronous sleep operations, I/O, and other asynchronous operations are performed.</span></span> <span data-ttu-id="87792-112">Les calculs asynchrones sont souvent démarrés dans un thread d’arrière-plan pendant que l’exécution se poursuit sur le thread actuel.</span><span class="sxs-lookup"><span data-stu-id="87792-112">Asynchronous computations are often started on a background thread while execution continues on the current thread.</span></span> <span data-ttu-id="87792-113">Le type de l’expression est `Async<'T>`, où `'T` est le type retourné par l’expression lorsque le `return` mot clé est utilisé.</span><span class="sxs-lookup"><span data-stu-id="87792-113">The type of the expression is `Async<'T>`, where `'T` is the type returned by the expression when the `return` keyword is used.</span></span> <span data-ttu-id="87792-114">Le code dans une telle expression est appelé un *bloc asynchrone*, ou *bloc async*.</span><span class="sxs-lookup"><span data-stu-id="87792-114">The code in such an expression is referred to as an *asynchronous block*, or *async block*.</span></span>

<span data-ttu-id="87792-115">Il existe plusieurs façons de programmation asynchrone et la [ `Async` ](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) classe fournit des méthodes qui prennent en charge plusieurs scénarios.</span><span class="sxs-lookup"><span data-stu-id="87792-115">There are a variety of ways of programming asynchronously, and the [`Async`](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7) class provides methods that support several scenarios.</span></span> <span data-ttu-id="87792-116">L’approche générale consiste à créer `Async` les objets qui représentent le calcul ou les calculs que vous souhaitez exécuter de façon asynchrone, puis à démarrer ces calculs en utilisant l’une des fonctions de déclenchement.</span><span class="sxs-lookup"><span data-stu-id="87792-116">The general approach is to create `Async` objects that represent the computation or computations that you want to run asynchronously, and then start these computations by using one of the triggering functions.</span></span> <span data-ttu-id="87792-117">Les diverses fonctions de déclenchement offrent des moyens différents de l’exécution de calculs asynchrones, et que vous utilisez varie selon que vous souhaitez utiliser le thread actuel, un thread d’arrière-plan ou un objet de tâche de .NET Framework, et s’il existe de continuation fonctions qui s’exécute lorsque la fin du calcul.</span><span class="sxs-lookup"><span data-stu-id="87792-117">The various triggering functions provide different ways of running asynchronous computations, and which one you use depends on whether you want to use the current thread, a background thread, or a .NET Framework task object, and whether there are continuation functions that should run when the computation finishes.</span></span> <span data-ttu-id="87792-118">Par exemple, pour démarrer un calcul asynchrone sur le thread actuel, vous pouvez utiliser [ `Async.StartImmediate` ](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span><span class="sxs-lookup"><span data-stu-id="87792-118">For example, to start an asynchronous computation on the current thread, you can use [`Async.StartImmediate`](https://msdn.microsoft.com/library/2f71d1cc-187f-48cf-ac66-e7fda41c46e3).</span></span> <span data-ttu-id="87792-119">Lorsque vous démarrez un calcul asynchrone à partir du thread d’interface utilisateur, vous ne bloquez pas la boucle d’événements principale qui traite les actions utilisateur telles que les séquences de touches et l’activité de la souris, donc votre application reste réactive.</span><span class="sxs-lookup"><span data-stu-id="87792-119">When you start an asynchronous computation from the UI thread, you do not block the main event loop that processes user actions such as keystrokes and mouse activity, so your application remains responsive.</span></span>

## <a name="asynchronous-binding-by-using-let"></a><span data-ttu-id="87792-120">Liaison asynchrone à l’aide de let !</span><span class="sxs-lookup"><span data-stu-id="87792-120">Asynchronous Binding by Using let!</span></span>

<span data-ttu-id="87792-121">Dans un flux de travail asynchrone, certaines expressions et opérations sont synchrones, et certaines sont des calculs plus longs conçus pour retourner un résultat de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="87792-121">In an asynchronous workflow, some expressions and operations are synchronous, and some are longer computations that are designed to return a result asynchronously.</span></span> <span data-ttu-id="87792-122">Lorsque vous appelez une méthode asynchrone, au lieu d’une boucle `let` de liaison, vous utilisez `let!`.</span><span class="sxs-lookup"><span data-stu-id="87792-122">When you call a method asynchronously, instead of an ordinary `let` binding, you use `let!`.</span></span> <span data-ttu-id="87792-123">L’effet de `let!` consiste à activer l’exécution continue sur d’autres calculs ou threads tandis que le calcul est exécuté.</span><span class="sxs-lookup"><span data-stu-id="87792-123">The effect of `let!` is to enable execution to continue on other computations or threads as the computation is being performed.</span></span> <span data-ttu-id="87792-124">Après le côté droit de la `let!` liaison retourne, le reste du workflow asynchrone reprend l’exécution.</span><span class="sxs-lookup"><span data-stu-id="87792-124">After the right side of the `let!` binding returns, the rest of the asynchronous workflow resumes execution.</span></span>

<span data-ttu-id="87792-125">Le code suivant montre la différence entre `let` et `let!`.</span><span class="sxs-lookup"><span data-stu-id="87792-125">The following code shows the difference between `let` and `let!`.</span></span> <span data-ttu-id="87792-126">La ligne de code qui utilise `let` crée simplement un calcul asynchrone en tant qu’objet que vous pouvez exécuter ultérieurement en utilisant, par exemple, `Async.StartImmediate` ou [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span><span class="sxs-lookup"><span data-stu-id="87792-126">The line of code that uses `let` just creates an asynchronous computation as an object that you can run later by using, for example, `Async.StartImmediate` or [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b).</span></span> <span data-ttu-id="87792-127">La ligne de code qui utilise `let!` démarre le calcul, et, le thread est interrompu jusqu'à ce que le résultat soit disponible au point d’exécution se poursuit.</span><span class="sxs-lookup"><span data-stu-id="87792-127">The line of code that uses `let!` starts the computation, and then the thread is suspended until the result is available, at which point execution continues.</span></span>

```fsharp
// let just stores the result as an asynchronous operation.
let (result1 : Async<byte[]>) = stream.AsyncRead(bufferSize)
// let! completes the asynchronous operation and returns the data.
let! (result2 : byte[])  = stream.AsyncRead(bufferSize)
```

<span data-ttu-id="87792-128">En plus de `let!`, vous pouvez utiliser `use!` pour effectuer des liaisons asynchrones.</span><span class="sxs-lookup"><span data-stu-id="87792-128">In addition to `let!`, you can use `use!` to perform asynchronous bindings.</span></span> <span data-ttu-id="87792-129">La différence entre `let!` et `use!` est identique à la différence entre `let` et `use`.</span><span class="sxs-lookup"><span data-stu-id="87792-129">The difference between `let!` and `use!` is the same as the difference between `let` and `use`.</span></span> <span data-ttu-id="87792-130">Pour `use!`, l’objet est supprimé à la fin de la portée actuelle.</span><span class="sxs-lookup"><span data-stu-id="87792-130">For `use!`, the object is disposed of at the close of the current scope.</span></span> <span data-ttu-id="87792-131">Notez que dans la version actuelle du langage F #, `use!` n’autorise pas une valeur être initialisés à null, même si `use` est.</span><span class="sxs-lookup"><span data-stu-id="87792-131">Note that in the current release of the F# language, `use!` does not allow a value to be initialized to null, even though `use` does.</span></span>

## <a name="asynchronous-primitives"></a><span data-ttu-id="87792-132">Primitives asynchrones</span><span class="sxs-lookup"><span data-stu-id="87792-132">Asynchronous Primitives</span></span>

<span data-ttu-id="87792-133">Une méthode qui effectue une tâche asynchrone unique et retourne le résultat est appelée un *primitive asynchrone*, et elles sont conçues spécifiquement pour une utilisation avec `let!`.</span><span class="sxs-lookup"><span data-stu-id="87792-133">A method that performs a single asynchronous task and returns the result is called an *asynchronous primitive*, and these are designed specifically for use with `let!`.</span></span> <span data-ttu-id="87792-134">Plusieurs primitives asynchrones sont définies dans la bibliothèque principale F #.</span><span class="sxs-lookup"><span data-stu-id="87792-134">Several asynchronous primitives are defined in the F# core library.</span></span> <span data-ttu-id="87792-135">Deux méthodes pour les applications Web sont définies dans le module [ `Microsoft.FSharp.Control.WebExtensions` ](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [ `WebRequest.AsyncGetResponse` ](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) et [ `WebClient.AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span><span class="sxs-lookup"><span data-stu-id="87792-135">Two such methods for Web applications are defined in the module [`Microsoft.FSharp.Control.WebExtensions`](https://msdn.microsoft.com/library/95ef17bc-ee3f-44ba-8a11-c90fcf4cf003): [`WebRequest.AsyncGetResponse`](https://msdn.microsoft.com/library/09a60c31-e6e2-4b5c-ad23-92a86e50060c) and [`WebClient.AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a).</span></span> <span data-ttu-id="87792-136">Les deux primitives téléchargent des données à partir d’une page Web, en fonction de l’URL.</span><span class="sxs-lookup"><span data-stu-id="87792-136">Both primitives download data from a Web page, given a URL.</span></span> <span data-ttu-id="87792-137">`AsyncGetResponse` génère un `System.Net.WebResponse` objet, et `AsyncDownloadString` produit une chaîne qui représente le code HTML pour une page Web.</span><span class="sxs-lookup"><span data-stu-id="87792-137">`AsyncGetResponse` produces a `System.Net.WebResponse` object, and `AsyncDownloadString` produces a string that represents the HTML for a Web page.</span></span>

<span data-ttu-id="87792-138">Plusieurs primitives pour les opérations d’e/s asynchrones sont inclus dans le [ `Microsoft.FSharp.Control.CommonExtensions` ](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) module.</span><span class="sxs-lookup"><span data-stu-id="87792-138">Several primitives for asynchronous I/O operations are included in the [`Microsoft.FSharp.Control.CommonExtensions`](https://msdn.microsoft.com/library/2edb67cb-6814-4a30-849f-b6dbdd042396) module.</span></span> <span data-ttu-id="87792-139">Ces méthodes d’extension de la `System.IO.Stream` classe sont [ `Stream.AsyncRead` ](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) et [ `Stream.AsyncWrite` ](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span><span class="sxs-lookup"><span data-stu-id="87792-139">These extension methods of the `System.IO.Stream` class are [`Stream.AsyncRead`](https://msdn.microsoft.com/library/85698aaa-bdda-47e6-abed-3730f59fda5e) and [`Stream.AsyncWrite`](https://msdn.microsoft.com/library/1b0a2751-e42a-47e1-bd27-020224adc618).</span></span>

<span data-ttu-id="87792-140">D’autres primitives asynchrones sont disponibles dans le [F # PowerTools](https://fsprojects.github.io/VisualFSharpPowerTools/).</span><span class="sxs-lookup"><span data-stu-id="87792-140">Additional asynchronous primitives are available in the [F# PowerTools](https://fsprojects.github.io/VisualFSharpPowerTools/).</span></span> <span data-ttu-id="87792-141">Vous pouvez également écrire vos propres primitives asynchrones en définissant une fonction dont le corps complet est placé dans un bloc async.</span><span class="sxs-lookup"><span data-stu-id="87792-141">You can also write your own asynchronous primitives by defining a function whose complete body is enclosed in an async block.</span></span>

<span data-ttu-id="87792-142">Pour utiliser les méthodes asynchrones dans .NET Framework qui sont conçues pour d’autres modèles asynchrones avec le modèle de programmation asynchrone F #, vous créez une fonction qui retourne une F # `Async` objet.</span><span class="sxs-lookup"><span data-stu-id="87792-142">To use asynchronous methods in the .NET Framework that are designed for other asynchronous models with the F# asynchronous programming model, you create a function that returns an F# `Async` object.</span></span> <span data-ttu-id="87792-143">La bibliothèque F # a des fonctions qui vous permet d’exécuter.</span><span class="sxs-lookup"><span data-stu-id="87792-143">The F# library has functions that make this easy to do.</span></span>

<span data-ttu-id="87792-144">Un exemple d’utilisation de flux de travail asynchrones est inclus ici ; Il existe de nombreux autres dans la documentation pour les méthodes de la [classe Async](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span><span class="sxs-lookup"><span data-stu-id="87792-144">One example of using asynchronous workflows is included here; there are many others in the documentation for the methods of the [Async class](https://msdn.microsoft.com/library/03eb4d12-a01a-4565-a077-5e83f17cf6f7).</span></span>

<span data-ttu-id="87792-145">Cet exemple montre comment utiliser des flux de travail asynchrones pour effectuer des calculs en parallèle.</span><span class="sxs-lookup"><span data-stu-id="87792-145">This example shows how to use asynchronous workflows to perform computations in parallel.</span></span>

<span data-ttu-id="87792-146">Dans l’exemple de code suivant, une fonction `fetchAsync` Obtient le texte HTML retourné à partir d’une requête Web.</span><span class="sxs-lookup"><span data-stu-id="87792-146">In the following code example, a function `fetchAsync` gets the HTML text returned from a Web request.</span></span> <span data-ttu-id="87792-147">Le `fetchAsync` fonction contient un bloc asynchrone de code.</span><span class="sxs-lookup"><span data-stu-id="87792-147">The `fetchAsync` function contains an asynchronous block of code.</span></span> <span data-ttu-id="87792-148">Lorsqu’une liaison est faite au résultat d’une primitive asynchrone, dans ce cas [ `AsyncDownloadString` ](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), laissez !</span><span class="sxs-lookup"><span data-stu-id="87792-148">When a binding is made to the result of an asynchronous primitive, in this case [`AsyncDownloadString`](https://msdn.microsoft.com/library/8a85a9b7-f712-4cac-a0ce-0a797f8ea32a), let!</span></span> <span data-ttu-id="87792-149">est utilisé au lieu de laisser.</span><span class="sxs-lookup"><span data-stu-id="87792-149">is used instead of let.</span></span>

<span data-ttu-id="87792-150">Vous utilisez la fonction [ `Async.RunSynchronously` ](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) pour exécuter une opération asynchrone et attendre son résultat.</span><span class="sxs-lookup"><span data-stu-id="87792-150">You use the function [`Async.RunSynchronously`](https://msdn.microsoft.com/library/0a6663a9-50f2-4d38-8bf3-cefd1a51fd6b) to execute an asynchronous operation and wait for its result.</span></span> <span data-ttu-id="87792-151">Par exemple, vous pouvez exécuter plusieurs opérations asynchrones en parallèle à l’aide de la [ `Async.Parallel` ](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) fonctionne conjointement avec la `Async.RunSynchronously` (fonction).</span><span class="sxs-lookup"><span data-stu-id="87792-151">As an example, you can execute multiple asynchronous operations in parallel by using the [`Async.Parallel`](https://msdn.microsoft.com/library/aa9b0355-2d55-4858-b943-cbe428de9dc4) function together with the `Async.RunSynchronously` function.</span></span> <span data-ttu-id="87792-152">Le `Async.Parallel` fonction prend une liste de la `Async` des objets, configure le code pour chaque `Async` objet de tâche à exécuter en parallèle et retourne un `Async` objet qui représente le calcul parallèle.</span><span class="sxs-lookup"><span data-stu-id="87792-152">The `Async.Parallel` function takes a list of the `Async` objects, sets up the code for each `Async` task object to run in parallel, and returns an `Async` object that represents the parallel computation.</span></span> <span data-ttu-id="87792-153">Comme pour une seule opération, vous appelez `Async.RunSynchronously` pour démarrer l’exécution.</span><span class="sxs-lookup"><span data-stu-id="87792-153">Just as for a single operation, you call `Async.RunSynchronously` to start the execution.</span></span>

<span data-ttu-id="87792-154">Le `runAll` fonction lance trois flux de travail asynchrones en parallèle et attend jusqu'à ce qu’ils ont terminé.</span><span class="sxs-lookup"><span data-stu-id="87792-154">The `runAll` function launches three asynchronous workflows in parallel and waits until they have all completed.</span></span>

[!code-fsharp[Main](../../../samples/snippets/fsharp/lang-ref-2/snippet8003.fs)]

## <a name="see-also"></a><span data-ttu-id="87792-155">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="87792-155">See Also</span></span>

[<span data-ttu-id="87792-156">Informations de référence du langage F#</span><span class="sxs-lookup"><span data-stu-id="87792-156">F# Language Reference</span></span>](index.md)

[<span data-ttu-id="87792-157">Expressions de calcul</span><span class="sxs-lookup"><span data-stu-id="87792-157">Computation Expressions</span></span>](computation-expressions.md)

[<span data-ttu-id="87792-158">Control.Async, classe</span><span class="sxs-lookup"><span data-stu-id="87792-158">Control.Async Class</span></span>](https://msdn.microsoft.com/visualfsharpdocs/conceptual/control.async-class-%5bfsharp%5d)
