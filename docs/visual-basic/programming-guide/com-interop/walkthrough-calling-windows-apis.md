---
title: "Procédure pas à pas : Appel des API Windows (Visual Basic) | Documents Microsoft"
ms.custom: 
ms.date: 2015-07-20
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology:
- devlang-visual-basic
ms.topic: article
dev_langs:
- VB
helpviewer_keywords:
- DLLs, calling
- Windows API, walkthroughs
- platform invoke, walkthroughs
- API calls, walkthroughs [Visual Basic]
- Windows API, calling
- walkthroughs [Visual Basic], API calls
- DllImport attribute, calling Windows API
- Declare statement, declaring DLL functions
ms.assetid: 9280ca96-7a93-47a3-8d01-6d01be0657cb
caps.latest.revision: 20
author: dotnet-bot
ms.author: dotnetcontent
translation.priority.ht:
- cs-cz
- de-de
- es-es
- fr-fr
- it-it
- ja-jp
- ko-kr
- pl-pl
- pt-br
- ru-ru
- tr-tr
- zh-cn
- zh-tw
ms.translationtype: Machine Translation
ms.sourcegitcommit: 9f5b8ebb69c9206ff90b05e748c64d29d82f7a16
ms.openlocfilehash: ae1ef60e6e27658c872689f5bfe2779493d42e7a
ms.contentlocale: fr-fr
ms.lasthandoff: 04/12/2017

---
# <a name="walkthrough-calling-windows-apis-visual-basic"></a><span data-ttu-id="6a8a6-102">Procédure pas à pas : appel des API Windows (Visual Basic)</span><span class="sxs-lookup"><span data-stu-id="6a8a6-102">Walkthrough: Calling Windows APIs (Visual Basic)</span></span>
<span data-ttu-id="6a8a6-103">Les API Windows sont des bibliothèques de liens dynamiques (DLL) qui font partie du système d’exploitation Windows.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-103">Windows APIs are dynamic-link libraries (DLLs) that are part of the Windows operating system.</span></span> <span data-ttu-id="6a8a6-104">Elles permettent d’effectuer des tâches lorsqu’il est difficile d’écrire des procédures équivalentes.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-104">You use them to perform tasks when it is difficult to write equivalent procedures of your own.</span></span> <span data-ttu-id="6a8a6-105">Par exemple, Windows propose une fonction nommée `FlashWindowEx` qui vous permet de rendre la barre de titre d’une application alterner entre les teintes claires et sombres.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-105">For example, Windows provides a function named `FlashWindowEx` that lets you make the title bar for an application alternate between light and dark shades.</span></span>  
  
 <span data-ttu-id="6a8a6-106">L’avantage de l’utilisation des API Windows dans votre code, qu’ils peuvent gagner du temps de développement parce qu’elles contiennent des douzaines de fonctions utiles déjà écrites et prêtes à être utilisées.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-106">The advantage of using Windows APIs in your code is that they can save development time because they contain dozens of useful functions that are already written and waiting to be used.</span></span> <span data-ttu-id="6a8a6-107">L’inconvénient est que les API Windows peuvent être difficiles à utiliser et implacables cas de problème.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-107">The disadvantage is that Windows APIs can be difficult to work with and unforgiving when things go wrong.</span></span>  
  
 <span data-ttu-id="6a8a6-108">Les API Windows représentent une catégorie spéciale d’interopérabilité.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-108">Windows APIs represent a special category of interoperability.</span></span> <span data-ttu-id="6a8a6-109">Les API Windows n’utilisent pas de code managé, n’ont pas intégrées de bibliothèques de types et utiliser des types de données qui sont différents de ceux utilisés avec Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-109">Windows APIs do not use managed code, do not have built-in type libraries, and use data types that are different than those used with Visual Studio.</span></span> <span data-ttu-id="6a8a6-110">En raison de ces différences, et comme les API Windows ne sont pas des objets COM, l’interopérabilité avec les API Windows et le [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] est effectuée à l’aide de la plate-forme invoke, ou PInvoke.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-110">Because of these differences, and because Windows APIs are not COM objects, interoperability with Windows APIs and the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] is performed using platform invoke, or PInvoke.</span></span> <span data-ttu-id="6a8a6-111">Appel de plateforme est un service qui permet au code managé appelle des fonctions non managées implémentées dans des DLL.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-111">Platform invoke is a service that enables managed code to call unmanaged functions implemented in DLLs.</span></span> <span data-ttu-id="6a8a6-112">Pour plus d’informations, consultez [consommation de fonctions DLL non managées](http://msdn.microsoft.com/library/eca7606e-ebfb-4f47-b8d9-289903fdc045).</span><span class="sxs-lookup"><span data-stu-id="6a8a6-112">For more information, see [Consuming Unmanaged DLL Functions](http://msdn.microsoft.com/library/eca7606e-ebfb-4f47-b8d9-289903fdc045).</span></span> <span data-ttu-id="6a8a6-113">Vous pouvez employer PInvoke dans [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] à l’aide du `Declare` instruction ou en appliquant la `DllImport` attribut à une procédure vide.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-113">You can use PInvoke in [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] by using either the `Declare` statement or applying the `DllImport` attribute to an empty procedure.</span></span>  
  
 <span data-ttu-id="6a8a6-114">Appels d’API Windows ont été une partie importante de [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] de programmation dans le passé, mais sont rarement nécessaires avec [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)].</span><span class="sxs-lookup"><span data-stu-id="6a8a6-114">Windows API calls were an important part of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] programming in the past, but are seldom necessary with [!INCLUDE[vbprvblong](../../../visual-basic/developing-apps/customizing-extending-my/includes/vbprvblong_md.md)].</span></span> <span data-ttu-id="6a8a6-115">Si possible, vous devez utiliser du code managé à partir de la [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] pour effectuer des tâches, au lieu d’appels d’API Windows.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-115">Whenever possible, you should use managed code from the [!INCLUDE[dnprdnshort](../../../csharp/getting-started/includes/dnprdnshort_md.md)] to perform tasks, instead of Windows API calls.</span></span> <span data-ttu-id="6a8a6-116">Cette procédure pas à pas fournit des informations pour les cas dans lesquels l’utilisation des API Windows est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-116">This walkthrough provides information for those situations in which using Windows APIs is necessary.</span></span>  
  
[!INCLUDE[note_settings_general](../../../csharp/language-reference/compiler-messages/includes/note_settings_general_md.md)]  
  
## <a name="api-calls-using-declare"></a><span data-ttu-id="6a8a6-117">Déclarent des appels d’API à l’aide de</span><span class="sxs-lookup"><span data-stu-id="6a8a6-117">API Calls Using Declare</span></span>  
 <span data-ttu-id="6a8a6-118">La méthode la plus courante d’appeler les API Windows consiste à utiliser la `Declare` instruction.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-118">The most common way to call Windows APIs is by using the `Declare` statement.</span></span>  
  
#### <a name="to-declare-a-dll-procedure"></a><span data-ttu-id="6a8a6-119">Pour déclarer une procédure DLL</span><span class="sxs-lookup"><span data-stu-id="6a8a6-119">To declare a DLL procedure</span></span>  
  
1.  <span data-ttu-id="6a8a6-120">Déterminer le nom de la fonction à appeler, ses arguments, types d’arguments et retourne une valeur, ainsi que le nom et l’emplacement de la DLL qui la contient.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-120">Determine the name of the function you want to call, plus its arguments, argument types, and return value, as well as the name and location of the DLL that contains it.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="6a8a6-121">Pour plus d’informations sur les API Windows, consultez la documentation du SDK Win32 dans l’API Windows Platform SDK.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-121">For complete information about the Windows APIs, see the Win32 SDK documentation in the Platform SDK Windows API.</span></span> <span data-ttu-id="6a8a6-122">Pour plus d’informations sur l’une des constantes API Windows, examinez les fichiers d’en-tête tels que Windows.h inclus avec le SDK de plate-forme.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-122">For more information about the constants that Windows APIs use, examine the header files such as Windows.h included with the Platform SDK.</span></span>  
  
2.  <span data-ttu-id="6a8a6-123">Ouvrez un nouveau projet d’Application Windows en cliquant sur **nouveau** sur la **fichier** menu, puis en cliquant sur **projet**.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-123">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="6a8a6-124">La boîte de dialogue **Nouveau projet** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-124">The **New Project** dialog box appears.</span></span>  
  
3.  <span data-ttu-id="6a8a6-125">Sélectionnez **Application Windows** dans la liste des [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] des modèles de projet.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-125">Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates.</span></span> <span data-ttu-id="6a8a6-126">Le nouveau projet s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-126">The new project is displayed.</span></span>  
  
4.  <span data-ttu-id="6a8a6-127">Ajoutez le code suivant `Declare` fonctionner à la classe ou le module dans lequel vous souhaitez utiliser la DLL :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-127">Add the following `Declare` function either to the class or module in which you want to use the DLL:</span></span>  
  
     <span data-ttu-id="6a8a6-128">[!code-vb[VbVbalrInterop&#9;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_1.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-128">[!code-vb[VbVbalrInterop#9](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_1.vb)]</span></span>  
  
### <a name="parts-of-the-declare-statement"></a><span data-ttu-id="6a8a6-129">Parties de l’instruction Declare</span><span class="sxs-lookup"><span data-stu-id="6a8a6-129">Parts of the Declare Statement</span></span>  
 <span data-ttu-id="6a8a6-130">La `Declare` instruction inclut les éléments suivants.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-130">The `Declare` statement includes the following elements.</span></span>  
  
#### <a name="auto-modifier"></a><span data-ttu-id="6a8a6-131">Modificateur Auto</span><span class="sxs-lookup"><span data-stu-id="6a8a6-131">Auto modifier</span></span>  
 <span data-ttu-id="6a8a6-132">Le `Auto` modificateur indique au runtime de convertir la chaîne basée sur le nom de la méthode en fonction des règles du common language runtime (ou nom d’alias si spécifié).</span><span class="sxs-lookup"><span data-stu-id="6a8a6-132">The `Auto` modifier instructs the runtime to convert the string based on the method name according to common language runtime rules (or alias name if specified).</span></span>  
  
#### <a name="lib-and-alias-keywords"></a><span data-ttu-id="6a8a6-133">Mots clés lib et Alias</span><span class="sxs-lookup"><span data-stu-id="6a8a6-133">Lib and Alias keywords</span></span>  
 <span data-ttu-id="6a8a6-134">Le nom qui suit le `Function` mot clé est le nom de votre programme utilise pour accéder à la fonction importée.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-134">The name following the `Function` keyword is the name your program uses to access the imported function.</span></span> <span data-ttu-id="6a8a6-135">Il peut être le même que le nom réel de la fonction que vous appelez, ou vous pouvez utiliser n’importe quel nom de procédure valide, le puis le `Alias` (mot clé) pour indiquer le nom réel de la fonction que vous appelez.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-135">It can be the same as the real name of the function you are calling, or you can use any valid procedure name and then employ the `Alias` keyword to specify the real name of the function you are calling.</span></span>  
  
 <span data-ttu-id="6a8a6-136">Spécifiez le `Lib` (mot clé), suivi par le nom et l’emplacement de la DLL qui contient la fonction que vous appelez.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-136">Specify the `Lib` keyword, followed by the name and location of the DLL that contains the function you are calling.</span></span> <span data-ttu-id="6a8a6-137">Il est inutile de spécifier le chemin d’accès pour les fichiers situés dans les répertoires système Windows.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-137">You do not need to specify the path for files located in the Windows system directories.</span></span>  
  
 <span data-ttu-id="6a8a6-138">Utilisez le `Alias` mot clé si le nom de la fonction que vous appelez n’est pas valide [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] nom de procédure, ou est en conflit avec le nom d’autres éléments dans votre application.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-138">Use the `Alias` keyword if the name of the function you are calling is not a valid [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] procedure name, or conflicts with the name of other items in your application.</span></span> <span data-ttu-id="6a8a6-139">`Alias`Indique le véritable nom de la fonction appelée.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-139">`Alias` indicates the true name of the function being called.</span></span>  
  
#### <a name="argument-and-data-type-declarations"></a><span data-ttu-id="6a8a6-140">Argument et les déclarations de Type de données</span><span class="sxs-lookup"><span data-stu-id="6a8a6-140">Argument and Data Type Declarations</span></span>  
 <span data-ttu-id="6a8a6-141">Déclarez les arguments et leurs types de données.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-141">Declare the arguments and their data types.</span></span> <span data-ttu-id="6a8a6-142">Cette partie peut être complexe, car les types de données que Windows utilise ne correspondent pas aux types de données Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-142">This part can be challenging because the data types that Windows uses do not correspond to Visual Studio data types.</span></span> [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="6a8a6-143">effectue une grande partie du travail pour vous en convertissant les arguments en types de données compatibles, un processus appelé *marshaling*.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-143"> does a lot of the work for you by converting arguments to compatible data types, a process called *marshaling*.</span></span> <span data-ttu-id="6a8a6-144">Vous pouvez contrôler explicitement la façon dont les arguments sont marshalés en utilisant le <xref:System.Runtime.InteropServices.MarshalAsAttribute>attribut défini dans le <xref:System.Runtime.InteropServices>espace de noms.</xref:System.Runtime.InteropServices> </xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="6a8a6-144">You can explicitly control how arguments are marshaled by using the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute defined in the <xref:System.Runtime.InteropServices> namespace.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="6a8a6-145">Les versions précédentes de [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] autorisé à déclarer des paramètres `As Any`, ce qui signifie que des données de toutes les données type peut être utilisé.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-145">Previous versions of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] allowed you to declare parameters `As Any`, meaning that data of any data type could be used.</span></span> [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="6a8a6-146">requiert que vous utilisiez un type de données spécifique pour toutes les `Declare` instructions.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-146"> requires that you use a specific data type for all `Declare` statements.</span></span>  
  
#### <a name="windows-api-constants"></a><span data-ttu-id="6a8a6-147">Constantes API Windows</span><span class="sxs-lookup"><span data-stu-id="6a8a6-147">Windows API Constants</span></span>  
 <span data-ttu-id="6a8a6-148">Certains arguments sont des combinaisons de constantes.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-148">Some arguments are combinations of constants.</span></span> <span data-ttu-id="6a8a6-149">Par exemple, le `MessageBox` API indiqué dans cette procédure pas à pas accepte un argument entier appelé `Typ` qui contrôle l’affichage de la boîte de message.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-149">For example, the `MessageBox` API shown in this walkthrough accepts an integer argument called `Typ` that controls how the message box is displayed.</span></span> <span data-ttu-id="6a8a6-150">Vous pouvez déterminer la valeur numérique de ces constantes en examinant les `#define` instructions dans le fichier WinUser.h.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-150">You can determine the numeric value of these constants by examining the `#define` statements in the file WinUser.h.</span></span> <span data-ttu-id="6a8a6-151">Les valeurs numériques sont généralement affichées au format hexadécimal, vous pouvez donc utiliser une calculatrice pour les ajouter et convertissez-la en nombre décimal.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-151">The numeric values are generally shown in hexadecimal, so you may want to use a calculator to add them and convert to decimal.</span></span> <span data-ttu-id="6a8a6-152">Par exemple, si vous voulez combiner les constantes pour le style exclamation `MB_ICONEXCLAMATION` 0 x 00000030 et Oui/aucun style `MB_YESNO` 0 x 00000004, vous pouvez ajouter les nombres et obtenir un résultat de 0 x 00000034, ou 52 décimales.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-152">For example, if you want to combine the constants for the exclamation style `MB_ICONEXCLAMATION` 0x00000030 and the Yes/No style `MB_YESNO` 0x00000004, you can add the numbers and get a result of 0x00000034, or 52 decimal.</span></span> <span data-ttu-id="6a8a6-153">Bien que vous pouvez utiliser directement le résultat en décimales, il est préférable de déclarer ces valeurs en tant que constantes dans votre application et de les combiner à l’aide de la `Or` (opérateur).</span><span class="sxs-lookup"><span data-stu-id="6a8a6-153">Although you can use the decimal result directly, it is better to declare these values as constants in your application and combine them using the `Or` operator.</span></span>  
  
###### <a name="to-declare-constants-for-windows-api-calls"></a><span data-ttu-id="6a8a6-154">Pour déclarer des constantes pour les appels d’API Windows</span><span class="sxs-lookup"><span data-stu-id="6a8a6-154">To declare constants for Windows API calls</span></span>  
  
1.  <span data-ttu-id="6a8a6-155">Consultez la documentation de la fonction Windows que vous appelez.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-155">Consult the documentation for the Windows function you are calling.</span></span> <span data-ttu-id="6a8a6-156">Déterminez le nom des constantes utilisées et le nom du fichier .h qui contient les valeurs numériques de ces constantes.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-156">Determine the name of the constants it uses and the name of the .h file that contains the numeric values for these constants.</span></span>  
  
2.  <span data-ttu-id="6a8a6-157">Utilisez un éditeur de texte tel que le bloc-notes, pour afficher le contenu du fichier d’en-tête (.h) et rechercher les valeurs associées aux constantes que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-157">Use a text editor, such as Notepad, to view the contents of the header (.h) file, and find the values associated with the constants you are using.</span></span> <span data-ttu-id="6a8a6-158">Par exemple, le `MessageBox` API utilise la constante `MB_ICONQUESTION` pour afficher un point d’interrogation dans la boîte de message.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-158">For example, the `MessageBox` API uses the constant `MB_ICONQUESTION` to show a question mark in the message box.</span></span> <span data-ttu-id="6a8a6-159">La définition de `MB_ICONQUESTION` se trouve dans WinUser.h et se présente comme suit :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-159">The definition for `MB_ICONQUESTION` is in WinUser.h and appears as follows:</span></span>  
  
     `#define MB_ICONQUESTION             0x00000020L`  
  
3.  <span data-ttu-id="6a8a6-160">Ajouter équivalent `Const` instructions pour votre classe ou module pour rendre ces constantes disponibles pour votre application.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-160">Add equivalent `Const` statements to your class or module to make these constants available to your application.</span></span> <span data-ttu-id="6a8a6-161">Exemple :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-161">For example:</span></span>  
  
     <span data-ttu-id="6a8a6-162">[!code-vb[VbVbalrInterop&#11;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_2.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-162">[!code-vb[VbVbalrInterop#11](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_2.vb)]</span></span>  
  
###### <a name="to-call-the-dll-procedure"></a><span data-ttu-id="6a8a6-163">Pour appeler la procédure DLL</span><span class="sxs-lookup"><span data-stu-id="6a8a6-163">To call the DLL procedure</span></span>  
  
1.  <span data-ttu-id="6a8a6-164">Ajoutez un bouton nommé `Button1` au démarrage du formulaire pour votre projet, puis double-cliquez dessus pour afficher son code.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-164">Add a button named `Button1` to the startup form for your project, and then double-click it to view its code.</span></span> <span data-ttu-id="6a8a6-165">Le Gestionnaire d’événements pour le bouton s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-165">The event handler for the button is displayed.</span></span>  
  
2.  <span data-ttu-id="6a8a6-166">Ajoutez le code pour le `Click` Gestionnaire d’événements pour le bouton que vous avez ajouté pour appeler la procédure et indiquez les arguments appropriés :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-166">Add code to the `Click` event handler for the button you added, to call the procedure and provide the appropriate arguments:</span></span>  
  
     <span data-ttu-id="6a8a6-167">[!code-vb[VbVbalrInterop&#12;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_3.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-167">[!code-vb[VbVbalrInterop#12](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_3.vb)]</span></span>  
  
3.  <span data-ttu-id="6a8a6-168">Exécutez le projet en appuyant sur F5.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-168">Run the project by pressing F5.</span></span> <span data-ttu-id="6a8a6-169">La boîte de message s’affiche avec les deux **Oui** et **non** boutons de réponse.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-169">The message box is displayed with both **Yes** and **No** response buttons.</span></span> <span data-ttu-id="6a8a6-170">Cliquez sur l’un.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-170">Click either one.</span></span>  
  
#### <a name="data-marshaling"></a><span data-ttu-id="6a8a6-171">Marshaling de données</span><span class="sxs-lookup"><span data-stu-id="6a8a6-171">Data Marshaling</span></span>  
 [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)]<span data-ttu-id="6a8a6-172">Convertit les types de données des paramètres et valeurs de retour pour les appels d’API Windows, mais vous pouvant utiliser automatiquement les `MarshalAs` attribut pour spécifier explicitement les types de données non managés attendus par une API.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-172"> automatically converts the data types of parameters and return values for Windows API calls, but you can use the `MarshalAs` attribute to explicitly specify unmanaged data types that an API expects.</span></span> <span data-ttu-id="6a8a6-173">Pour plus d’informations sur le marshaling d’interopérabilité, consultez [Marshaling d’interopérabilité](http://msdn.microsoft.com/library/115f7a2f-d422-4605-ab36-13a8dd28142a).</span><span class="sxs-lookup"><span data-stu-id="6a8a6-173">For more information about interop marshaling, see [Interop Marshaling](http://msdn.microsoft.com/library/115f7a2f-d422-4605-ab36-13a8dd28142a).</span></span>  
  
###### <a name="to-use-declare-and-marshalas-in-an-api-call"></a><span data-ttu-id="6a8a6-174">Pour utiliser Declare et MarshalAs dans un appel d’API</span><span class="sxs-lookup"><span data-stu-id="6a8a6-174">To use Declare and MarshalAs in an API call</span></span>  
  
1.  <span data-ttu-id="6a8a6-175">Déterminer le nom de la fonction à appeler, ses arguments, types de données, et la valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-175">Determine the name of the function you want to call, plus its arguments, data types, and return value.</span></span>  
  
2.  <span data-ttu-id="6a8a6-176">Pour simplifier l’accès à la `MarshalAs` d’attribut, ajoutez un `Imports` en haut du code de la classe ou du module, comme dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-176">To simplify access to the `MarshalAs` attribute, add an `Imports` statement to the top of the code for the class or module, as in the following example:</span></span>  
  
     <span data-ttu-id="6a8a6-177">[!code-vb[VbVbalrInterop&#13;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-177">[!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span></span>  
  
3.  <span data-ttu-id="6a8a6-178">Ajoutez un prototype de fonction pour la fonction importée à la classe ou le module que vous utilisez et appliquerez les `MarshalAs` les paramètres de l’attribut ou la valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-178">Add a function prototype for the imported function to the class or module you are using, and apply the `MarshalAs` attribute to the parameters or return value.</span></span> <span data-ttu-id="6a8a6-179">Dans l’exemple suivant, un appel API qui attend le type `void*` est marshalé en tant que `AsAny`:</span><span class="sxs-lookup"><span data-stu-id="6a8a6-179">In the following example, an API call that expects the type `void*` is marshaled as `AsAny`:</span></span>  
  
     <span data-ttu-id="6a8a6-180">[!code-vb[VbVbalrInterop&#14;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_5.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-180">[!code-vb[VbVbalrInterop#14](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_5.vb)]</span></span>  
  
## <a name="api-calls-using-dllimport"></a><span data-ttu-id="6a8a6-181">Les appels d’API à l’aide de DllImport</span><span class="sxs-lookup"><span data-stu-id="6a8a6-181">API Calls Using DllImport</span></span>  
 <span data-ttu-id="6a8a6-182">Le `DllImport` attribut offre un deuxième moyen pour appeler des fonctions dans les DLL sans bibliothèque de types.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-182">The `DllImport` attribute provides a second way to call functions in DLLs without type libraries.</span></span> <span data-ttu-id="6a8a6-183">`DllImport`équivaut à peu près à utiliser une `Declare` instruction mais fournit plus de contrôle sur la façon dont les fonctions sont appelées.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-183">`DllImport` is roughly equivalent to using a `Declare` statement but provides more control over how functions are called.</span></span>  
  
 <span data-ttu-id="6a8a6-184">Vous pouvez utiliser `DllImport` avec la plupart des API Windows appelle tant que l’appel fait référence à un élément partagé (parfois appelé *statique*) méthode.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-184">You can use `DllImport` with most Windows API calls as long as the call refers to a shared (sometimes called *static*) method.</span></span> <span data-ttu-id="6a8a6-185">Vous ne pouvez pas utiliser des méthodes qui requièrent une instance d’une classe.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-185">You cannot use methods that require an instance of a class.</span></span> <span data-ttu-id="6a8a6-186">Contrairement aux `Declare` instructions, `DllImport` appelle ne peut pas utiliser le `MarshalAs` attribut.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-186">Unlike `Declare` statements, `DllImport` calls cannot use the `MarshalAs` attribute.</span></span>  
  
#### <a name="to-call-a-windows-api-using-the-dllimport-attribute"></a><span data-ttu-id="6a8a6-187">Pour appeler une API Windows à l’aide de l’attribut DllImport</span><span class="sxs-lookup"><span data-stu-id="6a8a6-187">To call a Windows API using the DllImport attribute</span></span>  
  
1.  <span data-ttu-id="6a8a6-188">Ouvrez un nouveau projet d’Application Windows en cliquant sur **nouveau** sur la **fichier** menu, puis en cliquant sur **projet**.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-188">Open a new Windows Application project by clicking **New** on the **File** menu, and then clicking **Project**.</span></span> <span data-ttu-id="6a8a6-189">La boîte de dialogue **Nouveau projet** s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-189">The **New Project** dialog box appears.</span></span>  
  
2.  <span data-ttu-id="6a8a6-190">Sélectionnez **Application Windows** dans la liste des [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] des modèles de projet.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-190">Select **Windows Application** from the list of [!INCLUDE[vbprvb](../../../csharp/programming-guide/concepts/linq/includes/vbprvb_md.md)] project templates.</span></span> <span data-ttu-id="6a8a6-191">Le nouveau projet s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-191">The new project is displayed.</span></span>  
  
3.  <span data-ttu-id="6a8a6-192">Ajoutez un bouton nommé `Button2` pour le formulaire de démarrage.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-192">Add a button named `Button2` to the startup form.</span></span>  
  
4.  <span data-ttu-id="6a8a6-193">Double-cliquez sur `Button2` pour afficher le code du formulaire.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-193">Double-click `Button2` to open the code view for the form.</span></span>  
  
5.  <span data-ttu-id="6a8a6-194">Pour simplifier l’accès à `DllImport`, ajoutez une `Imports` en haut du code de la classe de formulaire de démarrage :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-194">To simplify access to `DllImport`, add an `Imports` statement to the top of the code for the startup form class:</span></span>  
  
     <span data-ttu-id="6a8a6-195">[!code-vb[VbVbalrInterop&#13;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-195">[!code-vb[VbVbalrInterop#13](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_4.vb)]</span></span>  
  
6.  <span data-ttu-id="6a8a6-196">Déclarez une fonction vide qui précède le `End Class` instruction pour le formulaire et le nom de la fonction `MoveFile`.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-196">Declare an empty function preceding the `End Class` statement for the form, and name the function `MoveFile`.</span></span>  
  
7.  <span data-ttu-id="6a8a6-197">Appliquer le `Public` et `Shared` modificateurs de la déclaration de fonction et définissez des paramètres pour `MoveFile` basée sur les arguments de la fonction API Windows utilise :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-197">Apply the `Public` and `Shared` modifiers to the function declaration and set parameters for `MoveFile` based on the arguments the Windows API function uses:</span></span>  
  
     <span data-ttu-id="6a8a6-198">[!code-vb[VbVbalrInterop&#16;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_6.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-198">[!code-vb[VbVbalrInterop#16](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_6.vb)]</span></span>  
  
     <span data-ttu-id="6a8a6-199">Votre fonction peut avoir n’importe quel nom de procédure valide ; le `DllImport` attribut spécifie le nom de la DLL.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-199">Your function can have any valid procedure name; the `DllImport` attribute specifies the name in the DLL.</span></span> <span data-ttu-id="6a8a6-200">Il gère également le marshaling d’interopérabilité pour les paramètres et valeurs de retour, vous pouvez sélectionner les types de données de Visual Studio qui sont similaires aux données des types de l’API utilise.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-200">It also handles interoperability marshaling for the parameters and return values, so you can choose Visual Studio data types that are similar to the data types the API uses.</span></span>  
  
8.  <span data-ttu-id="6a8a6-201">Appliquer les `DllImport` d’attribut à la fonction vide.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-201">Apply the `DllImport` attribute to the empty function.</span></span> <span data-ttu-id="6a8a6-202">Le premier paramètre est le nom et l’emplacement de la DLL contenant la fonction que vous appelez.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-202">The first parameter is the name and location of the DLL containing the function you are calling.</span></span> <span data-ttu-id="6a8a6-203">Il est inutile de spécifier le chemin d’accès pour les fichiers situés dans les répertoires système Windows.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-203">You do not need to specify the path for files located in the Windows system directories.</span></span> <span data-ttu-id="6a8a6-204">Le deuxième paramètre est un argument nommé qui spécifie le nom de la fonction dans l’API Windows.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-204">The second parameter is a named argument that specifies the name of the function in the Windows API.</span></span> <span data-ttu-id="6a8a6-205">Dans cet exemple, le `DllImport` attribut force les appels à `MoveFile` transmis à `MoveFileW` dans KERNEL32. DLL.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-205">In this example, the `DllImport` attribute forces calls to `MoveFile` to be forwarded to `MoveFileW` in KERNEL32.DLL.</span></span> <span data-ttu-id="6a8a6-206">Le `MoveFileW` méthode copie un fichier à partir du chemin `src` le chemin d’accès `dst`.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-206">The `MoveFileW` method copies a file from the path `src` to the path `dst`.</span></span>  
  
     <span data-ttu-id="6a8a6-207">[!code-vb[VbVbalrInterop&#17;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_7.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-207">[!code-vb[VbVbalrInterop#17](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_7.vb)]</span></span>  
  
9. <span data-ttu-id="6a8a6-208">Ajoutez le code pour le `Button2_Click` Gestionnaire d’événements pour appeler la fonction :</span><span class="sxs-lookup"><span data-stu-id="6a8a6-208">Add code to the `Button2_Click` event handler to call the function:</span></span>  
  
     <span data-ttu-id="6a8a6-209">[!code-vb[VbVbalrInterop&#18;](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_8.vb)]</span><span class="sxs-lookup"><span data-stu-id="6a8a6-209">[!code-vb[VbVbalrInterop#18](../../../visual-basic/programming-guide/com-interop/codesnippet/VisualBasic/walkthrough-calling-windows-apis_8.vb)]</span></span>  
  
10. <span data-ttu-id="6a8a6-210">Créez un fichier nommé Test.txt et placez-le dans le répertoire C:\Tmp de votre disque dur.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-210">Create a file named Test.txt and place it in the C:\Tmp directory on your hard drive.</span></span> <span data-ttu-id="6a8a6-211">Créez le répertoire Tmp si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-211">Create the Tmp directory if necessary.</span></span>  
  
11. <span data-ttu-id="6a8a6-212">Appuyez sur F5 pour démarrer l'application.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-212">Press F5 to start the application.</span></span> <span data-ttu-id="6a8a6-213">Le formulaire principal s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-213">The main form appears.</span></span>  
  
12. <span data-ttu-id="6a8a6-214">Cliquez sur **Button2**.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-214">Click **Button2**.</span></span> <span data-ttu-id="6a8a6-215">Le message « le fichier a été déplacé avec succès » s’affiche si le fichier peut être déplacé.</span><span class="sxs-lookup"><span data-stu-id="6a8a6-215">The message "The file was moved successfully" is displayed if the file can be moved.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="6a8a6-216">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="6a8a6-216">See Also</span></span>  
 <span data-ttu-id="6a8a6-217"><xref:System.Runtime.InteropServices.DllImportAttribute></xref:System.Runtime.InteropServices.DllImportAttribute></span><span class="sxs-lookup"><span data-stu-id="6a8a6-217"><xref:System.Runtime.InteropServices.DllImportAttribute></span></span>   
 <span data-ttu-id="6a8a6-218"><xref:System.Runtime.InteropServices.MarshalAsAttribute></xref:System.Runtime.InteropServices.MarshalAsAttribute></span><span class="sxs-lookup"><span data-stu-id="6a8a6-218"><xref:System.Runtime.InteropServices.MarshalAsAttribute></span></span>   
<span data-ttu-id="6a8a6-219"> [Declare (instruction)](../../../visual-basic/language-reference/statements/declare-statement.md) </span><span class="sxs-lookup"><span data-stu-id="6a8a6-219"> [Declare Statement](../../../visual-basic/language-reference/statements/declare-statement.md) </span></span>  
<span data-ttu-id="6a8a6-220"> [Auto](../../../visual-basic/language-reference/modifiers/auto.md) </span><span class="sxs-lookup"><span data-stu-id="6a8a6-220"> [Auto](../../../visual-basic/language-reference/modifiers/auto.md) </span></span>  
<span data-ttu-id="6a8a6-221"> [Alias](../../../visual-basic/language-reference/statements/alias-clause.md) </span><span class="sxs-lookup"><span data-stu-id="6a8a6-221"> [Alias](../../../visual-basic/language-reference/statements/alias-clause.md) </span></span>  
<span data-ttu-id="6a8a6-222"> [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md) </span><span class="sxs-lookup"><span data-stu-id="6a8a6-222"> [COM Interop](../../../visual-basic/programming-guide/com-interop/index.md) </span></span>  
<span data-ttu-id="6a8a6-223"> [Création de Prototypes dans du Code managé](http://msdn.microsoft.com/library/ecdcf25d-cae3-4f07-a2b6-8397ac6dc42d) </span><span class="sxs-lookup"><span data-stu-id="6a8a6-223"> [Creating Prototypes in Managed Code](http://msdn.microsoft.com/library/ecdcf25d-cae3-4f07-a2b6-8397ac6dc42d) </span></span>  
<span data-ttu-id="6a8a6-224"> [Marshaling d’un délégué comme méthode de rappel](http://msdn.microsoft.com/library/6ddd7866-9804-4571-84de-83f5cc017a5a)</span><span class="sxs-lookup"><span data-stu-id="6a8a6-224"> [Marshaling a Delegate as a Callback Method](http://msdn.microsoft.com/library/6ddd7866-9804-4571-84de-83f5cc017a5a)</span></span>
