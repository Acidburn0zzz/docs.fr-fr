---
title: "Les valeurs de retour de référence et variables locales ref (Guide C#)"
description: "Découvrir comment définir et utiliser des valeurs de retour de référence et des variables locales ref"
author: rpetrusha
ms.author: ronpet
ms.date: 05/30/2017
ms.topic: article
ms.prod: .net
ms.technology: devlang-csharp
ms.devlang: csharp
ms.assetid: 18cf7a4b-29f0-4b14-85b8-80af754aabd8
ms.openlocfilehash: 1d8fb092b578602b5d4f791a3fd14f47dfae1ba6
ms.sourcegitcommit: 7e99f66ef09d2903e22c789c67ff5a10aa953b2f
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/18/2017
---
# <a name="ref-returns-and-ref-locals"></a><span data-ttu-id="26a2c-103">Retours ref et variables locales ref</span><span class="sxs-lookup"><span data-stu-id="26a2c-103">Ref returns and ref locals</span></span>

<span data-ttu-id="26a2c-104">À compter de C# 7, C# prend en charge les valeurs de retour de référence (retours ref).</span><span class="sxs-lookup"><span data-stu-id="26a2c-104">Starting with C# 7, C# supports reference return values (ref returns).</span></span> <span data-ttu-id="26a2c-105">Une valeur de retour de référence permet à une méthode de retourner à un appelant une référence à un objet, plutôt qu’à une valeur.</span><span class="sxs-lookup"><span data-stu-id="26a2c-105">A reference return value allows a method to return a reference to an object, rather than a value, back to a caller.</span></span> <span data-ttu-id="26a2c-106">L’appelant peut alors choisir de traiter l’objet retourné comme s’il était retourné par valeur ou par référence.</span><span class="sxs-lookup"><span data-stu-id="26a2c-106">The caller can then choose to treat the returned object returned as if it were returned by value or by reference.</span></span> <span data-ttu-id="26a2c-107">Une valeur retournée par référence que l’appelant gère comme une référence plutôt que comme une valeur est une variable locale ref.</span><span class="sxs-lookup"><span data-stu-id="26a2c-107">A value returned by reference that the caller handles as a reference rather than a value is a ref local.</span></span>

## <a name="what-is-a-reference-return-value"></a><span data-ttu-id="26a2c-108">Qu’est-ce qu’une valeur de retour de référence ?</span><span class="sxs-lookup"><span data-stu-id="26a2c-108">What is a reference return value?</span></span>

<span data-ttu-id="26a2c-109">La plupart des développeurs sont familiarisés avec le passage d’un argument à une méthode appelée *par référence*.</span><span class="sxs-lookup"><span data-stu-id="26a2c-109">Most developers are familiar with passing an argument to a called method *by reference*.</span></span> <span data-ttu-id="26a2c-110">La liste d’arguments d’une méthode appelée comprend une valeur passée par référence, et toute modification apportée à sa valeur par la méthode appelée est retournée à l’appelant.</span><span class="sxs-lookup"><span data-stu-id="26a2c-110">A called method's argument list includes a value passed by reference, and any changes made to its value by the called method are returned to the caller.</span></span> <span data-ttu-id="26a2c-111">Une *valeur de retour de référence* est le contraire :</span><span class="sxs-lookup"><span data-stu-id="26a2c-111">A *reference return value* is the opposite:</span></span>

- <span data-ttu-id="26a2c-112">La valeur de retour de la méthode appelée est une référence, et non pas un argument qui lui est passé.</span><span class="sxs-lookup"><span data-stu-id="26a2c-112">The called method's return value, rather than an argument passed to it, is a reference.</span></span>

- <span data-ttu-id="26a2c-113">L’appelant, et non pas la méthode appelée, peut modifier la valeur retournée par la méthode.</span><span class="sxs-lookup"><span data-stu-id="26a2c-113">The caller, rather than the called method, can modify the value returned by the method.</span></span>

- <span data-ttu-id="26a2c-114">Au lieu que les modifications apportées à l’argument soient reflétées dans l’état de l’objet sur l’appelant, les modifications apportées à la valeur de retour de la méthode par l’appelant sont reflétées dans l’état de l’objet dont la méthode a été appelée.</span><span class="sxs-lookup"><span data-stu-id="26a2c-114">Instead of modifications to the argument that are reflected in state of the object on the caller, modifications to the method's return value by the caller are reflected in the state of the object whose method was called.</span></span>

<span data-ttu-id="26a2c-115">Les valeurs de retour de référence peuvent produire du code plus compact, et permettre également à un objet d’exposer uniquement les éléments de données individuels, tels que d’un élément de tableau, qui sont dignes d’intérêt pour l’appelant.</span><span class="sxs-lookup"><span data-stu-id="26a2c-115">Reference return values can produce more compact code, as well as allow an object to expose only the individual data items, such as an array element, that are of interest to the caller.</span></span> <span data-ttu-id="26a2c-116">Cela réduit la probabilité que l’appelant modifie par inadvertance l’état de l’objet.</span><span class="sxs-lookup"><span data-stu-id="26a2c-116">This reduces the likelihood that the caller will inadvertently modify the object's state.</span></span>

<span data-ttu-id="26a2c-117">Certaines restrictions s’appliquent à la valeur qu’une méthode peut retourner comme valeur de retour de référence.</span><span class="sxs-lookup"><span data-stu-id="26a2c-117">There are some restrictions on the value that a method can return as a reference return value.</span></span> <span data-ttu-id="26a2c-118">Elles incluent notamment :</span><span class="sxs-lookup"><span data-stu-id="26a2c-118">These include:</span></span>

- <span data-ttu-id="26a2c-119">La valeur de retour ne peut pas être `void`.</span><span class="sxs-lookup"><span data-stu-id="26a2c-119">The return value cannot be `void`.</span></span> <span data-ttu-id="26a2c-120">Une tentative de définition d’une méthode avec une valeur de retour de référence `void` génère l’erreur du compilateur CS1547, « Le mot clé 'void' ne peut pas être utilisé dans ce contexte ».</span><span class="sxs-lookup"><span data-stu-id="26a2c-120">Attempting to define a method with a `void` reference return value generates compiler error CS1547, "Keyword 'void' cannot be used in this context."</span></span>
 
- <span data-ttu-id="26a2c-121">La valeur de retour ne peut pas être une variable locale dans la méthode qui la retourne. Elle doit avoir une portée située en dehors de la méthode qui la retourne.</span><span class="sxs-lookup"><span data-stu-id="26a2c-121">The return value cannot be a local variable in the method that returns it; it must have a scope that is outside the method that returns it.</span></span> <span data-ttu-id="26a2c-122">Il peut s’agir d’un champ d’instance ou statique d’une classe, ou bien un argument passé à la méthode.</span><span class="sxs-lookup"><span data-stu-id="26a2c-122">It can be an instance or static field of a class, or it can be an argument passed to the method.</span></span> <span data-ttu-id="26a2c-123">Une tentative de retour d’une variable locale génère l’erreur du compilateur CS8168, « Impossible de retourner la variable locale 'obj' par référence, car il ne s’agit pas d’une variable locale de référence ».</span><span class="sxs-lookup"><span data-stu-id="26a2c-123">Attempting to return a local variable generates compiler error CS8168, "Cannot return local 'obj' by reference because it is not a ref local."</span></span>

- <span data-ttu-id="26a2c-124">La valeur de retour ne peut pas être `null`.</span><span class="sxs-lookup"><span data-stu-id="26a2c-124">The return value cannot be a `null`.</span></span> <span data-ttu-id="26a2c-125">Une tentative de retour de `null` génère l’erreur du compilateur CS8156, « Impossible d’utiliser une expression dans ce contexte, car elle ne peut pas être retournée par référence ».</span><span class="sxs-lookup"><span data-stu-id="26a2c-125">Attempting to return `null` generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

   <span data-ttu-id="26a2c-126">Si une méthode avec un retour ref doit retourner une valeur null, vous pouvez retourner une valeur null (non instanciée) pour un type référence ou un [type nullable](../nullable-types/index.md) pour un type valeur.</span><span class="sxs-lookup"><span data-stu-id="26a2c-126">If a method with a ref return needs to return a null value, you can either return a null (uninstantiated) value for a reference type or a [nullable type](../nullable-types/index.md) for a value type.</span></span>
 
- <span data-ttu-id="26a2c-127">La valeur de retour ne peut pas être une constante, un membre d’énumération ou une propriété d’un `class` ou d’un `struct`.</span><span class="sxs-lookup"><span data-stu-id="26a2c-127">The return value cannot be a constant, an enumeration member, or a property of a `class` or `struct`.</span></span> <span data-ttu-id="26a2c-128">Une tentative de retour de ces éléments génère l’erreur du compilateur CS8156, « Impossible d’utiliser une expression dans ce contexte, car elle ne peut pas être retournée par référence ».</span><span class="sxs-lookup"><span data-stu-id="26a2c-128">Attempting to return these generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

<span data-ttu-id="26a2c-129">De plus, étant donné qu’une méthode asynchrone peut retourner une valeur avant que son exécution soit terminée, alors que sa valeur de retour est toujours inconnue, les valeurs de retour de référence ne sont pas autorisées sur les méthodes async.</span><span class="sxs-lookup"><span data-stu-id="26a2c-129">In addition, because an asynchronous method may return before it has finished execution, while its return value is still unknown, reference return values are not allowed on async methods.</span></span>
 
## <a name="defining-a-ref-return-value"></a><span data-ttu-id="26a2c-130">Définition d’une valeur de retour de référence</span><span class="sxs-lookup"><span data-stu-id="26a2c-130">Defining a ref return value</span></span>

<span data-ttu-id="26a2c-131">Vous définissez une valeur de retour de référence en ajoutant le mot clé [ref](../../language-reference/keywords/ref.md) au type de retour de la signature de méthode.</span><span class="sxs-lookup"><span data-stu-id="26a2c-131">You define a ref return value by adding the [ref](../../language-reference/keywords/ref.md) keyword to the return type of the method signature.</span></span> <span data-ttu-id="26a2c-132">Par exemple, la signature suivante indique que la propriété `GetContactInformation` retourne une référence à un objet `Person` à l’appelant :</span><span class="sxs-lookup"><span data-stu-id="26a2c-132">For example, the following signature indicates that the `GetContactInformation` property returns a reference to a `Person` object to the caller:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname);
```

<span data-ttu-id="26a2c-133">De plus, le nom de l’objet retourné par chaque instruction [return](../../language-reference/keywords/return.md) dans le corps de la méthode doit être précédé du mot clé [ref](../../language-reference/keywords/ref.md).</span><span class="sxs-lookup"><span data-stu-id="26a2c-133">In addition, the name of the object returned by each [return](../../language-reference/keywords/return.md) statement in the method body must be preceded by the [ref](../../language-reference/keywords/ref.md) keyword.</span></span> <span data-ttu-id="26a2c-134">Par exemple, l’instruction `return` suivante retourne un objet `Person` nommé `p` par référence :</span><span class="sxs-lookup"><span data-stu-id="26a2c-134">For example, the following `return` statement returns a `Person` object named `p` by reference:</span></span>

```csharp
return ref p;
```

## <a name="consuming-a-ref-return-value"></a><span data-ttu-id="26a2c-135">Utilisation d’une valeur de retour de référence</span><span class="sxs-lookup"><span data-stu-id="26a2c-135">Consuming a ref return value</span></span>

<span data-ttu-id="26a2c-136">Un appelant peut gérer une valeur de retour de référence de deux manières :</span><span class="sxs-lookup"><span data-stu-id="26a2c-136">A caller can handle a ref return value in either of two ways:</span></span>

- <span data-ttu-id="26a2c-137">Comme une valeur ordinaire retournée par valeur à partir d’une méthode.</span><span class="sxs-lookup"><span data-stu-id="26a2c-137">As an ordinary value returned by value from a method.</span></span> <span data-ttu-id="26a2c-138">L’appelant peut choisir d’ignorer que la valeur de retour est une valeur de retour de référence.</span><span class="sxs-lookup"><span data-stu-id="26a2c-138">The caller can choose to ignore that the return value is a reference return value.</span></span> <span data-ttu-id="26a2c-139">Dans ce cas, toute modification apportée à la valeur retournée par l’appel de méthode n’est pas reflétée dans l’état du type appelé.</span><span class="sxs-lookup"><span data-stu-id="26a2c-139">In this case, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span> <span data-ttu-id="26a2c-140">Si la valeur retournée est un type valeur, toute modification apportée à la valeur retournée par l’appel de méthode n’est pas reflétée dans l’état du type appelé.</span><span class="sxs-lookup"><span data-stu-id="26a2c-140">If the returned value is a value type, any changes made to the value returned by the method call are not reflected in the state of the called type.</span></span>

- <span data-ttu-id="26a2c-141">Comme valeur de retour de référence.</span><span class="sxs-lookup"><span data-stu-id="26a2c-141">As a reference return value.</span></span> <span data-ttu-id="26a2c-142">L’appelant doit définir la variable à laquelle la valeur de retour de référence est affectée comme une [variable locale ref](#ref-local), et toute modification apportée à la valeur retournée par l’appel de méthode est reflétée dans l’état du type appelé.</span><span class="sxs-lookup"><span data-stu-id="26a2c-142">The caller must define the variable to which the reference return value is assigned as a [ref local](#ref-local), and any changes to the value returned by the method call are reflected in the state of the called type.</span></span> 

## <a name="ref-locals"></a><span data-ttu-id="26a2c-143">Variables locales ref</span><span class="sxs-lookup"><span data-stu-id="26a2c-143">Ref locals</span></span>

<span data-ttu-id="26a2c-144">Pour gérer la valeur de retour de référence comme une référence, l’appelant doit déclarer la valeur comme étant une *variable locale ref* à l’aide du mot clé `ref`.</span><span class="sxs-lookup"><span data-stu-id="26a2c-144">To handle the reference return value as a reference, the caller must declare the value to be a *ref local* by using the `ref` keyword.</span></span> <span data-ttu-id="26a2c-145">Par exemple, si la valeur retournée par la méthode `Person.GetContactInfomation` doit être utilisée comme une référence plutôt que comme une valeur, l’appel de la méthode se présente ainsi :</span><span class="sxs-lookup"><span data-stu-id="26a2c-145">For example, if the value returned by the `Person.GetContactInfomation` method is to be consumed as a reference rather than a value, the method call appears as:</span></span>

```csharp
ref Person p = ref contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="26a2c-146">Notez que le mot clé `ref` est utilisé à la fois avant la déclaration de la variable locale *et* avant l’appel de la méthode.</span><span class="sxs-lookup"><span data-stu-id="26a2c-146">Note that the `ref` keyword is used both before the local variable declaration *and* before the method call.</span></span> <span data-ttu-id="26a2c-147">Si les deux mots clés `ref` ne sont pas inclus dans la déclaration et l’affectation de la variable, l’erreur du compilateur CS8172, « Impossible d’initialiser une variable par référence avec une valeur » est générée.</span><span class="sxs-lookup"><span data-stu-id="26a2c-147">Failure to include both `ref` keywords in the variable declaration and assignment results in compiler error CS8172, "Cannot initialize a by-reference variable with a value."</span></span> 
 
<span data-ttu-id="26a2c-148">Les modifications ultérieures apportées à l’objet `Person` retourné par la méthode sont reflétées dans l’objet `contacts`.</span><span class="sxs-lookup"><span data-stu-id="26a2c-148">Subsequent changes to the `Person` object returned by the method are reflected in the `contacts` object.</span></span>

<span data-ttu-id="26a2c-149">Si `p` n’est pas défini comme une variable locale ref à l’aide du mot clé `ref`, toute modification apportée à `p` par l’appelant n’est pas reflétée dans l’objet `contacts`.</span><span class="sxs-lookup"><span data-stu-id="26a2c-149">If `p` is not defined as a ref local by using the `ref` keyword, any changes made to `p` by the caller are not reflected in the `contacts` object.</span></span>
 
## <a name="ref-returns-and-ref-locals-an-example"></a><span data-ttu-id="26a2c-150">Retours ref et variables locales ref : exemple</span><span class="sxs-lookup"><span data-stu-id="26a2c-150">Ref returns and ref locals: an example</span></span>

<span data-ttu-id="26a2c-151">L’exemple suivant définit une classe `NumberStore` qui stocke un tableau de valeurs entières.</span><span class="sxs-lookup"><span data-stu-id="26a2c-151">The following example defines a `NumberStore` class that stores an array of integer values.</span></span> <span data-ttu-id="26a2c-152">La méthode `FindNumber` retourne par référence le premier nombre supérieur ou égal au nombre passé comme argument.</span><span class="sxs-lookup"><span data-stu-id="26a2c-152">The `FindNumber` method returns by reference the first number that is greater than or equal to the number passed as an argument.</span></span> <span data-ttu-id="26a2c-153">Si aucun nombre n’est supérieur ou égal à l’argument, la méthode retourne le nombre se trouvant à l’index 0.</span><span class="sxs-lookup"><span data-stu-id="26a2c-153">If no number is greater than or equal to the argument, the method returns the number in index 0.</span></span> 

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#1)]

<span data-ttu-id="26a2c-154">L’exemple suivant appelle la méthode `NumberStore.FindNumber` pour récupérer la première valeur supérieure ou égale à 16.</span><span class="sxs-lookup"><span data-stu-id="26a2c-154">The following example calls the `NumberStore.FindNumber` method to retrieve the first value that is greater than or equal to 16.</span></span> <span data-ttu-id="26a2c-155">L’appelant multiplie ensuite par deux la valeur retournée par la méthode.</span><span class="sxs-lookup"><span data-stu-id="26a2c-155">The caller then doubles the value returned by the method.</span></span> <span data-ttu-id="26a2c-156">Comme le montre la sortie de l’exemple, cette modification est reflétée dans la valeur des éléments de tableau de l’instance `NumberStore`.</span><span class="sxs-lookup"><span data-stu-id="26a2c-156">As the output from the example shows, this change is reflected in the value of the array elements of the `NumberStore` instance.</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#2)]

<span data-ttu-id="26a2c-157">Si les valeurs de retour de référence ne sont pas prises en charge, une telle opération est généralement effectuée en retournant l’index de l’élément de tableau ainsi que sa valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="26a2c-157">Without support for reference return values, such an operation is usually performed by returning the index of the array element along with its value.</span></span> <span data-ttu-id="26a2c-158">L’appelant peut ensuite utiliser cet index pour modifier la valeur dans un appel de méthode distinct.</span><span class="sxs-lookup"><span data-stu-id="26a2c-158">The caller can then use this index to modify the value in a separate method call.</span></span> <span data-ttu-id="26a2c-159">Toutefois, l’appelant peut également modifier l’index pour accéder à d’autres valeurs de tableau et éventuellement les modifier.</span><span class="sxs-lookup"><span data-stu-id="26a2c-159">However, the caller can also modify the index to access and possibly modify other array values.</span></span>  
 
## <a name="see-also"></a><span data-ttu-id="26a2c-160">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="26a2c-160">See also</span></span>

[<span data-ttu-id="26a2c-161">ref, mot clé</span><span class="sxs-lookup"><span data-stu-id="26a2c-161">ref keyword</span></span>](../../language-reference/keywords/ref.md)
