---
title: "Les valeurs de retour de référence et variables locales ref (Guide C#)"
description: "Découvrir comment définir et utiliser des valeurs de retour de référence et des variables locales ref"
author: rpetrusha
ms.author: ronpet
ms.date: 01/23/2017
ms.topic: article
ms.prod: .net
ms.technology: devlang-csharp
ms.devlang: csharp
ms.openlocfilehash: a74563c0d24b6cd2a2fa8534787f078f3cc92674
ms.sourcegitcommit: cf22b29db780e532e1090c6e755aa52d28273fa6
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/01/2018
---
# <a name="ref-returns-and-ref-locals"></a><span data-ttu-id="694ab-103">Retours ref et variables locales ref</span><span class="sxs-lookup"><span data-stu-id="694ab-103">Ref returns and ref locals</span></span>

<span data-ttu-id="694ab-104">À compter de C# 7, C# prend en charge les valeurs de retour de référence (retours ref).</span><span class="sxs-lookup"><span data-stu-id="694ab-104">Starting with C# 7, C# supports reference return values (ref returns).</span></span> <span data-ttu-id="694ab-105">Une valeur de retour de référence permet à une méthode de retourner à un appelant une référence à une variable, plutôt qu’à une valeur.</span><span class="sxs-lookup"><span data-stu-id="694ab-105">A reference return value allows a method to return a reference to a variable, rather than a value, back to a caller.</span></span> <span data-ttu-id="694ab-106">L’appelant peut alors choisir de traiter la variable retournée comme si elle était retournée par valeur ou par référence.</span><span class="sxs-lookup"><span data-stu-id="694ab-106">The caller can then choose to treat the returned variable as if it were returned by value or by reference.</span></span> <span data-ttu-id="694ab-107">L’appelant peut créer une nouvelle variable qui est elle-même une référence à la valeur retournée, appelée variable locale ref.</span><span class="sxs-lookup"><span data-stu-id="694ab-107">The caller can create a new variable that is itself a reference to the returned value, called a ref local.</span></span>

## <a name="what-is-a-reference-return-value"></a><span data-ttu-id="694ab-108">Qu’est-ce qu’une valeur de retour de référence ?</span><span class="sxs-lookup"><span data-stu-id="694ab-108">What is a reference return value?</span></span>

<span data-ttu-id="694ab-109">La plupart des développeurs sont familiarisés avec le passage d’un argument à une méthode appelée *par référence*.</span><span class="sxs-lookup"><span data-stu-id="694ab-109">Most developers are familiar with passing an argument to a called method *by reference*.</span></span> <span data-ttu-id="694ab-110">La liste d’arguments d’une méthode appelée comprend une variable passée par référence, et toute modification apportée à sa valeur par la méthode appelée est observée par l’appelant.</span><span class="sxs-lookup"><span data-stu-id="694ab-110">A called method's argument list includes a variable passed by reference, and any changes made to its value by the called method are observed by the caller.</span></span> <span data-ttu-id="694ab-111">Une *valeur de retour de référence* signifie qu’une méthode retourne une *référence* (ou un alias) à une variable dont l’étendue inclut la méthode et dont la durée de vie doit s’étendre au-delà du retour de la méthode.</span><span class="sxs-lookup"><span data-stu-id="694ab-111">A *reference return value* means that a method returns a *reference* (or an alias) to some variable whose scope includes the method and whose lifetime must extend beyond the return of the method.</span></span> <span data-ttu-id="694ab-112">Des modifications apportées par l’appelant à la valeur de retour de la méthode portent sur la variable qui est retournée par la méthode.</span><span class="sxs-lookup"><span data-stu-id="694ab-112">Modifications to the method's return value by the caller are made to the variable that is returned by the method.</span></span>

<span data-ttu-id="694ab-113">La déclaration qu’une méthode retourne une *valeur de retour de référence* indique que la méthode retourne un alias vers une variable.</span><span class="sxs-lookup"><span data-stu-id="694ab-113">Declaring that a method returns a *reference return value* indicates that the method returns an alias to a variable.</span></span> <span data-ttu-id="694ab-114">L’intention de conception est souvent que le code appelant ait accès à cette variable à travers l’alias, et qu’il puisse également la modifier.</span><span class="sxs-lookup"><span data-stu-id="694ab-114">The design intent is often that the calling code should have access to that variable through the alias, including to modify it.</span></span> <span data-ttu-id="694ab-115">C’est pourquoi les méthodes de retour par référence ne peuvent pas avoir le type de retour `void`.</span><span class="sxs-lookup"><span data-stu-id="694ab-115">It follows that methods returning by reference cannot have the return type `void`.</span></span>

<span data-ttu-id="694ab-116">Certaines restrictions s’appliquent à l’expression qu’une méthode peut retourner comme valeur de retour de référence.</span><span class="sxs-lookup"><span data-stu-id="694ab-116">There are some restrictions on the expression that a method can return as a reference return value.</span></span> <span data-ttu-id="694ab-117">Elles incluent notamment :</span><span class="sxs-lookup"><span data-stu-id="694ab-117">These include:</span></span>

- <span data-ttu-id="694ab-118">La valeur de retour doit avoir une durée de vie qui s’étend au-delà de l’exécution de la méthode.</span><span class="sxs-lookup"><span data-stu-id="694ab-118">The return value must have a lifetime that extends beyond the execution of the method.</span></span> <span data-ttu-id="694ab-119">En d’autres termes, il ne peut pas s’agir d’une variable locale dans la méthode qui la retourne.</span><span class="sxs-lookup"><span data-stu-id="694ab-119">In other words, it cannot be a local variable in the method that returns it.</span></span> <span data-ttu-id="694ab-120">Il peut s’agir d’un champ d’instance ou statique d’une classe, ou bien un argument passé à la méthode.</span><span class="sxs-lookup"><span data-stu-id="694ab-120">It can be an instance or static field of a class, or it can be an argument passed to the method.</span></span> <span data-ttu-id="694ab-121">Une tentative de retour d’une variable locale génère l’erreur du compilateur CS8168, « Impossible de retourner la variable locale 'obj' par référence, car il ne s’agit pas d’une variable locale de référence ».</span><span class="sxs-lookup"><span data-stu-id="694ab-121">Attempting to return a local variable generates compiler error CS8168, "Cannot return local 'obj' by reference because it is not a ref local."</span></span>

- <span data-ttu-id="694ab-122">La valeur de retour ne peut pas être le littéral `null`.</span><span class="sxs-lookup"><span data-stu-id="694ab-122">The return value cannot be the literal `null`.</span></span> <span data-ttu-id="694ab-123">Une tentative de retour de `null` génère l’erreur du compilateur CS8156, « Impossible d’utiliser une expression dans ce contexte, car elle ne peut pas être retournée par référence ».</span><span class="sxs-lookup"><span data-stu-id="694ab-123">Attempting to return `null` generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

   <span data-ttu-id="694ab-124">Une méthode avec un retour de référence peut retourner un alias vers une variable dont la valeur est actuellement la valeur (non instanciée) null ou un [type nullable](../nullable-types/index.md) pour un type valeur.</span><span class="sxs-lookup"><span data-stu-id="694ab-124">A method with a ref return can return an alias to a variable whose value is currently the null (uninstantiated) value or a [nullable type](../nullable-types/index.md) for a value type.</span></span>
 
- <span data-ttu-id="694ab-125">La valeur de retour ne peut pas être une constante, un membre d’énumération, la valeur de retour par valeur d’une propriété, ou une méthode d’une `class` ou d’un `struct`.</span><span class="sxs-lookup"><span data-stu-id="694ab-125">The return value cannot be a constant, an enumeration member, the by-value return value from a property, or a method of a `class` or `struct`.</span></span> <span data-ttu-id="694ab-126">Une tentative de retour de ces éléments génère l’erreur du compilateur CS8156, « Impossible d’utiliser une expression dans ce contexte, car elle ne peut pas être retournée par référence ».</span><span class="sxs-lookup"><span data-stu-id="694ab-126">Attempting to return these generates compiler error CS8156, "An expression cannot be used in this context because it may not be returned by reference."</span></span>

<span data-ttu-id="694ab-127">De plus, étant donné qu’une méthode asynchrone peut retourner une valeur avant que son exécution soit terminée, alors que sa valeur de retour est toujours inconnue, les valeurs de retour de référence ne sont pas autorisées sur les méthodes async.</span><span class="sxs-lookup"><span data-stu-id="694ab-127">In addition, because an asynchronous method may return before it has finished execution, while its return value is still unknown, reference return values are not allowed on async methods.</span></span>
 
## <a name="defining-a-ref-return-value"></a><span data-ttu-id="694ab-128">Définition d’une valeur de retour de référence</span><span class="sxs-lookup"><span data-stu-id="694ab-128">Defining a ref return value</span></span>

<span data-ttu-id="694ab-129">Vous définissez une valeur de retour de référence en ajoutant le mot clé [ref](../../language-reference/keywords/ref.md) au type de retour de la signature de méthode.</span><span class="sxs-lookup"><span data-stu-id="694ab-129">You define a ref return value by adding the [ref](../../language-reference/keywords/ref.md) keyword to the return type of the method signature.</span></span> <span data-ttu-id="694ab-130">Par exemple, la signature suivante indique que la propriété `GetContactInformation` retourne une référence à un objet `Person` à l’appelant :</span><span class="sxs-lookup"><span data-stu-id="694ab-130">For example, the following signature indicates that the `GetContactInformation` property returns a reference to a `Person` object to the caller:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname);
```

<span data-ttu-id="694ab-131">De plus, le nom de l’objet retourné par chaque instruction [return](../../language-reference/keywords/return.md) dans le corps de la méthode doit être précédé du mot clé [ref](../../language-reference/keywords/ref.md).</span><span class="sxs-lookup"><span data-stu-id="694ab-131">In addition, the name of the object returned by each [return](../../language-reference/keywords/return.md) statement in the method body must be preceded by the [ref](../../language-reference/keywords/ref.md) keyword.</span></span> <span data-ttu-id="694ab-132">Par exemple, l’instruction `return` suivante retourne une référence à un objet `Person` nommé `p` :</span><span class="sxs-lookup"><span data-stu-id="694ab-132">For example, the following `return` statement returns a reference to a `Person` object named `p`:</span></span>

```csharp
return ref p;
```

## <a name="consuming-a-ref-return-value"></a><span data-ttu-id="694ab-133">Utilisation d’une valeur de retour de référence</span><span class="sxs-lookup"><span data-stu-id="694ab-133">Consuming a ref return value</span></span>

<span data-ttu-id="694ab-134">La valeur de retour de référence est l’alias vers une autre variable dans l’étendue de la méthode appelée.</span><span class="sxs-lookup"><span data-stu-id="694ab-134">The ref return value is an alias to another variable in the called method's scope.</span></span> <span data-ttu-id="694ab-135">Toute utilisation d’une valeur de retour de référence revient à utiliser la variable dont elle est l’alias :</span><span class="sxs-lookup"><span data-stu-id="694ab-135">You can interpret any use of the ref return as using the variable it aliases:</span></span>

- <span data-ttu-id="694ab-136">Quand vous lui affectez une valeur, vous affectez une valeur à la variable dont elle est l’alias.</span><span class="sxs-lookup"><span data-stu-id="694ab-136">When you assign its value, you are assigning a value to the variable it aliases.</span></span>
- <span data-ttu-id="694ab-137">Quand vous lisez sa valeur, vous lisez la valeur de la variable dont elle est l’alias.</span><span class="sxs-lookup"><span data-stu-id="694ab-137">When you read its value, you are reading the value of the variable it aliases.</span></span>
- <span data-ttu-id="694ab-138">Si vous la retournez *par référence*, vous retournez un alias vers cette même variable.</span><span class="sxs-lookup"><span data-stu-id="694ab-138">If you return it *by reference* you are returning an alias to that same variable.</span></span>
- <span data-ttu-id="694ab-139">Si vous la passez à une autre méthode *par référence*, vous passez une référence à la variable dont elle est l’alias.</span><span class="sxs-lookup"><span data-stu-id="694ab-139">If you pass it to another method *by reference* you are passing a reference to the variable it aliases.</span></span>
- <span data-ttu-id="694ab-140">Quand vous créez un alias de [variable locale ref](#ref-local), vous créez un nouvel alias vers la même variable.</span><span class="sxs-lookup"><span data-stu-id="694ab-140">When you make a [ref local](#ref-local) alias, you make a new alias to the same variable.</span></span>


## <a name="ref-locals"></a><span data-ttu-id="694ab-141">Variables locales ref</span><span class="sxs-lookup"><span data-stu-id="694ab-141">Ref locals</span></span>

<span data-ttu-id="694ab-142">Partez du principe que la méthode `GetContactInformation` est déclarée comme un retour de référence :</span><span class="sxs-lookup"><span data-stu-id="694ab-142">Assume the `GetContactInformation` method is declared as a ref return:</span></span>

```csharp
public ref Person GetContactInformation(string fname, string lname)
```

<span data-ttu-id="694ab-143">Une affectation par valeur lit la valeur d’une variable et l’affecte à une nouvelle variable :</span><span class="sxs-lookup"><span data-stu-id="694ab-143">A by-value assignment reads the value of a variable and assigns it to a new variable:</span></span>

```csharp
Person p = contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="694ab-144">L’affectation précédente déclare `p` comme une variable locale.</span><span class="sxs-lookup"><span data-stu-id="694ab-144">The preceding assignment declares `p` as a local variable.</span></span> <span data-ttu-id="694ab-145">Sa valeur initiale est copiée à partir de la lecture de la valeur retournée par `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="694ab-145">Its initial value is copied from reading the value returned by `GetContactInformation`.</span></span> <span data-ttu-id="694ab-146">Toute affectation future à `p` ne modifiera en rien la valeur de la variable renvoyée par `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="694ab-146">Any future assignments to `p` will not change the value of the variable returned by `GetContactInformation`.</span></span> <span data-ttu-id="694ab-147">La variable `p` n’est plus un alias vers la variable retournée.</span><span class="sxs-lookup"><span data-stu-id="694ab-147">The variable `p` is no longer an alias to the variable returned.</span></span>

<span data-ttu-id="694ab-148">Vous déclarez une variable *locale ref* pour copier l’alias vers la valeur d’origine.</span><span class="sxs-lookup"><span data-stu-id="694ab-148">You declare a *ref local* variable to copy the alias to the original value.</span></span> <span data-ttu-id="694ab-149">Dans l’affectation suivante, `p` est un alias vers la variable retournée à partir de `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="694ab-149">In the following assignment, `p` is an alias to the variable returned from `GetContactInformation`.</span></span>

```csharp
ref Person p = ref contacts.GetContactInformation("Brandie", "Best");
```

<span data-ttu-id="694ab-150">L’utilisation ultérieure de `p` revient à utiliser la variable retournée par `GetContactInformation`, car `p` est un alias de cette variable.</span><span class="sxs-lookup"><span data-stu-id="694ab-150">Subsequent usage of `p` is the same as using the variable returned by `GetContactInformation` because `p` is an alias for that variable.</span></span> <span data-ttu-id="694ab-151">Les modifications apportées à `p` modifient également la variable retournée à partir de `GetContactInformation`.</span><span class="sxs-lookup"><span data-stu-id="694ab-151">Changes to `p` also change the variable returned from `GetContactInformation`.</span></span>

<span data-ttu-id="694ab-152">Notez que le mot clé `ref` est utilisé à la fois avant la déclaration de la variable locale *et* avant l’appel de la méthode.</span><span class="sxs-lookup"><span data-stu-id="694ab-152">Note that the `ref` keyword is used both before the local variable declaration *and* before the method call.</span></span> <span data-ttu-id="694ab-153">Si les deux mots clés `ref` ne sont pas inclus dans la déclaration et l’affectation de la variable, l’erreur du compilateur CS8172, « Impossible d’initialiser une variable par référence avec une valeur » est générée.</span><span class="sxs-lookup"><span data-stu-id="694ab-153">Failure to include both `ref` keywords in the variable declaration and assignment results in compiler error CS8172, "Cannot initialize a by-reference variable with a value."</span></span> 
 
## <a name="ref-returns-and-ref-locals-an-example"></a><span data-ttu-id="694ab-154">Retours ref et variables locales ref : exemple</span><span class="sxs-lookup"><span data-stu-id="694ab-154">Ref returns and ref locals: an example</span></span>

<span data-ttu-id="694ab-155">L’exemple suivant définit une classe `NumberStore` qui stocke un tableau de valeurs entières.</span><span class="sxs-lookup"><span data-stu-id="694ab-155">The following example defines a `NumberStore` class that stores an array of integer values.</span></span> <span data-ttu-id="694ab-156">La méthode `FindNumber` retourne par référence le premier nombre supérieur ou égal au nombre passé comme argument.</span><span class="sxs-lookup"><span data-stu-id="694ab-156">The `FindNumber` method returns by reference the first number that is greater than or equal to the number passed as an argument.</span></span> <span data-ttu-id="694ab-157">Si aucun nombre n’est supérieur ou égal à l’argument, la méthode retourne le nombre se trouvant à l’index 0.</span><span class="sxs-lookup"><span data-stu-id="694ab-157">If no number is greater than or equal to the argument, the method returns the number in index 0.</span></span> 

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#1)]

<span data-ttu-id="694ab-158">L’exemple suivant appelle la méthode `NumberStore.FindNumber` pour récupérer la première valeur supérieure ou égale à 16.</span><span class="sxs-lookup"><span data-stu-id="694ab-158">The following example calls the `NumberStore.FindNumber` method to retrieve the first value that is greater than or equal to 16.</span></span> <span data-ttu-id="694ab-159">L’appelant multiplie ensuite par deux la valeur retournée par la méthode.</span><span class="sxs-lookup"><span data-stu-id="694ab-159">The caller then doubles the value returned by the method.</span></span> <span data-ttu-id="694ab-160">Comme le montre la sortie de l’exemple, cette modification est reflétée dans la valeur des éléments de tableau de l’instance `NumberStore`.</span><span class="sxs-lookup"><span data-stu-id="694ab-160">As the output from the example shows, this change is reflected in the value of the array elements of the `NumberStore` instance.</span></span>

[!code-csharp[ref-returns](../../../../samples/snippets/csharp/programming-guide/ref-returns/ref-returns1.cs#2)]

<span data-ttu-id="694ab-161">Si les valeurs de retour de référence ne sont pas prises en charge, une telle opération est généralement effectuée en retournant l’index de l’élément de tableau ainsi que sa valeur de retour.</span><span class="sxs-lookup"><span data-stu-id="694ab-161">Without support for reference return values, such an operation is usually performed by returning the index of the array element along with its value.</span></span> <span data-ttu-id="694ab-162">L’appelant peut ensuite utiliser cet index pour modifier la valeur dans un appel de méthode distinct.</span><span class="sxs-lookup"><span data-stu-id="694ab-162">The caller can then use this index to modify the value in a separate method call.</span></span> <span data-ttu-id="694ab-163">Toutefois, l’appelant peut également modifier l’index pour accéder à d’autres valeurs de tableau et éventuellement les modifier.</span><span class="sxs-lookup"><span data-stu-id="694ab-163">However, the caller can also modify the index to access and possibly modify other array values.</span></span>  
 
## <a name="see-also"></a><span data-ttu-id="694ab-164">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="694ab-164">See also</span></span>

[<span data-ttu-id="694ab-165">ref, mot clé</span><span class="sxs-lookup"><span data-stu-id="694ab-165">ref keyword</span></span>](../../language-reference/keywords/ref.md)
