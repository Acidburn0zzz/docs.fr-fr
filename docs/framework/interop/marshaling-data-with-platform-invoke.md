---
title: Marshaling de données à l’aide de l’appel de code managé
ms.date: 03/20/2019
dev_langs:
- cpp
helpviewer_keywords:
- platform invoke, marshaling data
- data marshaling, platform invoke
- marshaling, platform invoke
ms.assetid: dc5c76cf-7b12-406f-b79c-d1a023ec245d
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 396dc1dec60a6a984f9ddd0b8a8753b7293a5ab9
ms.sourcegitcommit: 77854e8704b9689b73103d691db34d71c2bf1dad
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/21/2019
ms.locfileid: "58307861"
---
# <a name="marshaling-data-with-platform-invoke"></a><span data-ttu-id="4020f-102">Marshaling de données à l’aide de l’appel de code managé</span><span class="sxs-lookup"><span data-stu-id="4020f-102">Marshaling Data with Platform Invoke</span></span>

<span data-ttu-id="4020f-103">Pour appeler des fonctions exportées depuis une bibliothèque non managée, une application .NET Framework a besoin d'un prototype de fonction dans du code managé qui représente la fonction non managée.</span><span class="sxs-lookup"><span data-stu-id="4020f-103">To call functions exported from an unmanaged library, a .NET Framework application requires a function prototype in managed code that represents the unmanaged function.</span></span> <span data-ttu-id="4020f-104">Pour créer un prototype qui permette à un appel de code non managé de marshaler des données correctement, vous devez procédez comme suit :</span><span class="sxs-lookup"><span data-stu-id="4020f-104">To create a prototype that enables platform invoke to marshal data correctly, you must do the following:</span></span>

- <span data-ttu-id="4020f-105">Appliquez l’attribut <xref:System.Runtime.InteropServices.DllImportAttribute> à la fonction ou à la méthode statique dans du code managé.</span><span class="sxs-lookup"><span data-stu-id="4020f-105">Apply the <xref:System.Runtime.InteropServices.DllImportAttribute> attribute to the static function or method in managed code.</span></span>

- <span data-ttu-id="4020f-106">Remplacez les types de données managés par des types de données non managés.</span><span class="sxs-lookup"><span data-stu-id="4020f-106">Substitute managed data types for unmanaged data types.</span></span>

<span data-ttu-id="4020f-107">Vous pouvez utiliser la documentation fournie avec une fonction non managée pour construire un prototype managé équivalent en appliquant l'attribut et ses champs facultatifs, et en remplaçant les types de données managés par des types non managés.</span><span class="sxs-lookup"><span data-stu-id="4020f-107">You can use the documentation supplied with an unmanaged function to construct an equivalent managed prototype by applying the attribute with its optional fields and substituting managed data types for unmanaged types.</span></span> <span data-ttu-id="4020f-108">Pour obtenir des instructions sur l’application de **DllImportAttribute**, consultez [Consommation de fonctions DLL non managées](../../../docs/framework/interop/consuming-unmanaged-dll-functions.md).</span><span class="sxs-lookup"><span data-stu-id="4020f-108">For instructions about how to apply the **DllImportAttribute**, see [Consuming Unmanaged DLL Functions](../../../docs/framework/interop/consuming-unmanaged-dll-functions.md).</span></span>

<span data-ttu-id="4020f-109">Cette section fournit des exemples qui montrent comment créer des prototypes de fonctions managés pour passer des arguments et recevoir des valeurs de retour des fonctions exportées par des bibliothèques non managées.</span><span class="sxs-lookup"><span data-stu-id="4020f-109">This section provides samples that demonstrate how to create managed function prototypes for passing arguments to and receiving return values from functions exported by unmanaged libraries.</span></span> <span data-ttu-id="4020f-110">Les exemples montrent également quand utiliser l'attribut <xref:System.Runtime.InteropServices.MarshalAsAttribute> et la classe <xref:System.Runtime.InteropServices.Marshal> pour marshaler explicitement des données.</span><span class="sxs-lookup"><span data-stu-id="4020f-110">The samples also demonstrate when to use the <xref:System.Runtime.InteropServices.MarshalAsAttribute> attribute and the <xref:System.Runtime.InteropServices.Marshal> class to explicitly marshal data.</span></span>

## <a name="platform-invoke-data-types"></a><span data-ttu-id="4020f-111">Types de données d'appel de code non managé</span><span class="sxs-lookup"><span data-stu-id="4020f-111">Platform invoke data types</span></span>

<span data-ttu-id="4020f-112">Le tableau suivant répertorie les types de données utilisés dans les fonctions de l'API Win32 (répertoriées dans Wtypes.h) et dans les fonctions de style C.</span><span class="sxs-lookup"><span data-stu-id="4020f-112">The following table lists data types used in the Win32 API (listed in Wtypes.h) and C-style functions.</span></span> <span data-ttu-id="4020f-113">De nombreuses bibliothèques non managées contiennent des fonctions qui passent ces types de données comme des paramètres et des valeurs de retour.</span><span class="sxs-lookup"><span data-stu-id="4020f-113">Many unmanaged libraries contain functions that pass these data types as parameters and return values.</span></span> <span data-ttu-id="4020f-114">La troisième colonne contient le type valeur ou la classe .NET Framework intégrés correspondants que vous utilisez dans le code managé.</span><span class="sxs-lookup"><span data-stu-id="4020f-114">The third column lists the corresponding .NET Framework built-in value type or class that you use in managed code.</span></span> <span data-ttu-id="4020f-115">Dans certains cas, vous pouvez remplacer un type de la même taille par le type répertorié dans le tableau.</span><span class="sxs-lookup"><span data-stu-id="4020f-115">In some cases, you can substitute a type of the same size for the type listed in the table.</span></span>

|<span data-ttu-id="4020f-116">Type non managé dans Wtypes.h</span><span class="sxs-lookup"><span data-stu-id="4020f-116">Unmanaged type in Wtypes.h</span></span>|<span data-ttu-id="4020f-117">Type de langage C non managé</span><span class="sxs-lookup"><span data-stu-id="4020f-117">Unmanaged C language type</span></span>|<span data-ttu-id="4020f-118">Nom du type managé</span><span class="sxs-lookup"><span data-stu-id="4020f-118">Managed type name</span></span>|<span data-ttu-id="4020f-119">Description</span><span class="sxs-lookup"><span data-stu-id="4020f-119">Description</span></span>|
|--------------------------------|-------------------------------|------------------------|-----------------|
|<span data-ttu-id="4020f-120">**VOID**</span><span class="sxs-lookup"><span data-stu-id="4020f-120">**VOID**</span></span>|<span data-ttu-id="4020f-121">**void**</span><span class="sxs-lookup"><span data-stu-id="4020f-121">**void**</span></span>|<xref:System.Void?displayProperty=nameWithType>|<span data-ttu-id="4020f-122">Appliqué à une fonction qui ne retourne pas de valeur.</span><span class="sxs-lookup"><span data-stu-id="4020f-122">Applied to a function that does not return a value.</span></span>|
|<span data-ttu-id="4020f-123">**HANDLE**</span><span class="sxs-lookup"><span data-stu-id="4020f-123">**HANDLE**</span></span>|<span data-ttu-id="4020f-124">**void \***</span><span class="sxs-lookup"><span data-stu-id="4020f-124">**void \***</span></span>|<span data-ttu-id="4020f-125"><xref:System.IntPtr?displayProperty=nameWithType> ou <xref:System.UIntPtr?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4020f-125"><xref:System.IntPtr?displayProperty=nameWithType> or <xref:System.UIntPtr?displayProperty=nameWithType></span></span>|<span data-ttu-id="4020f-126">32 bits sur les systèmes d'exploitation Windows 32 bits, 64 bits sur les systèmes d'exploitation Windows 64 bits.</span><span class="sxs-lookup"><span data-stu-id="4020f-126">32 bits on 32-bit Windows operating systems, 64 bits on 64-bit Windows operating systems.</span></span>|
|<span data-ttu-id="4020f-127">**BYTE**</span><span class="sxs-lookup"><span data-stu-id="4020f-127">**BYTE**</span></span>|<span data-ttu-id="4020f-128">**unsigned char**</span><span class="sxs-lookup"><span data-stu-id="4020f-128">**unsigned char**</span></span>|<xref:System.Byte?displayProperty=nameWithType>|<span data-ttu-id="4020f-129">8 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-129">8 bits</span></span>|
|<span data-ttu-id="4020f-130">**SHORT**</span><span class="sxs-lookup"><span data-stu-id="4020f-130">**SHORT**</span></span>|<span data-ttu-id="4020f-131">**short**</span><span class="sxs-lookup"><span data-stu-id="4020f-131">**short**</span></span>|<xref:System.Int16?displayProperty=nameWithType>|<span data-ttu-id="4020f-132">16 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-132">16 bits</span></span>|
|<span data-ttu-id="4020f-133">**WORD**</span><span class="sxs-lookup"><span data-stu-id="4020f-133">**WORD**</span></span>|<span data-ttu-id="4020f-134">**unsigned short**</span><span class="sxs-lookup"><span data-stu-id="4020f-134">**unsigned short**</span></span>|<xref:System.UInt16?displayProperty=nameWithType>|<span data-ttu-id="4020f-135">16 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-135">16 bits</span></span>|
|<span data-ttu-id="4020f-136">**INT**</span><span class="sxs-lookup"><span data-stu-id="4020f-136">**INT**</span></span>|<span data-ttu-id="4020f-137">**int**</span><span class="sxs-lookup"><span data-stu-id="4020f-137">**int**</span></span>|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="4020f-138">32 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-138">32 bits</span></span>|
|<span data-ttu-id="4020f-139">**UINT**</span><span class="sxs-lookup"><span data-stu-id="4020f-139">**UINT**</span></span>|<span data-ttu-id="4020f-140">**unsigned int**</span><span class="sxs-lookup"><span data-stu-id="4020f-140">**unsigned int**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="4020f-141">32 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-141">32 bits</span></span>|
|<span data-ttu-id="4020f-142">**LONG**</span><span class="sxs-lookup"><span data-stu-id="4020f-142">**LONG**</span></span>|<span data-ttu-id="4020f-143">**long**</span><span class="sxs-lookup"><span data-stu-id="4020f-143">**long**</span></span>|<xref:System.Int32?displayProperty=nameWithType>|<span data-ttu-id="4020f-144">32 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-144">32 bits</span></span>|
|<span data-ttu-id="4020f-145">**BOOL**</span><span class="sxs-lookup"><span data-stu-id="4020f-145">**BOOL**</span></span>|<span data-ttu-id="4020f-146">**long**</span><span class="sxs-lookup"><span data-stu-id="4020f-146">**long**</span></span>|<span data-ttu-id="4020f-147"><xref:System.Boolean?displayProperty=nameWithType> ou <xref:System.Int32?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4020f-147"><xref:System.Boolean?displayProperty=nameWithType> or <xref:System.Int32?displayProperty=nameWithType></span></span>|<span data-ttu-id="4020f-148">32 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-148">32 bits</span></span>|
|<span data-ttu-id="4020f-149">**DWORD**</span><span class="sxs-lookup"><span data-stu-id="4020f-149">**DWORD**</span></span>|<span data-ttu-id="4020f-150">**unsigned long**</span><span class="sxs-lookup"><span data-stu-id="4020f-150">**unsigned long**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="4020f-151">32 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-151">32 bits</span></span>|
|<span data-ttu-id="4020f-152">**ULONG**</span><span class="sxs-lookup"><span data-stu-id="4020f-152">**ULONG**</span></span>|<span data-ttu-id="4020f-153">**unsigned long**</span><span class="sxs-lookup"><span data-stu-id="4020f-153">**unsigned long**</span></span>|<xref:System.UInt32?displayProperty=nameWithType>|<span data-ttu-id="4020f-154">32 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-154">32 bits</span></span>|
|<span data-ttu-id="4020f-155">**CHAR**</span><span class="sxs-lookup"><span data-stu-id="4020f-155">**CHAR**</span></span>|<span data-ttu-id="4020f-156">**char**</span><span class="sxs-lookup"><span data-stu-id="4020f-156">**char**</span></span>|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="4020f-157">Décorer avec ANSI.</span><span class="sxs-lookup"><span data-stu-id="4020f-157">Decorate with ANSI.</span></span>|
|<span data-ttu-id="4020f-158">**WCHAR**</span><span class="sxs-lookup"><span data-stu-id="4020f-158">**WCHAR**</span></span>|<span data-ttu-id="4020f-159">**wchar_t**</span><span class="sxs-lookup"><span data-stu-id="4020f-159">**wchar_t**</span></span>|<xref:System.Char?displayProperty=nameWithType>|<span data-ttu-id="4020f-160">Décorer avec Unicode.</span><span class="sxs-lookup"><span data-stu-id="4020f-160">Decorate with Unicode.</span></span>|
|<span data-ttu-id="4020f-161">**LPSTR**</span><span class="sxs-lookup"><span data-stu-id="4020f-161">**LPSTR**</span></span>|<span data-ttu-id="4020f-162">**char &ast;**</span><span class="sxs-lookup"><span data-stu-id="4020f-162">**char &ast;**</span></span>|<span data-ttu-id="4020f-163"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4020f-163"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4020f-164">Décorer avec ANSI.</span><span class="sxs-lookup"><span data-stu-id="4020f-164">Decorate with ANSI.</span></span>|
|<span data-ttu-id="4020f-165">**LPCSTR**</span><span class="sxs-lookup"><span data-stu-id="4020f-165">**LPCSTR**</span></span>|<span data-ttu-id="4020f-166">**const char &ast;**</span><span class="sxs-lookup"><span data-stu-id="4020f-166">**const char &ast;**</span></span>|<span data-ttu-id="4020f-167"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4020f-167"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4020f-168">Décorer avec ANSI.</span><span class="sxs-lookup"><span data-stu-id="4020f-168">Decorate with ANSI.</span></span>|
|<span data-ttu-id="4020f-169">**LPWSTR**</span><span class="sxs-lookup"><span data-stu-id="4020f-169">**LPWSTR**</span></span>|<span data-ttu-id="4020f-170">**wchar_t &ast;**</span><span class="sxs-lookup"><span data-stu-id="4020f-170">**wchar_t &ast;**</span></span>|<span data-ttu-id="4020f-171"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4020f-171"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4020f-172">Décorer avec Unicode.</span><span class="sxs-lookup"><span data-stu-id="4020f-172">Decorate with Unicode.</span></span>|
|<span data-ttu-id="4020f-173">**LPCWSTR**</span><span class="sxs-lookup"><span data-stu-id="4020f-173">**LPCWSTR**</span></span>|<span data-ttu-id="4020f-174">**const wchar_t &ast;**</span><span class="sxs-lookup"><span data-stu-id="4020f-174">**const wchar_t &ast;**</span></span>|<span data-ttu-id="4020f-175"><xref:System.String?displayProperty=nameWithType> ou <xref:System.Text.StringBuilder?displayProperty=nameWithType></span><span class="sxs-lookup"><span data-stu-id="4020f-175"><xref:System.String?displayProperty=nameWithType> or <xref:System.Text.StringBuilder?displayProperty=nameWithType></span></span>|<span data-ttu-id="4020f-176">Décorer avec Unicode.</span><span class="sxs-lookup"><span data-stu-id="4020f-176">Decorate with Unicode.</span></span>|
|<span data-ttu-id="4020f-177">**FLOAT**</span><span class="sxs-lookup"><span data-stu-id="4020f-177">**FLOAT**</span></span>|<span data-ttu-id="4020f-178">**float**</span><span class="sxs-lookup"><span data-stu-id="4020f-178">**float**</span></span>|<xref:System.Single?displayProperty=nameWithType>|<span data-ttu-id="4020f-179">32 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-179">32 bits</span></span>|
|<span data-ttu-id="4020f-180">**DOUBLE**</span><span class="sxs-lookup"><span data-stu-id="4020f-180">**DOUBLE**</span></span>|<span data-ttu-id="4020f-181">**double**</span><span class="sxs-lookup"><span data-stu-id="4020f-181">**double**</span></span>|<xref:System.Double?displayProperty=nameWithType>|<span data-ttu-id="4020f-182">64 bits</span><span class="sxs-lookup"><span data-stu-id="4020f-182">64 bits</span></span>|

<span data-ttu-id="4020f-183">Pour les types correspondants dans [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], C# et C++, consultez [Introduction à la bibliothèque de classes .NET Framework](../../../docs/standard/class-library-overview.md).</span><span class="sxs-lookup"><span data-stu-id="4020f-183">For corresponding types in [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], C#, and C++, see the [Introduction to the .NET Framework Class Library](../../../docs/standard/class-library-overview.md).</span></span>

## <a name="pinvokelibdll"></a><span data-ttu-id="4020f-184">PinvokeLib.dll</span><span class="sxs-lookup"><span data-stu-id="4020f-184">PinvokeLib.dll</span></span>

<span data-ttu-id="4020f-185">Le code suivant définit les fonctions de bibliothèque fournies par Pinvoke.dll.</span><span class="sxs-lookup"><span data-stu-id="4020f-185">The following code defines the library functions provided by Pinvoke.dll.</span></span> <span data-ttu-id="4020f-186">De nombreux exemples décrits dans cette section appellent cette bibliothèque.</span><span class="sxs-lookup"><span data-stu-id="4020f-186">Many samples described in this section call this library.</span></span>

### <a name="example"></a><span data-ttu-id="4020f-187">Exemple</span><span class="sxs-lookup"><span data-stu-id="4020f-187">Example</span></span>

[!code-cpp[PInvokeLib#1](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.cpp#1)]

[!code-cpp[PInvokeLib#2](../../../samples/snippets/cpp/VS_Snippets_CLR/pinvokelib/cpp/pinvokelib.h#2)]
