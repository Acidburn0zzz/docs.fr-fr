---
title: "Procédure pas à pas : création d'informations d'identification de client et de service personnalisées"
ms.custom: ''
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: ''
ms.suite: ''
ms.technology:
- dotnet-clr
ms.tgt_pltfrm: ''
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 2b5ba5c3-0c6c-48e9-9e46-54acaec443ba
caps.latest.revision: 13
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload:
- dotnet
ms.openlocfilehash: cf9f6c1ad5be3a2d63140f03f74713809624e277
ms.sourcegitcommit: 94d33cadc5ff81d2ac389bf5f26422c227832052
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/30/2018
---
# <a name="walkthrough-creating-custom-client-and-service-credentials"></a><span data-ttu-id="9d46e-102">Procédure pas à pas : création d'informations d'identification de client et de service personnalisées</span><span class="sxs-lookup"><span data-stu-id="9d46e-102">Walkthrough: Creating Custom Client and Service Credentials</span></span>
<span data-ttu-id="9d46e-103">Cette rubrique indique comment implémenter des informations d'identification de client et de service personnalisées et comment les utiliser à partir du code d'application.</span><span class="sxs-lookup"><span data-stu-id="9d46e-103">This topic shows how to implement custom client and service credentials and how to use custom credentials from application code.</span></span>  
  
## <a name="credentials-extensibility-classes"></a><span data-ttu-id="9d46e-104">Classes d'extensibilité d'informations d'identification</span><span class="sxs-lookup"><span data-stu-id="9d46e-104">Credentials Extensibility Classes</span></span>  
 <span data-ttu-id="9d46e-105">Les classes <xref:System.ServiceModel.Description.ClientCredentials> et <xref:System.ServiceModel.Description.ServiceCredentials> sont les points d'entrée principaux à l'extensibilité de la sécurité [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d46e-105">The <xref:System.ServiceModel.Description.ClientCredentials> and <xref:System.ServiceModel.Description.ServiceCredentials> classes are the main entry points to the [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] security extensibility.</span></span> <span data-ttu-id="9d46e-106">Ces classes d'informations d'identification fournissent les API qui permettent au code d'application de définir des informations d'identification et de convertir les types d'informations d'identification en jetons de sécurité.</span><span class="sxs-lookup"><span data-stu-id="9d46e-106">These credentials classes provide the APIs that enable application code to set credentials information and to convert credential types into security tokens.</span></span> <span data-ttu-id="9d46e-107">(*Les jetons de sécurité* sont la forme utilisée pour transmettre des informations d’identification dans les messages SOAP.) Les responsabilités de ces classes d'informations d'identification peuvent être réparties en deux catégories :</span><span class="sxs-lookup"><span data-stu-id="9d46e-107">(*Security tokens* are the form used to transmit credential information inside SOAP messages.) The responsibilities of these credentials classes can be divided into two areas:</span></span>  
  
-   <span data-ttu-id="9d46e-108">Fournir les API pour que les applications définissent des informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="9d46e-108">Provide the APIs for applications to set credentials information.</span></span>  
  
-   <span data-ttu-id="9d46e-109">S'exécuter en tant que fabrique pour les implémentations <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-109">Perform as a factory for <xref:System.IdentityModel.Selectors.SecurityTokenManager> implementations.</span></span>  
  
 <span data-ttu-id="9d46e-110">Les deux classes <xref:System.ServiceModel.Description.ClientCredentials> et <xref:System.ServiceModel.Description.ServiceCredentials> héritent de la classe <xref:System.ServiceModel.Security.SecurityCredentialsManager> abstraite qui définit le contrat permettant de retourner <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-110">Both the <xref:System.ServiceModel.Description.ClientCredentials> and the <xref:System.ServiceModel.Description.ServiceCredentials> classes inherit from the abstract <xref:System.ServiceModel.Security.SecurityCredentialsManager> class that defines the contract for returning the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span></span>  
  
 <span data-ttu-id="9d46e-111">Pour plus d’informations sur les classes d’informations d’identification et comment elles s’adaptent les [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] architecture de sécurité, consultez [Architecture de sécurité](http://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span><span class="sxs-lookup"><span data-stu-id="9d46e-111">For more information about the credentials classes and how they fit into the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security architecture, see [Security Architecture](http://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span></span>  
  
 <span data-ttu-id="9d46e-112">Les implémentations par défaut fournies dans [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] prennent en charge les types d'informations d'identification fournis par le système et créent un gestionnaire de jetons de sécurité capable de gérer ces types d'informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="9d46e-112">The default implementations provided in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] support the system-provided credential types and create a security token manager that is capable of handling those credentials types.</span></span>  
  
## <a name="reasons-to-customize"></a><span data-ttu-id="9d46e-113">Raisons de la personnalisation</span><span class="sxs-lookup"><span data-stu-id="9d46e-113">Reasons to Customize</span></span>  
 <span data-ttu-id="9d46e-114">La personnalisation des classes d'informations d'identification de service ou de client peut se justifier pour plusieurs raisons.</span><span class="sxs-lookup"><span data-stu-id="9d46e-114">There are multiple reasons for customizing either client or service credential classes.</span></span> <span data-ttu-id="9d46e-115">La plus importante est la nécessité de modifier le comportement de sécurité [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] par défaut concernant la gestion des types d'informations d'identification fournis par le système, en particulier pour les motifs suivants :</span><span class="sxs-lookup"><span data-stu-id="9d46e-115">Foremost is the requirement to change the default [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security behavior with regard to handling system-provided credential types, especially for the following reasons:</span></span>  
  
-   <span data-ttu-id="9d46e-116">Modifications qu'il n'est pas possible d'effectuer à l'aide d'autres points d'extensibilité.</span><span class="sxs-lookup"><span data-stu-id="9d46e-116">Changes that are not possible using other extensibility points.</span></span>  
  
-   <span data-ttu-id="9d46e-117">Ajout de nouveaux types d'informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="9d46e-117">Adding new credential types.</span></span>  
  
-   <span data-ttu-id="9d46e-118">Ajout de nouveaux types de jetons de sécurité personnalisés.</span><span class="sxs-lookup"><span data-stu-id="9d46e-118">Adding new custom security token types.</span></span>  
  
 <span data-ttu-id="9d46e-119">Cette rubrique décrit comment implémenter des informations d'identification de client et de service personnalisées et comment les utiliser à partir du code d'application.</span><span class="sxs-lookup"><span data-stu-id="9d46e-119">This topic describes how to implement custom client and service credentials and how to use them from application code.</span></span>  
  
## <a name="first-in-a-series"></a><span data-ttu-id="9d46e-120">Première étape</span><span class="sxs-lookup"><span data-stu-id="9d46e-120">First in a Series</span></span>  
 <span data-ttu-id="9d46e-121">La création d'une classe d'informations d'identification personnalisée n'est que la première étape, car la personnalisation des informations d'identification a pour objectif de modifier le comportement [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] concernant la fourniture, la sérialisation de jeton de sécurité ou l'authentification des informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="9d46e-121">Creating a custom credentials class is only the first step, because the reason for customizing credentials is to change [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] behavior regarding credentials provisioning, security token serialization, or authentication.</span></span> <span data-ttu-id="9d46e-122">D'autres rubriques de cette section décrivent comment créer des sérialiseurs et authentificateurs personnalisés.</span><span class="sxs-lookup"><span data-stu-id="9d46e-122">Other topics in this section describe how to create custom serializers and authenticators.</span></span> <span data-ttu-id="9d46e-123">À cet égard, la création de la classe d'informations d'identification personnalisées constitue la première rubrique.</span><span class="sxs-lookup"><span data-stu-id="9d46e-123">In this regard, creating custom credential class is the first topic in the series.</span></span> <span data-ttu-id="9d46e-124">Les actions suivantes (création de sérialiseurs et authentificateurs personnalisés) peuvent être effectuées uniquement après la création d'informations d'identification personnalisées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-124">Subsequent actions (creating custom serializers and authenticators) can be done only after creating custom credentials.</span></span> <span data-ttu-id="9d46e-125">Les autres rubriques basées sur celles-ci sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="9d46e-125">Additional topics that build upon this topic include:</span></span>  
  
-   [<span data-ttu-id="9d46e-126">Guide pratique pour créer un fournisseur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="9d46e-126">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
  
-   [<span data-ttu-id="9d46e-127">Guide pratique pour créer un authentificateur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="9d46e-127">How to: Create a Custom Security Token Authenticator</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)  
  
-   <span data-ttu-id="9d46e-128">[Comment : créer un jeton personnalisé](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="9d46e-128">[How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="9d46e-129">Procédures</span><span class="sxs-lookup"><span data-stu-id="9d46e-129">Procedures</span></span>  
  
#### <a name="to-implement-custom-client-credentials"></a><span data-ttu-id="9d46e-130">Pour implémenter des informations d'identification de client personnalisées</span><span class="sxs-lookup"><span data-stu-id="9d46e-130">To implement custom client credentials</span></span>  
  
1.  <span data-ttu-id="9d46e-131">Définissez une nouvelle classe dérivée de la classe <xref:System.ServiceModel.Description.ClientCredentials>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-131">Define a new class derived from the <xref:System.ServiceModel.Description.ClientCredentials> class.</span></span>  
  
2.  <span data-ttu-id="9d46e-132">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-132">Optional.</span></span> <span data-ttu-id="9d46e-133">Ajoutez de nouvelles propriétés ou méthodes pour les nouveaux types d'informations d'identification.</span><span class="sxs-lookup"><span data-stu-id="9d46e-133">Add new methods or properties for new credential types.</span></span> <span data-ttu-id="9d46e-134">Si vous n'ajoutez pas de nouveau type d'informations d'identification, ignorez cette étape.</span><span class="sxs-lookup"><span data-stu-id="9d46e-134">If you do not add new credential types, skip this step.</span></span> <span data-ttu-id="9d46e-135">L'exemple suivant ajoute une propriété `CreditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="9d46e-135">The following example adds a `CreditCardNumber` property.</span></span>  
  
3.  <span data-ttu-id="9d46e-136">Remplacez la méthode <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-136">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="9d46e-137">Cette méthode est automatiquement appelée par l'infrastructure de sécurité [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] lors de l'utilisation des informations d'identification de client personnalisées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-137">This method is automatically called by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] security infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="9d46e-138">Cette méthode est chargée de créer et de retourner une instance d'une implémentation de la classe <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-138">This method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class.</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="9d46e-139">Il est important de noter que la méthode <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> est remplacée pour créer un gestionnaire de jetons de sécurité personnalisé.</span><span class="sxs-lookup"><span data-stu-id="9d46e-139">It is important to note that the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method is overridden to create a custom security token manager.</span></span> <span data-ttu-id="9d46e-140">Le gestionnaire de jetons de sécurité, dérivé de <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, doit retourner un fournisseur de jetons de sécurité personnalisé, dérivé de <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, pour créer le jeton de sécurité réel.</span><span class="sxs-lookup"><span data-stu-id="9d46e-140">The security token manager, derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>, must return a custom security token provider, derived from <xref:System.IdentityModel.Selectors.SecurityTokenProvider>, to create the actual security token.</span></span> <span data-ttu-id="9d46e-141">Si vous ne suivez pas ce modèle pour créer des jetons de sécurité, votre application peut ne pas fonctionner correctement lorsque des objets <xref:System.ServiceModel.ChannelFactory> sont mis en cache (comportement par défaut des proxys clients WCF), ce qui peut éventuellement provoquer une attaque par élévation de privilège.</span><span class="sxs-lookup"><span data-stu-id="9d46e-141">If you do not follow this pattern for creating security tokens, your application may function incorrectly when <xref:System.ServiceModel.ChannelFactory> objects are cached (which is the default behavior for WCF client proxies), potentially resulting in an elevation of privilege attack.</span></span> <span data-ttu-id="9d46e-142">L'objet personnalisé d'informations d'identification est mis en cache dans le cadre de <xref:System.ServiceModel.ChannelFactory>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-142">The custom credential object is cached as part of the <xref:System.ServiceModel.ChannelFactory>.</span></span> <span data-ttu-id="9d46e-143">Toutefois, le <xref:System.IdentityModel.Selectors.SecurityTokenManager> personnalisé est créé à chaque appel, ce qui limite la menace de sécurité dès l'instant où la logique de création de jeton est placée dans <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-143">However, the custom <xref:System.IdentityModel.Selectors.SecurityTokenManager> is created on every invocation, which mitigates the security threat as long as the token creation logic is placed in the <xref:System.IdentityModel.Selectors.SecurityTokenManager>.</span></span>  
  
4.  <span data-ttu-id="9d46e-144">Remplacez la méthode <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-144">Override the <xref:System.ServiceModel.Description.ClientCredentials.CloneCore%2A> method.</span></span>  
  
     [!code-csharp[c_CustomCredentials#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#1)]
     [!code-vb[c_CustomCredentials#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#1)]  
  
#### <a name="to-implement-a-custom-client-security-token-manager"></a><span data-ttu-id="9d46e-145">Pour implémenter un gestionnaire de jetons de sécurité client personnalisé</span><span class="sxs-lookup"><span data-stu-id="9d46e-145">To implement a custom client security token manager</span></span>  
  
1.  <span data-ttu-id="9d46e-146">Définissez une nouvelle classe dérivée de <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-146">Define a new class derived from <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager>.</span></span>  
  
2.  <span data-ttu-id="9d46e-147">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-147">Optional.</span></span> <span data-ttu-id="9d46e-148">Substituez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> si une implémentation <xref:System.IdentityModel.Selectors.SecurityTokenProvider> personnalisée doit être créée.</span><span class="sxs-lookup"><span data-stu-id="9d46e-148">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="9d46e-149">Pour plus d’informations sur les fournisseurs de jetons de sécurité personnalisé, consultez [Comment : créer un fournisseur de jetons de sécurité personnalisé](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="9d46e-149">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span></span>  
  
3.  <span data-ttu-id="9d46e-150">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-150">Optional.</span></span> <span data-ttu-id="9d46e-151">Substituez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> si une implémentation <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> personnalisée doit être créée.</span><span class="sxs-lookup"><span data-stu-id="9d46e-151">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%28System.IdentityModel.Selectors.SecurityTokenRequirement%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%40%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="9d46e-152">Pour plus d’informations sur les authentificateurs de jetons de sécurité personnalisé, consultez [Comment : créer un authentificateur de jeton de sécurité personnalisé](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md).</span><span class="sxs-lookup"><span data-stu-id="9d46e-152">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md).</span></span>  
  
4.  <span data-ttu-id="9d46e-153">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-153">Optional.</span></span> <span data-ttu-id="9d46e-154">Substituez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> si une implémentation <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> personnalisée doit être créée.</span><span class="sxs-lookup"><span data-stu-id="9d46e-154">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="9d46e-155">Pour plus d’informations sur les jetons de sécurité personnalisés et des sérialiseurs de jeton de sécurité personnalisé, consultez [Comment : créer un jeton personnalisé](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="9d46e-155">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomCredentials#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#2)]
     [!code-vb[c_CustomCredentials#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#2)]  
  
#### <a name="to-use-a-custom-client-credentials-from-application-code"></a><span data-ttu-id="9d46e-156">Pour utiliser des informations d'identification de client personnalisées à partir du code de l'application</span><span class="sxs-lookup"><span data-stu-id="9d46e-156">To use a custom client credentials from application code</span></span>  
  
1.  <span data-ttu-id="9d46e-157">Créez une instance du client généré qui représente l'interface de service, ou créez une instance de <xref:System.ServiceModel.ChannelFactory> qui pointe vers un service avec lequel vous souhaitez communiquer.</span><span class="sxs-lookup"><span data-stu-id="9d46e-157">Either create an instance of the generated client that represents the service interface, or create an instance of the <xref:System.ServiceModel.ChannelFactory> pointing to a service you want to communicate with.</span></span>  
  
2.  <span data-ttu-id="9d46e-158">Supprimez le comportement d'informations d'identification de client fourni par le système de la collection <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>, qui est accessible via la propriété <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-158">Remove the system-provided client credentials behavior from the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>  
  
3.  <span data-ttu-id="9d46e-159">Créez une nouvelle instance d'une classe d'informations d'identification de client personnalisées et ajoutez-la à la collection <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A>, qui est accessible via la propriété <xref:System.ServiceModel.ChannelFactory.Endpoint%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-159">Create a new instance of a custom client credentials class and add it to the <xref:System.ServiceModel.Description.ServiceEndpoint.Behaviors%2A> collection, which can be accessed through the <xref:System.ServiceModel.ChannelFactory.Endpoint%2A> property.</span></span>  
  
     [!code-csharp[c_CustomCredentials#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#3)]
     [!code-vb[c_CustomCredentials#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/client/client.vb#3)]  
  
 <span data-ttu-id="9d46e-160">La procédure précédente indique comment utiliser les informations d'identification du client à partir du code de l'application.</span><span class="sxs-lookup"><span data-stu-id="9d46e-160">The previous procedure shows how to use client credentials from application code.</span></span> <span data-ttu-id="9d46e-161">Les informations d'identification [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] peuvent également être configurées en utilisant le fichier de configuration de l'application.</span><span class="sxs-lookup"><span data-stu-id="9d46e-161">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] credentials can also be configured using the application configuration file.</span></span> <span data-ttu-id="9d46e-162">L'utilisation de la configuration de l'application est souvent préférable à l'encodage effectué de manière irréversible, car elle permet de modifier les paramètres d'application sans qu'il soit nécessaire de modifier la source, de recompiler et de redéployer.</span><span class="sxs-lookup"><span data-stu-id="9d46e-162">Using application configuration is often preferable to hard-coding because it enables modification of application parameters without having to modify the source, recompiling, and redeployment.</span></span>  
  
 <span data-ttu-id="9d46e-163">La procédure suivante décrit comment assurer la prise en charge de la configuration des informations d'identification personnalisées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-163">The next procedure describes how to provide support for configuration of custom credentials.</span></span>  
  
#### <a name="creating-a-configuration-handler-for-custom-client-credentials"></a><span data-ttu-id="9d46e-164">Création d'un gestionnaire de configuration pour les informations d'identification de client personnalisées</span><span class="sxs-lookup"><span data-stu-id="9d46e-164">Creating a configuration handler for custom client credentials</span></span>  
  
1.  <span data-ttu-id="9d46e-165">Définissez une nouvelle classe dérivée de <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-165">Define a new class derived from <xref:System.ServiceModel.Configuration.ClientCredentialsElement>.</span></span>  
  
2.  <span data-ttu-id="9d46e-166">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-166">Optional.</span></span> <span data-ttu-id="9d46e-167">Ajoutez des propriétés pour tous les paramètres de configuration supplémentaires que vous souhaitez exposer via la configuration de l'application.</span><span class="sxs-lookup"><span data-stu-id="9d46e-167">Add properties for all additional configuration parameters that you want to expose through application configuration.</span></span> <span data-ttu-id="9d46e-168">L'exemple ci-dessous ajoute une propriété appelée `CreditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="9d46e-168">The example below adds one property named `CreditCardNumber`.</span></span>  
  
3.  <span data-ttu-id="9d46e-169">Substituez la propriété <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> pour retourner le type de la classe d'informations d'identification de client personnalisées créée avec l'élément de configuration.</span><span class="sxs-lookup"><span data-stu-id="9d46e-169">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.BehaviorType%2A> property to return the type of the custom client credentials class created with the configuration element.</span></span>  
  
4.  <span data-ttu-id="9d46e-170">Remplacez la méthode <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-170">Override the <xref:System.ServiceModel.Configuration.BehaviorExtensionElement.CreateBehavior%2A> method.</span></span> <span data-ttu-id="9d46e-171">La méthode est chargée de créer et de retourner une instance de la classe d'informations d'identification personnalisées en fonction des paramètres chargés à partir du fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="9d46e-171">The method is responsible for creating and returning an instance of the custom credential class based on the settings loaded from the configuration file.</span></span> <span data-ttu-id="9d46e-172">Appelez la méthode <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> de base à partir de cette méthode pour récupérer les paramètres d'informations d'identification fournis par le système chargés dans votre instance d'informations d'identification de client personnalisées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-172">Call the base <xref:System.ServiceModel.Configuration.ClientCredentialsElement.ApplyConfiguration%28System.ServiceModel.Description.ClientCredentials%29> method from this method to retrieve the system-provided credentials settings loaded into your custom client credentials instance.</span></span>  
  
5.  <span data-ttu-id="9d46e-173">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-173">Optional.</span></span> <span data-ttu-id="9d46e-174">Si vous avez ajouté des propriétés supplémentaires dans l'étape 2, vous devez substituer la propriété <xref:System.Configuration.ConfigurationElement.Properties%2A> pour enregistrer vos paramètres de configuration supplémentaires afin que l'infrastructure de configuration les reconnaisse.</span><span class="sxs-lookup"><span data-stu-id="9d46e-174">If you added additional properties in step 2, you need to override the <xref:System.Configuration.ConfigurationElement.Properties%2A> property in order to register your additional configuration settings for the configuration framework to recognize them.</span></span> <span data-ttu-id="9d46e-175">Combinez vos propriétés avec celle de la classe de base afin de permettre la configuration des paramètres fournis par le système via cet élément de configuration d'informations d'identification de client personnalisées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-175">Combine your properties with the base class properties to allow the system-provided settings to be configured through this custom client credentials configuration element.</span></span>  
  
     [!code-csharp[c_CustomCredentials#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#7)]
     [!code-vb[c_CustomCredentials#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#7)]  
  
 <span data-ttu-id="9d46e-176">Lorsque vous disposez de la classe de gestionnaire de configuration, vous pouvez l'intégrer dans l'infrastructure de configuration [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="9d46e-176">Once you have the configuration handler class, it can be integrated into the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] configuration framework.</span></span> <span data-ttu-id="9d46e-177">Cela permet d'utiliser les informations d'identification de client personnalisées dans les éléments de comportement de point de terminaison client, tel qu'indiqué dans la procédure suivante.</span><span class="sxs-lookup"><span data-stu-id="9d46e-177">That enables the custom client credentials to be used in the client endpoint behavior elements, as shown in the next procedure.</span></span>  
  
#### <a name="to-register-and-use-a-custom-client-credentials-configuration-handler-in-the-application-configuration"></a><span data-ttu-id="9d46e-178">Pour inscrire et utiliser un gestionnaire de configuration d'informations d'identification de client personnalisées dans la configuration de l'application</span><span class="sxs-lookup"><span data-stu-id="9d46e-178">To register and use a custom client credentials configuration handler in the application configuration</span></span>  
  
1.  <span data-ttu-id="9d46e-179">Ajouter un <`extensions`> élément et un <`behaviorExtensions`> élément au fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="9d46e-179">Add an <`extensions`> element and a <`behaviorExtensions`> element to the configuration file.</span></span>  
  
2.  <span data-ttu-id="9d46e-180">Ajouter un <`add`> élément à la <`behaviorExtensions`> et définissez la `name` attribut une valeur appropriée.</span><span class="sxs-lookup"><span data-stu-id="9d46e-180">Add an <`add`> element to the <`behaviorExtensions`> element and set the `name` attribute to an appropriate value.</span></span>  
  
3.  <span data-ttu-id="9d46e-181">Affectez le nom de type complet à l'attribut `type`.</span><span class="sxs-lookup"><span data-stu-id="9d46e-181">Set the `type` attribute to the fully-qualified type name.</span></span> <span data-ttu-id="9d46e-182">Incluez également le nom d'assembly ainsi que les autres attributs d'assembly.</span><span class="sxs-lookup"><span data-stu-id="9d46e-182">Also include the assembly name and other assembly attributes.</span></span>  
  
    ```xml  
    <system.serviceModel>  
      <extensions>  
        <behaviorExtensions>  
          <add name="myClientCredentials" type="Microsoft.ServiceModel.Samples.MyClientCredentialsConfigHandler, CustomCredentials, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />  
        </behaviorExtensions>  
      </extensions>  
    <system.serviceModel>  
    ```  
  
4.  <span data-ttu-id="9d46e-183">Après l’inscription de votre gestionnaire de configuration, l’élément d’informations d’identification personnalisées peut être utilisé dans le même fichier de configuration au lieu de fournie par le système <`clientCredentials`> élément.</span><span class="sxs-lookup"><span data-stu-id="9d46e-183">After registering your configuration handler, the custom credentials element can be used inside the same configuration file instead of the system-provided <`clientCredentials`> element.</span></span> <span data-ttu-id="9d46e-184">Vous pouvez utiliser à la fois les propriétés fournies par le système et les nouvelles propriétés ajoutées à votre implémentation de gestionnaire de configuration.</span><span class="sxs-lookup"><span data-stu-id="9d46e-184">You can use both the system-provided properties and any new properties that you have added to your configuration handler implementation.</span></span> <span data-ttu-id="9d46e-185">L'exemple suivant définit la valeur d'une propriété personnalisée à l'aide de l'attribut `creditCardNumber`.</span><span class="sxs-lookup"><span data-stu-id="9d46e-185">The following example sets the value of a custom property using the `creditCardNumber` attribute.</span></span>  
  
    ```xml  
    <behaviors>  
      <endpointBehaviors>  
        <behavior name="myClientCredentialsBehavior">  
          <myClientCredentials creditCardNumber="123-123-123"/>  
        </behavior>  
      </endpointBehaviors>  
    </behaviors>  
    ```  
  
#### <a name="to-implement-custom-service-credentials"></a><span data-ttu-id="9d46e-186">Pour implémenter des informations d'identification de service personnalisées</span><span class="sxs-lookup"><span data-stu-id="9d46e-186">To implement custom service credentials</span></span>  
  
1.  <span data-ttu-id="9d46e-187">Définissez une nouvelle classe dérivée de <xref:System.ServiceModel.Description.ServiceCredentials>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-187">Define a new class derived from <xref:System.ServiceModel.Description.ServiceCredentials>.</span></span>  
  
2.  <span data-ttu-id="9d46e-188">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-188">Optional.</span></span> <span data-ttu-id="9d46e-189">Ajoutez de nouvelles propriétés pour fournir des API aux nouvelles valeurs d'informations d'identification ajoutées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-189">Add new properties to provide APIs for new credential values that are being added.</span></span> <span data-ttu-id="9d46e-190">Si vous n'ajoutez pas de nouvelle valeur d'informations d'identification, ignorez cette étape.</span><span class="sxs-lookup"><span data-stu-id="9d46e-190">If you do not add new credential values, skip this step.</span></span> <span data-ttu-id="9d46e-191">L'exemple suivant ajoute une propriété `AdditionalCertificate`.</span><span class="sxs-lookup"><span data-stu-id="9d46e-191">The following example adds an `AdditionalCertificate` property.</span></span>  
  
3.  <span data-ttu-id="9d46e-192">Remplacez la méthode <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-192">Override the <xref:System.ServiceModel.Security.SecurityCredentialsManager.CreateSecurityTokenManager%2A> method.</span></span> <span data-ttu-id="9d46e-193">Cette méthode est automatiquement appelée par l'infrastructure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] lors de l'utilisation des informations d'identification de client personnalisées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-193">This method is automatically called by the [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] infrastructure when the custom client credential is used.</span></span> <span data-ttu-id="9d46e-194">La méthode est chargée de créer et de retourner une instance d'une implémentation de la classe <xref:System.IdentityModel.Selectors.SecurityTokenManager> (décrite dans la procédure suivante).</span><span class="sxs-lookup"><span data-stu-id="9d46e-194">The method is responsible for creating and returning an instance of an implementation of the <xref:System.IdentityModel.Selectors.SecurityTokenManager> class (described in the next procedure).</span></span>  
  
4.  <span data-ttu-id="9d46e-195">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-195">Optional.</span></span> <span data-ttu-id="9d46e-196">Remplacez la méthode <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-196">Override the <xref:System.ServiceModel.Description.ServiceCredentials.CloneCore%2A> method.</span></span> <span data-ttu-id="9d46e-197">Cela est uniquement requis lors de l'ajout de nouvelles propriétés ou de nouveaux champs internes à l'implémentation d'informations d'identification de client personnalisées.</span><span class="sxs-lookup"><span data-stu-id="9d46e-197">This is required only if adding new properties or internal fields to the custom client credentials implementation.</span></span>  
  
     [!code-csharp[c_CustomCredentials#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#4)]
     [!code-vb[c_CustomCredentials#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#4)]  
  
#### <a name="to-implement-a-custom-service-security-token-manager"></a><span data-ttu-id="9d46e-198">Pour implémenter un gestionnaire de jetons de sécurité de service personnalisé</span><span class="sxs-lookup"><span data-stu-id="9d46e-198">To implement a custom service security token manager</span></span>  
  
1.  <span data-ttu-id="9d46e-199">Définissez une nouvelle classe dérivée de la classe <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-199">Define a new class derived from the <xref:System.ServiceModel.Security.ServiceCredentialsSecurityTokenManager> class.</span></span>  
  
2.  <span data-ttu-id="9d46e-200">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-200">Optional.</span></span> <span data-ttu-id="9d46e-201">Substituez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> si une implémentation <xref:System.IdentityModel.Selectors.SecurityTokenProvider> personnalisée doit être créée.</span><span class="sxs-lookup"><span data-stu-id="9d46e-201">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenProvider%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenProvider> implementation must be created.</span></span> <span data-ttu-id="9d46e-202">Pour plus d’informations sur les fournisseurs de jetons de sécurité personnalisé, consultez [Comment : créer un fournisseur de jetons de sécurité personnalisé](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="9d46e-202">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span></span>  
  
3.  <span data-ttu-id="9d46e-203">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-203">Optional.</span></span> <span data-ttu-id="9d46e-204">Substituez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> si une implémentation <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> personnalisée doit être créée.</span><span class="sxs-lookup"><span data-stu-id="9d46e-204">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> implementation must be created.</span></span> <span data-ttu-id="9d46e-205">Pour plus d’informations sur les authentificateurs de jetons de sécurité personnalisé, consultez [Comment : créer un authentificateur de jeton de sécurité personnalisé](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md) rubrique.</span><span class="sxs-lookup"><span data-stu-id="9d46e-205">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md) topic.</span></span>  
  
4.  <span data-ttu-id="9d46e-206">Facultatif.</span><span class="sxs-lookup"><span data-stu-id="9d46e-206">Optional.</span></span> <span data-ttu-id="9d46e-207">Substituez la méthode <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> si une implémentation <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> personnalisée doit être créée.</span><span class="sxs-lookup"><span data-stu-id="9d46e-207">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenSerializer%28System.IdentityModel.Selectors.SecurityTokenVersion%29> method if a custom <xref:System.IdentityModel.Selectors.SecurityTokenSerializer> must be created.</span></span> <span data-ttu-id="9d46e-208">Pour plus d’informations sur les jetons de sécurité personnalisés et des sérialiseurs de jeton de sécurité personnalisé, consultez [Comment : créer un jeton personnalisé](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="9d46e-208">For more information about custom security tokens and custom security token serializers, see [How to: Create a Custom Token](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomCredentials#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#5)]
     [!code-vb[c_CustomCredentials#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#5)]  
  
#### <a name="to-use-custom-service-credentials-from-application-code"></a><span data-ttu-id="9d46e-209">Pour utiliser des informations d'identification de service personnalisées à partir du code de l'application</span><span class="sxs-lookup"><span data-stu-id="9d46e-209">To use custom service credentials from application code</span></span>  
  
1.  <span data-ttu-id="9d46e-210">Créez une instance de <xref:System.ServiceModel.ServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-210">Create an instance of the <xref:System.ServiceModel.ServiceHost>.</span></span>  
  
2.  <span data-ttu-id="9d46e-211">Supprimez le comportement d'informations d'identification de service fourni par le système de la collection <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-211">Remove the system-provided service credentials behavior from the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>  
  
3.  <span data-ttu-id="9d46e-212">Créez une instance de la classe d'informations d'identification de service personnalisées et ajoutez-la à la collection <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A>.</span><span class="sxs-lookup"><span data-stu-id="9d46e-212">Create a new instance of the custom service credentials class and add it to the <xref:System.ServiceModel.Description.ServiceDescription.Behaviors%2A> collection.</span></span>  
  
     [!code-csharp[c_CustomCredentials#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customcredentials/cs/source.cs#6)]
     [!code-vb[c_CustomCredentials#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customcredentials/vb/service/service.vb#6)]  
  
 <span data-ttu-id="9d46e-213">Ajoutez la prise en charge de la configuration à l'aide des étapes décrites précédemment dans les procédures « `To create a configuration handler for custom client credentials` » et « `To register and use a custom client credentials configuration handler in the application configuration` ». La seule différence réside dans l'utilisation de la classe <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> au lieu de la classe <xref:System.ServiceModel.Configuration.ClientCredentialsElement> comme classe de base pour le gestionnaire de configuration.</span><span class="sxs-lookup"><span data-stu-id="9d46e-213">Add support for configuration using the steps described previously in the procedures "`To create a configuration handler for custom client credentials`" and "`To register and use a custom client credentials configuration handler in the application configuration`." The only difference is to use the <xref:System.ServiceModel.Configuration.ServiceCredentialsElement> class instead of the <xref:System.ServiceModel.Configuration.ClientCredentialsElement> class as a base class for the configuration handler.</span></span> <span data-ttu-id="9d46e-214">L'élément d'informations d'identification de service personnalisées peut ensuite être utilisé partout où l'élément `<serviceCredentials>` fourni par le système est utilisé.</span><span class="sxs-lookup"><span data-stu-id="9d46e-214">The custom service credential element can then be used wherever the system-provided `<serviceCredentials>` element is used.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="9d46e-215">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="9d46e-215">See Also</span></span>  
 <xref:System.ServiceModel.Description.ClientCredentials>  
 <xref:System.ServiceModel.Description.ServiceCredentials>  
 <xref:System.ServiceModel.Security.SecurityCredentialsManager>  
 <xref:System.IdentityModel.Selectors.SecurityTokenManager>  
 <xref:System.ServiceModel.Configuration.ClientCredentialsElement>  
 <xref:System.ServiceModel.Configuration.ServiceCredentialsElement>  
 [<span data-ttu-id="9d46e-216">Guide pratique pour créer un fournisseur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="9d46e-216">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)  
 [<span data-ttu-id="9d46e-217">Guide pratique pour créer un authentificateur de jetons de sécurité personnalisé</span><span class="sxs-lookup"><span data-stu-id="9d46e-217">How to: Create a Custom Security Token Authenticator</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)  
 [<span data-ttu-id="9d46e-218">Guide pratique pour créer un jeton personnalisé</span><span class="sxs-lookup"><span data-stu-id="9d46e-218">How to: Create a Custom Token</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-token.md)
