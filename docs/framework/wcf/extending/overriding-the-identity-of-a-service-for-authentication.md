---
title: "Substitution de l'identité d'un service pour l'authentification"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
caps.latest.revision: "9"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: e1f8f6bd4d8661393bc849405a8668341f65f8d5
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/22/2017
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="c70cd-102">Substitution de l'identité d'un service pour l'authentification</span><span class="sxs-lookup"><span data-stu-id="c70cd-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="c70cd-103">Généralement, vous n'avez pas besoin de définir l'identité sur un service car la sélection d'un type d'informations d'identification du client impose le type d'identité exposé dans les métadonnées du service.</span><span class="sxs-lookup"><span data-stu-id="c70cd-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="c70cd-104">Par exemple, le code de configuration suivant utilise le [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) et affecte le `clientCredentialType` à Windows d’attribut.</span><span class="sxs-lookup"><span data-stu-id="c70cd-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  
  
  
  
 <span data-ttu-id="c70cd-105">Le fragment WSDL (Web Services Description Language) suivant affiche l'identité du point de terminaison défini précédemment.</span><span class="sxs-lookup"><span data-stu-id="c70cd-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="c70cd-106">Dans cet exemple, le service s’exécute comme un service auto-hébergé sous un compte d’utilisateur particulier (username@contoso.com) et par conséquent, l’identité d’utilisateur principaux (UPN) contient le nom du compte.</span><span class="sxs-lookup"><span data-stu-id="c70cd-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="c70cd-107">L'UPN est également appelé nom de connexion d'utilisateur dans un domaine Windows.</span><span class="sxs-lookup"><span data-stu-id="c70cd-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  
  
  
  
 <span data-ttu-id="c70cd-108">Pour un exemple d’application qui illustre la définition de l’identité, consultez [exemple](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="c70cd-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="c70cd-109">identité de service, consultez [l’identité du Service et l’authentification](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="c70cd-109"> service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="c70cd-110">Authentification et identité Kerberos</span><span class="sxs-lookup"><span data-stu-id="c70cd-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="c70cd-111">Par défaut, lorsqu’un service est configuré pour utiliser les informations d’identification Windows, un [ \<identité >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) élément contenant un [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) ou [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) élément est généré dans le WSDL.</span><span class="sxs-lookup"><span data-stu-id="c70cd-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="c70cd-112">Si le service s’exécute sous le `LocalSystem`, `LocalService`, ou `NetworkService` compte, un service de nom principal (SPN) est généré par défaut sous la forme de `host/` \< *nom d’hôte*>, car ces comptes ont accès aux données SPN de l’ordinateur.</span><span class="sxs-lookup"><span data-stu-id="c70cd-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="c70cd-113">Si le service s’exécute sous un compte différent, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] génère un UPN sous la forme de \< *nom d’utilisateur*>@<*domainName*`>`.</span><span class="sxs-lookup"><span data-stu-id="c70cd-113">If the service is running under a different account, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="c70cd-114">Cela est dû au fait que l'authentification Kerberos requiert qu'un UPN ou SPN soit fourni au client pour authentifier le service.</span><span class="sxs-lookup"><span data-stu-id="c70cd-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="c70cd-115">Vous pouvez également utiliser l'outil Setspn.exe pour inscrire un SPN supplémentaire avec un compte de service dans un domaine.</span><span class="sxs-lookup"><span data-stu-id="c70cd-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="c70cd-116">Vous pouvez ensuite utiliser le SPN comme identité du service.</span><span class="sxs-lookup"><span data-stu-id="c70cd-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="c70cd-117">Pour télécharger l’outil, consultez [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="c70cd-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](http://go.microsoft.com/fwlink/?LinkId=91752).</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="c70cd-118">l’outil, consultez [présentation de Setspn](http://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="c70cd-118"> the tool, see [Setspn Overview](http://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="c70cd-119">Pour utiliser le type d'informations d'identification Windows sans négociation, le compte d'utilisateur du service doit avoir accès au SPN inscrit avec le domaine Active Directory.</span><span class="sxs-lookup"><span data-stu-id="c70cd-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="c70cd-120">Pour ce faire, vous pouvez procéder de différentes façons :</span><span class="sxs-lookup"><span data-stu-id="c70cd-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="c70cd-121">Utilisez le compte NetworkService ou LocalSystem pour exécuter votre service.</span><span class="sxs-lookup"><span data-stu-id="c70cd-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="c70cd-122">Comme ces comptes ont accès au SPN de l'ordinateur établi lorsque l'ordinateur rejoint le domaine Active Directory, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] génère automatiquement l'élément SPN approprié à l'intérieur du point de terminaison du service dans les métadonnées du service (WSDL).</span><span class="sxs-lookup"><span data-stu-id="c70cd-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="c70cd-123">Utilisez un compte de domaine Active Directory arbitraire pour exécuter votre service.</span><span class="sxs-lookup"><span data-stu-id="c70cd-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="c70cd-124">Dans ce cas, établissez un SPN pour ce compte de domaine, pour cela vous pouvez vous servir de l'utilitaire Setspn.exe.</span><span class="sxs-lookup"><span data-stu-id="c70cd-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="c70cd-125">Une fois que le SPN du compte du service a été créé, configurez [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] pour publier ce SPN sur les clients du service par le biais de ses métadonnées (WSDL).</span><span class="sxs-lookup"><span data-stu-id="c70cd-125">Once you create the SPN for the service's account, configure [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="c70cd-126">Pour cela, il suffit de définir l'identité du point de terminaison exposé, à l'aide d'un fichier de configuration d'application ou du code.</span><span class="sxs-lookup"><span data-stu-id="c70cd-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="c70cd-127">Noms principaux de service, le protocole Kerberos et Active Directory, voir [Kerberos supplément technique pour Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="c70cd-127"> SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](http://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="c70cd-128">Lorsque SPN ou UPN équivaut à une chaîne vide</span><span class="sxs-lookup"><span data-stu-id="c70cd-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="c70cd-129">Si vous attribuez une valeur de chaîne vide à SPN ou UPN, plusieurs choses se produisent, en fonction du niveau de sécurité et du mode d'authentification utilisés :</span><span class="sxs-lookup"><span data-stu-id="c70cd-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="c70cd-130">Si vous utilisez la sécurité de niveau transport, l'authentification NTLM (NT LanMan) est choisie.</span><span class="sxs-lookup"><span data-stu-id="c70cd-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="c70cd-131">Si vous utilisez la sécurité de niveau message, l'authentification peut échouer, en fonction du mode d'authentification.</span><span class="sxs-lookup"><span data-stu-id="c70cd-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="c70cd-132">Si vous utilisez le mode `spnego` et que l'attribut `AllowNtlm` a la valeur `false`, l'authentification échoue.</span><span class="sxs-lookup"><span data-stu-id="c70cd-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="c70cd-133">Si vous utilisez le mode `spnego` et que l'attribut `AllowNtlm` a la valeur `true`, l'authentification échoue si l'UPN est vide, mais réussit si le SPN est vide.</span><span class="sxs-lookup"><span data-stu-id="c70cd-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="c70cd-134">Si vous utilisez Kerberos direct (également appelé « one-shot »), l'authentification échoue.</span><span class="sxs-lookup"><span data-stu-id="c70cd-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="c70cd-135">À l’aide de la \<identité > élément de Configuration</span><span class="sxs-lookup"><span data-stu-id="c70cd-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="c70cd-136">Si vous remplacez le type d'informations d'identification du client dans la liaison présentée précédemment par Certificate`,` le fichier WSDL généré contient alors un certificat X.509 sérialisé pour la valeur d'identité, comme illustré dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="c70cd-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="c70cd-137">Il s'agit de la valeur par défaut pour tous les types d'informations d'identification du client autres que Windows.</span><span class="sxs-lookup"><span data-stu-id="c70cd-137">This is the default for all client credential types other than Windows.</span></span>  
  
  
  
 <span data-ttu-id="c70cd-138">Vous pouvez modifier la valeur de l'identité de service par défaut ou le type de l'identité à l'aide de l'élément <`identity`> dans la configuration ou en définissant l'identité dans le code.</span><span class="sxs-lookup"><span data-stu-id="c70cd-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="c70cd-139">Le code de configuration suivant affecte à une identité DNS (Domain Name System) la valeur `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="c70cd-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  
  
  
  
### <a name="setting-identity-programmatically"></a><span data-ttu-id="c70cd-140">Définition de l'identité par programme</span><span class="sxs-lookup"><span data-stu-id="c70cd-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="c70cd-141">Votre service n'a pas besoin de spécifier une identité de manière explicite, car [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] la détermine automatiquement.</span><span class="sxs-lookup"><span data-stu-id="c70cd-141">Your service does not have to explicitly specify an identity, because [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] automatically determines it.</span></span> <span data-ttu-id="c70cd-142">Toutefois, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] vous permet de spécifier une identité sur un point de terminaison, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="c70cd-142">However, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="c70cd-143">Le code suivant ajoute un point de terminaison de service avec une identité DNS spécifique.</span><span class="sxs-lookup"><span data-stu-id="c70cd-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="c70cd-144">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c70cd-144">See Also</span></span>  
 [<span data-ttu-id="c70cd-145">Guide pratique pour créer un vérificateur d’identité du client personnalisé</span><span class="sxs-lookup"><span data-stu-id="c70cd-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)  
 [<span data-ttu-id="c70cd-146">Identité du service et authentification</span><span class="sxs-lookup"><span data-stu-id="c70cd-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
