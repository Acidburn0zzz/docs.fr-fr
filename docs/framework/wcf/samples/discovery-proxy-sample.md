---
title: Exemple Discovery Proxy
ms.date: 03/30/2017
ms.assetid: 1dfa02df-15b1-4e97-9c8e-f5f2772711b0
ms.openlocfilehash: 6fc0680bc6b61a6fe1b4b141c8b1e5081df5a124
ms.sourcegitcommit: 64f4baed249341e5bf64d1385bf48e3f2e1a0211
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2018
ms.locfileid: "44127798"
---
# <a name="discovery-proxy-sample"></a><span data-ttu-id="aaf1a-102">Exemple Discovery Proxy</span><span class="sxs-lookup"><span data-stu-id="aaf1a-102">Discovery Proxy Sample</span></span>
<span data-ttu-id="aaf1a-103">Cet exemple montre comment créer une implémentation d'un proxy de découverte pour stocker des informations sur des services existants et comment des clients peuvent interroger ce proxy afin d'obtenir les informations.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-103">This sample shows how to create an implementation of a Discovery proxy to store information about existing services and how clients can query that proxy for information.</span></span> <span data-ttu-id="aaf1a-104">Cet exemple est composé de trois projets :</span><span class="sxs-lookup"><span data-stu-id="aaf1a-104">This sample consists of three projects:</span></span>  
  
-   <span data-ttu-id="aaf1a-105">**Service**: un simple service de calculatrice de Windows Communication Foundation (WCF) qui s’enregistre avec le proxy de découverte.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-105">**Service**: A simple Windows Communication Foundation (WCF) calculator service that registers itself with the discovery proxy.</span></span>  
  
-   <span data-ttu-id="aaf1a-106">**Proxy de découverte**: l’implémentation d’un service de proxy de découverte.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-106">**Discovery Proxy**: The implementation of a discovery proxy service.</span></span>  
  
-   <span data-ttu-id="aaf1a-107">**Client**: application cliente WCF qui appelle le proxy de découverte pour rechercher des services.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-107">**Client**: A WCF client application that calls the discovery proxy to search for services.</span></span>  
  
## <a name="demonstrates"></a><span data-ttu-id="aaf1a-108">Démonstrations</span><span class="sxs-lookup"><span data-stu-id="aaf1a-108">Demonstrates</span></span>  
 <span data-ttu-id="aaf1a-109">Implémentation du proxy de découverte</span><span class="sxs-lookup"><span data-stu-id="aaf1a-109">Discovery proxy implementation</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="aaf1a-110">Les exemples peuvent déjà être installés sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-110">The samples may already be installed on your machine.</span></span> <span data-ttu-id="aaf1a-111">Recherchez le répertoire (par défaut) suivant avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-111">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="aaf1a-112">Si ce répertoire n’existe pas, accédez à [Windows Communication Foundation (WCF) et des exemples de Windows Workflow Foundation (WF) pour .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) pour télécharger tous les Windows Communication Foundation (WCF) et [!INCLUDE[wf1](../../../../includes/wf1-md.md)] exemples.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-112">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="aaf1a-113">Cet exemple se trouve dans le répertoire suivant.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-113">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Discovery\DiscoveryProxy`  
  
## <a name="discoveryproxy"></a><span data-ttu-id="aaf1a-114">DiscoveryProxy</span><span class="sxs-lookup"><span data-stu-id="aaf1a-114">DiscoveryProxy</span></span>  
 <span data-ttu-id="aaf1a-115">Dans la méthode `Main` du fichier Program.cs, l'exemple montre comment un service de type <xref:System.ServiceModel.Discovery.DiscoveryProxy> est hébergé.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-115">In the `Main` method of the Program.cs file, the sample shows how a service of type <xref:System.ServiceModel.Discovery.DiscoveryProxy> is hosted.</span></span> <span data-ttu-id="aaf1a-116">Il expose deux points de terminaison ; l'un de type <xref:System.ServiceModel.Discovery.DiscoveryEndpoint>, l'autre de type <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-116">It exposes two endpoints, one of type <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> and another of type <xref:System.ServiceModel.Discovery.AnnouncementEndpoint>.</span></span> <span data-ttu-id="aaf1a-117">Les points de terminaison utilisent tous deux un transport TCP.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-117">Both of the endpoints use TCP as a transport.</span></span> <span data-ttu-id="aaf1a-118">L'<xref:System.ServiceModel.Discovery.DiscoveryEndpoint> écoute au niveau de l'URI spécifié par le paramètre `probeEndpointAddress`, là où les clients peuvent envoyer des messages Probe pour interroger le proxy afin d'obtenir ses données.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-118">The <xref:System.ServiceModel.Discovery.DiscoveryEndpoint> is listening at the URI specified by the `probeEndpointAddress` parameter, this is where clients can send probe messages to query the proxy for its data.</span></span> <span data-ttu-id="aaf1a-119">Le <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> écoute au niveau de l'URI spécifié par le paramètre `announcementEndpointAddress`,</span><span class="sxs-lookup"><span data-stu-id="aaf1a-119">The <xref:System.ServiceModel.Discovery.AnnouncementEndpoint> is listening at the URI specified by the `announcementEndpointAddress` parameter.</span></span> <span data-ttu-id="aaf1a-120">là où le proxy écoute les annonces.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-120">This is where the proxy listens to for announcements.</span></span> <span data-ttu-id="aaf1a-121">Lorsqu'une annonce en ligne est reçue, le proxy ajoute le service à son cache et lorsqu'une annonce hors connexion est reçue, il supprime le service de son cache.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-121">When an online announcement is received, the proxy adds the service to its cache and when an offline announcement is received it removes the service from its cache.</span></span>  
  
 <span data-ttu-id="aaf1a-122">Le fichier DiscoveryProxy.cs contient l'implémentation du <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-122">The DiscoveryProxy.cs contains the implementation of the <xref:System.ServiceModel.Discovery.DiscoveryProxy>.</span></span> <span data-ttu-id="aaf1a-123">Le proxy doit hériter de la classe <xref:System.Object> et requiert une implémentation d'<xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-123">The Proxy must inherit from the <xref:System.Object> class and requires an implementation of <xref:System.Runtime.Remoting.Messaging.AsyncResult>.</span></span> <span data-ttu-id="aaf1a-124">À l'instanciation, le proxy crée un <xref:System.Collections.Generic.Dictionary%602>, qu'il utilise pour stocker les éléments qui lui sont connus.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-124">At instantiation, the Proxy creates a new <xref:System.Collections.Generic.Dictionary%602>, which it uses to store elements it knows about.</span></span>  
  
 <span data-ttu-id="aaf1a-125">Le fichier est divisé en deux régions, l'une pour les méthodes du cache du proxy, l'autre pour l'implémentation de Discovery Proxy.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-125">The file is divided into two regions, Proxy Cache Methods and Discovery Proxy Implementation.</span></span> <span data-ttu-id="aaf1a-126">La région des méthodes du cache du proxy contient des méthodes utilisées pour mettre à jour le <xref:System.Collections.Generic.Dictionary%602>, exécuter des requêtes sur le <xref:System.Collections.Generic.Dictionary%602> et imprimer les données pour les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-126">The Proxy Cache Methods region contains methods used to update the <xref:System.Collections.Generic.Dictionary%602>, perform queries against the <xref:System.Collections.Generic.Dictionary%602>, and print the data for users.</span></span> <span data-ttu-id="aaf1a-127">La région de l'implémentation de Discovery Proxy contient les méthodes substituées requises pour les fonctionnalités d'annonce et de sonde.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-127">The Discovery Proxy Implementation region contains the overridden methods required for the Announcement and Probe functionality.</span></span> <span data-ttu-id="aaf1a-128">Elles définissent les actions effectuées par un proxy après réception d'une annonce en ligne, d'une annonce hors connexion ou d'un message Probe.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-128">They define the actions taken by a proxy after receiving an Online Announcement, an Offline Announcement, or a Probe message.</span></span>  
  
## <a name="service"></a><span data-ttu-id="aaf1a-129">Service</span><span class="sxs-lookup"><span data-stu-id="aaf1a-129">Service</span></span>  
 <span data-ttu-id="aaf1a-130">Dans le fichier Program.cs du projet Service, le même URI est utilisé pour le point de terminaison d'annonce et le proxy de découverte.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-130">In the Program.cs file in the Service project, the same URI is used for its announcement endpoint as the discovery proxy.</span></span> <span data-ttu-id="aaf1a-131">En effet, le service utilise le point de terminaison pour l'envoi des annonces, alors que le proxy l'utilise pour leur réception.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-131">This is because service uses the endpoint for sending the announcements, while the proxy uses it for receiving them.</span></span> <span data-ttu-id="aaf1a-132">Le service utilise le <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> et lui ajoute un point de terminaison d'annonce.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-132">The service uses the <xref:System.ServiceModel.Discovery.EndpointDiscoveryBehavior> and adds an announcement endpoint to it.</span></span>  
  
## <a name="client"></a><span data-ttu-id="aaf1a-133">Client</span><span class="sxs-lookup"><span data-stu-id="aaf1a-133">Client</span></span>  
 <span data-ttu-id="aaf1a-134">Le projet Client utilise le même URI pour son point de terminaison de sonde et le proxy.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-134">The Client project uses the same URI for its probe endpoint as the Proxy.</span></span> <span data-ttu-id="aaf1a-135">En effet, les sondes de ce scénario font également l'objet d'une monodiffusion spécifiquement vers le point de terminaison disponible sur le proxy.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-135">This is because the probes in this scenario are also being unicast specifically to the endpoint available on the proxy.</span></span> <span data-ttu-id="aaf1a-136">Le client se connecte à cette adresse bien connue, puis l'interroge au sujet du service.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-136">The Client connects to this well-known address and then queries it for the service.</span></span> <span data-ttu-id="aaf1a-137">Une fois qu'il a trouvé le service, il s'y connecte.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-137">Once it has found the service it connects to it.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="aaf1a-138">Pour utiliser cet exemple</span><span class="sxs-lookup"><span data-stu-id="aaf1a-138">To use this sample</span></span>  
  
1.  <span data-ttu-id="aaf1a-139">Chargez la solution du projet dans [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] et générez le projet.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-139">Load the project solution in [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] and build the project.</span></span>  
  
2.  <span data-ttu-id="aaf1a-140">En premier lieu, exécutez l'application Discovery Proxy, générée dans [répertoire de base de la solution]\DiscoveryProxy\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-140">First run the Discovery Proxy application, generated in [solution base directory]\DiscoveryProxy\bin\debug.</span></span> <span data-ttu-id="aaf1a-141">Discovery Proxy doit s'exécuter en premier, car les points de terminaison d'annonce TCP doivent être en place pour permettre au service d'envoyer ses annonces.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-141">The Discovery Proxy must run first because TCP announcement endpoints must be up for the service to send its announcements.</span></span>  
  
3.  <span data-ttu-id="aaf1a-142">En second lieu, exécutez l'application Service, générée dans [répertoire de base de la solution]\Service\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-142">Second, run the service application generated in [solution base directory]\Service\bin\debug.</span></span> <span data-ttu-id="aaf1a-143">Au démarrage, le service envoie une annonce au point de terminaison d'annonce du proxy de découverte et est inscrit dans le cache du proxy.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-143">At start-up, the service sends an announcement to the announcement endpoint of the discovery proxy and is registered in the proxy’s cache.</span></span>  
  
4.  <span data-ttu-id="aaf1a-144">Ensuite, exécutez l'application Client, générée dans [répertoire de base de la solution]\Client\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-144">Next, run the client application, generated in [solution base directory]\Client\bin\debug.</span></span> <span data-ttu-id="aaf1a-145">Le client interroge le proxy, obtient l'adresse du service, puis s'y connecte.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-145">The client queries the proxy, gets the service address and then connects to the service.</span></span>  
  
5.  <span data-ttu-id="aaf1a-146">Enfin, arrêtez le client, le service, puis le proxy.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-146">Lastly, terminate the client, service and then the proxy.</span></span> <span data-ttu-id="aaf1a-147">Pour recevoir l'annonce hors connexion du service, le proxy doit être en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="aaf1a-147">The proxy must be running for it to receive the service's offline announcement.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="aaf1a-148">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="aaf1a-148">See Also</span></span>
