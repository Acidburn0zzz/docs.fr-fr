---
title: Sélection automatique du format
ms.date: 03/30/2017
ms.assetid: dab51e56-8517-4a6a-bb54-b55b15ab37bb
ms.openlocfilehash: 4fd695195f5c7c13bc088248a6b3c12388328d37
ms.sourcegitcommit: 64f4baed249341e5bf64d1385bf48e3f2e1a0211
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2018
ms.locfileid: "44084025"
---
# <a name="automatic-format-selection"></a><span data-ttu-id="c9919-102">Sélection automatique du format</span><span class="sxs-lookup"><span data-stu-id="c9919-102">Automatic Format Selection</span></span>
<span data-ttu-id="c9919-103">Cet exemple montre comment activer la sélection automatique du format (XML ou JSON) avec le reste de Windows Communication Foundation (WCF) modèle, ainsi que comment définir explicitement le format dans le code d’opération de programmation.</span><span class="sxs-lookup"><span data-stu-id="c9919-103">This sample demonstrates how to enable automatic format selection (XML or JSON) with the Windows Communication Foundation (WCF) REST programming model, as well as how to explicitly set the format in the operation code.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="c9919-104">Détails de l'exemple</span><span class="sxs-lookup"><span data-stu-id="c9919-104">Sample Details</span></span>  
 <span data-ttu-id="c9919-105">L'exemple se compose d'un service et du code client qui adresse des requêtes au service.</span><span class="sxs-lookup"><span data-stu-id="c9919-105">The sample consists of a service along with client code that makes requests to the service.</span></span> <span data-ttu-id="c9919-106">Le service prend en charge une seule opération HTTP `GET` (`EchoWithGet`) et une seule opération HTTP `POST` (`EchoWithPost`).</span><span class="sxs-lookup"><span data-stu-id="c9919-106">The service supports a single HTTP `GET` operation (`EchoWithGet`) and a single HTTP `POST` operation (`EchoWithPost`).</span></span> <span data-ttu-id="c9919-107">Les deux opérations attendent une chaîne, qu'elles retournent dans la réponse.</span><span class="sxs-lookup"><span data-stu-id="c9919-107">Both operations expect a string and then return the string in the response.</span></span> <span data-ttu-id="c9919-108">Avec l'opération `GET`, la chaîne est fournie dans un paramètre de chaîne de requête URI.</span><span class="sxs-lookup"><span data-stu-id="c9919-108">With the `GET` operation, the string is provided in a URI query-string parameter.</span></span> <span data-ttu-id="c9919-109">Avec l'opération `POST`, la chaîne est fournie dans le corps de la requête, sérialisé en XML.</span><span class="sxs-lookup"><span data-stu-id="c9919-109">With the `POST` operation, the string is provided in the body of the request, serialized in XML.</span></span> <span data-ttu-id="c9919-110">Le service est en mesure de retourner des réponses au format XML ou JSON, en utilisant les nouvelles fonctionnalités de sélection automatique du format et de sélection impérative du format de [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span><span class="sxs-lookup"><span data-stu-id="c9919-110">The service is able to return responses in either XML or JSON, utilizing the new automatic format selection and imperative format selection features in [!INCLUDE[netfx40_long](../../../../includes/netfx40-long-md.md)].</span></span>  
  
 <span data-ttu-id="c9919-111">Dans l'exemple, la sélection automatique du format est activée au moyen du fichier App.config.</span><span class="sxs-lookup"><span data-stu-id="c9919-111">In the sample, automatic format selection is enabled using the App.config file.</span></span> <span data-ttu-id="c9919-112">Sur le point de terminaison HTTP Web par défaut, la valeur `automaticFormatSelectionEnabled` a été affectée à l'attribut `true`.</span><span class="sxs-lookup"><span data-stu-id="c9919-112">On the default Web HTTP endpoint, the `automaticFormatSelectionEnabled` attribute has been given a value of `true`.</span></span> <span data-ttu-id="c9919-113">Avec la sélection automatique du format activée, l’infrastructure WCF sélectionne le plus approprié format de réponse (XML ou JSON) étant donné les en-têtes HTTP Accept ou Content-Type de la demande.</span><span class="sxs-lookup"><span data-stu-id="c9919-113">With automatic format selection enabled, the WCF infrastructure selects the most appropriate response format (XML or JSON) given the HTTP Accept or Content-Type headers of the request.</span></span> <span data-ttu-id="c9919-114">Le développeur n'est pas obligé de fournir de code ou de configuration supplémentaire ; il lui suffit d'affecter à l'attribut `automaticFormatSelectionEnabled` la valeur `true` pour utiliser cette nouvelle fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="c9919-114">The developer is not required to provide any additional code or configuration other than setting the `automaticFormatSelectionEnabled` attribute to `true` to use this new feature.</span></span> <span data-ttu-id="c9919-115">Dans le code client dans le fichier Program.cs, les demandes sont envoyées dans le `GET` et `POST` opérations du service avec l’en-tête HTTP Accept spécifié comme « application/xml » ou « application/json » et le service renvoie une réponse qui format en question.</span><span class="sxs-lookup"><span data-stu-id="c9919-115">In the client code in Program.cs, requests are sent to both the `GET` and `POST` operations of the service with the HTTP Accept header specified as either "application/xml" or "application/json" and the service returns a response in that respective format.</span></span>  
  
 <span data-ttu-id="c9919-116">La sélection impérative du format est aussi utilisée dans l'opération `GET`.</span><span class="sxs-lookup"><span data-stu-id="c9919-116">Also in the `GET` operation, imperative format selection is used.</span></span> <span data-ttu-id="c9919-117">L'opération `GET` recherche un paramètre de chaîne de requête `format` facultatif et si elle en trouve, définit le format de réponse dans la propriété <xref:System.ServiceModel.Web.WebOperationContext.OutgoingResponse%2A>.</span><span class="sxs-lookup"><span data-stu-id="c9919-117">The `GET` operation checks for an optional `format` query-string parameter and if present, sets the response format on the <xref:System.ServiceModel.Web.WebOperationContext.OutgoingResponse%2A> property.</span></span> <span data-ttu-id="c9919-118">Définir impérativement le format de réponse de cette façon substitue la sélection automatique du format effectuée par l’infrastructure WCF.</span><span class="sxs-lookup"><span data-stu-id="c9919-118">Imperatively setting the response format in this way overrides the automatic format selection done by the WCF infrastructure.</span></span>  
  
 <span data-ttu-id="c9919-119">L'exemple est constitué d'un service auto-hébergé et d'un client qui s'exécute dans une application console.</span><span class="sxs-lookup"><span data-stu-id="c9919-119">The sample consists of a self-hosted service and a client that runs within a console application.</span></span> <span data-ttu-id="c9919-120">Lorsque l'application console s'exécute, le client adresse des requêtes au service et affiche les informations pertinentes des réponses dans la fenêtre de console.</span><span class="sxs-lookup"><span data-stu-id="c9919-120">As the console application runs, the client makes requests to the service and writes the pertinent information from the responses to the console window.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="c9919-121">Pour utiliser cet exemple</span><span class="sxs-lookup"><span data-stu-id="c9919-121">To use this sample</span></span>  
  
1.  <span data-ttu-id="c9919-122">Ouvrez la solution de l'exemple Automatic Format Selection.</span><span class="sxs-lookup"><span data-stu-id="c9919-122">Open the solution for the Automatic Format Selection Sample.</span></span> <span data-ttu-id="c9919-123">Pour que l'exemple fonctionne correctement, vous devez exécuter [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] en tant qu'administrateur.</span><span class="sxs-lookup"><span data-stu-id="c9919-123">When launching [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)], you must run as an administrator for the sample to execute successfully.</span></span> <span data-ttu-id="c9919-124">Cela en double-cliquant sur le [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icône, sélectionnez **exécuter en tant qu’administrateur** dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="c9919-124">Do this by right-clicking the [!INCLUDE[vs_current_long](../../../../includes/vs-current-long-md.md)] icon and select **Run as Administrator** from the context menu.</span></span>  
  
2.  <span data-ttu-id="c9919-125">Appuyez sur CTRL+MAJT+B pour générer la solution, puis appuyez sur Ctrl+F5 pour exécuter le projet d'application console AutomaticFormatSelection.</span><span class="sxs-lookup"><span data-stu-id="c9919-125">Press CTRL+SHIFT+B to build the solution and then press Ctrl+F5 to run the console application AutomaticFormatSelection project.</span></span> <span data-ttu-id="c9919-126">La fenêtre de console apparaît et fournit l'URI du service en cours d'exécution, ainsi que l'URI de sa page d'aide HTML.</span><span class="sxs-lookup"><span data-stu-id="c9919-126">The console window appears and provides the URI of the running service and the URI of the HTML help page for the running service.</span></span>  
  
3.  <span data-ttu-id="c9919-127">Lorsque l'exemple s'exécute, le client envoie des requêtes au service et affiche les réponses dans la fenêtre de console.</span><span class="sxs-lookup"><span data-stu-id="c9919-127">As the sample runs, the client sends requests to the service and writes the responses to the console window.</span></span> <span data-ttu-id="c9919-128">Remarquez les différents formats des réponses, XML et JSON.</span><span class="sxs-lookup"><span data-stu-id="c9919-128">Notice the different formats of the responses in XML and JSON.</span></span>  
  
4.  <span data-ttu-id="c9919-129">Appuyez sur une touche quelconque pour arrêter l'exemple.</span><span class="sxs-lookup"><span data-stu-id="c9919-129">Press any key to terminate the sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="c9919-130">Les exemples peuvent déjà être installés sur votre ordinateur.</span><span class="sxs-lookup"><span data-stu-id="c9919-130">The samples may already be installed on your machine.</span></span> <span data-ttu-id="c9919-131">Recherchez le répertoire (par défaut) suivant avant de continuer.</span><span class="sxs-lookup"><span data-stu-id="c9919-131">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="c9919-132">Si ce répertoire n’existe pas, accédez à [Windows Communication Foundation (WCF) et des exemples de Windows Workflow Foundation (WF) pour .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) pour télécharger tous les Windows Communication Foundation (WCF) et [!INCLUDE[wf1](../../../../includes/wf1-md.md)] exemples.</span><span class="sxs-lookup"><span data-stu-id="c9919-132">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="c9919-133">Cet exemple se trouve dans le répertoire suivant.</span><span class="sxs-lookup"><span data-stu-id="c9919-133">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Basic\Web\AutomaticFormatSelection`  
  
## <a name="see-also"></a><span data-ttu-id="c9919-134">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="c9919-134">See Also</span></span>
