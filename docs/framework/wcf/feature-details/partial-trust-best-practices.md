---
title: Meilleures pratiques dans un environnement de confiance partielle
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 0d052bc0-5b98-4c50-8bb5-270cc8a8b145
caps.latest.revision: "17"
author: Erikre
ms.author: erikre
manager: erikre
ms.openlocfilehash: cbe782d117fee7c1cd8b8cb6fd3710e2adac77e5
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="partial-trust-best-practices"></a><span data-ttu-id="7bb9b-102">Meilleures pratiques dans un environnement de confiance partielle</span><span class="sxs-lookup"><span data-stu-id="7bb9b-102">Partial Trust Best Practices</span></span>
<span data-ttu-id="7bb9b-103">Cette rubrique décrit les meilleures pratiques lors de l'exécution de [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] dans un environnement de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-103">This topic describes best practices when running [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] in a partial trust environment.</span></span>  
  
## <a name="serialization"></a><span data-ttu-id="7bb9b-104">Sérialisation</span><span class="sxs-lookup"><span data-stu-id="7bb9b-104">Serialization</span></span>  
 <span data-ttu-id="7bb9b-105">Appliquez les pratiques suivantes lors de l'utilisation du <xref:System.Runtime.Serialization.DataContractSerializer> dans une application de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-105">Apply the following practices when using the <xref:System.Runtime.Serialization.DataContractSerializer> in a partially-trusted application.</span></span>  
  
-   <span data-ttu-id="7bb9b-106">Tous les types sérialisables doivent être marqués explicitement avec l'attribut `[DataContract]`.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-106">All serializable types must be explicitly marked with the `[DataContract]` attribute.</span></span> <span data-ttu-id="7bb9b-107">Les techniques suivantes ne sont pas prises en charge dans un environnement de confiance partielle :</span><span class="sxs-lookup"><span data-stu-id="7bb9b-107">The following techniques are not supported in a partial trust environment:</span></span>  
  
-   <span data-ttu-id="7bb9b-108">Marquage des classes à sérialiser avec le <xref:System.SerializableAttribute>.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-108">Marking classes to be serialized with the <xref:System.SerializableAttribute>.</span></span>  
  
-   <span data-ttu-id="7bb9b-109">L'implémentation de l'interface <xref:System.Runtime.Serialization.ISerializable> pour permettre à une classe de contrôler son processus de sérialisation.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-109">Implementing the <xref:System.Runtime.Serialization.ISerializable> interface to allow a class to control its serialization process.</span></span>  
  
### <a name="using-datacontractserializer"></a><span data-ttu-id="7bb9b-110">Utilisation de DataContractSerializer</span><span class="sxs-lookup"><span data-stu-id="7bb9b-110">Using DataContractSerializer</span></span>  
  
-   <span data-ttu-id="7bb9b-111">Tous les types marqués avec l'attribut `[DataContract]` doivent être publics.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-111">All types marked with the `[DataContract]` attribute must be public.</span></span> <span data-ttu-id="7bb9b-112">Les types non publics ne peuvent pas être sérialisés dans un environnement de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-112">Non-public types cannot be serialized in a partial trust environment.</span></span>  
  
-   <span data-ttu-id="7bb9b-113">Tous les membres `[DataContract]` dans un type `[DataContract]` sérialisable doivent être publics.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-113">All `[DataContract]` members in a serializable `[DataContract]` type must be public.</span></span> <span data-ttu-id="7bb9b-114">Un type avec un `[DataMember]` non public ne peut pas être sérialisé dans un environnement de confiance partielle.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-114">A type with a non-public `[DataMember]` cannot be serialized in a partial trust environment.</span></span>  
  
-   <span data-ttu-id="7bb9b-115">Les méthodes qui gèrent des événements de sérialisation (telles que `OnSerializing`, `OnSerialized`, `OnDeserializing`et `OnDeserialized`) doivent être déclarées comme publiques.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-115">Methods that handle serialization events (such as `OnSerializing`, `OnSerialized`, `OnDeserializing`, and `OnDeserialized`) must be declared as public.</span></span> <span data-ttu-id="7bb9b-116">Toutefois, les implémentations explicites et implicites de <xref:System.Runtime.Serialization.IDeserializationCallback.OnDeserialization%28System.Object%29> sont prises en charge.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-116">However, both explicit and implicit implementations of <xref:System.Runtime.Serialization.IDeserializationCallback.OnDeserialization%28System.Object%29> are supported.</span></span>  
  
-   <span data-ttu-id="7bb9b-117">Les types `[DataContract]` implémentés dans les assemblys marqués avec <xref:System.Security.AllowPartiallyTrustedCallersAttribute> ne doivent pas effectuer d'actions relatives à la sécurité dans le constructeur de type, étant donné que <xref:System.Runtime.Serialization.DataContractSerializer> n'appelle pas le constructeur de l'objet instancié récemment pendant la désérialisation.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-117">`[DataContract]` types implemented in assemblies marked with the <xref:System.Security.AllowPartiallyTrustedCallersAttribute> must not perform security-related actions in the type constructor, as the <xref:System.Runtime.Serialization.DataContractSerializer> does not call the constructor of the newly-instantiated object during deserialization.</span></span> <span data-ttu-id="7bb9b-118">En particulier, les techniques de sécurité courantes suivantes doivent être évitées pour les types `[DataContract]` :</span><span class="sxs-lookup"><span data-stu-id="7bb9b-118">Specifically, the following common security techniques must be avoided for `[DataContract]` types:</span></span>  
  
-   <span data-ttu-id="7bb9b-119">Tenter de restreindre l'accès de confiance partielle en rendant le constructeur du type interne ou privé.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-119">Attempting to restrict partial trust access by making the type's constructor internal or private.</span></span>  
  
-   <span data-ttu-id="7bb9b-120">Restreindre l'accès au type en ajoutant un `[LinkDemand]` au constructeur du type.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-120">Restricting access to the type by adding a `[LinkDemand]` to the type's constructor.</span></span>  
  
-   <span data-ttu-id="7bb9b-121">Supposer que du fait de l'instanciation correcte de l'objet, les contrôles de validation appliqués par le constructeur ont réussi.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-121">Assuming that because the object has been successfully instantiated, any validation checks enforced by the constructor have passed successfully.</span></span>  
  
### <a name="using-ixmlserializable"></a><span data-ttu-id="7bb9b-122">Utilisation de IXmlSerializable</span><span class="sxs-lookup"><span data-stu-id="7bb9b-122">Using IXmlSerializable</span></span>  
 <span data-ttu-id="7bb9b-123">Les meilleures pratiques suivantes s'appliquent aux types qui implémentent <xref:System.Xml.Serialization.IXmlSerializable> et sont sérialisés à l'aide du <xref:System.Runtime.Serialization.DataContractSerializer> :</span><span class="sxs-lookup"><span data-stu-id="7bb9b-123">The following best practices apply for types that implement <xref:System.Xml.Serialization.IXmlSerializable> and are serialized using the <xref:System.Runtime.Serialization.DataContractSerializer>:</span></span>  
  
-   <span data-ttu-id="7bb9b-124">Les implémentations de méthode statique <xref:System.Xml.Serialization.IXmlSerializable.GetSchema%2A> doivent être `public`.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-124">The <xref:System.Xml.Serialization.IXmlSerializable.GetSchema%2A> static method implementations must be `public`.</span></span>  
  
-   <span data-ttu-id="7bb9b-125">Les méthodes d'instance qui implémentent l'interface <xref:System.Xml.Serialization.IXmlSerializable> doivent être `public`.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-125">The instance methods that implement the <xref:System.Xml.Serialization.IXmlSerializable> interface must be `public`.</span></span>  
  
## <a name="using-wcf-from-fully-trusted-platform-code-that-allows-calls-from-partially-trusted-callers"></a><span data-ttu-id="7bb9b-126">Utilisation de WCF à partir d'un code de plateforme d'un niveau de confiance suffisant qui autorise les appels d'appelants d'un niveau de confiance partiel</span><span class="sxs-lookup"><span data-stu-id="7bb9b-126">Using WCF from Fully-Trusted Platform Code that Allows Calls from Partially Trusted Callers</span></span>  
 <span data-ttu-id="7bb9b-127">Le modèle de sécurité de confiance partielle [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] suppose que tout appelant d'une méthode ou propriété publique [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] s'exécute dans le contexte de sécurité d'accès du code (CAS) de l'application d'hébergement.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-127">The [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] partial trust security model assumes that any caller of a [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] public method or property is running in the code access security (CAS) context of the hosting application.</span></span> [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="7bb9b-128"> suppose également qu'un seul contexte de sécurité des applications existe pour chaque <xref:System.AppDomain>, et que ce contexte est établi à l'heure de création <xref:System.AppDomain> par un hôte approuvé (par exemple, par un appel à <xref:System.AppDomain.CreateDomain%2A> ou par le Gestionnaire d'applications ASP.NET).</span><span class="sxs-lookup"><span data-stu-id="7bb9b-128"> also assumes that only one application security context exists for each <xref:System.AppDomain>, and that this context is established at <xref:System.AppDomain> creation time by a trusted host (for example, by a call to <xref:System.AppDomain.CreateDomain%2A> or by the ASP.NET Application Manager).</span></span>  
  
 <span data-ttu-id="7bb9b-129">Ce modèle de sécurité s'applique aux applications écrites par l'utilisateur qui ne peuvent pas déclarer des autorisations CAS supplémentaires, telles que l'exécution du code utilisateur dans une application ASP.NET de confiance moyenne.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-129">This security model applies to user-written applications that cannot assert additional CAS permissions, such as user code running in a Medium Trust ASP.NET application.</span></span> <span data-ttu-id="7bb9b-130">Toutefois, le code de plateforme d'un niveau de confiance total (par exemple, un assembly tiers installé dans le cache d'assembly global et qui accepte des appels de code de niveau de confiance partiel) doit faire preuve de prudence lors de l'appel dans [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] au nom d'une application de confiance partielle pour éviter d'introduire des failles de sécurité au niveau de l'application.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-130">However, fully-trusted platform code (for example, a third-party assembly that is installed in the global assembly cache and accepts calls from partially-trusted code) must take explicit care when calling into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] on behalf of a partially-trusted application to avoid introducing application-level security vulnerabilities.</span></span>  
  
 <span data-ttu-id="7bb9b-131">Le code de confiance totale doit éviter de modifier le jeu d'autorisations CAS du thread actuel (en appelant la méthode <xref:System.Security.PermissionSet.Assert%2A> <xref:System.Security.PermissionSet.PermitOnly%2A> ou <xref:System.Security.PermissionSet.Deny%2A>) avant d'appeler les API de [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] de la part du code d'un niveau de confiance partiel.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-131">Full-trust code should avoid altering the CAS permission set of the current thread (by calling <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, or <xref:System.Security.PermissionSet.Deny%2A>) prior to calling [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] APIs on behalf of partially-trusted code.</span></span> <span data-ttu-id="7bb9b-132">La déclaration ou le refus, ou toute création d'un contexte d'autorisation spécifique au thread qui est indépendant du contexte de sécurité au niveau de l'application, peut entraîner un comportement imprévu.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-132">Asserting, denying, or otherwise creating a thread-specific permission context that is independent of the application-level security context can result in unexpected behavior.</span></span> <span data-ttu-id="7bb9b-133">Selon l'application, ce comportement peut provoquer des failles de sécurité au niveau de l'application.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-133">Depending on the application, this behavior may result in application-level security vulnerabilities.</span></span>  
  
 <span data-ttu-id="7bb9b-134">Le code qui appelle dans [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] à l'aide d'un contexte d'autorisation spécifique au thread doit être prêt à gérer les situations suivantes susceptibles de se produire :</span><span class="sxs-lookup"><span data-stu-id="7bb9b-134">Code that calls into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] using a thread-specific permission context must be prepared to handle the following situations that may arise:</span></span>  
  
-   <span data-ttu-id="7bb9b-135">Le contexte de sécurité spécifique au thread ne peut pas être maintenu pour la durée de l'opération, ce qui provoque des exceptions de sécurité potentielles.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-135">The thread-specific security context may not be maintained for the duration of the operation, which results in potential security exceptions.</span></span>  
  
-   <span data-ttu-id="7bb9b-136">Le code [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] interne, ainsi que tous les rappels fournis par l'utilisateur, peuvent s'exécuter dans un contexte de sécurité différent de celui dans lequel l'appel a été initialisé à l'origine.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-136">Internal [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] code as well as any user-provided callbacks may run in a different security context than the one under which the call was originally initiated.</span></span> <span data-ttu-id="7bb9b-137">Ces contextes sont les suivants :</span><span class="sxs-lookup"><span data-stu-id="7bb9b-137">These contexts include:</span></span>  
  
    -   <span data-ttu-id="7bb9b-138">Le contexte d'autorisation d'application.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-138">The application permission context.</span></span>  
  
    -   <span data-ttu-id="7bb9b-139">Tout contexte d'autorisation spécifique au thread créé précédemment par d'autres threads utilisateur utilisés pour appeler dans [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] pendant la durée de vie du <xref:System.AppDomain> en cours d'exécution.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-139">Any thread-specific permission context previously created by other user threads used to call into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] during the lifetime of the currently running <xref:System.AppDomain>.</span></span>  
  
 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)]<span data-ttu-id="7bb9b-140"> garantit que le code d'un niveau de confiance partiel ne peut pas obtenir des autorisations de confiance totale sauf si ces autorisations sont déclarées par un composant d'un niveau de confiance total avant d'appeler dans les API publiques de [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="7bb9b-140"> guarantees that partially-trusted code cannot obtain full-trust permissions unless such permissions are asserted by a fully-trusted component prior to calling into [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] public APIs.</span></span> <span data-ttu-id="7bb9b-141">Toutefois, il ne garantit pas que les effets de la déclaration de la confiance totale sont isolés d'un thread, d'une opération ou d'une action utilisateur en particulier.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-141">However, it does not guarantee that the effects of asserting full trust is isolated to a particular thread, operation, or user action.</span></span>  
  
 <span data-ttu-id="7bb9b-142">La meilleure pratique consiste à éviter de créer le contexte d'autorisation spécifique au thread en appelant <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A> ou <xref:System.Security.PermissionSet.Deny%2A>.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-142">As a best practice, avoid creating thread-specific permission context by calling <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.PermitOnly%2A>, or <xref:System.Security.PermissionSet.Deny%2A>.</span></span> <span data-ttu-id="7bb9b-143">Au lieu de cela, accordez ou refusez le privilège à l'application, afin qu'aucune méthode <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.Deny%2A> ou <xref:System.Security.PermissionSet.PermitOnly%2A> ne soit requise.</span><span class="sxs-lookup"><span data-stu-id="7bb9b-143">Instead, grant or deny the privilege to the application itself, so that no <xref:System.Security.PermissionSet.Assert%2A>, <xref:System.Security.PermissionSet.Deny%2A>, or <xref:System.Security.PermissionSet.PermitOnly%2A> is required.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="7bb9b-144">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="7bb9b-144">See Also</span></span>  
 <xref:System.Runtime.Serialization.DataContractSerializer>  
 <xref:System.Xml.Serialization.IXmlSerializable>
