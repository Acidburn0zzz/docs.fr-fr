---
title: "Éléments internes de l'hôte du service de workflow"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: af44596f-bf6a-4149-9f04-08d8e8f45250
caps.latest.revision: "5"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: cf12cac374759c1cb45a7086ac771a982758e78f
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/02/2017
---
# <a name="workflow-service-host-internals"></a><span data-ttu-id="713f0-102">Éléments internes de l'hôte du service de workflow</span><span class="sxs-lookup"><span data-stu-id="713f0-102">Workflow Service Host Internals</span></span>
<span data-ttu-id="713f0-103"><xref:System.ServiceModel.WorkflowServiceHost> fournit un hôte pour les services basés sur des workflows.</span><span class="sxs-lookup"><span data-stu-id="713f0-103"><xref:System.ServiceModel.WorkflowServiceHost> provides a host for workflow services.</span></span> <span data-ttu-id="713f0-104">Elle est chargée d'écouter les messages entrants et de les router vers l'instance de service de workflow appropriée, contrôle le déchargement et la persistance des workflows inactifs, et plus encore.</span><span class="sxs-lookup"><span data-stu-id="713f0-104">It is responsible for listening for incoming messages and routing them to the appropriate workflow service instance, it controls unloading and persisting of idle workflows, and more.</span></span> <span data-ttu-id="713f0-105">Cette rubrique explique comment WorkflowServiceHost traite les messages entrants.</span><span class="sxs-lookup"><span data-stu-id="713f0-105">This topic describes how WorkflowServiceHost processes incoming messages.</span></span>  
  
## <a name="workflowservicehost-overview"></a><span data-ttu-id="713f0-106">Vue d'ensemble WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="713f0-106">WorkflowServiceHost Overview</span></span>  
 <span data-ttu-id="713f0-107">La classe <xref:System.ServiceModel.WorkflowServiceHost> permet d'héberger des services de workflow.</span><span class="sxs-lookup"><span data-stu-id="713f0-107">The <xref:System.ServiceModel.WorkflowServiceHost> class is used to host workflow services.</span></span> <span data-ttu-id="713f0-108">Elle écoute les messages entrants et les route vers l'instance de service appropriée, en créant de nouvelles instances ou en chargeant des instances existantes à partir d'un stockage durable, selon les besoins.</span><span class="sxs-lookup"><span data-stu-id="713f0-108">It listens for incoming messages and routes them to the appropriate service instance, creating new instances or loading existing instances from durable storage as needed.</span></span>  <span data-ttu-id="713f0-109">Le diagramme suivant illustre le fonctionnement général de <xref:System.ServiceModel.WorkflowServiceHost>.</span><span class="sxs-lookup"><span data-stu-id="713f0-109">The following diagram illustrates on a high level how <xref:System.ServiceModel.WorkflowServiceHost> works.</span></span>  
  
 <span data-ttu-id="713f0-110">![Vue d’ensemble WorkflowServiceHost](../../../../docs/framework/wcf/feature-details/media/wfshhighlevel.gif "WFSHHighLevel")</span><span class="sxs-lookup"><span data-stu-id="713f0-110">![WorkflowServiceHost Overview](../../../../docs/framework/wcf/feature-details/media/wfshhighlevel.gif "WFSHHighLevel")</span></span>  
  
 <span data-ttu-id="713f0-111">Ce diagramme montre que la classe <xref:System.ServiceModel.WorkflowServiceHost> charge les définitions de service de workflow à partir de fichiers .xamlx et les informations de configuration à partir d'un fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="713f0-111">This diagram shows that <xref:System.ServiceModel.WorkflowServiceHost> loads workflow service definitions from .xamlx files and loads configuration information from a configuration file.</span></span> <span data-ttu-id="713f0-112">Elle charge aussi la configuration du suivi à partir du profil de suivi.</span><span class="sxs-lookup"><span data-stu-id="713f0-112">It also loads tracking configuration from the tracking profile.</span></span> <span data-ttu-id="713f0-113"><xref:System.ServiceModel.WorkflowServiceHost> expose un point de terminaison de contrôle de workflow qui vous permet d'envoyer des opérations de contrôle à des instances de workflow.</span><span class="sxs-lookup"><span data-stu-id="713f0-113"><xref:System.ServiceModel.WorkflowServiceHost> exposes a workflow control endpoint which allows you to send control operations to workflow instances.</span></span>  <span data-ttu-id="713f0-114">Pour plus d’informations, consultez [point de terminaison de contrôle de flux de travail](../../../../docs/framework/wcf/feature-details/workflow-control-endpoint.md) et [exemple de point de terminaison de gestion de flux de travail](../../../../docs/framework/windows-workflow-foundation/samples/workflow-management-endpoint-sample.md).</span><span class="sxs-lookup"><span data-stu-id="713f0-114">For more information see [Workflow Control Endpoint](../../../../docs/framework/wcf/feature-details/workflow-control-endpoint.md) and [Workflow Management Endpoint Sample](../../../../docs/framework/windows-workflow-foundation/samples/workflow-management-endpoint-sample.md).</span></span>  
  
 <span data-ttu-id="713f0-115"><xref:System.ServiceModel.WorkflowServiceHost> expose aussi des points de terminaison d'application qui écoutent les messages d'application entrants.</span><span class="sxs-lookup"><span data-stu-id="713f0-115"><xref:System.ServiceModel.WorkflowServiceHost> also exposes application endpoints that listen for incoming application messages.</span></span> <span data-ttu-id="713f0-116">Un message entrant qui arrive est envoyé à l'instance de service de workflow appropriée (si celle-ci est actuellement chargée).</span><span class="sxs-lookup"><span data-stu-id="713f0-116">When an incoming message arrives it is sent to the appropriate workflow service instance (if it is currently loaded).</span></span> <span data-ttu-id="713f0-117">Au besoin, une nouvelle instance de workflow est créée.</span><span class="sxs-lookup"><span data-stu-id="713f0-117">If needed a new workflow instance is created.</span></span> <span data-ttu-id="713f0-118">Cependant, si une instance existante a été rendue persistante, elle est chargée à partir du magasin de persistance.</span><span class="sxs-lookup"><span data-stu-id="713f0-118">Or if an existing instance has been persisted it is loaded from the persistence store.</span></span>  
  
## <a name="workflowservicehost-details"></a><span data-ttu-id="713f0-119">Détails de WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="713f0-119">WorkflowServiceHost Details</span></span>  
 <span data-ttu-id="713f0-120">Le diagramme suivant montre un peu plus en détail la façon dont <xref:System.ServiceModel.WorkflowServiceHost> traite les messages.</span><span class="sxs-lookup"><span data-stu-id="713f0-120">The following diagram shows how <xref:System.ServiceModel.WorkflowServiceHost> handles messages in a bit more detail.</span></span>  
  
 <span data-ttu-id="713f0-121">![Hôte de Service de flux de travail des flux de messages](../../../../docs/framework/wcf/feature-details/media/wfshmessageflow.gif "WFSHMessageFlow")</span><span class="sxs-lookup"><span data-stu-id="713f0-121">![Workflow Service Host Message Flow](../../../../docs/framework/wcf/feature-details/media/wfshmessageflow.gif "WFSHMessageFlow")</span></span>  
  
 <span data-ttu-id="713f0-122">Ce diagramme présente trois points de terminaison distincts : un point de terminaison d'application, un point de terminaison de contrôle de workflow et un point de terminaison d'hébergement de workflow.</span><span class="sxs-lookup"><span data-stu-id="713f0-122">This diagram shows three different endpoints, an application endpoint, a workflow control endpoint, and a workflow hosting endpoint.</span></span> <span data-ttu-id="713f0-123">Le point de terminaison d'application reçoit les messages liés à une instance de workflow spécifique.</span><span class="sxs-lookup"><span data-stu-id="713f0-123">The application endpoint receives messages that are bound for a specific workflow instance.</span></span> <span data-ttu-id="713f0-124">Le point de terminaison de contrôle de workflow écoute les opérations de contrôle.</span><span class="sxs-lookup"><span data-stu-id="713f0-124">The workflow control endpoint listens for control operations.</span></span> <span data-ttu-id="713f0-125">Le point de terminaison d'hébergement de workflow écoute les messages qui entraînent le chargement et l'exécution par <xref:System.ServiceModel.WorkflowServiceHost> de workflows sans service.</span><span class="sxs-lookup"><span data-stu-id="713f0-125">The workflow hosting endpoint listens for messages that cause <xref:System.ServiceModel.WorkflowServiceHost> to load and execute non-service workflows.</span></span> <span data-ttu-id="713f0-126">Comme le montre le diagramme, tous les messages sont traités via le runtime WCF.</span><span class="sxs-lookup"><span data-stu-id="713f0-126">As shown in the diagram all messages are processed through the WCF runtime.</span></span>  <span data-ttu-id="713f0-127">La limitation d'instance de service de workflow s'effectue à l'aide de la propriété <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentInstances%2A>.</span><span class="sxs-lookup"><span data-stu-id="713f0-127">Workflow service instance throttling is achieved by using the <xref:System.ServiceModel.Description.ServiceThrottlingBehavior.MaxConcurrentInstances%2A> property.</span></span> <span data-ttu-id="713f0-128">Cette propriété limite le nombre d'instances de service de workflow.</span><span class="sxs-lookup"><span data-stu-id="713f0-128">This property will limit the number of concurrent workflow service instances.</span></span> <span data-ttu-id="713f0-129">En cas de dépassement de cette limite, les demandes supplémentaires de nouvelle instance de service de workflow ou les demandes d'activation d'instances de workflow persistantes seront mises en file d'attente.</span><span class="sxs-lookup"><span data-stu-id="713f0-129">When this throttle is exceeded any additional requests for new workflow service instances or requests to activate persisted workflow instances will be queued.</span></span> <span data-ttu-id="713f0-130">Les demandes mises en file d'attente sont traitées dans l'ordre FIFO (premier entré, premier sorti) qu'il s'agisse de demandes de nouvelle instance ou d'une instance en cours d'exécution, persistante.</span><span class="sxs-lookup"><span data-stu-id="713f0-130">The queued requests are processed in FIFO order regardless of whether they are requests for a new instance or a running, persisted instance.</span></span> <span data-ttu-id="713f0-131">Des informations de stratégie d'hôte qui déterminent le mode de traitement des exceptions non gérées et la façon dont les services de workflow inactifs sont déchargés et rendus persistants sont chargées.</span><span class="sxs-lookup"><span data-stu-id="713f0-131">Host policy information is loaded that determines how unhandled exceptions are dealt with, and how idle workflow services are unloaded and persisted.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="713f0-132">Ces rubriques voir [Comment : configurer les flux de travail non gérée comportement d’Exception avec WorkflowServiceHost](../../../../docs/framework/wcf/feature-details/config-workflow-unhandled-exception-workflowservicehost.md) et [Comment : configurer le comportement inactif avec WorkflowServiceHost](../../../../docs/framework/wcf/feature-details/how-to-configure-idle-behavior-with-workflowservicehost.md).</span><span class="sxs-lookup"><span data-stu-id="713f0-132"> these topics see [How to: Configure Workflow Unhandled Exception Behavior with WorkflowServiceHost](../../../../docs/framework/wcf/feature-details/config-workflow-unhandled-exception-workflowservicehost.md) and [How to: Configure Idle Behavior with WorkflowServiceHost](../../../../docs/framework/wcf/feature-details/how-to-configure-idle-behavior-with-workflowservicehost.md).</span></span> <span data-ttu-id="713f0-133">Les instances de workflow sont rendues persistantes conformément aux stratégies d'hôte, puis rechargées selon les besoins.</span><span class="sxs-lookup"><span data-stu-id="713f0-133">Workflow instances are persisted according to host policies and are reloaded when needed.</span></span> <span data-ttu-id="713f0-134">Pour plus d’informations sur la persistance des flux de travail, consultez : [Comment : configurer la persistance avec WorkflowServiceHost](../../../../docs/framework/wcf/feature-details/how-to-configure-persistence-with-workflowservicehost.md), [création d’un Service de flux de travail de longue](../../../../docs/framework/wcf/feature-details/creating-a-long-running-workflow-service.md), et [persistance de Workflow ](../../../../docs/framework/windows-workflow-foundation/workflow-persistence.md).</span><span class="sxs-lookup"><span data-stu-id="713f0-134">For more information about workflow persistence see: [How to: Configure Persistence with WorkflowServiceHost](../../../../docs/framework/wcf/feature-details/how-to-configure-persistence-with-workflowservicehost.md), [Creating a Long-running Workflow Service](../../../../docs/framework/wcf/feature-details/creating-a-long-running-workflow-service.md), and [Workflow Persistence](../../../../docs/framework/windows-workflow-foundation/workflow-persistence.md).</span></span>  
  
 <span data-ttu-id="713f0-135">L'illustration suivante montre ce qui se passe suite à l'appel de WorkflowServiceHost.Open.</span><span class="sxs-lookup"><span data-stu-id="713f0-135">The following illustration shows what the WorkflowServiceHost.Open is called.</span></span>  
  
 <span data-ttu-id="713f0-136">![Lorsque WorkflowServiceHost.Open est appelé](../../../../docs/framework/wcf/feature-details/media/wfhostopen.gif "WFHostOpen")</span><span class="sxs-lookup"><span data-stu-id="713f0-136">![When WorkflowServiceHost.Open is called](../../../../docs/framework/wcf/feature-details/media/wfhostopen.gif "WFHostOpen")</span></span>  
  
 <span data-ttu-id="713f0-137">Le workflow est chargé à partir du XAML et l’arborescence d’activité est créée.</span><span class="sxs-lookup"><span data-stu-id="713f0-137">The workflow is loaded from XAML and the activity tree is created.</span></span> <span data-ttu-id="713f0-138"><xref:System.ServiceModel.WorkflowServiceHost> parcourt l'arborescence d'activité et crée la description du service.</span><span class="sxs-lookup"><span data-stu-id="713f0-138"><xref:System.ServiceModel.WorkflowServiceHost> walks the activity tree and creates the service description.</span></span> <span data-ttu-id="713f0-139">La configuration est appliquée à l'hôte.</span><span class="sxs-lookup"><span data-stu-id="713f0-139">Configuration is applied to the host.</span></span> <span data-ttu-id="713f0-140">Enfin, l'hôte commence à écouter les messages entrants.</span><span class="sxs-lookup"><span data-stu-id="713f0-140">Finally the host begins to listen for incoming messages.</span></span>  
  
 <span data-ttu-id="713f0-141">L'illustration suivante montre ce que fait <xref:System.ServiceModel.WorkflowServiceHost> à réception d'un message lié à une activité Receive dont CanCreateInstance a la valeur `true`.</span><span class="sxs-lookup"><span data-stu-id="713f0-141">The following illustration shows what the <xref:System.ServiceModel.WorkflowServiceHost> does when it receives a message bound for a Receive activity that has CanCreateInstance set to `true`.</span></span>  
  
 <span data-ttu-id="713f0-142">![Hôte de Service de flux de travail reçoit un message](../../../../docs/framework/wcf/feature-details/media/wfhreceivemessagecci.gif "WFHReceiveMessageCCI")</span><span class="sxs-lookup"><span data-stu-id="713f0-142">![Workflow Service Host Receives a message](../../../../docs/framework/wcf/feature-details/media/wfhreceivemessagecci.gif "WFHReceiveMessageCCI")</span></span>  
  
 <span data-ttu-id="713f0-143">Le message arrive et est traité par la pile de canaux WCF.</span><span class="sxs-lookup"><span data-stu-id="713f0-143">The message arrives and is processed by the WCF channel stack.</span></span> <span data-ttu-id="713f0-144">Les limitations sont vérifiées et les requêtes de corrélation exécutées.</span><span class="sxs-lookup"><span data-stu-id="713f0-144">Throttles are checked and correlation queries are executed.</span></span> <span data-ttu-id="713f0-145">Si le message est lié à une instance existante, il est remis.</span><span class="sxs-lookup"><span data-stu-id="713f0-145">If the message is bound for an existing instance the message is delivered.</span></span> <span data-ttu-id="713f0-146">Si une nouvelle instance doit être créée, la propriété CanCreateInstance de l'activité Receive est vérifiée.</span><span class="sxs-lookup"><span data-stu-id="713f0-146">If a new instance needs to be created, the Receive activity’s CanCreateInstance property is checked.</span></span> <span data-ttu-id="713f0-147">Si sa valeur est true, une nouvelle instance est créée et le message est remis.</span><span class="sxs-lookup"><span data-stu-id="713f0-147">If it is set to true, a new instance is created and the message is delivered.</span></span>  
  
 <span data-ttu-id="713f0-148">L'illustration suivante montre ce que fait <xref:System.ServiceModel.WorkflowServiceHost> à réception d'un message lié à une activité Receive dont CanCreateInstance a la valeur false.</span><span class="sxs-lookup"><span data-stu-id="713f0-148">The following illustration shows what the <xref:System.ServiceModel.WorkflowServiceHost> does when it receives a message bound for a Receive activity that has CanCreateInstance set to false.</span></span>  
  
 <span data-ttu-id="713f0-149">![WorkflowServiceHost reçoit un message](../../../../docs/framework/wcf/feature-details/media/wfshreceivemessage.gif "WFSHReceiveMessage")</span><span class="sxs-lookup"><span data-stu-id="713f0-149">![WorkflowServiceHost receives a message](../../../../docs/framework/wcf/feature-details/media/wfshreceivemessage.gif "WFSHReceiveMessage")</span></span>  
  
 <span data-ttu-id="713f0-150">Le message arrive et est traité par la pile de canaux WCF.</span><span class="sxs-lookup"><span data-stu-id="713f0-150">The message arrives and is processed by the WCF channel stack.</span></span> <span data-ttu-id="713f0-151">Les limitations sont vérifiées et les requêtes de corrélation exécutées.</span><span class="sxs-lookup"><span data-stu-id="713f0-151">Throttles are checked and correlation queries are executed.</span></span> <span data-ttu-id="713f0-152">Le message est lié à une instance existante (puisque CanCreateInstance a la valeur false), de sorte que l'instance est chargée à partir du magasin de persistance, le signet est repris et le workflow s'exécute.</span><span class="sxs-lookup"><span data-stu-id="713f0-152">The message is bound for an existing instance (because CanCreateInstance is false) so the instance is loaded from persistence store, the bookmark is resumed and the workflow executes.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="713f0-153">Si SQL Server est configuré de façon à n'écouter que le protocole NamedPipe, l'ouverture de l'hôte du service de workflow échoue.</span><span class="sxs-lookup"><span data-stu-id="713f0-153">Workflow Service Host will fail to open if SQL Server is configured to listen on NamedPipe protocol only.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="713f0-154">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="713f0-154">See Also</span></span>  
 [<span data-ttu-id="713f0-155">Services de workflow</span><span class="sxs-lookup"><span data-stu-id="713f0-155">Workflow Services</span></span>](../../../../docs/framework/wcf/feature-details/workflow-services.md)  
 [<span data-ttu-id="713f0-156">Services d’hébergement de flux de travail</span><span class="sxs-lookup"><span data-stu-id="713f0-156">Hosting Workflow Services</span></span>](../../../../docs/framework/wcf/feature-details/hosting-workflow-services.md)  
 [<span data-ttu-id="713f0-157">Point de terminaison de contrôle du flux de travail</span><span class="sxs-lookup"><span data-stu-id="713f0-157">Workflow Control Endpoint</span></span>](../../../../docs/framework/wcf/feature-details/workflow-control-endpoint.md)  
 [<span data-ttu-id="713f0-158">Exemple de point de terminaison de gestion de flux de travail</span><span class="sxs-lookup"><span data-stu-id="713f0-158">Workflow Management Endpoint Sample</span></span>](../../../../docs/framework/windows-workflow-foundation/samples/workflow-management-endpoint-sample.md)  
 [<span data-ttu-id="713f0-159">Comment : configurer les flux de travail non gérée de comportement des exceptions avec WorkflowServiceHost</span><span class="sxs-lookup"><span data-stu-id="713f0-159">How to: Configure Workflow Unhandled Exception Behavior with WorkflowServiceHost</span></span>](../../../../docs/framework/wcf/feature-details/config-workflow-unhandled-exception-workflowservicehost.md)  
 [<span data-ttu-id="713f0-160">Création d’un Service de flux de travail de longue</span><span class="sxs-lookup"><span data-stu-id="713f0-160">Creating a Long-running Workflow Service</span></span>](../../../../docs/framework/wcf/feature-details/creating-a-long-running-workflow-service.md)  
 [<span data-ttu-id="713f0-161">Persistance du workflow</span><span class="sxs-lookup"><span data-stu-id="713f0-161">Workflow Persistence</span></span>](../../../../docs/framework/windows-workflow-foundation/workflow-persistence.md)
