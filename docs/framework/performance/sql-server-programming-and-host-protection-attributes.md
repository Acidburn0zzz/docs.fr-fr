---
title: Attributs de programmation et de protection des hôtes SQL Server
ms.date: 03/30/2017
helpviewer_keywords:
- SQL Server [.NET Framework]
- permission sets, SQL Server
- SQL Server Programming and Host Protection Attributes
- managed code, SQL Server
- reliability [.NET Framework]
- writing reliable code
- hosts, reliability
- host protection attributes
- HostProtectionAttribute class, reliability
ms.assetid: 7dfa36b4-e773-4c75-a3ff-ff1af3ce4c4f
author: mairaw
ms.author: mairaw
ms.openlocfilehash: f1049187dabbea64599617bb4372ed50515a51e3
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/08/2019
ms.locfileid: "59088717"
---
# <a name="sql-server-programming-and-host-protection-attributes"></a>Attributs de programmation et de protection des hôtes SQL Server
Pouvoir charger et exécuter du code managé sur un hôte SQL Server nécessite de remplir les exigences de l’hôte en matière de sécurité d’accès du code et de protection des ressources de l’hôte.  Les exigences de sécurité d’accès au code sont spécifiées par un des trois jeux d’autorisations SQL Server : SAFE, EXTERNAL-ACCESS ou UNSAFE. Le code exécuté dans les jeux d’autorisations SAFE ou EXTERNAL-ACCESS doit éviter certains types ou membres dont l’attribut <xref:System.Security.Permissions.HostProtectionAttribute> est appliqué. <xref:System.Security.Permissions.HostProtectionAttribute> n’est pas tant une autorisation de sécurité qu’une garantie de fiabilité, car il identifie des constructions de code spécifiques, à savoir des types ou des méthodes, que l’hôte peut interdire.  L’utilisation de l’attribut <xref:System.Security.Permissions.HostProtectionAttribute> permet d’appliquer un modèle de programmation qui contribue à améliorer la stabilité de l’hôte.  
  
## <a name="host-protection-attributes"></a>Attributs de protection de l’hôte  
 Les attributs de protection de l’hôte identifient les types ou les membres qui ne sont pas adaptés au modèle de programmation de l’hôte et représentent les niveaux croissants suivants de menace pour la fiabilité :  
  
-   Sans gravité par ailleurs.  
  
-   Risque d’instabilité du code utilisateur managé par le serveur.  
  
-   Risque d’instabilité du processus serveur lui-même.  
  
 SQL Server n’autorise pas l’utilisation d’un type ou d’un membre dont l’attribut <xref:System.Security.Permissions.HostProtectionAttribute> spécifie une valeur <xref:System.Security.Permissions.HostProtectionResource> égale à <xref:System.Security.Permissions.HostProtectionResource.SharedState>, <xref:System.Security.Permissions.HostProtectionResource.Synchronization>, <xref:System.Security.Permissions.HostProtectionResource.MayLeakOnAbort> ou <xref:System.Security.Permissions.HostProtectionResource.ExternalProcessMgmt>. Cela empêche les assemblys d’appeler des membres qui activent l’état de partage, effectuent la synchronisation, peuvent entraîner une fuite de ressource à l’arrêt ou affectent l’intégrité du processus SQL Server.  
  
### <a name="disallowed-types-and-members"></a>Types et membres non autorisés  
 Le tableau suivant identifie les types et les membres dont les valeurs <xref:System.Security.Permissions.HostProtectionResource> ne sont pas autorisées par SQL Server.  
  
|Espace de noms|Type ou membre|  
|---------------|--------------------|  
|`Microsoft.Win32`|<xref:Microsoft.Win32.PowerModeChangedEventArgs> class<br /><br /> <xref:Microsoft.Win32.PowerModeChangedEventHandler> délégué<br /><br /> <xref:Microsoft.Win32.SessionEndedEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionEndedEventHandler> délégué<br /><br /> <xref:Microsoft.Win32.SessionEndingEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionEndingEventHandler> délégué<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventArgs> class<br /><br /> <xref:Microsoft.Win32.SessionSwitchEventHandler> délégué<br /><br /> <xref:Microsoft.Win32.SystemEvents> class<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventArgs> class<br /><br /> <xref:Microsoft.Win32.TimerElapsedEventHandler> délégué<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangedEventArgs> class<br /><br /> <xref:Microsoft.Win32.UserPreferenceChangingEventArgs> class|  
|`System.Collections`|<xref:System.Collections.ArrayList.Synchronized%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Collections.Hashtable.Synchronized%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Collections.Queue.Synchronized%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Collections.SortedList.Synchronized%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Collections.Stack.Synchronized%2A?displayProperty=nameWithType> méthode|  
|`System.ComponentModel`|<xref:System.ComponentModel.AddingNewEventArgs> class<br /><br /> <xref:System.ComponentModel.AddingNewEventHandler> délégué<br /><br /> <xref:System.ComponentModel.ArrayConverter> class<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventArgs> class<br /><br /> <xref:System.ComponentModel.AsyncCompletedEventHandler> délégué<br /><br /> <xref:System.ComponentModel.AsyncOperation> class<br /><br /> <xref:System.ComponentModel.AsyncOperationManager> class<br /><br /> <xref:System.ComponentModel.AttributeCollection> class<br /><br /> <xref:System.ComponentModel.BackgroundWorker> class<br /><br /> <xref:System.ComponentModel.BaseNumberConverter> class<br /><br /> <xref:System.ComponentModel.BindingList%601> class<br /><br /> <xref:System.ComponentModel.BooleanConverter> class<br /><br /> <xref:System.ComponentModel.ByteConverter> class<br /><br /> <xref:System.ComponentModel.CancelEventArgs> class<br /><br /> <xref:System.ComponentModel.CancelEventHandler> délégué<br /><br /> <xref:System.ComponentModel.CharConverter> class<br /><br /> <xref:System.ComponentModel.CollectionChangeEventArgs> class<br /><br /> <xref:System.ComponentModel.CollectionChangeEventHandler> délégué<br /><br /> <xref:System.ComponentModel.CollectionConverter> class<br /><br /> <xref:System.ComponentModel.ComponentCollection> class<br /><br /> <xref:System.ComponentModel.ComponentConverter> class<br /><br /> <xref:System.ComponentModel.ComponentEditor> class<br /><br /> <xref:System.ComponentModel.ComponentResourceManager> class<br /><br /> <xref:System.ComponentModel.Container> class<br /><br /> <xref:System.ComponentModel.ContainerFilterService> class<br /><br /> <xref:System.ComponentModel.CultureInfoConverter> class<br /><br /> <xref:System.ComponentModel.CustomTypeDescriptor> class<br /><br /> <xref:System.ComponentModel.DateTimeConverter> class<br /><br /> <xref:System.ComponentModel.DecimalConverter> class<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ActiveDesignerEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.CheckoutException> class<br /><br /> <xref:System.ComponentModel.Design.CommandID> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangedEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentChangingEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.ComponentEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.ComponentRenameEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.DesignerCollection> class<br /><br /> <xref:System.ComponentModel.Design.DesignerEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.DesignerEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.DesignerOptionService> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransaction> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.DesignerTransactionCloseEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.DesignerVerb> class<br /><br /> <xref:System.ComponentModel.Design.DesignerVerbCollection> class<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContext> class<br /><br /> <xref:System.ComponentModel.Design.DesigntimeLicenseContextSerializer> class<br /><br /> <xref:System.ComponentModel.Design.MenuCommand> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ComponentSerializationService> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ContextStack> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.DesignerLoader> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.InstanceDescriptor> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.MemberRelationshipService> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventArgs> class<br /><br /> <xref:System.ComponentModel.Design.Serialization.ResolveNameEventHandler> délégué<br /><br /> <xref:System.ComponentModel.Design.Serialization.SerializationStore> class<br /><br /> <xref:System.ComponentModel.Design.ServiceContainer> class<br /><br /> <xref:System.ComponentModel.Design.ServiceCreatorCallback> délégué<br /><br /> <xref:System.ComponentModel.Design.StandardCommands> class<br /><br /> <xref:System.ComponentModel.Design.StandardToolWindows> class<br /><br /> <xref:System.ComponentModel.DoubleConverter> class<br /><br /> <xref:System.ComponentModel.DoWorkEventArgs> class<br /><br /> <xref:System.ComponentModel.DoWorkEventHandler> délégué<br /><br /> <xref:System.ComponentModel.EnumConverter> class<br /><br /> <xref:System.ComponentModel.EventDescriptor> class<br /><br /> <xref:System.ComponentModel.EventDescriptorCollection> class<br /><br /> <xref:System.ComponentModel.EventHandlerList> class<br /><br /> <xref:System.ComponentModel.ExpandableObjectConverter> class<br /><br /> <xref:System.ComponentModel.HandledEventArgs> class<br /><br /> <xref:System.ComponentModel.HandledEventHandler> délégué<br /><br /> <xref:System.ComponentModel.InstanceCreationEditor> class<br /><br /> <xref:System.ComponentModel.Int16Converter> class<br /><br /> <xref:System.ComponentModel.Int32Converter> class<br /><br /> <xref:System.ComponentModel.Int64Converter> class<br /><br /> <xref:System.ComponentModel.InvalidAsynchronousStateException> class<br /><br /> <xref:System.ComponentModel.InvalidEnumArgumentException> class<br /><br /> <xref:System.ComponentModel.ISynchronizeInvoke.BeginInvoke%2A> méthode<br /><br /> <xref:System.ComponentModel.License> class<br /><br /> <xref:System.ComponentModel.LicenseContext> class<br /><br /> <xref:System.ComponentModel.LicenseException> class<br /><br /> <xref:System.ComponentModel.LicenseManager> class<br /><br /> <xref:System.ComponentModel.LicenseProvider> class<br /><br /> <xref:System.ComponentModel.LicFileLicenseProvider> class<br /><br /> <xref:System.ComponentModel.ListChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.ListChangedEventHandler> délégué<br /><br /> <xref:System.ComponentModel.ListSortDescription> class<br /><br /> <xref:System.ComponentModel.ListSortDescriptionCollection> class<br /><br /> <xref:System.ComponentModel.MaskedTextProvider> class<br /><br /> <xref:System.ComponentModel.MemberDescriptor> class<br /><br /> <xref:System.ComponentModel.MultilineStringConverter> class<br /><br /> <xref:System.ComponentModel.NestedContainer> class<br /><br /> <xref:System.ComponentModel.NullableConverter> class<br /><br /> <xref:System.ComponentModel.ProgressChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.ProgressChangedEventHandler> délégué<br /><br /> <xref:System.ComponentModel.PropertyChangedEventArgs> class<br /><br /> <xref:System.ComponentModel.PropertyChangedEventHandler> délégué<br /><br /> <xref:System.ComponentModel.PropertyDescriptor> class<br /><br /> <xref:System.ComponentModel.PropertyDescriptorCollection> class<br /><br /> <xref:System.ComponentModel.ReferenceConverter> class<br /><br /> <xref:System.ComponentModel.RefreshEventArgs> class<br /><br /> <xref:System.ComponentModel.RefreshEventHandler> délégué<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventArgs> class<br /><br /> <xref:System.ComponentModel.RunWorkerCompletedEventHandler> délégué<br /><br /> <xref:System.ComponentModel.SByteConverter> class<br /><br /> <xref:System.ComponentModel.SingleConverter> class<br /><br /> <xref:System.ComponentModel.StringConverter> class<br /><br /> <xref:System.ComponentModel.SyntaxCheck> class<br /><br /> <xref:System.ComponentModel.TimeSpanConverter> class<br /><br /> <xref:System.ComponentModel.TypeConverter> class<br /><br /> <xref:System.ComponentModel.TypeDescriptionProvider> class<br /><br /> <xref:System.ComponentModel.TypeDescriptor> class<br /><br /> <xref:System.ComponentModel.TypeListConverter> class<br /><br /> <xref:System.ComponentModel.UInt16Converter> class<br /><br /> <xref:System.ComponentModel.UInt32Converter> class<br /><br /> <xref:System.ComponentModel.UInt64Converter> class<br /><br /> <xref:System.ComponentModel.WarningException> class<br /><br /> <xref:System.ComponentModel.Win32Exception> class|  
|`System.Diagnostics`|<xref:System.Diagnostics.Debug.Listeners%2A?displayProperty=nameWithType> propriété<br /><br /> <xref:System.Diagnostics.Trace.Listeners%2A?displayProperty=nameWithType> propriété<br /><br /> <xref:System.Diagnostics.EventLog.SynchronizingObject%2A?displayProperty=nameWithType> propriété<br /><br /> <xref:System.Diagnostics.ConsoleTraceListener> class<br /><br /> <xref:System.Diagnostics.DefaultTraceListener> class<br /><br /> <xref:System.Diagnostics.DelimitedListTraceListener> class<br /><br /> <xref:System.Diagnostics.EventLogTraceListener> class<br /><br /> <xref:System.Diagnostics.PerformanceCounter> class<br /><br /> <xref:System.Diagnostics.PerformanceCounterCategory> class<br /><br /> <xref:System.Diagnostics.Process> class<br /><br /> <xref:System.Diagnostics.ProcessStartInfo> class<br /><br /> <xref:System.Diagnostics.TextWriterTraceListener> class<br /><br /> <xref:System.Diagnostics.TraceListener> class<br /><br /> <xref:System.Diagnostics.XmlWriterTraceListener> class<br /><br /> <xref:System.Diagnostics.TraceSource.Listeners%2A?displayProperty=nameWithType> propriété|  
|`System.IO`|<xref:System.IO.Stream.Synchronized%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.IO.TextReader.Synchronized%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.IO.TextWriter.Synchronized%2A?displayProperty=nameWithType> méthode|  
|`System.Reflection.Emit`|<xref:System.Reflection.Emit.ConstructorBuilder> class<br /><br /> <xref:System.Reflection.Emit.EventBuilder> class<br /><br /> <xref:System.Reflection.Emit.FieldBuilder> class<br /><br /> <xref:System.Reflection.Emit.MethodBuilder> class<br /><br /> <xref:System.Reflection.Emit.CustomAttributeBuilder> class<br /><br /> <xref:System.Reflection.Emit.MethodRental> class<br /><br /> <xref:System.Reflection.Emit.ModuleBuilder> class<br /><br /> <xref:System.Reflection.Emit.PropertyBuilder> class<br /><br /> <xref:System.Reflection.Emit.TypeBuilder> class<br /><br /> <xref:System.Reflection.Emit.UnmanagedMarshal> class|  
|`System.Text`|<xref:System.Text.RegularExpressions.Group.Synchronized%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Text.RegularExpressions.Match.Synchronized%2A?displayProperty=nameWithType> méthode|  
|`System.Threading`|<xref:System.Threading.AutoResetEvent> class<br /><br /> <xref:System.Threading.EventWaitHandle> class<br /><br /> <xref:System.Threading.ManualResetEvent> class<br /><br /> <xref:System.Threading.Monitor> class<br /><br /> <xref:System.Threading.Mutex> class<br /><br /> <xref:System.Threading.ReaderWriterLock> class<br /><br /> <xref:System.Threading.Semaphore> class<br /><br /> <xref:System.Threading.Thread.AllocateNamedDataSlot%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.BeginCriticalRegion%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.EndCriticalRegion%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.FreeNamedDataSlot%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.GetData%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.SetApartmentState%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.SetData%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.SpinWait%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.Thread.TrySetApartmentState%2A?displayProperty=nameWithType> méthode<br /><br /> <xref:System.Threading.ThreadPool> class<br /><br /> <xref:System.Threading.Timer> class|  
|`System.Timers`|<xref:System.Timers.Timer> class|  
|`System.Web.Configuration`|<xref:System.Web.Configuration.MachineKeyValidationConverter> class|  
|`System.Windows.Forms`|<xref:System.Windows.Forms.AutoCompleteStringCollection.SyncRoot%2A?displayProperty=nameWithType> propriété|  
  
## <a name="sql-server-permission-sets"></a>Jeux d’autorisations SQL Server  
 SQL Server permet aux utilisateurs de spécifier les exigences de fiabilité du code déployé dans une base de données. Lorsque les assemblys sont chargés dans la base de données, l’auteur de l’assembly peut spécifier un des trois jeux d’autorisations pour cet assembly : SAFE, EXTERNAL-ACCESS ou UNSAFE.  
  
|Jeu d’autorisations|SAFE|EXTERNAL-ACCESS|UNSAFE|  
|--------------------|----------|----------------------|------------|  
|Sécurité d'accès du code|Exécution uniquement|Exécution + accès aux ressources externes|Non restreint|  
|Restrictions du modèle de programmation|Oui|Oui|Aucune restriction|  
|Vérifiabilité requise|Oui|Oui|Non|  
|Possibilité d’appeler du code natif|Non|Non|Oui|  
  
 SAFE est le mode le plus fiable et le plus sécurisé avec des restrictions associées quant au modèle de programmation autorisé. Le code SAFE présente des fonctionnalités de sécurité et de fiabilité élevées. Les assemblys SAFE ont des autorisations suffisantes pour s’exécuter, effectuer des calculs et accéder à la base de données locale. Les assemblys SAFE doivent être de type sécurisé vérifié et ne sont pas autorisés à appeler du code non managé.  
  
 EXTERNAL-ACCESS fournit une option de sécurité intermédiaire. Il permet au code d’accéder à des ressources externes à la base de données, tout en offrant la fiabilité et la sécurité de SAFE.  
  
 UNSAFE est réservé au code entièrement fiable qui peut être créé uniquement par les administrateurs de base de données. Ce code entièrement fiable n’a pas de restrictions d’accès du code et peut appeler du code non managé (natif).  
  
 SQL Server utilise la couche de stratégie de sécurité d’accès du code au niveau de l’hôte pour définir une stratégie d’hébergement qui accorde l’un des trois jeux d’autorisations en fonction du jeu d’autorisations stocké dans les catalogues SQL Server. Le code managé exécuté dans la base de données obtient toujours l’un de ces jeux d’autorisations d’accès du code.  
  
## <a name="programming-model-restrictions"></a>Restrictions du modèle de programmation  
 Le modèle de programmation du code managé dans SQL Server nécessite des fonctions, des procédures et des types qui n’ont pas besoin d’utiliser un état maintenu entre les appels ou de partager l’état entre plusieurs sessions utilisateur. Par ailleurs, comme décrit précédemment, la présence d’un état partagé peut provoquer des exceptions critiques qui affectent l’extensibilité et la fiabilité de l’application.  
  
 Pour ces raisons, SQL Server n’autorise pas l’utilisation de variables statiques ni de membres de données statiques. Pour les assemblys SAFE et EXTERNAL-ACCESS, SQL Server examine les métadonnées des assemblys au moment de leur création et ne crée pas ces assemblys s’il détecte la présence de membres de données ou variables statiques.  
  
## <a name="see-also"></a>Voir aussi

- <xref:System.Security.Permissions.HostProtectionAttribute>
- <xref:System.Security.Permissions.HostProtectionResource>
