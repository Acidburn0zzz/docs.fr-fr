---
title: "Comment : déterminer si un travail d'impression peut être imprimé à cette heure de la journée"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
- cpp
helpviewer_keywords:
- print queues [WPF], timing
- printers [WPF], availability
- print jobs [WPF], timing
ms.assetid: 7e9c8ec1-abf6-4b3d-b1c6-33b35d3c4063
caps.latest.revision: "9"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 9ac89b8dce67c95c78a5dd46e591d84730a68346
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 11/21/2017
---
# <a name="how-to-discover-whether-a-print-job-can-be-printed-at-this-time-of-day"></a><span data-ttu-id="fbac2-102">Comment : déterminer si un travail d'impression peut être imprimé à cette heure de la journée</span><span class="sxs-lookup"><span data-stu-id="fbac2-102">How to: Discover Whether a Print Job Can Be Printed At This Time of Day</span></span>
<span data-ttu-id="fbac2-103">Les files d’attente d’impression ne sont pas toujours disponibles pour 24 heures par jour.</span><span class="sxs-lookup"><span data-stu-id="fbac2-103">Print queues are not always available for 24 hours a day.</span></span> <span data-ttu-id="fbac2-104">Ils ont des propriétés au moment du début et de fin qui peuvent être définies pour les rendre indisponibles à certains moments de la journée.</span><span class="sxs-lookup"><span data-stu-id="fbac2-104">They have start and end time properties that can be set to make them unavailable at certain times of day.</span></span> <span data-ttu-id="fbac2-105">Cette fonctionnalité peut être utilisée, par exemple, pour réserver une imprimante à l’usage exclusif d’un département après 17 h 00.</span><span class="sxs-lookup"><span data-stu-id="fbac2-105">This feature can be used, for example, to reserve a printer for the exclusive use of a certain department after 5 P.M..</span></span> <span data-ttu-id="fbac2-106">Ce service aurait une autre file d’attente l’imprimante que les autres services à utiliser.</span><span class="sxs-lookup"><span data-stu-id="fbac2-106">That department would have a different queue servicing the printer than other departments use.</span></span> <span data-ttu-id="fbac2-107">La file d’attente pour les autres services a la valeur n’est pas disponible après 17 h 00, alors que la file d’attente pour le département privilégié peut être définie pour être disponible à tout moment.</span><span class="sxs-lookup"><span data-stu-id="fbac2-107">The queue for the other departments would be set to be unavailable after 5 P.M., while queue for the favored department could be set to be available at all times.</span></span>  
  
 <span data-ttu-id="fbac2-108">En outre, les travaux d’impression eux-mêmes peuvent être définis pour être imprimables uniquement dans un intervalle de temps spécifié.</span><span class="sxs-lookup"><span data-stu-id="fbac2-108">Moreover, print jobs themselves can be set to be printable only within a specified span of time.</span></span>  
  
 <span data-ttu-id="fbac2-109">Le <xref:System.Printing.PrintQueue> et <xref:System.Printing.PrintSystemJobInfo> classes exposées dans le [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] de [!INCLUDE[TLA#tla_winfx](../../../../includes/tlasharptla-winfx-md.md)] fournissent un moyen de vérifier à distance si un travail d’impression donné peut imprimer sur une file d’attente donnée à l’heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="fbac2-109">The <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> classes exposed in the [!INCLUDE[TLA#tla_api#plural](../../../../includes/tlasharptla-apisharpplural-md.md)] of [!INCLUDE[TLA#tla_winfx](../../../../includes/tlasharptla-winfx-md.md)] provide a means for remotely checking whether a given print job can print on a given queue at the current time.</span></span>  
  
## <a name="example"></a><span data-ttu-id="fbac2-110">Exemple</span><span class="sxs-lookup"><span data-stu-id="fbac2-110">Example</span></span>  
 <span data-ttu-id="fbac2-111">L’exemple ci-dessous est un exemple qui peut diagnostiquer les problèmes liés à un travail d’impression.</span><span class="sxs-lookup"><span data-stu-id="fbac2-111">The example below is a sample that can diagnose problems with a print job.</span></span>  
  
 <span data-ttu-id="fbac2-112">Il existe deux principales étapes de ce type de fonction comme suit.</span><span class="sxs-lookup"><span data-stu-id="fbac2-112">There are two major steps for this kind of function as follows.</span></span>  
  
1.  <span data-ttu-id="fbac2-113">Lecture la <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> et <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> propriétés de la <xref:System.Printing.PrintQueue> pour déterminer si l’heure actuelle est entre eux.</span><span class="sxs-lookup"><span data-stu-id="fbac2-113">Read the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintQueue> to determine whether the current time is between them.</span></span>  
  
2.  <span data-ttu-id="fbac2-114">Lecture la <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> et <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> propriétés de la <xref:System.Printing.PrintSystemJobInfo> pour déterminer si l’heure actuelle est entre eux.</span><span class="sxs-lookup"><span data-stu-id="fbac2-114">Read the <xref:System.Printing.PrintSystemJobInfo.StartTimeOfDay%2A> and <xref:System.Printing.PrintSystemJobInfo.UntilTimeOfDay%2A> properties of the <xref:System.Printing.PrintSystemJobInfo> to determine whether the current time is between them.</span></span>  
  
 <span data-ttu-id="fbac2-115">Mais les complications provient du fait que ces propriétés ne sont pas <xref:System.DateTime> objets.</span><span class="sxs-lookup"><span data-stu-id="fbac2-115">But complications arise from the fact that these properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="fbac2-116">Au lieu de cela, ils sont <xref:System.Int32> objets qui expriment l’heure du jour en tant que le nombre de minutes depuis minuit.</span><span class="sxs-lookup"><span data-stu-id="fbac2-116">Instead they are <xref:System.Int32> objects that express the time of day as the number of minutes since midnight.</span></span> <span data-ttu-id="fbac2-117">En outre, il n’est pas minuit dans le fuseau horaire actuel, mais minuit UTC (Coordinated Universal Time).</span><span class="sxs-lookup"><span data-stu-id="fbac2-117">Moreover, this is not midnight in the current time zone, but midnight UTC (Coordinated Universal Time).</span></span>  
  
 <span data-ttu-id="fbac2-118">Le premier exemple de code présente la méthode statique **ReportQueueAndJobAvailability**, qui est passé un <xref:System.Printing.PrintSystemJobInfo> et appelle les méthodes d’assistance pour déterminer si le travail peut être imprimé à l’heure actuelle et, si, quand il peut s’impriment pas.</span><span class="sxs-lookup"><span data-stu-id="fbac2-118">The first code example presents the static method **ReportQueueAndJobAvailability**, which is passed a <xref:System.Printing.PrintSystemJobInfo> and calls helper methods to determine whether the job can print at the current time and, if not, when it can print.</span></span> <span data-ttu-id="fbac2-119">Notez qu’un <xref:System.Printing.PrintQueue> n’est pas passé à la méthode.</span><span class="sxs-lookup"><span data-stu-id="fbac2-119">Notice that a <xref:System.Printing.PrintQueue> is not passed to the method.</span></span> <span data-ttu-id="fbac2-120">C’est parce que le <xref:System.Printing.PrintSystemJobInfo> inclut une référence à la file d’attente dans son <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> propriété.</span><span class="sxs-lookup"><span data-stu-id="fbac2-120">This is because the <xref:System.Printing.PrintSystemJobInfo> includes a reference to the queue in its <xref:System.Printing.PrintSystemJobInfo.HostingPrintQueue%2A> property.</span></span>  
  
 <span data-ttu-id="fbac2-121">Les méthodes subordonnées incluent surchargées **ReportAvailabilityAtThisTime** méthode qui peut également accepter soit un <xref:System.Printing.PrintQueue> ou un <xref:System.Printing.PrintSystemJobInfo> en tant que paramètre.</span><span class="sxs-lookup"><span data-stu-id="fbac2-121">The subordinate methods include the overloaded **ReportAvailabilityAtThisTime** method which can take either a <xref:System.Printing.PrintQueue> or a <xref:System.Printing.PrintSystemJobInfo> as a parameter.</span></span> <span data-ttu-id="fbac2-122">Il existe également un **TimeConverter.ConvertToLocalHumanReadableTime**.</span><span class="sxs-lookup"><span data-stu-id="fbac2-122">There is also a **TimeConverter.ConvertToLocalHumanReadableTime**.</span></span> <span data-ttu-id="fbac2-123">Toutes ces méthodes sont décrites ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="fbac2-123">All of these methods are discussed below.</span></span>  
  
 <span data-ttu-id="fbac2-124">Le **ReportQueueAndJobAvailability** méthode commence par vérifier si la file d’attente ou le travail d’impression n’est pas disponible pour l’instant.</span><span class="sxs-lookup"><span data-stu-id="fbac2-124">The **ReportQueueAndJobAvailability** method begins by checking to see if either the queue or the print job is unavailable at this time.</span></span> <span data-ttu-id="fbac2-125">Si un d’eux n’est pas disponible, il vérifie ensuite si la file d’attente est indisponible.</span><span class="sxs-lookup"><span data-stu-id="fbac2-125">If either of them is unavailable, it then checks to see if the queue unavailable.</span></span> <span data-ttu-id="fbac2-126">S’il n’est pas disponible, la méthode signale ce fait et l’heure lorsque la file d’attente est disponible.</span><span class="sxs-lookup"><span data-stu-id="fbac2-126">If it is not available, then the method reports this fact and the time when the queue will become available again.</span></span> <span data-ttu-id="fbac2-127">Il vérifie ensuite le travail et si elle n’est pas disponible, il signale le prochain intervalle pendant qu’elle peut imprimer.</span><span class="sxs-lookup"><span data-stu-id="fbac2-127">It then checks the job and if it is unavailable, it reports the next time span when it when it can print.</span></span> <span data-ttu-id="fbac2-128">Enfin, la méthode signale la première heure lorsque le travail peut être imprimé.</span><span class="sxs-lookup"><span data-stu-id="fbac2-128">Finally, the method reports the earliest time when the job can print.</span></span> <span data-ttu-id="fbac2-129">Ceci est la plus récente de deux fois de suite.</span><span class="sxs-lookup"><span data-stu-id="fbac2-129">This is the later of following two times.</span></span>  
  
-   <span data-ttu-id="fbac2-130">L’heure auxquelles la file d’attente d’impression est ensuite disponible.</span><span class="sxs-lookup"><span data-stu-id="fbac2-130">The time when the print queue is next available.</span></span>  
  
-   <span data-ttu-id="fbac2-131">L’heure auxquelles le travail d’impression est ensuite disponible.</span><span class="sxs-lookup"><span data-stu-id="fbac2-131">The time when the print job is next available.</span></span>  
  
 <span data-ttu-id="fbac2-132">Lors du signalement des heures de la journée, le <xref:System.DateTime.ToShortTimeString%2A> méthode est également appelée car la méthode supprime les années, mois et jours de la sortie.</span><span class="sxs-lookup"><span data-stu-id="fbac2-132">When reporting times of day, the <xref:System.DateTime.ToShortTimeString%2A> method is also called because this method suppresses the years, months, and days from the output.</span></span> <span data-ttu-id="fbac2-133">Vous ne pouvez pas restreindre la disponibilité d’une file d’attente d’impression ou d’un travail d’impression pour les jours, mois ou années particuliers.</span><span class="sxs-lookup"><span data-stu-id="fbac2-133">You cannot restrict the availability of either a print queue or a print job to particular years, months, or days.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#reportqueueandjobavailability)]
 [!code-csharp[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#reportqueueandjobavailability)]
 [!code-vb[DiagnoseProblematicPrintJob#ReportQueueAndJobAvailability](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#reportqueueandjobavailability)]  
  
 <span data-ttu-id="fbac2-134">Les deux surcharges de la **ReportAvailabilityAtThisTime** méthode sont identiques à l’exception du type passé les uns aux autres, ainsi que la <xref:System.Printing.PrintQueue> version est présentée ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="fbac2-134">The two overloads of the **ReportAvailabilityAtThisTime** method are identical except for the type passed to them, so only the <xref:System.Printing.PrintQueue> version is presented below.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="fbac2-135">Le fait que les méthodes sont identiques à l’exception de type déclenche la question de savoir pourquoi l’exemple ne crée pas une méthode générique **ReportAvailabilityAtThisTime\<T >**.</span><span class="sxs-lookup"><span data-stu-id="fbac2-135">The fact that the methods are identical except for type raises the question of why the sample does not create a generic method **ReportAvailabilityAtThisTime\<T>**.</span></span> <span data-ttu-id="fbac2-136">La raison est qu’une telle méthode devrait être limité à une classe qui a le **StartTimeOfDay** et **UntilTimeOfDay** propriétés de la méthode appelle, mais une méthode générique peut uniquement être limité à un une seule classe et la seule classe commune aux deux <xref:System.Printing.PrintQueue> et <xref:System.Printing.PrintSystemJobInfo> l’héritage arborescence est <xref:System.Printing.PrintSystemObject> n’ayant pas de telles propriétés.</span><span class="sxs-lookup"><span data-stu-id="fbac2-136">The reason is that such a method would have to be restricted to a class that has the **StartTimeOfDay** and **UntilTimeOfDay** properties that the method calls, but a generic method can only be restricted to a single class and the only class common to both <xref:System.Printing.PrintQueue> and <xref:System.Printing.PrintSystemJobInfo> in the inheritance tree is <xref:System.Printing.PrintSystemObject> which has no such properties.</span></span>  
  
 <span data-ttu-id="fbac2-137">Le **ReportAvailabilityAtThisTime** (méthode) (présentée dans l’exemple de code ci-dessous) commence par initialiser un <xref:System.Boolean> variable sentinelle `true`.</span><span class="sxs-lookup"><span data-stu-id="fbac2-137">The **ReportAvailabilityAtThisTime** method (presented in the code example below) begins by initializing a <xref:System.Boolean> sentinel variable to `true`.</span></span> <span data-ttu-id="fbac2-138">Elle sera réinitialisée à `false`, si la file d’attente n’est pas disponible.</span><span class="sxs-lookup"><span data-stu-id="fbac2-138">It will be reset to `false`, if the queue is not available.</span></span>  
  
 <span data-ttu-id="fbac2-139">Ensuite, la méthode vérifie si le début et « jusqu'à ce que « heures sont identiques.</span><span class="sxs-lookup"><span data-stu-id="fbac2-139">Next, the method checks to see if the start and "until" times are identical.</span></span> <span data-ttu-id="fbac2-140">Dans le cas, la file d’attente est toujours disponible, alors la méthode retourne `true`.</span><span class="sxs-lookup"><span data-stu-id="fbac2-140">If they are, the queue is always available, so the method returns `true`.</span></span>  
  
 <span data-ttu-id="fbac2-141">Si la file d’attente n’est pas disponible tout le temps, la méthode utilise la méthode statique <xref:System.DateTime.UtcNow%2A> propriété à obtenir l’heure actuelle en tant qu’un <xref:System.DateTime> objet.</span><span class="sxs-lookup"><span data-stu-id="fbac2-141">If the queue is not available all the time, the method uses the static <xref:System.DateTime.UtcNow%2A> property to get the current time as a <xref:System.DateTime> object.</span></span> <span data-ttu-id="fbac2-142">(Nous n’avez pas besoin de heure locale, car le <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> et <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> propriétés sont elles-mêmes en heure UTC.)</span><span class="sxs-lookup"><span data-stu-id="fbac2-142">(We do not need local time because the <xref:System.Printing.PrintQueue.StartTimeOfDay%2A> and <xref:System.Printing.PrintQueue.UntilTimeOfDay%2A> properties are themselves in UTC time.)</span></span>  
  
 <span data-ttu-id="fbac2-143">Toutefois, ces deux propriétés ne sont pas <xref:System.DateTime> objets.</span><span class="sxs-lookup"><span data-stu-id="fbac2-143">However, these two properties are not <xref:System.DateTime> objects.</span></span> <span data-ttu-id="fbac2-144">Ils sont <xref:System.Int32>s exprimant le temps que le nombre de minutes après minuit UTC.</span><span class="sxs-lookup"><span data-stu-id="fbac2-144">They are <xref:System.Int32>s expressing the time as the number of minutes-after-UTC-midnight.</span></span> <span data-ttu-id="fbac2-145">Donc nous devons convertir notre <xref:System.DateTime> objet en minutes après minuit.</span><span class="sxs-lookup"><span data-stu-id="fbac2-145">So we do have to convert our <xref:System.DateTime> object to minutes-after-midnight.</span></span> <span data-ttu-id="fbac2-146">Lorsque que vous avez terminé, la méthode vérifie simplement pour voir si « maintenant » est entre le début de la file d’attente et « jusqu'à ce que « heures, définit la sentinelle False si « maintenant » n’est pas entre les deux heures et retourne la sentinelle.</span><span class="sxs-lookup"><span data-stu-id="fbac2-146">When that is done, the method simply checks to see whether "now" is between the queue's start and "until" times, sets the sentinel to false if "now" is not between the two times, and returns the sentinel.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#printqueuestartuntil)]
 [!code-csharp[DiagnoseProblematicPrintJob#PrintQueueStartUntil](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#printqueuestartuntil)]
 [!code-vb[DiagnoseProblematicPrintJob#PrintQueueStartUntil](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#printqueuestartuntil)]  
  
 <span data-ttu-id="fbac2-147">Le **TimeConverter.ConvertToLocalHumanReadableTime** (méthode) (présentée dans l’exemple de code ci-dessous) n’utilise pas les méthodes introduites avec [!INCLUDE[TLA#tla_winfx](../../../../includes/tlasharptla-winfx-md.md)], de sorte que la description est brève.</span><span class="sxs-lookup"><span data-stu-id="fbac2-147">The **TimeConverter.ConvertToLocalHumanReadableTime** method (presented in the code example below) does not use any methods introduced with [!INCLUDE[TLA#tla_winfx](../../../../includes/tlasharptla-winfx-md.md)], so the discussion is brief.</span></span> <span data-ttu-id="fbac2-148">La méthode a une double tâche de conversion : il doit prendre un entier exprimant des minutes après minuit et le convertir en une heure contrôlable de visu et il doit le convertir en heure locale.</span><span class="sxs-lookup"><span data-stu-id="fbac2-148">The method has a double conversion task: it must take an integer expressing minutes-after-midnight and convert it to a human-readable time and it must convert this to the local time.</span></span> <span data-ttu-id="fbac2-149">Il y parvient en créant d’abord un <xref:System.DateTime> objet qui est définie à minuit UTC, puis il utilise le <xref:System.DateTime.AddMinutes%2A> méthode pour ajouter les minutes qui ont été passés à la méthode.</span><span class="sxs-lookup"><span data-stu-id="fbac2-149">It accomplishes this by first creating a <xref:System.DateTime> object that is set to midnight UTC and then it uses the <xref:System.DateTime.AddMinutes%2A> method to add the minutes that were passed to the method.</span></span> <span data-ttu-id="fbac2-150">Cela retourne une nouvelle <xref:System.DateTime> exprimant l’heure d’origine qui a été passé à la méthode.</span><span class="sxs-lookup"><span data-stu-id="fbac2-150">This returns a new <xref:System.DateTime> expressing the original time that was passed to the method.</span></span> <span data-ttu-id="fbac2-151">Le <xref:System.DateTime.ToLocalTime%2A> méthode convertit ensuite cette valeur d’heure locale.</span><span class="sxs-lookup"><span data-stu-id="fbac2-151">The <xref:System.DateTime.ToLocalTime%2A> method then converts this to local time.</span></span>  
  
 [!code-cpp[DiagnoseProblematicPrintJob#TimeConverter](../../../../samples/snippets/cpp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CPP/Program.cpp#timeconverter)]
 [!code-csharp[DiagnoseProblematicPrintJob#TimeConverter](../../../../samples/snippets/csharp/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/CSharp/Program.cs#timeconverter)]
 [!code-vb[DiagnoseProblematicPrintJob#TimeConverter](../../../../samples/snippets/visualbasic/VS_Snippets_Wpf/DiagnoseProblematicPrintJob/visualbasic/program.vb#timeconverter)]  
  
## <a name="see-also"></a><span data-ttu-id="fbac2-152">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="fbac2-152">See Also</span></span>  
 <xref:System.DateTime>  
 <xref:System.Printing.PrintSystemJobInfo>  
 <xref:System.Printing.PrintQueue>  
 [<span data-ttu-id="fbac2-153">Documents dans WPF</span><span class="sxs-lookup"><span data-stu-id="fbac2-153">Documents in WPF</span></span>](../../../../docs/framework/wpf/advanced/documents-in-wpf.md)  
 [<span data-ttu-id="fbac2-154">Vue d’ensemble de l’impression</span><span class="sxs-lookup"><span data-stu-id="fbac2-154">Printing Overview</span></span>](../../../../docs/framework/wpf/advanced/printing-overview.md)
