---
title: "Traçage de données dans ADO.NET"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: a6a752a5-d2a9-4335-a382-b58690ccb79f
caps.latest.revision: "9"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: df958982739c7ab2fd7aba42918b919c25d86829
ms.sourcegitcommit: ed26cfef4e18f6d93ab822d8c29f902cff3519d1
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/17/2018
---
# <a name="data-tracing-in-adonet"></a><span data-ttu-id="496dd-102">Traçage de données dans ADO.NET</span><span class="sxs-lookup"><span data-stu-id="496dd-102">Data Tracing in ADO.NET</span></span>
<span data-ttu-id="496dd-103">ADO.NET introduit une nouvelle fonctionnalité intégrée de traçage de données prise en charge par les fournisseurs de données .NET pour [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)], Oracle, OLE DB et ODBC, de même que l'objet <xref:System.Data.DataSet> ADO.NET et les protocoles réseau [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)].</span><span class="sxs-lookup"><span data-stu-id="496dd-103">ADO.NET features built-in data tracing functionality that is supported by the .NET data providers for [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)], Oracle, OLE DB and ODBC, as well as the ADO.NET <xref:System.Data.DataSet>, and the [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] network protocols.</span></span>  
  
 <span data-ttu-id="496dd-104">Le traçage d'appels API d'accès aux données peut aider à diagnostiquer les problèmes suivants :</span><span class="sxs-lookup"><span data-stu-id="496dd-104">Tracing data access API calls can help diagnose the following problems:</span></span>  
  
-   <span data-ttu-id="496dd-105">discordance de schéma entre le programme client et la base de données ;</span><span class="sxs-lookup"><span data-stu-id="496dd-105">Schema mismatch between client program and the database.</span></span>  
  
-   <span data-ttu-id="496dd-106">problèmes d'indisponibilité de base de données ou de bibliothèque réseau ;</span><span class="sxs-lookup"><span data-stu-id="496dd-106">Database unavailability or network library problems.</span></span>  
  
-   <span data-ttu-id="496dd-107">SQL incorrect qu'il soit en codage dur ou généré par une application ;</span><span class="sxs-lookup"><span data-stu-id="496dd-107">Incorrect SQL whether hard coded or generated by an application.</span></span>  
  
-   <span data-ttu-id="496dd-108">logique de programmation incorrecte ;</span><span class="sxs-lookup"><span data-stu-id="496dd-108">Incorrect programming logic.</span></span>  
  
-   <span data-ttu-id="496dd-109">problèmes résultant de l'interaction entre plusieurs composants ADO.NET ou entre ADO.NET et vos propres composants.</span><span class="sxs-lookup"><span data-stu-id="496dd-109">Issues resulting from the interaction between multiple ADO.NET components or between ADO.NET and your own components.</span></span>  
  
 <span data-ttu-id="496dd-110">Pour prendre en charge plusieurs technologies de traçage, le traçage est extensible, de sorte qu'un développeur peut tracer un problème à tout niveau de la pile d'applications.</span><span class="sxs-lookup"><span data-stu-id="496dd-110">To support different trace technologies, tracing is extensible, so a developer can trace a problem at any level of the application stack.</span></span> <span data-ttu-id="496dd-111">Bien que le traçage ne soit pas une fonctionnalité purement ADO.NET, les fournisseurs Microsoft tirent parti des API de suivi et d’instrumentation généralisées.</span><span class="sxs-lookup"><span data-stu-id="496dd-111">Although tracing is not an ADO.NET-only feature, Microsoft providers take advantage of generalized tracing and instrumentation APIs.</span></span>  
  
 <span data-ttu-id="496dd-112">Pour plus d’informations sur la configuration et la configuration du traçage managé dans ADO.NET, consultez [accès aux données de suivi](http://msdn.microsoft.com/library/hh880086.aspx).</span><span class="sxs-lookup"><span data-stu-id="496dd-112">For more information about setting and configuring managed tracing in ADO.NET, see [Tracing Data Access](http://msdn.microsoft.com/library/hh880086.aspx).</span></span>  
  
## <a name="accessing-diagnostic-information-in-the-extended-events-log"></a><span data-ttu-id="496dd-113">Accès aux informations de diagnostic dans le journal des événements étendus</span><span class="sxs-lookup"><span data-stu-id="496dd-113">Accessing Diagnostic Information in the Extended Events Log</span></span>  
 <span data-ttu-id="496dd-114">Dans le [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] fournisseur de données pour [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)], suivi d’accès aux données ([suivi d’accès aux données](http://msdn.microsoft.com/library/hh880086.aspx)) a été mis à jour pour le rendre plus facile à plus facile à mettre en corrélation des événements clients avec les informations de diagnostic, tels que les échecs de connexion à partir en anneau mémoire tampon et l’application performances informations de connectivité du serveur dans le journal des événements étendus.</span><span class="sxs-lookup"><span data-stu-id="496dd-114">In the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] Data Provider for [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)], data access tracing ([Data Access Tracing](http://msdn.microsoft.com/library/hh880086.aspx)) has been updated to make it easier to easier to correlate client events with diagnostic information, such as connection failures, from the server's connectivity ring buffer and application performance information in the extended events log.</span></span> <span data-ttu-id="496dd-115">Pour plus d’informations sur la lecture du journal des événements étendus, consultez [afficher les données de Session événements](http://msdn.microsoft.com/library/hh710068\(SQL.110\).aspx).</span><span class="sxs-lookup"><span data-stu-id="496dd-115">For information about reading the extended events log, see [View Event Session Data](http://msdn.microsoft.com/library/hh710068\(SQL.110\).aspx).</span></span>  
  
 <span data-ttu-id="496dd-116">Pour les opérations de connexion, ADO.NET envoie un ID de connexion client.</span><span class="sxs-lookup"><span data-stu-id="496dd-116">For connection operations, ADO.NET will send a client connection ID.</span></span> <span data-ttu-id="496dd-117">Si la connexion échoue, vous pouvez accéder à la mémoire tampon en anneau de connectivité ([résolution des problèmes de connectivité dans SQL Server 2008 avec la mémoire tampon en anneau de connectivité](http://go.microsoft.com/fwlink/?LinkId=207752)) et recherchez le `ClientConnectionID` champ et obtenir des informations de diagnostic sur la Échec de connexion.</span><span class="sxs-lookup"><span data-stu-id="496dd-117">If the connection fails, you can access the connectivity ring buffer ([Connectivity troubleshooting in SQL Server 2008 with the Connectivity Ring Buffer](http://go.microsoft.com/fwlink/?LinkId=207752)) and find the `ClientConnectionID` field and get diagnostic information about the connection failure.</span></span> <span data-ttu-id="496dd-118">Les identificateurs de connexion client sont enregistrés dans la mémoire tampon en anneau uniquement si une erreur se produit.</span><span class="sxs-lookup"><span data-stu-id="496dd-118">Client connection IDs are logged in the ring buffer only if an error occurs.</span></span> <span data-ttu-id="496dd-119">(Si une connexion échoue avant l'envoi du paquet de préouverture de session, aucun ID de connexion client n'est généré.) L'ID de connexion client est un GUID de 16 octets.</span><span class="sxs-lookup"><span data-stu-id="496dd-119">(If a connection fails before sending the prelogin packet, a client connection ID will not be generated.) The client connection ID is a 16-byte GUID.</span></span> <span data-ttu-id="496dd-120">Vous pouvez également rechercher l'ID de connexion client dans la sortie cible d'événements étendus, si l'action `client_connection_id` est ajoutée aux événements dans une session d'événements étendus.</span><span class="sxs-lookup"><span data-stu-id="496dd-120">You can also find the client connection ID in the extended events target output, if the `client_connection_id` action is added to events in an extended events session.</span></span> <span data-ttu-id="496dd-121">Vous pouvez activer le traçage d'accès aux données, réexécuter la commande de connexion et observer le champ `ClientConnectionID` dans la trace d'accès aux données, si vous avez besoin d'obtenir une aide supplémentaire pour le diagnostic du pilote client.</span><span class="sxs-lookup"><span data-stu-id="496dd-121">You can enable data access tracing and rerun the connection command and observe the `ClientConnectionID` field in the data access trace, if you need further client driver diagnostic assistance.</span></span>  
  
 <span data-ttu-id="496dd-122">Vous pouvez obtenir l'ID de connexion client par programme à l'aide de la propriété `SqlConnection.ClientConnectionID`.</span><span class="sxs-lookup"><span data-stu-id="496dd-122">You can get the client connection ID programmatically by using the `SqlConnection.ClientConnectionID` property.</span></span>  
  
 <span data-ttu-id="496dd-123">`ClientConnectionID` est disponible pour un objet <xref:System.Data.SqlClient.SqlConnection> qui établit une connexion.</span><span class="sxs-lookup"><span data-stu-id="496dd-123">The `ClientConnectionID` is available for a <xref:System.Data.SqlClient.SqlConnection> object that successfully establishes  a connection.</span></span> <span data-ttu-id="496dd-124">Si une tentative de connexion échoue, `ClientConnectionID` peut être disponible via `SqlException.ToString`.</span><span class="sxs-lookup"><span data-stu-id="496dd-124">If a connection attempt fails, `ClientConnectionID` may be available via `SqlException.ToString`.</span></span>  
  
 <span data-ttu-id="496dd-125">ADO.NET envoie également un ID d'activité propre au thread</span><span class="sxs-lookup"><span data-stu-id="496dd-125">ADO.NET also sends a thread-specific activity ID.</span></span> <span data-ttu-id="496dd-126">L'ID d'activité est capturé dans les sessions des événements étendus si les sessions sont démarrées avec l'option TRACK_CAUSAILITY activée.</span><span class="sxs-lookup"><span data-stu-id="496dd-126">The activity ID is captured in the extended events sessions if the sessions are started with the TRACK_CAUSAILITY option enabled.</span></span> <span data-ttu-id="496dd-127">Pour les problèmes de performances avec une connexion active, vous pouvez obtenir l'ID d'activité de la trace d'accès aux données du client (champ `ActivityID`), puis localiser l'ID d'activité dans la sortie d'événements étendus.</span><span class="sxs-lookup"><span data-stu-id="496dd-127">For performance issues with an active connection, you can get the activity ID from the client's data access trace (`ActivityID` field) and then locate the activity ID in the extended events output.</span></span> <span data-ttu-id="496dd-128">L'ID d'activité dans des événements étendus est un GUID de 16 octets (différent du GUID de l'ID de connexion client) ajouté à un numéro séquentiel à quatre octets.</span><span class="sxs-lookup"><span data-stu-id="496dd-128">The activity ID in extended events is a 16-byte GUID (not the same as the GUID for the client connection ID) appended with a four-byte sequence number.</span></span> <span data-ttu-id="496dd-129">Le numéro séquentiel représente l'ordre d'une demande dans un thread et indique le classement relatif des instructions par lots et RPC pour le thread.</span><span class="sxs-lookup"><span data-stu-id="496dd-129">The sequence number represents the order of a request within a thread and indicates the relative ordering of batch and RPC statements for the thread.</span></span> <span data-ttu-id="496dd-130">`ActivityID` est actuellement éventuellement envoyé pour les instructions par lots SQL et les demandes RPC lorsque le suivi de l'accès aux données est activé et le 18e bit dans le mot de configuration de suivi d'accès aux données est activé.</span><span class="sxs-lookup"><span data-stu-id="496dd-130">The `ActivityID` is currently optionally sent for SQL batch statements and RPC requests when data access tracing is enabled on and the 18th bit in the data access tracing configuration word is turned ON.</span></span>  
  
 <span data-ttu-id="496dd-131">Voici un exemple qui utilise [!INCLUDE[tsql](../../../../includes/tsql-md.md)] pour démarrer une session d'événements étendus qui sera enregistrée dans une mémoire tampon en anneau et indique l'ID d'activité envoyé à partir d'un client sur le RPC et les opérations par lots.</span><span class="sxs-lookup"><span data-stu-id="496dd-131">The following is a sample that uses [!INCLUDE[tsql](../../../../includes/tsql-md.md)] to start an extended events session that will be stored in a ring buffer and will record the activity ID sent from a client on RPC and batch operations.</span></span>  
  
```  
create event session MySession on server   
add event connectivity_ring_buffer_recorded,   
add event sql_statement_starting (action (client_connection_id)),   
add event sql_statement_completed (action (client_connection_id)),   
add event rpc_starting (action (client_connection_id)),   
add event rpc_completed (action (client_connection_id))  
add target ring_buffer with (track_causality=on)  
```  
  
## <a name="see-also"></a><span data-ttu-id="496dd-132">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="496dd-132">See Also</span></span>  
 [<span data-ttu-id="496dd-133">Traçage réseau dans .NET Framework</span><span class="sxs-lookup"><span data-stu-id="496dd-133">Network Tracing in the .NET Framework</span></span>](../../../../docs/framework/network-programming/network-tracing.md)  
 [<span data-ttu-id="496dd-134">Suivi et instrumentation d’applications</span><span class="sxs-lookup"><span data-stu-id="496dd-134">Tracing and Instrumenting Applications</span></span>](../../../../docs/framework/debug-trace-profile/tracing-and-instrumenting-applications.md)  
 [<span data-ttu-id="496dd-135">Fournisseurs managés ADO.NET et centre de développement DataSet</span><span class="sxs-lookup"><span data-stu-id="496dd-135">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
