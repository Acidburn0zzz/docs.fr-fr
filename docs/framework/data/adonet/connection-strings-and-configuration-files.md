---
title: "Chaînes de connexion et fichiers de configuration"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-ado
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
ms.assetid: 37df2641-661e-407a-a3fb-7bf9540f01e8
caps.latest.revision: "4"
author: douglaslMS
ms.author: douglasl
manager: craigg
ms.workload: dotnet
ms.openlocfilehash: 447b2d6c0e5eeafeaff89aa1d6430eec72d59a4d
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/19/2018
---
# <a name="connection-strings-and-configuration-files"></a><span data-ttu-id="4af2e-102">Chaînes de connexion et fichiers de configuration</span><span class="sxs-lookup"><span data-stu-id="4af2e-102">Connection Strings and Configuration Files</span></span>
<span data-ttu-id="4af2e-103">L'incorporation de chaînes de connexion dans le code de votre application peut entraîner des vulnérabilités de sécurité et des problèmes de maintenance.</span><span class="sxs-lookup"><span data-stu-id="4af2e-103">Embedding connection strings in your application's code can lead to security vulnerabilities and maintenance problems.</span></span> <span data-ttu-id="4af2e-104">Les chaînes de connexion non chiffrée compilés dans le code source d’une application peuvent être affichées à l’aide de la [Ildasm.exe (désassembleur IL)](../../../../docs/framework/tools/ildasm-exe-il-disassembler.md) outil.</span><span class="sxs-lookup"><span data-stu-id="4af2e-104">Unencrypted connection strings compiled into an application's source code can be viewed using the [Ildasm.exe (IL Disassembler)](../../../../docs/framework/tools/ildasm-exe-il-disassembler.md) tool.</span></span> <span data-ttu-id="4af2e-105">En outre, si la chaîne de connexion change, votre application doit être recompilée.</span><span class="sxs-lookup"><span data-stu-id="4af2e-105">Moreover, if the connection string ever changes, your application must be recompiled.</span></span> <span data-ttu-id="4af2e-106">Pour ces raisons, nous vous recommandons de stocker les chaînes de connexion dans un fichier de configuration de l'application.</span><span class="sxs-lookup"><span data-stu-id="4af2e-106">For these reasons, we recommend storing connection strings in an application configuration file.</span></span>  
  
## <a name="working-with-application-configuration-files"></a><span data-ttu-id="4af2e-107">Utilisation de fichiers de configuration de l'application</span><span class="sxs-lookup"><span data-stu-id="4af2e-107">Working with Application Configuration Files</span></span>  
 <span data-ttu-id="4af2e-108">Les fichiers de configuration de l'application contiennent des paramètres spécifiques à une application particulière.</span><span class="sxs-lookup"><span data-stu-id="4af2e-108">Application configuration files contain settings that are specific to a particular application.</span></span> <span data-ttu-id="4af2e-109">Par exemple, une application ASP.NET peut posséder un ou plusieurs **web.config** fichiers et une application Windows peuvent avoir un facultatif **app.config** fichier.</span><span class="sxs-lookup"><span data-stu-id="4af2e-109">For example, an ASP.NET application can have one or more **web.config** files, and a Windows application can have an optional **app.config** file.</span></span> <span data-ttu-id="4af2e-110">Les fichiers de configuration partagent des éléments communs, bien que le nom et l'emplacement d'un fichier de configuration varient selon l'hôte de l'application.</span><span class="sxs-lookup"><span data-stu-id="4af2e-110">Configuration files share common elements, although the name and location of a configuration file vary depending on the application's host.</span></span>  
  
### <a name="the-connectionstrings-section"></a><span data-ttu-id="4af2e-111">Section connectionStrings</span><span class="sxs-lookup"><span data-stu-id="4af2e-111">The connectionStrings Section</span></span>  
 <span data-ttu-id="4af2e-112">Chaînes de connexion peuvent être stockées sous forme de paires clé/valeur dans la **connectionStrings** section de la **configuration** élément d’un fichier de configuration d’application.</span><span class="sxs-lookup"><span data-stu-id="4af2e-112">Connection strings can be stored as key/value pairs in the **connectionStrings** section of the **configuration** element of an application configuration file.</span></span> <span data-ttu-id="4af2e-113">Les éléments enfants incluent **ajouter**, **effacer**, et **supprimer**.</span><span class="sxs-lookup"><span data-stu-id="4af2e-113">Child elements include **add**, **clear**, and **remove**.</span></span>  
  
 <span data-ttu-id="4af2e-114">Le fragment de fichier de configuration ci-dessous illustre le schéma et la syntaxe utilisés stocker une chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="4af2e-114">The following configuration file fragment demonstrates the schema and syntax for storing a connection string.</span></span> <span data-ttu-id="4af2e-115">Le **nom** attribut est un nom que vous fournissez pour identifier de façon unique une chaîne de connexion afin qu’elle puisse être récupérée au moment de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="4af2e-115">The **name** attribute is a name that you provide to uniquely identify a connection string so that it can be retrieved at run time.</span></span> <span data-ttu-id="4af2e-116">Le **providerName** correspond au nom invariant du fournisseur de données .NET Framework, qui est enregistré dans le fichier machine.config.</span><span class="sxs-lookup"><span data-stu-id="4af2e-116">The **providerName** is the invariant name of the .NET Framework data provider, which is registered in the machine.config file.</span></span>  
  
```xml  
<?xml version='1.0' encoding='utf-8'?>  
  <configuration>  
    <connectionStrings>  
      <clear />  
      <add name="Name"   
       providerName="System.Data.ProviderName"   
       connectionString="Valid Connection String;" />  
    </connectionStrings>  
  </configuration>  
```  
  
> [!NOTE]
>  <span data-ttu-id="4af2e-117">Vous pouvez enregistrer une partie d'une chaîne de connexion dans un fichier de configuration et utiliser la classe <xref:System.Data.Common.DbConnectionStringBuilder> pour la compléter au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="4af2e-117">You can save part of a connection string in a configuration file and use the <xref:System.Data.Common.DbConnectionStringBuilder> class to complete it at run time.</span></span> <span data-ttu-id="4af2e-118">Cela est utile dans des scénarios où vous ne connaissez pas à l'avance les éléments de la chaîne de connexion ou lorsque vous ne voulez pas enregistrer des informations sensibles dans un fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="4af2e-118">This is useful in scenarios where you do not know elements of the connection string ahead of time, or when you do not want to save sensitive information in a configuration file.</span></span> <span data-ttu-id="4af2e-119">Pour plus d’informations, consultez [générateurs de chaînes de connexion](../../../../docs/framework/data/adonet/connection-string-builders.md).</span><span class="sxs-lookup"><span data-stu-id="4af2e-119">For more information, see [Connection String Builders](../../../../docs/framework/data/adonet/connection-string-builders.md).</span></span>  
  
### <a name="using-external-configuration-files"></a><span data-ttu-id="4af2e-120">Utilisation de fichiers de configuration externes</span><span class="sxs-lookup"><span data-stu-id="4af2e-120">Using External Configuration Files</span></span>  
 <span data-ttu-id="4af2e-121">Les fichiers de configuration externes sont des fichiers distincts qui contiennent un fragment d'un fichier de configuration composé d'une section unique.</span><span class="sxs-lookup"><span data-stu-id="4af2e-121">External configuration files are separate files that contain a fragment of a configuration file consisting of a single section.</span></span> <span data-ttu-id="4af2e-122">Le fichier de configuration externe est ensuite référencé par le fichier de configuration principal.</span><span class="sxs-lookup"><span data-stu-id="4af2e-122">The external configuration file is then referenced by the main configuration file.</span></span> <span data-ttu-id="4af2e-123">Stocker le **connectionStrings** section dans un fichier séparé physiquement est utile dans les situations où les chaînes de connexion peuvent être modifiées une fois que l’application est déployée.</span><span class="sxs-lookup"><span data-stu-id="4af2e-123">Storing the **connectionStrings** section in a physically separate file is useful in situations where connection strings may be edited after the application is deployed.</span></span> <span data-ttu-id="4af2e-124">Par exemple, le comportement ASP.NET standard consiste à redémarrer un domaine d'application lorsque les fichiers de configuration sont modifiés, ce qui entraîne la perte des informations d'état.</span><span class="sxs-lookup"><span data-stu-id="4af2e-124">For example, the standard ASP.NET behavior is to restart an application domain when configuration files are modified, which results in state information being lost.</span></span> <span data-ttu-id="4af2e-125">Toutefois, la modification d'un fichier de configuration externe n'entraîne pas le redémarrage d'une application.</span><span class="sxs-lookup"><span data-stu-id="4af2e-125">However, modifying an external configuration file does not cause an application restart.</span></span> <span data-ttu-id="4af2e-126">Les fichiers de configuration externes ne sont pas limités à ASP.NET ; ils peuvent également être utilisés par des applications Windows.</span><span class="sxs-lookup"><span data-stu-id="4af2e-126">External configuration files are not limited to ASP.NET; they can also be used by Windows applications.</span></span> <span data-ttu-id="4af2e-127">En outre, la sécurité et les autorisations d'accès aux fichiers permettent de limiter l'accès aux fichiers de configuration externes.</span><span class="sxs-lookup"><span data-stu-id="4af2e-127">In addition, file access security and permissions can be used to restrict access to external configuration files.</span></span> <span data-ttu-id="4af2e-128">L'utilisation de fichiers de configuration externes au moment de l'exécution est transparente et ne requiert aucun codage spécial.</span><span class="sxs-lookup"><span data-stu-id="4af2e-128">Working with external configuration files at run time is transparent, and requires no special coding.</span></span>  
  
 <span data-ttu-id="4af2e-129">Pour stocker des chaînes de connexion dans un fichier de configuration externe, créez un fichier distinct contenant uniquement le **connectionStrings** section.</span><span class="sxs-lookup"><span data-stu-id="4af2e-129">To store connection strings in an external configuration file, create a separate file that contains only the **connectionStrings** section.</span></span> <span data-ttu-id="4af2e-130">N'incluez aucun élément, section ou attribut supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="4af2e-130">Do not include any additional elements, sections, or attributes.</span></span> <span data-ttu-id="4af2e-131">L'exemple ci-dessous illustre la syntaxe pour un fichier de configuration externe.</span><span class="sxs-lookup"><span data-stu-id="4af2e-131">This example shows the syntax for an external configuration file.</span></span>  
  
```xml  
<connectionStrings>  
  <add name="Name"   
   providerName="System.Data.ProviderName"   
   connectionString="Valid Connection String;" />  
</connectionStrings>  
```  
  
 <span data-ttu-id="4af2e-132">Dans le fichier de configuration principale de l’application, vous utilisez la **configSource** attribut pour spécifier le nom qualifié complet et l’emplacement du fichier externe.</span><span class="sxs-lookup"><span data-stu-id="4af2e-132">In the main application configuration file, you use the **configSource** attribute to specify the fully qualified name and location of the external file.</span></span> <span data-ttu-id="4af2e-133">Cet exemple fait référence à un fichier de configuration externe nommé `connections.config`.</span><span class="sxs-lookup"><span data-stu-id="4af2e-133">This example refers to an external configuration file named `connections.config`.</span></span>  
  
```xml  
<?xml version='1.0' encoding='utf-8'?>  
<configuration>  
    <connectionStrings configSource="connections.config"/>  
</configuration>  
```  
  
## <a name="retrieving-connection-strings-at-run-time"></a><span data-ttu-id="4af2e-134">Extraction de chaînes de connexion au moment de l'exécution</span><span class="sxs-lookup"><span data-stu-id="4af2e-134">Retrieving Connection Strings at Run Time</span></span>  
 <span data-ttu-id="4af2e-135">Le .NET Framework 2.0 a introduit de nouvelles classes dans l'espace de noms <xref:System.Configuration> afin de simplifier l'extraction des chaînes de connexion à partir des fichiers de configuration au moment de l'exécution.</span><span class="sxs-lookup"><span data-stu-id="4af2e-135">The .NET Framework 2.0 introduced new classes in the <xref:System.Configuration> namespace to simplify retrieving connection strings from configuration files at run time.</span></span> <span data-ttu-id="4af2e-136">Vous pouvez extraire par programme une chaîne de connexion en utilisant son nom ou le nom du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="4af2e-136">You can programmatically retrieve a connection string by name or by provider name.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4af2e-137">Le **machine.config** fichier contient également un **connectionStrings** section, qui contient les chaînes de connexion utilisées par Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="4af2e-137">The **machine.config** file also contains a **connectionStrings** section, which contains connection strings used by Visual Studio.</span></span> <span data-ttu-id="4af2e-138">Lors de la récupération des chaînes de connexion par le nom du fournisseur à partir de la **app.config** fichier dans une application Windows, les chaînes de connexion dans **machine.config** obtenir chargées les premières, puis les entrées à partir de **app.config**. Ajout de **effacer** immédiatement après le **connectionStrings** élément supprime toutes les références héritées de la structure de données en mémoire, afin que seules les chaînes de connexion définies dans local**app.config** fichier sont pris en compte.</span><span class="sxs-lookup"><span data-stu-id="4af2e-138">When retrieving connection strings by provider name from the **app.config** file in a Windows application, the connection strings in **machine.config** get loaded first, and then the entries from **app.config**. Adding **clear** immediately after the **connectionStrings** element removes all inherited references from the data structure in memory, so that only the connection strings defined in the local **app.config** file are considered.</span></span>  
  
### <a name="working-with-the-configuration-classes"></a><span data-ttu-id="4af2e-139">Utilisation des classes de configuration</span><span class="sxs-lookup"><span data-stu-id="4af2e-139">Working with the Configuration Classes</span></span>  
 <span data-ttu-id="4af2e-140">À partir du .NET Framework 2.0, <xref:System.Configuration.ConfigurationManager>est utilisé lors de l'utilisation de fichiers de configuration sur l'ordinateur local, pour remplacer la <xref:System.Configuration.ConfigurationSettings> déconseillée.</span><span class="sxs-lookup"><span data-stu-id="4af2e-140">Starting with the .NET Framework 2.0, <xref:System.Configuration.ConfigurationManager> is used when working with configuration files on the local computer, replacing the deprecated <xref:System.Configuration.ConfigurationSettings>.</span></span> <span data-ttu-id="4af2e-141"><xref:System.Web.Configuration.WebConfigurationManager> permet d'utiliser des fichiers de configuration ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4af2e-141"><xref:System.Web.Configuration.WebConfigurationManager> is used to work with ASP.NET configuration files.</span></span> <span data-ttu-id="4af2e-142">Il est conçu pour fonctionner avec des fichiers de configuration sur un serveur Web et permet un accès par programmation à des sections du fichier de configuration, tels que **system.web**.</span><span class="sxs-lookup"><span data-stu-id="4af2e-142">It is designed to work with configuration files on a Web server, and allows programmatic access to configuration file sections such as **system.web**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4af2e-143">L'accès aux fichiers de configuration au moment de l'exécution exige d'accorder des autorisations à l'appelant ; les autorisations requises dépendent du type d'application, du fichier de configuration et de l'emplacement.</span><span class="sxs-lookup"><span data-stu-id="4af2e-143">Accessing configuration files at run time requires granting permissions to the caller; the required permissions depend on the type of application, configuration file, and location.</span></span> <span data-ttu-id="4af2e-144">Pour plus d’informations, consultez [à l’aide des Classes de Configuration](http://msdn.microsoft.com/library/98d2b386-baf6-4a17-974b-76e3b4c87acc) et <xref:System.Web.Configuration.WebConfigurationManager> pour les applications ASP.NET, et <xref:System.Configuration.ConfigurationManager> pour les applications Windows.</span><span class="sxs-lookup"><span data-stu-id="4af2e-144">For more information, see [Using the Configuration Classes](http://msdn.microsoft.com/library/98d2b386-baf6-4a17-974b-76e3b4c87acc) and <xref:System.Web.Configuration.WebConfigurationManager> for ASP.NET applications, and <xref:System.Configuration.ConfigurationManager> for Windows applications.</span></span>  
  
 <span data-ttu-id="4af2e-145">Vous pouvez utiliser <xref:System.Configuration.ConnectionStringSettingsCollection> pour extraire les chaînes de connexion à partir des fichiers de configuration de l'application.</span><span class="sxs-lookup"><span data-stu-id="4af2e-145">You can use the <xref:System.Configuration.ConnectionStringSettingsCollection> to retrieve connection strings from application configuration files.</span></span> <span data-ttu-id="4af2e-146">Il constituée une collection de <xref:System.Configuration.ConnectionStringSettings> objets, chacun d’eux représente une entrée unique dans le **connectionStrings** section.</span><span class="sxs-lookup"><span data-stu-id="4af2e-146">It contains a collection of <xref:System.Configuration.ConnectionStringSettings> objects, each of which represents a single entry in the **connectionStrings** section.</span></span> <span data-ttu-id="4af2e-147">Ses propriétés correspondent aux attributs des chaînes de connexion, ce qui vous permet d'extraire une chaîne de connexion en spécifiant son nom ou le nom du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="4af2e-147">Its properties map to connection string attributes, allowing you to retrieve a connection string by specifying the name or the provider name.</span></span>  
  
|<span data-ttu-id="4af2e-148">Propriété</span><span class="sxs-lookup"><span data-stu-id="4af2e-148">Property</span></span>|<span data-ttu-id="4af2e-149">Description</span><span class="sxs-lookup"><span data-stu-id="4af2e-149">Description</span></span>|  
|--------------|-----------------|  
|<xref:System.Configuration.ConnectionStringSettings.Name%2A>|<span data-ttu-id="4af2e-150">Nom de la chaîne de connexion.</span><span class="sxs-lookup"><span data-stu-id="4af2e-150">The name of the connection string.</span></span> <span data-ttu-id="4af2e-151">Mappe à la **nom** attribut.</span><span class="sxs-lookup"><span data-stu-id="4af2e-151">Maps to the **name** attribute.</span></span>|  
|<xref:System.Configuration.ConnectionStringSettings.ProviderName%2A>|<span data-ttu-id="4af2e-152">Nom complet du fournisseur.</span><span class="sxs-lookup"><span data-stu-id="4af2e-152">The fully qualified provider name.</span></span> <span data-ttu-id="4af2e-153">Mappe à la **providerName** attribut.</span><span class="sxs-lookup"><span data-stu-id="4af2e-153">Maps to the **providerName** attribute.</span></span>|  
|<xref:System.Configuration.ConnectionStringSettings.ConnectionString%2A>|<span data-ttu-id="4af2e-154">Chaîne de connexion</span><span class="sxs-lookup"><span data-stu-id="4af2e-154">The connection string.</span></span> <span data-ttu-id="4af2e-155">Mappe à la **connectionString** attribut.</span><span class="sxs-lookup"><span data-stu-id="4af2e-155">Maps to the **connectionString** attribute.</span></span>|  
  
### <a name="example-listing-all-connection-strings"></a><span data-ttu-id="4af2e-156">Exemple : répertorier toutes les chaînes de connexion</span><span class="sxs-lookup"><span data-stu-id="4af2e-156">Example: Listing All Connection Strings</span></span>  
 <span data-ttu-id="4af2e-157">Cet exemple itère au sein de la collection `ConnectionStringSettings` et affiche les propriétés <xref:System.Configuration.ConnectionStringSettings.Name%2A>, <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A> et <xref:System.Configuration.ConnectionStringSettings.ConnectionString%2A> dans la fenêtre de console.</span><span class="sxs-lookup"><span data-stu-id="4af2e-157">This example iterates through the `ConnectionStringSettings` collection and displays the <xref:System.Configuration.ConnectionStringSettings.Name%2A>, <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A>, and <xref:System.Configuration.ConnectionStringSettings.ConnectionString%2A> properties in the console window.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4af2e-158">Le fichier System.Configuration.dll n'est pas inclus dans tous les types de projets et vous pouvez être amené à définir une référence à ce fichier afin d'utiliser les classes de configuration.</span><span class="sxs-lookup"><span data-stu-id="4af2e-158">System.Configuration.dll is not included in all project types, and you may need to set a reference to it in order to use the configuration classes.</span></span> <span data-ttu-id="4af2e-159">Le nom et l'emplacement d'un fichier de configuration particulier de l'application varient selon le type d'application et le processus d'hébergement.</span><span class="sxs-lookup"><span data-stu-id="4af2e-159">The name and location of a particular application configuration file varies by the type of application and the hosting process.</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringSettings.RetrieveFromConfig#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfig/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringSettings.RetrieveFromConfig#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfig/VB/source.vb#1)]  
  
### <a name="example-retrieving-a-connection-string-by-name"></a><span data-ttu-id="4af2e-160">Exemple : extraction d'une chaîne de connexion à l'aide de son nom</span><span class="sxs-lookup"><span data-stu-id="4af2e-160">Example: Retrieving a Connection String by Name</span></span>  
 <span data-ttu-id="4af2e-161">Cet exemple montre comment extraire une chaîne de connexion à partir d'un fichier de configuration en spécifiant son nom.</span><span class="sxs-lookup"><span data-stu-id="4af2e-161">This example demonstrates how to retrieve a connection string from a configuration file by specifying its name.</span></span> <span data-ttu-id="4af2e-162">Le code crée un objet <xref:System.Configuration.ConnectionStringSettings>, en faisant correspondre le paramètre d'entrée fourni au nom <xref:System.Configuration.ConfigurationManager.ConnectionStrings%2A>.</span><span class="sxs-lookup"><span data-stu-id="4af2e-162">The code creates a <xref:System.Configuration.ConnectionStringSettings> object, matching the supplied input parameter to the <xref:System.Configuration.ConfigurationManager.ConnectionStrings%2A> name.</span></span> <span data-ttu-id="4af2e-163">Si aucun nom correspondant n'est trouvé, la fonction retourne `null` (`Nothing` en Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="4af2e-163">If no matching name is found, the function returns `null` (`Nothing` in Visual Basic).</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringSettings.RetrieveFromConfigByName#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByName/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringSettings.RetrieveFromConfigByName#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByName/VB/source.vb#1)]  
  
### <a name="example-retrieving-a-connection-string-by-provider-name"></a><span data-ttu-id="4af2e-164">Exemple : extraction d'une chaîne de connexion à l'aide du nom du fournisseur</span><span class="sxs-lookup"><span data-stu-id="4af2e-164">Example: Retrieving a Connection String by Provider Name</span></span>  
 <span data-ttu-id="4af2e-165">Cet exemple montre comment extraire une chaîne de connexion en spécifiant le nom invariant du fournisseur dans le format *System.Data.ProviderName*.</span><span class="sxs-lookup"><span data-stu-id="4af2e-165">This example demonstrates how to retrieve a connection string by specifying the provider-invariant name in the format *System.Data.ProviderName*.</span></span> <span data-ttu-id="4af2e-166">Le code itère au sein de <xref:System.Configuration.ConnectionStringSettingsCollection> et retourne la chaîne de connexion du premier <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A> trouvé.</span><span class="sxs-lookup"><span data-stu-id="4af2e-166">The code iterates through the <xref:System.Configuration.ConnectionStringSettingsCollection> and returns the connection string for the first <xref:System.Configuration.ConnectionStringSettings.ProviderName%2A> found.</span></span> <span data-ttu-id="4af2e-167">Si le nom du fournisseur est introuvable, la fonction retourne `null` (`Nothing` en Visual Basic).</span><span class="sxs-lookup"><span data-stu-id="4af2e-167">If the provider name is not found, the function returns `null` (`Nothing` in Visual Basic).</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringSettings.RetrieveFromConfigByProvider/VB/source.vb#1)]  
  
## <a name="encrypting-configuration-file-sections-using-protected-configuration"></a><span data-ttu-id="4af2e-168">Chiffrement de sections de fichier de configuration à l'aide d'une configuration protégée</span><span class="sxs-lookup"><span data-stu-id="4af2e-168">Encrypting Configuration File Sections Using Protected Configuration</span></span>  
 <span data-ttu-id="4af2e-169">ASP.NET 2.0 a introduit une nouvelle fonctionnalité, appelée *configuration protégée*, qui vous permet de chiffrer les informations sensibles dans un fichier de configuration.</span><span class="sxs-lookup"><span data-stu-id="4af2e-169">ASP.NET 2.0 introduced a new feature, called *protected configuration*, that enables you to encrypt sensitive information in a configuration file.</span></span> <span data-ttu-id="4af2e-170">Bien qu'elle ait été conçu à l'origine pour les applications ASP.NET, la configuration protégée peut également servir à chiffrer les sections des fichiers de configuration dans les applications Windows.</span><span class="sxs-lookup"><span data-stu-id="4af2e-170">Although primarily designed for ASP.NET, protected configuration can also be used to encrypt configuration file sections in Windows applications.</span></span> <span data-ttu-id="4af2e-171">Pour obtenir une description détaillée des fonctionnalités de configuration protégée, consultez [chiffrement Configuration des informations à l’aide de Configuration protégée](http://msdn.microsoft.com/library/51cdfe5b-9d82-458c-94ff-c551c4f38ed1).</span><span class="sxs-lookup"><span data-stu-id="4af2e-171">For a detailed description of the protected configuration capabilities, see [Encrypting Configuration Information Using Protected Configuration](http://msdn.microsoft.com/library/51cdfe5b-9d82-458c-94ff-c551c4f38ed1).</span></span>  
  
 <span data-ttu-id="4af2e-172">Fragment de fichier de configuration suivant montre la **connectionStrings** section après qu’il a été chiffré.</span><span class="sxs-lookup"><span data-stu-id="4af2e-172">The following configuration file fragment shows the **connectionStrings** section after it has been encrypted.</span></span> <span data-ttu-id="4af2e-173">Le **configProtectionProvider** Spécifie le fournisseur de configuration protégée utilisé pour chiffrer et déchiffrer les chaînes de connexion.</span><span class="sxs-lookup"><span data-stu-id="4af2e-173">The **configProtectionProvider** specifies the protected configuration provider used to encrypt and decrypt the connection strings.</span></span> <span data-ttu-id="4af2e-174">Le **EncryptedData** section contient du texte chiffré.</span><span class="sxs-lookup"><span data-stu-id="4af2e-174">The **EncryptedData** section contains the cipher text.</span></span>  
  
```xml  
<connectionStrings configProtectionProvider="DataProtectionConfigurationProvider">  
  <EncryptedData>  
    <CipherData>  
      <CipherValue>AQAAANCMnd8BFdERjHoAwE/Cl+sBAAAAH2... </CipherValue>  
    </CipherData>  
  </EncryptedData>  
</connectionStrings>  
```  
  
 <span data-ttu-id="4af2e-175">Lorsque la chaîne de connexion chiffrée est extraite au moment de l’exécution, le .NET Framework utilise le fournisseur spécifié pour déchiffrer le **CipherValue** et le rendre disponible pour votre application.</span><span class="sxs-lookup"><span data-stu-id="4af2e-175">When the encrypted connection string is retrieved at run time, the .NET Framework uses the specified provider to decrypt the **CipherValue** and make it available to your application.</span></span> <span data-ttu-id="4af2e-176">Il est inutile d'écrire du code supplémentaire pour gérer le processus de déchiffrement.</span><span class="sxs-lookup"><span data-stu-id="4af2e-176">You do not need to write any additional code to manage the decryption process.</span></span>  
  
### <a name="protected-configuration-providers"></a><span data-ttu-id="4af2e-177">Fournisseurs de configuration protégée</span><span class="sxs-lookup"><span data-stu-id="4af2e-177">Protected Configuration Providers</span></span>  
 <span data-ttu-id="4af2e-178">Fournisseurs de configuration protégée sont enregistrés dans le **configProtectedData** section de la **machine.config** des fichiers sur l’ordinateur local, comme indiqué dans le fragment suivant, qui montre les deux fournisseurs de configuration protégée fournis avec le .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4af2e-178">Protected configuration providers are registered in the **configProtectedData** section of the **machine.config** file on the local computer, as shown in the following fragment, which shows the two protected configuration providers supplied with the .NET Framework.</span></span> <span data-ttu-id="4af2e-179">Les valeurs indiquées ici ont été tronquées pour améliorer la lisibilité.</span><span class="sxs-lookup"><span data-stu-id="4af2e-179">The values shown here have been truncated for readability.</span></span>  
  
```xml  
<configProtectedData defaultProvider="RsaProtectedConfigurationProvider">  
  <providers>  
    <add name="RsaProtectedConfigurationProvider"   
      type="System.Configuration.RsaProtectedConfigurationProvider, ... />  
    <add name="DataProtectionConfigurationProvider"   
      type="System.Configuration.DpapiProtectedConfigurationProvider, ... />  
  </providers>  
</configProtectedData>  
```  
  
 Vous pouvez configurer les fournisseurs de configuration protégée supplémentaires en les ajoutant à la **machine.config** fichier. Vous pouvez également créer votre propre fournisseur de configuration protégée en héritant de la classe de base abstraite <xref:System.Configuration.ProtectedConfigurationProvider>. <span data-ttu-id="4af2e-182">Le tableau suivant décrit les deux fichiers de configuration inclus avec le .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="4af2e-182">The following table describes the two configuration files included with the .NET Framework.</span></span>  
  
|<span data-ttu-id="4af2e-183">Fournisseur</span><span class="sxs-lookup"><span data-stu-id="4af2e-183">Provider</span></span>|<span data-ttu-id="4af2e-184">Description</span><span class="sxs-lookup"><span data-stu-id="4af2e-184">Description</span></span>|  
|--------------|-----------------|  
|<!--zz<xref:System.Configuration.RSAProtectedConfigurationProvider>-->`System.Configuration.RSAProtectedConfigurationProvider`|<span data-ttu-id="4af2e-185">Utilise l'algorithme de chiffrement RSA pour chiffrer et déchiffrer des données.</span><span class="sxs-lookup"><span data-stu-id="4af2e-185">Uses the RSA encryption algorithm to encrypt and decrypt data.</span></span> <span data-ttu-id="4af2e-186">L'algorithme RSA peut être utilisé pour le chiffrement de clé publique et les signatures numériques.</span><span class="sxs-lookup"><span data-stu-id="4af2e-186">The RSA algorithm can be used for both public key encryption and digital signatures.</span></span> <span data-ttu-id="4af2e-187">Il est également appelé « clé publique » ou chiffrement asymétrique, car il utilise deux clés différentes.</span><span class="sxs-lookup"><span data-stu-id="4af2e-187">It is also known as "public key" or asymmetrical encryption because it employs two different keys.</span></span> <span data-ttu-id="4af2e-188">Vous pouvez utiliser la [ASP.NET IIS Registration Tool (Aspnet_regiis.exe)](http://msdn.microsoft.com/library/6491c41e-e2b0-481f-9863-db3614d5f96b) pour chiffrer des sections dans un fichier Web.config et gérer les clés de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="4af2e-188">You can use the [ASP.NET IIS Registration Tool (Aspnet_regiis.exe)](http://msdn.microsoft.com/library/6491c41e-e2b0-481f-9863-db3614d5f96b) to encrypt sections in a Web.config file and manage the encryption keys.</span></span> <span data-ttu-id="4af2e-189">ASP.NET déchiffre le fichier de configuration lorsqu'il traite le fichier.</span><span class="sxs-lookup"><span data-stu-id="4af2e-189">ASP.NET decrypts the configuration file when it processes the file.</span></span> <span data-ttu-id="4af2e-190">L'identité de l'application ASP.NET doit disposer d'un accès à la clé de chiffrement utilisée pour chiffrer et déchiffrer les sections chiffrées.</span><span class="sxs-lookup"><span data-stu-id="4af2e-190">The identity of the ASP.NET application must have read access to the encryption key that is used to encrypt and decrypt the encrypted sections.</span></span>|  
|<!--zz<xref:System.Configuration.DPAPIProtectedConfigurationProvider>-->`System.Configuration.DPAPIProtectedConfigurationProvider`|<span data-ttu-id="4af2e-191">Utilise l'API de protection de données (DPAPI) Windows pour chiffrer les sections de configuration.</span><span class="sxs-lookup"><span data-stu-id="4af2e-191">Uses the Windows Data Protection API (DPAPI) to encrypt configuration sections.</span></span> <span data-ttu-id="4af2e-192">Il utilise les services de chiffrement intégrés de Windows et peut être configuré pour une protection spécifique à un ordinateur ou spécifique à un compte d'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4af2e-192">It uses the Windows built-in cryptographic services and can be configured for either machine-specific or user-account-specific protection.</span></span> <span data-ttu-id="4af2e-193">La protection spécifique à un ordinateur est utile pour plusieurs applications sur le même serveur qui doivent partager des informations.</span><span class="sxs-lookup"><span data-stu-id="4af2e-193">Machine-specific protection is useful for multiple applications on the same server that need to share information.</span></span> <span data-ttu-id="4af2e-194">La protection spécifique à un compte d'utilisateur peut être utilisée avec des services qui s'exécutent avec une identité d'utilisateur spécifique, telle qu'un environnement d'hébergement partagé.</span><span class="sxs-lookup"><span data-stu-id="4af2e-194">User-account-specific protection can be used with services that run with a specific user identity, such as a shared hosting environment.</span></span> <span data-ttu-id="4af2e-195">Chaque application s'exécute sous une identité différente qui restreint l'accès aux ressources telles que les fichiers et les bases de données.</span><span class="sxs-lookup"><span data-stu-id="4af2e-195">Each application runs under a separate identity which restricts access to resources such as files and databases.</span></span>|  
  
 <span data-ttu-id="4af2e-196">Les deux fournisseurs offrent un chiffrement renforcé des données.</span><span class="sxs-lookup"><span data-stu-id="4af2e-196">Both providers offer strong encryption of data.</span></span> <span data-ttu-id="4af2e-197">Cependant, si vous prévoyez d'utiliser le même fichier de configuration chiffré sur plusieurs serveurs, comme une batterie de serveurs Web, seul `RsaProtectedConfigurationProvider` vous permet d'exporter les clefs de chiffrement utilisées pour chiffrer les données et les importer sur un autre serveur.</span><span class="sxs-lookup"><span data-stu-id="4af2e-197">However, if you are planning to use the same encrypted configuration file on multiple servers, such as a Web farm, only the `RsaProtectedConfigurationProvider` enables you to export the encryption keys used to encrypt the data and import them on another server.</span></span> <span data-ttu-id="4af2e-198">Pour plus d’informations, consultez [importation et exportation protégé Configuration conteneurs de clé RSA](http://msdn.microsoft.com/library/f3022b39-f17f-48c1-b067-025eab0ce8bc).</span><span class="sxs-lookup"><span data-stu-id="4af2e-198">For more information, see [Importing and Exporting Protected Configuration RSA Key Containers](http://msdn.microsoft.com/library/f3022b39-f17f-48c1-b067-025eab0ce8bc).</span></span>  
  
### <a name="using-the-configuration-classes"></a><span data-ttu-id="4af2e-199">Utilisation des classes de configuration</span><span class="sxs-lookup"><span data-stu-id="4af2e-199">Using the Configuration Classes</span></span>  
 <span data-ttu-id="4af2e-200">L'espace de noms <xref:System.Configuration> fournit des classes pour utiliser des paramètres de configuration par programme.</span><span class="sxs-lookup"><span data-stu-id="4af2e-200">The <xref:System.Configuration> namespace provides classes to work with configuration settings programmatically.</span></span> <span data-ttu-id="4af2e-201">La classe <xref:System.Configuration.ConfigurationManager> fournit un accès aux fichiers de configuration d'ordinateur, d'application et d'utilisateur.</span><span class="sxs-lookup"><span data-stu-id="4af2e-201">The <xref:System.Configuration.ConfigurationManager> class provides access to machine, application, and user configuration files.</span></span> <span data-ttu-id="4af2e-202">Si vous créez une application ASP.NET, vous pouvez utiliser la <xref:System.Web.Configuration.WebConfigurationManager> (classe), qui fournit les mêmes fonctionnalités, alors que vous permettant également d’accéder aux paramètres qui sont uniques pour les applications ASP.NET, tels que ceux trouvés dans  **\< System.Web >**.</span><span class="sxs-lookup"><span data-stu-id="4af2e-202">If you are creating an ASP.NET application, you can use the <xref:System.Web.Configuration.WebConfigurationManager> class, which provides the same functionality while also allowing you to access settings that are unique to ASP.NET applications, such as those found in **\<system.web>**.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4af2e-203">L'espace de noms <xref:System.Security.Cryptography> contient des classes qui fournissent des options supplémentaires pour le chiffrement et déchiffrement de données.</span><span class="sxs-lookup"><span data-stu-id="4af2e-203">The <xref:System.Security.Cryptography> namespace contains classes that provide additional options for encrypting and decrypting data.</span></span> <span data-ttu-id="4af2e-204">Utilisez ces classes si vous avez besoin de services de chiffrement qui ne sont pas disponibles via la configuration protégée.</span><span class="sxs-lookup"><span data-stu-id="4af2e-204">Use these classes if you require cryptographic services that are not available using protected configuration.</span></span> <span data-ttu-id="4af2e-205">Certaines de ces classes sont des wrappers pour l'interface Microsoft CryptoAPI non managée, tandis que d'autres ne sont purement que des implémentations managées.</span><span class="sxs-lookup"><span data-stu-id="4af2e-205">Some of these classes are wrappers for the unmanaged Microsoft CryptoAPI, while others are purely managed implementations.</span></span> <span data-ttu-id="4af2e-206">Pour plus d’informations, consultez [Services de cryptographie](http://msdn.microsoft.com/library/68a1e844-c63c-44af-9247-f6716eb23781).</span><span class="sxs-lookup"><span data-stu-id="4af2e-206">For more information, see [Cryptographic Services](http://msdn.microsoft.com/library/68a1e844-c63c-44af-9247-f6716eb23781).</span></span>  
  
### <a name="appconfig-example"></a><span data-ttu-id="4af2e-207">Exemple App.config</span><span class="sxs-lookup"><span data-stu-id="4af2e-207">App.config Example</span></span>  
 <span data-ttu-id="4af2e-208">Cet exemple montre comment basculer le chiffrement de la **connectionStrings** section dans un **app.config** fichier pour une application Windows.</span><span class="sxs-lookup"><span data-stu-id="4af2e-208">This example demonstrates how to toggle encrypting the **connectionStrings** section in an **app.config** file for a Windows application.</span></span> <span data-ttu-id="4af2e-209">Dans cet exemple, la procédure prend le nom de l’application en tant qu’argument, par exemple, « MyApplication.exe ».</span><span class="sxs-lookup"><span data-stu-id="4af2e-209">In this example, the procedure takes the name of the application as an argument, for example, "MyApplication.exe".</span></span> <span data-ttu-id="4af2e-210">Le **app.config** fichier est ensuite chiffré et copié dans le dossier qui contient le fichier exécutable sous le nom « MyApplication.exe.config ».</span><span class="sxs-lookup"><span data-stu-id="4af2e-210">The **app.config** file will then be encrypted and copied to the folder that contains the executable under the name of "MyApplication.exe.config".</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4af2e-211">La chaîne de connexion peut uniquement être déchiffrée sur l'ordinateur sur lequel elle a été chiffrée.</span><span class="sxs-lookup"><span data-stu-id="4af2e-211">The connection string can only be decrypted on the computer on which it was encrypted.</span></span>  
  
 <span data-ttu-id="4af2e-212">Le code utilise le <xref:System.Configuration.ConfigurationManager.OpenExeConfiguration%2A> méthode pour ouvrir le **app.config** fichier pour le modifier et le <xref:System.Configuration.ConfigurationManager.GetSection%2A> méthode retourne la **connectionStrings** section.</span><span class="sxs-lookup"><span data-stu-id="4af2e-212">The code uses the <xref:System.Configuration.ConfigurationManager.OpenExeConfiguration%2A> method to open the **app.config** file for editing, and the <xref:System.Configuration.ConfigurationManager.GetSection%2A> method returns the **connectionStrings** section.</span></span> <span data-ttu-id="4af2e-213">Le code vérifie ensuite la propriété <xref:System.Configuration.SectionInformation.IsProtected%2A>, en appelant le <xref:System.Configuration.SectionInformation.ProtectSection%2A> pour chiffrer la section si elle n'est pas chiffrée.</span><span class="sxs-lookup"><span data-stu-id="4af2e-213">The code then checks the <xref:System.Configuration.SectionInformation.IsProtected%2A> property, calling the <xref:System.Configuration.SectionInformation.ProtectSection%2A> to encrypt the section if it is not encrypted.</span></span> <span data-ttu-id="4af2e-214">La méthode <xref:System.Configuration.SectionInformation.UnprotectSection%2A> est appelée pour déchiffrer la section.</span><span class="sxs-lookup"><span data-stu-id="4af2e-214">The <xref:System.Configuration.SectionInformation.UnprotectSection%2A> method is invoked to decrypt the section.</span></span> <span data-ttu-id="4af2e-215">La méthode <xref:System.Configuration.Configuration.Save%2A> termine l'opération et enregistre les modifications.</span><span class="sxs-lookup"><span data-stu-id="4af2e-215">The <xref:System.Configuration.Configuration.Save%2A> method completes the operation and saves the changes.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="4af2e-216">Vous devez définir une référence à `System.Configuration.dll` dans votre projet pour le code à exécuter.</span><span class="sxs-lookup"><span data-stu-id="4af2e-216">You must set a reference to `System.Configuration.dll` in your project for the code to run.</span></span>  
  
 [!code-csharp[DataWorks ConnectionStrings.Encrypt#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStrings.Encrypt/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStrings.Encrypt#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStrings.Encrypt/VB/source.vb#1)]  
  
### <a name="webconfig-example"></a><span data-ttu-id="4af2e-217">Exemple Web.config</span><span class="sxs-lookup"><span data-stu-id="4af2e-217">Web.config Example</span></span>  
 <span data-ttu-id="4af2e-218">Cet exemple utilise la méthode <xref:System.Web.Configuration.WebConfigurationManager.OpenWebConfiguration%2A> de `WebConfigurationManager`.</span><span class="sxs-lookup"><span data-stu-id="4af2e-218">This example uses the <xref:System.Web.Configuration.WebConfigurationManager.OpenWebConfiguration%2A> method of the `WebConfigurationManager`.</span></span> <span data-ttu-id="4af2e-219">Notez que dans ce cas vous pouvez fournir le chemin d’accès relatif à la **Web.config** fichier en utilisant un tilde.</span><span class="sxs-lookup"><span data-stu-id="4af2e-219">Note that in this case you can supply the relative path to the **Web.config** file by using a tilde.</span></span> <span data-ttu-id="4af2e-220">Le code requiert une référence à la classe `System.Web.Configuration`.</span><span class="sxs-lookup"><span data-stu-id="4af2e-220">The code requires a reference to the `System.Web.Configuration` class.</span></span>  
  
 [!code-csharp[DataWorks ConnectionStringsWeb.Encrypt#1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DataWorks ConnectionStringsWeb.Encrypt/CS/source.cs#1)]
 [!code-vb[DataWorks ConnectionStringsWeb.Encrypt#1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DataWorks ConnectionStringsWeb.Encrypt/VB/source.vb#1)]  
  
 <span data-ttu-id="4af2e-221">Pour plus d’informations sur la sécurisation des applications ASP.NET, consultez [NIB : sécurité ASP.NET](http://msdn.microsoft.com/library/04b37532-18d9-40b4-8e5f-ee09a70b311d) et [pratiques de sécurité ASP.NET 2.0 en un coup de œil](http://go.microsoft.com/fwlink/?LinkId=59997) sur le centre de développement ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="4af2e-221">For more information securing ASP.NET applications, see [NIB: ASP.NET Security](http://msdn.microsoft.com/library/04b37532-18d9-40b4-8e5f-ee09a70b311d) and [ASP.NET 2.0 Security Practices at a Glance](http://go.microsoft.com/fwlink/?LinkId=59997) on the ASP.NET Developer Center.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="4af2e-222">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="4af2e-222">See Also</span></span>  
 [<span data-ttu-id="4af2e-223">Générateurs de chaînes de connexion</span><span class="sxs-lookup"><span data-stu-id="4af2e-223">Connection String Builders</span></span>](../../../../docs/framework/data/adonet/connection-string-builders.md)  
 [<span data-ttu-id="4af2e-224">Protection des informations de connexion</span><span class="sxs-lookup"><span data-stu-id="4af2e-224">Protecting Connection Information</span></span>](../../../../docs/framework/data/adonet/protecting-connection-information.md)  
 [<span data-ttu-id="4af2e-225">À l’aide des Classes de Configuration</span><span class="sxs-lookup"><span data-stu-id="4af2e-225">Using the Configuration Classes</span></span>](http://msdn.microsoft.com/library/98d2b386-baf6-4a17-974b-76e3b4c87acc)  
 [<span data-ttu-id="4af2e-226">Configuration d'applications</span><span class="sxs-lookup"><span data-stu-id="4af2e-226">Configuring Apps</span></span>](../../../../docs/framework/configure-apps/index.md)  
 [<span data-ttu-id="4af2e-227">Administration de Site Web ASP.NET</span><span class="sxs-lookup"><span data-stu-id="4af2e-227">ASP.NET Web Site Administration</span></span>](http://msdn.microsoft.com/library/1298034b-5f7d-464d-abd1-ad9e6b3eeb7e)  
 [<span data-ttu-id="4af2e-228">Fournisseurs managés ADO.NET et centre de développement DataSet</span><span class="sxs-lookup"><span data-stu-id="4af2e-228">ADO.NET Managed Providers and DataSet Developer Center</span></span>](http://go.microsoft.com/fwlink/?LinkId=217917)
