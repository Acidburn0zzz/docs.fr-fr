---
title: 'Comment : effectuer une conversion entre les flux .NET Framework et les flux Windows Runtime'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
ms.assetid: 23a763ea-8348-4244-9f8c-a4280b870b47
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 96067ab6c8e13417158e4ebf7fae0e08cb9fbea4
ms.sourcegitcommit: 64f4baed249341e5bf64d1385bf48e3f2e1a0211
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/07/2018
ms.locfileid: "44087477"
---
# <a name="how-to-convert-between-net-framework-streams-and-windows-runtime-streams"></a><span data-ttu-id="2f382-102">Comment : effectuer une conversion entre les flux .NET Framework et les flux Windows Runtime</span><span class="sxs-lookup"><span data-stu-id="2f382-102">How to: Convert Between .NET Framework Streams and Windows Runtime Streams</span></span>

<span data-ttu-id="2f382-103">Le .Net Framework pour les applications Windows Store est un sous-ensemble du .NET Framework complet.</span><span class="sxs-lookup"><span data-stu-id="2f382-103">The .NET Framework for Windows Store apps is a subset of the full .NET Framework.</span></span> <span data-ttu-id="2f382-104">En raison de la sécurité et d'autres spécifications des applications Windows Store, vous ne pouvez pas utiliser l'ensemble d'API .NET Framework pour ouvrir et lire des fichiers.</span><span class="sxs-lookup"><span data-stu-id="2f382-104">Because of security and other requirements for Windows Store apps, you cannot use the full set of .NET Framework APIs to open and read files.</span></span> <span data-ttu-id="2f382-105">Pour plus d’informations, consultez [Vue d’ensemble de .NET pour les applications du Windows Store](https://docs.microsoft.com/previous-versions/windows/apps/br230302(v=vs.140)).</span><span class="sxs-lookup"><span data-stu-id="2f382-105">For more information, see [.NET for Windows Store apps overview](https://docs.microsoft.com/previous-versions/windows/apps/br230302(v=vs.140)).</span></span> <span data-ttu-id="2f382-106">Toutefois, vous pouvez utiliser des API .NET Framework pour les autres opérations de manipulation des flux.</span><span class="sxs-lookup"><span data-stu-id="2f382-106">However, you may want to use .NET Framework APIs for other stream manipulation operations.</span></span> <span data-ttu-id="2f382-107">Pour manipuler ces flux, il peut s’avérer nécessaire d’effectuer une conversion entre un type de flux .NET Framework tel que <xref:System.IO.MemoryStream> ou <xref:System.IO.FileStream>, et un flux Windows Runtime tel que <xref:Windows.Storage.Streams.IInputStream>, <xref:Windows.Storage.Streams.IOutputStream> ou <xref:Windows.Storage.Streams.IRandomAccessStream>.</span><span class="sxs-lookup"><span data-stu-id="2f382-107">To manipulate these streams, you may find it necessary to convert between a .NET Framework stream type such as <xref:System.IO.MemoryStream> or <xref:System.IO.FileStream>, and a Windows Runtime stream such as <xref:Windows.Storage.Streams.IInputStream>, <xref:Windows.Storage.Streams.IOutputStream>, or <xref:Windows.Storage.Streams.IRandomAccessStream>.</span></span>

<span data-ttu-id="2f382-108">La classe [System.IO.WindowsRuntimeStreamExtensions](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.aspx) contient des méthodes qui facilitent ces conversions.</span><span class="sxs-lookup"><span data-stu-id="2f382-108">The [System.IO.WindowsRuntimeStreamExtensions](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.aspx) class contains methods that make these conversions easy.</span></span> <span data-ttu-id="2f382-109">Toutefois, il existe des différences sous-jacentes entre les flux .NET Framework et Windows Runtime qui affecteront les résultats obtenus lors de l'utilisation ces méthodes.</span><span class="sxs-lookup"><span data-stu-id="2f382-109">However, there are underlying differences between streams in the .NET Framework and the Windows Runtime that will affect the results of using these methods.</span></span> <span data-ttu-id="2f382-110">Ces différentes sont décrites en détail dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="2f382-110">The details are described in the following sections.</span></span>

## <a name="converting-from-a-windows-runtime-stream-to-a-net-framework-stream"></a><span data-ttu-id="2f382-111">Conversion d'un flux Windows Runtime en un flux .NET Framework</span><span class="sxs-lookup"><span data-stu-id="2f382-111">Converting from a Windows Runtime stream to a .NET Framework stream</span></span>

<span data-ttu-id="2f382-112">Convertissez un flux Windows Runtime en un flux .NET Framework à l’aide de l’une des méthodes [System.IO.WindowsRuntimeStreamExtensions](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.aspx) suivantes :</span><span class="sxs-lookup"><span data-stu-id="2f382-112">You can convert from a Windows Runtime stream to a .NET Framework stream by using one of the following [System.IO.WindowsRuntimeStreamExtensions](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.aspx) methods:</span></span>

[<span data-ttu-id="2f382-113">System.IO.WindowsRuntimeStreamExtensions.AsStream</span><span class="sxs-lookup"><span data-stu-id="2f382-113">System.IO.WindowsRuntimeStreamExtensions.AsStream</span></span>](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asstream.aspx)  
<span data-ttu-id="2f382-114">Convertit un flux d'accès aléatoire Windows Runtime en un flux managé du sous-ensemble .NET pour les applications du Windows Store.</span><span class="sxs-lookup"><span data-stu-id="2f382-114">Converts a random-access stream in the Windows Runtime to a managed stream in the .NET for Windows Store apps subset.</span></span>

[<span data-ttu-id="2f382-115">System.IO.WindowsRuntimeStreamExtensions.AsStreamForWrite</span><span class="sxs-lookup"><span data-stu-id="2f382-115">System.IO.WindowsRuntimeStreamExtensions.AsStreamForWrite</span></span>](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asstreamforwrite.aspx)  
<span data-ttu-id="2f382-116">Convertit un flux de sortie Windows Runtime en un flux managé du sous-ensemble .NET pour les applications du Windows Store.</span><span class="sxs-lookup"><span data-stu-id="2f382-116">Converts an output stream in the Windows Runtime to a managed stream in the .NET for Windows Store apps subset.</span></span>

[<span data-ttu-id="2f382-117">System.IO.WindowsRuntimeStreamExtensions.AsStreamForRead</span><span class="sxs-lookup"><span data-stu-id="2f382-117">System.IO.WindowsRuntimeStreamExtensions.AsStreamForRead</span></span>](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asstreamforread.aspx)  
<span data-ttu-id="2f382-118">Convertit un flux d'entrée Windows Runtime en un flux managé du sous-ensemble .NET pour les applications du Windows Store.</span><span class="sxs-lookup"><span data-stu-id="2f382-118">Converts an input stream in the Windows Runtime to a managed stream in the .NET for Windows Store apps subset.</span></span>

<span data-ttu-id="2f382-119">Le Windows Runtime offre des types de flux qui prennent en charge la lecture seule, l'écriture seule ou la lecture et l'écriture. Ces capacités sont conservées lorsque vous convertissez un flux Windows Runtime en un flux .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2f382-119">The Windows Runtime offers stream types that support reading only, writing only or reading and writing, and these capabilities are maintained when you convert a Windows Runtime stream to a .NET Framework stream.</span></span> <span data-ttu-id="2f382-120">En outre, si vous convertissez un flux Windows Runtime en un flux .NET Framework et inversement, vous obtenez l'instance du Windows Runtime en retour.</span><span class="sxs-lookup"><span data-stu-id="2f382-120">Furthermore, if you convert a Windows Runtime stream to a .NET Framework stream and back, you get the original Windows Runtime instance back.</span></span> <span data-ttu-id="2f382-121">Il est recommandé d'utiliser la méthode de conversion correspondant aux capacités du flux Windows Runtime que vous souhaitez convertir.</span><span class="sxs-lookup"><span data-stu-id="2f382-121">It’s best practice to use the conversion method that matches the capabilities of the Windows Runtime stream you would like to convert.</span></span> <span data-ttu-id="2f382-122">Toutefois, comme <xref:Windows.Storage.Streams.IRandomAccessStream> est accessible en lecture et en écriture (il implémente <xref:Windows.Storage.Streams.IOutputStream> et <xref:Windows.Storage.Streams.IInputStream>), vous pouvez utiliser n’importe quelle méthode de conversion. Par ailleurs, les capacités du flux d’origine sont conservées.</span><span class="sxs-lookup"><span data-stu-id="2f382-122">However, since <xref:Windows.Storage.Streams.IRandomAccessStream> is readable and writeable (it implements both <xref:Windows.Storage.Streams.IOutputStream> and <xref:Windows.Storage.Streams.IInputStream>, you can use any of the conversion methods and the capabilities of the original stream are maintained.</span></span> <span data-ttu-id="2f382-123">Par exemple, l’utilisation de [System.IO.WindowsRuntimeStreamExtensions.AsStreamForRead](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asstreamforread.aspx) pour convertir <xref:Windows.Storage.Streams.IRandomAccessStream> n’empêche pas le flux .NET Framework converti d’être accessible en lecture seule. Il est également accessible en écriture.</span><span class="sxs-lookup"><span data-stu-id="2f382-123">For example, using [System.IO.WindowsRuntimeStreamExtensions.AsStreamForRead](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asstreamforread.aspx) to convert an <xref:Windows.Storage.Streams.IRandomAccessStream> will not limit the converted .NET Framework stream to being readable only; it will also be writable.</span></span>

### <a name="to-convert-from-a-windows-runtime-random-access-stream-to-a-net-framework-stream"></a><span data-ttu-id="2f382-124">Pour convertir un flux d'accès aléatoire Windows Runtime en un flux .NET Framework</span><span class="sxs-lookup"><span data-stu-id="2f382-124">To convert from a Windows Runtime random-access stream to a .NET Framework stream</span></span>

- <span data-ttu-id="2f382-125">Utilisez la méthode [System.IO.WindowsRuntimeStreamExtensions.AsStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asstream.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f382-125">Use the [System.IO.WindowsRuntimeStreamExtensions.AsStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asstream.aspx) method.</span></span>

  <span data-ttu-id="2f382-126">L'exemple de code suivant montre comment inviter l'utilisateur à sélectionner un fichier, l'ouvrir avec les API Windows Runtime, puis le convertir en un flux .NET Framework, qui est lu et envoyé vers un bloc de texte.</span><span class="sxs-lookup"><span data-stu-id="2f382-126">The following code example shows how to prompt the user to select a file, open it with Windows Runtime APIs, and then convert it to a .NET Framework stream, which is read and output to a text block.</span></span> <span data-ttu-id="2f382-127">Dans ce scénario, vous manipulez généralement le flux avec les API .NET Framework avant de sortir les résultats.</span><span class="sxs-lookup"><span data-stu-id="2f382-127">In this scenario, you would typically manipulate the stream with .NET Framework APIs before outputting the results.</span></span>

  <span data-ttu-id="2f382-128">Pour exécuter cet exemple, vous devez créer une application XAML Windows Store, contenant un bloc de texte nommé `TextBlock1` et un bouton nommé  `Button1`.</span><span class="sxs-lookup"><span data-stu-id="2f382-128">To run this example, you must create a Windows Store XAML app that contains a text block named `TextBlock1` and a button named  `Button1`.</span></span> <span data-ttu-id="2f382-129">L'événement Click du bouton doit être associé à la méthode `button1_Click` illustrée dans l'exemple.</span><span class="sxs-lookup"><span data-stu-id="2f382-129">The button click event must be associated with the `button1_Click` method shown in the example.</span></span>

  [!code-csharp[System.IO.WindowsRuntimeStreamExtensionsEx#Imports](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/cs/mainpage.xaml.cs#imports)]
  [!code-vb[System.IO.WindowsRuntimeStreamExtensionsEx#Imports](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/vb/mainpage.xaml.vb#imports)]
  [!code-csharp[System.IO.WindowsRuntimeStreamExtensionsEx#1](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/cs/mainpage.xaml.cs#1)]
  [!code-vb[System.IO.WindowsRuntimeStreamExtensionsEx#1](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/vb/mainpage.xaml.vb#1)]

## <a name="converting-from-a-net-framework-stream-to-a-windows-runtime-stream"></a><span data-ttu-id="2f382-130">Conversion d'un flux .NET Framework en un flux Windows Runtime</span><span class="sxs-lookup"><span data-stu-id="2f382-130">Converting from a .NET Framework stream to a Windows Runtime stream</span></span>

<span data-ttu-id="2f382-131">Convertissez un flux .NET Framework en un flux Windows Runtime à l’aide de l’une des méthodes [System.IO.WindowsRuntimeStreamExtensions](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.aspx) suivantes :</span><span class="sxs-lookup"><span data-stu-id="2f382-131">You can convert from a .NET Framework stream to a Windows Runtime stream by using one of the following [System.IO.WindowsRuntimeStreamExtensions](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.aspx) methods:</span></span>

<span data-ttu-id="2f382-132">[System.IO.WindowsRuntimeStreamExtensions.AsInputStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asinputstream.aspx) Convertit un flux managé du sous-ensemble .NET pour les applications du Windows Store en un flux d’entrée Windows Runtime.</span><span class="sxs-lookup"><span data-stu-id="2f382-132">[System.IO.WindowsRuntimeStreamExtensions.AsInputStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asinputstream.aspx) Converts a managed stream in the .NET for Windows Store apps subset to an input stream in the Windows Runtime.</span></span>

<span data-ttu-id="2f382-133">[System.IO.WindowsRuntimeStreamExtensions.AsOutputStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asoutputstream.aspx) Convertit un flux managé du sous-ensemble .NET pour les applications du Windows Store en un flux de sortie Windows Runtime.</span><span class="sxs-lookup"><span data-stu-id="2f382-133">[System.IO.WindowsRuntimeStreamExtensions.AsOutputStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asoutputstream.aspx) Converts a managed stream in the .NET for Windows Store apps subset to an output stream in the Windows Runtime.</span></span>

<span data-ttu-id="2f382-134">[AsRandomAccessStream](../../../docs/standard/cross-platform/windowsruntimestreamextensions-asrandomaccessstream-method.md) Convertit un flux managé du sous-ensemble .NET pour les applications du Windows Store en un flux d’accès aléatoire qui peut être utilisé pour lire ou écrire dans Windows Runtime.</span><span class="sxs-lookup"><span data-stu-id="2f382-134">[AsRandomAccessStream](../../../docs/standard/cross-platform/windowsruntimestreamextensions-asrandomaccessstream-method.md) Converts a managed stream in the .NET for Windows Store apps subset to a random-access stream that can be used for reading or writing in the Windows Runtime.</span></span>

<span data-ttu-id="2f382-135">Lorsque vous convertissez un flux .NET Framework en un flux Windows Runtime, les capacités du flux converti dépendent du flux d'origine.</span><span class="sxs-lookup"><span data-stu-id="2f382-135">When you convert a .NET Framework stream to a Windows Runtime stream, the capabilities of the converted stream will depend on the original stream.</span></span> <span data-ttu-id="2f382-136">Par exemple, si le flux d’origine prend en charge la lecture et l’écriture, et que vous appelez [System.IO.WindowsRuntimeStreamExtensions.AsInputStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asinputstream.aspx) pour convertir le flux, le type retourné est un `IRandomAccessStream`qui implémente `IInputStream` et `IOutputStream`, et prend en charge la lecture et l’écriture.</span><span class="sxs-lookup"><span data-stu-id="2f382-136">For example, if the original stream supports both reading and writing, and you call[System.IO.WindowsRuntimeStreamExtensions.AsInputStream](https://msdn.microsoft.com/library/system.io.windowsruntimestreamextensions.asinputstream.aspx) to convert the stream, the returned type will be an `IRandomAccessStream`, which  implements `IInputStream` and `IOutputStream`, and supports reading and writing.</span></span>

<span data-ttu-id="2f382-137">Les flux .NET Framework ne prennent pas en charge le clonage, même après la conversion.</span><span class="sxs-lookup"><span data-stu-id="2f382-137">.NET Framework streams do not support cloning, even after conversion.</span></span> <span data-ttu-id="2f382-138">Cela signifie que si vous convertissez un flux .NET Framework en flux Windows Runtime, et si vous appelez <xref:Windows.Storage.Streams.InMemoryRandomAccessStream.GetInputStreamAt%2A> ou <xref:Windows.Storage.Streams.IRandomAccessStream.GetOutputStreamAt%2A>, qui appelle <xref:Windows.Storage.Streams.RandomAccessStreamOverStream.CloneStream%2A> ou <xref:Windows.Storage.Streams.RandomAccessStreamOverStream.CloneStream%2A> directement, une exception est levée.</span><span class="sxs-lookup"><span data-stu-id="2f382-138">This means that if you convert a .NET Framework stream to a Windows Runtime stream and call <xref:Windows.Storage.Streams.InMemoryRandomAccessStream.GetInputStreamAt%2A> or <xref:Windows.Storage.Streams.IRandomAccessStream.GetOutputStreamAt%2A>, which call <xref:Windows.Storage.Streams.RandomAccessStreamOverStream.CloneStream%2A> or call <xref:Windows.Storage.Streams.RandomAccessStreamOverStream.CloneStream%2A> directly, an exception will occur.</span></span>

### <a name="to-convert-from-a-net-framework-stream-to-a-windows-runtime-random-access-stream"></a><span data-ttu-id="2f382-139">Pour convertir un flux .NET Framework en un flux d'accès aléatoire Windows Runtime</span><span class="sxs-lookup"><span data-stu-id="2f382-139">To convert from a .NET Framework stream to a Windows Runtime random-access stream</span></span>

- <span data-ttu-id="2f382-140">Utilisez la méthode [AsRandomAccessStream](../../../docs/standard/cross-platform/windowsruntimestreamextensions-asrandomaccessstream-method.md), comme illustré dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="2f382-140">Use the [AsRandomAccessStream](../../../docs/standard/cross-platform/windowsruntimestreamextensions-asrandomaccessstream-method.md) method, as shown in the following example:</span></span>

  > [!IMPORTANT]
  > <span data-ttu-id="2f382-141">Assurez-vous que le flux du .NET Framework que vous utilisez prend en charge la recherche, ou copiez-le dans un flux qui la prend en charge.</span><span class="sxs-lookup"><span data-stu-id="2f382-141">Ensure that the .NET Framework stream you are using supports seeking, or copy it to a stream that does.</span></span> <span data-ttu-id="2f382-142">Vous pouvez utiliser la propriété <xref:System.IO.Stream.CanSeek%2A?displayProperty=nameWithType> pour le déterminer.</span><span class="sxs-lookup"><span data-stu-id="2f382-142">You can use the <xref:System.IO.Stream.CanSeek%2A?displayProperty=nameWithType> property to determine this.</span></span>

  <span data-ttu-id="2f382-143">Pour exécuter cet exemple, vous devez créer une application XAML Windows Store qui cible le .NET Framework 4.5.1 et contient un bloc de texte nommé `TextBlock2` et un bouton nommé `Button2`.</span><span class="sxs-lookup"><span data-stu-id="2f382-143">To run this example, you must create a Windows Store XAML app that targets the .NET Framework 4.5.1 and contains a text block named `TextBlock2` and a button named `Button2`.</span></span> <span data-ttu-id="2f382-144">L'événement Click du bouton doit être associé à la méthode `button2_Click` illustrée dans cet exemple.</span><span class="sxs-lookup"><span data-stu-id="2f382-144">The button click event must be associated with the `button2_Click` method shown in this example.</span></span>

  [!code-csharp[System.IO.WindowsRuntimeStreamExtensionsEx#Imports](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/cs/mainpage.xaml.cs#imports)]
  [!code-vb[System.IO.WindowsRuntimeStreamExtensionsEx#Imports](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/vb/mainpage.xaml.vb#imports)]
  [!code-csharp[System.IO.WindowsRuntimeStreamExtensionsEx#2](~/samples/snippets/csharp/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/cs/mainpage.xaml.cs#2)]
  [!code-vb[System.IO.WindowsRuntimeStreamExtensionsEx#2](~/samples/snippets/visualbasic/VS_Snippets_CLR_System/system.io.windowsruntimestreamextensionsex/vb/mainpage.xaml.vb#2)]

## <a name="see-also"></a><span data-ttu-id="2f382-145">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="2f382-145">See also</span></span>

- [<span data-ttu-id="2f382-146">Démarrage rapide : lecture et écriture dans un fichier (Windows)</span><span class="sxs-lookup"><span data-stu-id="2f382-146">Quickstart: Reading and writing a file (Windows)</span></span>](https://msdn.microsoft.com/library/windows/apps/hh464978.aspx)  
- [<span data-ttu-id="2f382-147">Vue d’ensemble de .NET pour les applications Windows Store</span><span class="sxs-lookup"><span data-stu-id="2f382-147">.NET for Windows Store apps overview</span></span>](https://msdn.microsoft.com/library/windows/apps/br230302.aspx)  
- [<span data-ttu-id="2f382-148">.NET pour les applications du Windows Store : API prises en charge</span><span class="sxs-lookup"><span data-stu-id="2f382-148">.NET for Windows Store apps – supported APIs</span></span>](https://msdn.microsoft.com/library/windows/apps/br230232.aspx)  