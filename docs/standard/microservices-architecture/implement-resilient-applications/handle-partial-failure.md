---
title: Gestion d’une défaillance partielle
description: Architecture des microservices .NET pour les applications .NET en conteneur | Gestion d’une défaillance partielle
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 06/08/2018
ms.openlocfilehash: 94239fc30292760b2bb28849f8c6ab72c7ceb33d
ms.sourcegitcommit: ccd8c36b0d74d99291d41aceb14cf98d74dc9d2b
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 12/10/2018
ms.locfileid: "53144726"
---
# <a name="handling-partial-failure"></a><span data-ttu-id="5493d-103">Gestion d’une défaillance partielle</span><span class="sxs-lookup"><span data-stu-id="5493d-103">Handling partial failure</span></span>

<span data-ttu-id="5493d-104">Dans les systèmes distribués tels que les applications basées sur des microservices, le risque de défaillance partielle est omniprésent.</span><span class="sxs-lookup"><span data-stu-id="5493d-104">In distributed systems like microservices-based applications, there is an ever-present risk of partial failure.</span></span> <span data-ttu-id="5493d-105">Par exemple, un microservice ou un conteneur peut échouer ou ne pas être disponible pour répondre pendant un court instant, ou une machine virtuelle ou un serveur peut connaître un incident.</span><span class="sxs-lookup"><span data-stu-id="5493d-105">For instance, a single microservice/container can fail or might not be available to respond for a short time, or a single VM or server can crash.</span></span> <span data-ttu-id="5493d-106">Étant donné que les clients et les services sont des processus distincts, il peut arriver qu’un service ne puisse pas répondre à temps à une requête d’un client.</span><span class="sxs-lookup"><span data-stu-id="5493d-106">Since clients and services are separate processes, a service might not be able to respond in a timely way to a client’s request.</span></span> <span data-ttu-id="5493d-107">Le service peut être surchargé et répondre très lentement aux requêtes, ou il peut simplement ne pas être accessible pendant un bref laps de temps à cause de problèmes réseau.</span><span class="sxs-lookup"><span data-stu-id="5493d-107">The service might be overloaded and responding extremely slowly to requests or might simply not be accessible for a short time because of network issues.</span></span>

<span data-ttu-id="5493d-108">Prenons la page des détails de commande dans l’exemple d’application eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="5493d-108">For example, consider the Order details page from the eShopOnContainers sample application.</span></span> <span data-ttu-id="5493d-109">Si le microservice Ordering ne répond pas quand l’utilisateur tente d’envoyer sa commande, une mauvaise implémentation du processus client (l’application web MVC) peut bloquer indéfiniment les threads en attente d’une réponse. C’est le cas, par exemple, si le code client est défini pour utiliser des RPC synchrones sans délai d’expiration.</span><span class="sxs-lookup"><span data-stu-id="5493d-109">If the ordering microservice is unresponsive when the user tries to submit an order, a bad implementation of the client process (the MVC web application)—for example, if the client code were to use synchronous RPCs with no timeout—would block threads indefinitely waiting for a response.</span></span> <span data-ttu-id="5493d-110">Outre la mauvaise expérience que cela représente pour l’utilisateur, chaque attente de réponse consomme ou bloque un thread. Or les applications hautement évolutives ont besoin de beaucoup de threads.</span><span class="sxs-lookup"><span data-stu-id="5493d-110">In addition to creating a bad user experience, every unresponsive wait consumes or blocks a thread, and threads are extremely valuable in highly scalable applications.</span></span> <span data-ttu-id="5493d-111">Si de nombreux threads sont bloqués, le runtime de l’application peut finir par ne plus disposer de suffisamment de threads.</span><span class="sxs-lookup"><span data-stu-id="5493d-111">If there are many blocked threads, eventually the application’s runtime can run out of threads.</span></span> <span data-ttu-id="5493d-112">Si cela se produit, l’application risque de ne plus répondre du tout au lieu de ne plus répondre simplement partiellement, comme cela est illustré à la figure 10-1.</span><span class="sxs-lookup"><span data-stu-id="5493d-112">In that case, the application can become globally unresponsive instead of just partially unresponsive, as show in Figure 10-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="5493d-113">**Figure 10-1**.</span><span class="sxs-lookup"><span data-stu-id="5493d-113">**Figure 10-1**.</span></span> <span data-ttu-id="5493d-114">Défaillances partielles dues à des dépendances qui impactent la disponibilité des threads du service</span><span class="sxs-lookup"><span data-stu-id="5493d-114">Partial failures because of dependencies that impact service thread availability</span></span>

<span data-ttu-id="5493d-115">Dans une large application basée sur des microservices, une défaillance partielle peut avoir un impact plus global, surtout si la plupart des interactions de microservices internes sont basées sur des appels HTTP synchrones (ce qui est considéré comme anti-modèle).</span><span class="sxs-lookup"><span data-stu-id="5493d-115">In a large microservices-based application, any partial failure can be amplified, especially if most of the internal microservices interaction is based on synchronous HTTP calls (which is considered an anti-pattern).</span></span> <span data-ttu-id="5493d-116">Pensez à un système qui reçoit des millions d’appels par jour.</span><span class="sxs-lookup"><span data-stu-id="5493d-116">Think about a system that receives millions of incoming calls per day.</span></span> <span data-ttu-id="5493d-117">Si votre système a une mauvaise conception basée sur de longues chaînes d’appels HTTP synchrones, ces appels entrants peuvent provoquer des millions d’appels sortants supplémentaires (avec un ratio estimé de 1 pour 4) vers des dizaines de microservices internes et dépendances synchrones.</span><span class="sxs-lookup"><span data-stu-id="5493d-117">If your system has a bad design that is based on long chains of synchronous HTTP calls, these incoming calls might result in many more millions of outgoing calls (let’s suppose a ratio of 1:4) to dozens of internal microservices as synchronous dependencies.</span></span> <span data-ttu-id="5493d-118">Cette situation est illustrée à la figure 10-2, en particulier la dépendance \#3.</span><span class="sxs-lookup"><span data-stu-id="5493d-118">This situation is shown in Figure 10-2, especially dependency \#3.</span></span>

![](./media/image2.png)

<span data-ttu-id="5493d-119">**Figure 10-2**.</span><span class="sxs-lookup"><span data-stu-id="5493d-119">**Figure 10-2**.</span></span> <span data-ttu-id="5493d-120">Impact d’une mauvaise conception avec de longues chaînes de requêtes HTTP</span><span class="sxs-lookup"><span data-stu-id="5493d-120">The impact of having an incorrect design featuring long chains of HTTP requests</span></span>

<span data-ttu-id="5493d-121">Une défaillance intermittente est inévitable dans un système cloud et distribué, même si les dépendances présentent individuellement une haute disponibilité.</span><span class="sxs-lookup"><span data-stu-id="5493d-121">Intermittent failure is guaranteed in a distributed and cloud-based system, even if every dependency itself has excellent availability.</span></span> <span data-ttu-id="5493d-122">C’est un point important à prendre en compte.</span><span class="sxs-lookup"><span data-stu-id="5493d-122">It is fact you need to consider.</span></span>

<span data-ttu-id="5493d-123">Si vous ne concevez pas et n’implémentez pas de techniques de tolérance de panne, même de courts temps d’arrêt peuvent avoir des répercussions amplifiées.</span><span class="sxs-lookup"><span data-stu-id="5493d-123">If you do not design and implement techniques to ensure fault tolerance, even small downtimes can be amplified.</span></span> <span data-ttu-id="5493d-124">Par exemple, l’existence de 50 dépendances avec 99,99 % de disponibilité se traduit par plusieurs heures d’arrêt chaque mois en raison de cet effet amplificateur.</span><span class="sxs-lookup"><span data-stu-id="5493d-124">As an example, 50 dependencies each with 99.99% of availability would result in several hours of downtime each month because of this ripple effect.</span></span> <span data-ttu-id="5493d-125">En cas d’échec d’une dépendance de microservice pendant le traitement d’un grand nombre de requêtes, cette défaillance peut rapidement saturer tous les threads de requête disponibles dans chaque service et entraîner le blocage de l’application entière.</span><span class="sxs-lookup"><span data-stu-id="5493d-125">When a microservice dependency fails while handling a high volume of requests, that failure can quickly saturate all available request threads in each service and crash the whole application.</span></span>

![](./media/image3.png)

<span data-ttu-id="5493d-126">**Figure 10-3**.</span><span class="sxs-lookup"><span data-stu-id="5493d-126">**Figure 10-3**.</span></span> <span data-ttu-id="5493d-127">Défaillance partielle amplifiée par les microservices avec de longues chaînes d’appels HTTP synchrones</span><span class="sxs-lookup"><span data-stu-id="5493d-127">Partial failure amplified by microservices with long chains of synchronous HTTP calls</span></span>

<span data-ttu-id="5493d-128">Pour limiter ce problème, la section « *Asynchronous microservice integration enforce microservice’s autonomy* » (dans le chapitre sur l’architecture) vous recommande d’utiliser une communication asynchrone entre les microservices internes.</span><span class="sxs-lookup"><span data-stu-id="5493d-128">To minimize this problem, in the section "*Asynchronous microservice integration enforce microservice’s autonomy*” (in the architecture chapter), this guidance encourages you to use asynchronous communication across the internal microservices.</span></span> 

<span data-ttu-id="5493d-129">De plus, il est essentiel de concevoir vos microservices et applications clientes pour gérer les défaillances partielles, et ainsi les rendre résilients.</span><span class="sxs-lookup"><span data-stu-id="5493d-129">In addition, it is essential that you design your microservices and client applications to handle partial failures—that is, to build resilient microservices and client applications.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="5493d-130">[Précédent](index.md)
>[Suivant](partial-failure-strategies.md)</span><span class="sxs-lookup"><span data-stu-id="5493d-130">[Previous](index.md)
[Next](partial-failure-strategies.md)</span></span>