---
title: Déploiement d’applications web .NET Core basées sur un seul conteneur sur des hôtes Linux ou Windows Nano Server
description: Architecture des microservices .NET pour les applications .NET en conteneur | Déploiement d’applications web .NET Core basées sur un seul conteneur sur des hôtes Linux ou Windows Nano Server
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 06/27/2018
ms.openlocfilehash: 45be99a86a52ed450b795ca5f91c01ab82c7da47
ms.sourcegitcommit: 3c1c3ba79895335ff3737934e39372555ca7d6d0
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 09/05/2018
ms.locfileid: "43778001"
---
# <a name="deploying-single-container-based-net-core-web-applications-on-linux-or-windows-nano-server-hosts"></a><span data-ttu-id="f31df-103">Déploiement d’applications web .NET Core basées sur un seul conteneur sur des hôtes Linux ou Windows Nano Server</span><span class="sxs-lookup"><span data-stu-id="f31df-103">Deploying Single-Container-Based .NET Core Web Applications on Linux or Windows Nano Server Hosts</span></span>

<span data-ttu-id="f31df-104">_Vous pouvez utiliser des conteneurs Docker pour effectuer un déploiement monolithique d’applications web simples. Cela a pour effet d’améliorer les pipelines d’intégration continue et de déploiement continu et cela contribuer à la réussite du déploiement en production. Fini les « Comment cela se fait-il que cela fonctionne sur ma machine, mais pas en production ? »_</span><span class="sxs-lookup"><span data-stu-id="f31df-104">_You can use Docker containers for monolithic deployment of simpler web applications. This improves continuous integration and continuous deployment pipelines and helps achieve deployment-to-production success. No more “It works in my machine, why does it not work in production?”_</span></span>

<span data-ttu-id="f31df-105">Une architecture basée sur des microservices présente de nombreux avantages, mais ces avantages se payent par une complexité accrue.</span><span class="sxs-lookup"><span data-stu-id="f31df-105">A microservices-based architecture has many benefits, but those benefits come at a cost of increased complexity.</span></span> <span data-ttu-id="f31df-106">Dans certains cas, les inconvénients prennent le pas sur les avantages et une application à déploiement monolithique s’exécutant dans un seul ou dans quelques conteneurs seulement est une meilleure option.</span><span class="sxs-lookup"><span data-stu-id="f31df-106">In some cases, the costs outweigh the benefits and a monolithic deployment application running in one or a few containers is a better option.</span></span>

<span data-ttu-id="f31df-107">Il n’est pas toujours évident de décomposer une application monolithique en plusieurs microservices bien distincts.</span><span class="sxs-lookup"><span data-stu-id="f31df-107">A monolithic application might not be easily decomposable into well-separated microservices.</span></span> <span data-ttu-id="f31df-108">Vous avez appris que ces microservices devaient être partitionnés par fonction : ils doivent fonctionner indépendamment les uns des autres pour optimiser la résilience de l’application.</span><span class="sxs-lookup"><span data-stu-id="f31df-108">You've learned that these microservices should be partitioned by function: they should work independently of each other to provide a more resilient application.</span></span> <span data-ttu-id="f31df-109">Si vous ne pouvez pas proposer l’application par tranches de fonctionnalités, la diviser ne fait qu’ajouter de la complexité.</span><span class="sxs-lookup"><span data-stu-id="f31df-109">If you can't deliver feature slices of the application, separating it only adds complexity.</span></span>

<span data-ttu-id="f31df-110">Une application n’est pas pour autant nécessairement amenée à mettre à l’échelle les fonctionnalités de façon indépendante.</span><span class="sxs-lookup"><span data-stu-id="f31df-110">An application might not yet need to scale features independently.</span></span> <span data-ttu-id="f31df-111">Supposons qu’au début de l’existence de l’application de référence `eShopOnContainers`, le trafic ne justifiait pas de séparer les fonctionnalités en différents microservices.</span><span class="sxs-lookup"><span data-stu-id="f31df-111">Let’s suppose that in the early stages of the `eShopOnContainers` reference application, the traffic didn't justify separating features into different microservices.</span></span> <span data-ttu-id="f31df-112">Le trafic était si faible que le fait d’ajouter des ressources à un service revenait en fait à les ajouter à tous les services.</span><span class="sxs-lookup"><span data-stu-id="f31df-112">Traffic was small enough that adding resources to one service typically meant adding resources to all services.</span></span> <span data-ttu-id="f31df-113">Séparer l’application en services distincts aurait apporté des avantages minimes au regard du travail supplémentaire que cela demandait.</span><span class="sxs-lookup"><span data-stu-id="f31df-113">The additional work to separate the application into discrete services provided minimal benefit.</span></span>

<span data-ttu-id="f31df-114">De même, lors de la phase initiale du développement d’une application, vous n’avez peut-être pas une idée précise de là où se trouvent les limites fonctionnelles naturelles.</span><span class="sxs-lookup"><span data-stu-id="f31df-114">Also, early in the development of an application you might not have a clear idea where the natural functional boundaries are.</span></span> <span data-ttu-id="f31df-115">Même à un stade de développement où le produit est viable, il est possible que cette séparation naturelle ne se dégage toujours pas.</span><span class="sxs-lookup"><span data-stu-id="f31df-115">As you develop a minimum viable product, the natural separation might not yet have emerged.</span></span>

<span data-ttu-id="f31df-116">Certaines de ces conditions peuvent être passagères.</span><span class="sxs-lookup"><span data-stu-id="f31df-116">Some of these conditions might be temporary.</span></span> <span data-ttu-id="f31df-117">Vous pouvez commencer par créer une application monolithique et séparer par la suite certaines fonctionnalités en les développant et les déployant sous forme de microservices.</span><span class="sxs-lookup"><span data-stu-id="f31df-117">You might start by creating a monolithic application, and later separate some features to be developed and deployed as microservices.</span></span> <span data-ttu-id="f31df-118">D’autres conditions peuvent être essentielles à l’espace de problème de l’application, ce qui signifie que l’application risque de ne jamais être divisée en plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="f31df-118">Other conditions might be essential to the application’s problem space, meaning that the application might never be broken into multiple microservices.</span></span>

<span data-ttu-id="f31df-119">Séparer une application en divers processus distincts induit aussi des coûts.</span><span class="sxs-lookup"><span data-stu-id="f31df-119">Separating an application into many discrete processes also introduces overhead.</span></span> <span data-ttu-id="f31df-120">Il est plus complexe de séparer des fonctionnalités en différents processus.</span><span class="sxs-lookup"><span data-stu-id="f31df-120">There's more complexity in separating features into different processes.</span></span> <span data-ttu-id="f31df-121">Les protocoles de communication deviennent plus complexes.</span><span class="sxs-lookup"><span data-stu-id="f31df-121">The communication protocols become more complex.</span></span> <span data-ttu-id="f31df-122">Au lieu d’appeler des méthodes, vous devez utiliser des communications asynchrones entre les services.</span><span class="sxs-lookup"><span data-stu-id="f31df-122">Instead of method calls, you must use asynchronous communications between services.</span></span> <span data-ttu-id="f31df-123">Quand il s’agit de déplacer une architecture de microservices, vous devez ajouter de nombreux blocs de construction implémentés dans la version des microservices de l’application `eShopOnContainers` : gestion du bus d’événements, résilience des messages et nouvelles tentatives, cohérence à terme, etc.</span><span class="sxs-lookup"><span data-stu-id="f31df-123">As you move to a microservices architecture, you need to add many of the building blocks implemented in the microservices version of the `eShopOnContainers` application: event bus handling, message resiliency and retries, eventual consistency, and more.</span></span>

<span data-ttu-id="f31df-124">Une version très simplifiée d’eShopOnContainers (nommée [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) et figurant dans le même dépôt GitHub) s’exécute en tant qu’application MVC monolithique.</span><span class="sxs-lookup"><span data-stu-id="f31df-124">A much-simplified version of eShopOnContainers (named [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) and included in the same GitHub repository) runs as a monolithic MVC application.</span></span> <span data-ttu-id="f31df-125">Comme nous l’avons vu, ce choix de conception offre des avantages.</span><span class="sxs-lookup"><span data-stu-id="f31df-125">As described, there are advantages offered by that design choice.</span></span> <span data-ttu-id="f31df-126">Vous pouvez télécharger la source de cette application sur GitHub et l’exécuter localement.</span><span class="sxs-lookup"><span data-stu-id="f31df-126">You can download the source for this application from GitHub and run it locally.</span></span> <span data-ttu-id="f31df-127">Même cette application monolithique gagne à être déployée dans un environnement de conteneurs.</span><span class="sxs-lookup"><span data-stu-id="f31df-127">Even this monolithic application benefits from being deployed in a container environment.</span></span>

<span data-ttu-id="f31df-128">Tout d’abord, un déploiement en conteneur signifie que chaque instance de l’application s’exécute dans le même environnement.</span><span class="sxs-lookup"><span data-stu-id="f31df-128">For one, the containerized deployment means that every instance of the application runs in the same environment.</span></span> <span data-ttu-id="f31df-129">Cela inclut l’environnement de développement dans lequel les tests de la première heure et le développement ont été réalisés.</span><span class="sxs-lookup"><span data-stu-id="f31df-129">This includes the developer environment where early testing and development take place.</span></span> <span data-ttu-id="f31df-130">L’équipe de développement peut exécuter l’application dans un environnement à conteneurs qui correspond à l’environnement de production.</span><span class="sxs-lookup"><span data-stu-id="f31df-130">The development team can run the application in a containerized environment that matches the production environment.</span></span>

<span data-ttu-id="f31df-131">En outre, la montée en charge des applications en conteneur est moins coûteuse.</span><span class="sxs-lookup"><span data-stu-id="f31df-131">Also, containerized applications scale out at lower cost.</span></span> <span data-ttu-id="f31df-132">Comme nous l’avons vu précédemment, l’environnement à conteneurs permet un meilleur partage des ressources que les environnements à machines virtuelles classiques.</span><span class="sxs-lookup"><span data-stu-id="f31df-132">As you saw earlier, the container environment enables greater resource sharing than traditional VM environments.</span></span>

<span data-ttu-id="f31df-133">Enfin, la mise en conteneur de l’application contraint à établir une séparation entre la logique métier et le serveur de stockage.</span><span class="sxs-lookup"><span data-stu-id="f31df-133">Finally, containerizing the application forces a separation between the business logic and the storage server.</span></span> <span data-ttu-id="f31df-134">À mesure que l’application monte en charge, les différents conteneurs dépendent tous d’un même support de stockage physique.</span><span class="sxs-lookup"><span data-stu-id="f31df-134">As the application scales out, the various containers will all rely on a single physical storage medium.</span></span> <span data-ttu-id="f31df-135">Il s’agit généralement d’un serveur à haute disponibilité exécutant une base de données SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f31df-135">This storage would typically be a high-availability server running a SQL Server database.</span></span>

## <a name="application-tour"></a><span data-ttu-id="f31df-136">Exploration de l’application</span><span class="sxs-lookup"><span data-stu-id="f31df-136">Application tour</span></span>

<span data-ttu-id="f31df-137">L’application [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) représente une partie de l’application eShopOnContainers s’exécutant en tant qu’application monolithique, c’est-à-dire une application basée sur ASP.NET Core MVC s’exécutant sur .NET Core.</span><span class="sxs-lookup"><span data-stu-id="f31df-137">The [eShopWeb](https://github.com/dotnet-architecture/eShopOnContainers/tree/master/src/Web/WebMonolithic) application represents some of the eShopOnContainers application running as a monolithic application — an ASP.NET Core MVC-based application running on .NET Core.</span></span> <span data-ttu-id="f31df-138">Elle propose pour l’essentiel les fonctionnalités de consultation de catalogue décrites dans les sections précédentes.</span><span class="sxs-lookup"><span data-stu-id="f31df-138">It mainly provides the catalog browsing capabilities as described in earlier sections.</span></span>

<span data-ttu-id="f31df-139">L’application utilise une base de données SQL Server pour le stockage de catalogue.</span><span class="sxs-lookup"><span data-stu-id="f31df-139">The application uses a SQL Server database for the catalog storage.</span></span> <span data-ttu-id="f31df-140">Dans les déploiements basés sur des conteneurs, cette application monolithique peut accéder au même magasin de données que l’application basée sur des microservices.</span><span class="sxs-lookup"><span data-stu-id="f31df-140">In container-based deployments, this monolithic application can access the same data store as the microservices-based application.</span></span> <span data-ttu-id="f31df-141">L’application est configurée pour exécuter SQL Server dans un conteneur à côté de l’application monolithique.</span><span class="sxs-lookup"><span data-stu-id="f31df-141">The application is configured to run SQL Server in a container alongside the monolithic application.</span></span> <span data-ttu-id="f31df-142">Dans un environnement de production, SQL Server s’exécuterait sur une machine à haute disponibilité, en dehors de l’hôte Docker.</span><span class="sxs-lookup"><span data-stu-id="f31df-142">In a production environment, SQL Server would run on a high-availability machine, outside of the Docker host.</span></span> <span data-ttu-id="f31df-143">Pour des raisons pratiques, dans un environnement de développement ou de test, il est recommandé d’exécuter SQL Server dans son propre conteneur.</span><span class="sxs-lookup"><span data-stu-id="f31df-143">For convenience, in a development or test environment, running SQL Server in its own container is recommended.</span></span>

<span data-ttu-id="f31df-144">L’ensemble initial de fonctionnalités permet uniquement la consultation du catalogue.</span><span class="sxs-lookup"><span data-stu-id="f31df-144">The initial feature set only enables browsing the catalog.</span></span> <span data-ttu-id="f31df-145">Par des mises à jour, il serait possible d’activer l’ensemble complet de fonctionnalités de l’application en conteneur.</span><span class="sxs-lookup"><span data-stu-id="f31df-145">Updates would enable the full feature set of the containerized application.</span></span> <span data-ttu-id="f31df-146">Une architecture d’application web monolithique plus avancée est décrite dans le livre électronique [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) et [l’exemple d’application eShopOnWeb](https://aka.ms/WebAppArchitecture) associé.</span><span class="sxs-lookup"><span data-stu-id="f31df-146">A more advanced monolithic web application architecture is described in the [ASP.NET Web Application architecture practices](https://aka.ms/webappebook) e-book and related [eShopOnWeb sample application](https://aka.ms/WebAppArchitecture).</span></span>

## <a name="docker-support"></a><span data-ttu-id="f31df-147">Prise en charge de Docker</span><span class="sxs-lookup"><span data-stu-id="f31df-147">Docker support</span></span>

<span data-ttu-id="f31df-148">Le projet eShopOnWeb s’exécute sur .NET Core.</span><span class="sxs-lookup"><span data-stu-id="f31df-148">The eShopOnWeb project runs on .NET Core.</span></span> <span data-ttu-id="f31df-149">Cela signifie qu’il peut s’exécuter dans des conteneurs Linux ou Windows.</span><span class="sxs-lookup"><span data-stu-id="f31df-149">That means it can run in either Linux-based or Windows-based containers.</span></span> <span data-ttu-id="f31df-150">Notez que pour le déploiement de Docker, vous devez utiliser le même type d’hôte pour SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f31df-150">Note that for Docker deployment, you want to use the same host type for SQL Server.</span></span> <span data-ttu-id="f31df-151">Les conteneurs Linux offrent un plus faible encombrement et sont à privilégier.</span><span class="sxs-lookup"><span data-stu-id="f31df-151">Linux-based containers allow a smaller footprint and are preferred.</span></span>

<span data-ttu-id="f31df-152">Visual Studio propose un modèle de projet qui ajoute la prise en charge de Docker à une solution.</span><span class="sxs-lookup"><span data-stu-id="f31df-152">Visual Studio provides a project template that adds support for Docker to a solution.</span></span> <span data-ttu-id="f31df-153">Cliquez avec le bouton droit sur le projet, cliquez sur **Ajouter**, puis sur **Prise en charge de Docker**.</span><span class="sxs-lookup"><span data-stu-id="f31df-153">You right-click the project, click **Add** followed by **Docker Support**.</span></span> <span data-ttu-id="f31df-154">Le modèle ajoute un fichier Dockerfile à votre projet, ainsi qu’un nouveau projet **docker-compose** qui fournit un fichier *docker-compose.yml* de démarrage.</span><span class="sxs-lookup"><span data-stu-id="f31df-154">The template adds a Dockerfile to your project, and a new **docker-compose** project that provides a starter *docker-compose.yml* file.</span></span> <span data-ttu-id="f31df-155">Cette étape a déjà été effectuée dans le projet eShopOnWeb téléchargé sur GitHub.</span><span class="sxs-lookup"><span data-stu-id="f31df-155">This step has already been done in the eShopOnWeb project downloaded from GitHub.</span></span> <span data-ttu-id="f31df-156">Vous pouvez constater que la solution contient le projet **eShopOnWeb** et le projet **docker-compose**, comme illustré dans la figure 6-1.</span><span class="sxs-lookup"><span data-stu-id="f31df-156">You can see that the solution contains the **eShopOnWeb** project and the **docker-compose** project as shown in Figure 6-1.</span></span>

![](./media/image1.png)

<span data-ttu-id="f31df-157">**Figure 6-1** :</span><span class="sxs-lookup"><span data-stu-id="f31df-157">**Figure 6-1**.</span></span> <span data-ttu-id="f31df-158">le projet **docker-composer** dans une application web à conteneur unique</span><span class="sxs-lookup"><span data-stu-id="f31df-158">The **docker-compose** project in a single-container web application</span></span>

<span data-ttu-id="f31df-159">Ces fichiers sont des fichiers docker-composer standard, conformément à n’importe quel projet Docker.</span><span class="sxs-lookup"><span data-stu-id="f31df-159">These files are standard docker-compose files, consistent with any Docker project.</span></span> <span data-ttu-id="f31df-160">Vous pouvez les utiliser avec Visual Studio ou à partir de la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="f31df-160">You can use them with Visual Studio or from the command line.</span></span> <span data-ttu-id="f31df-161">Cette application s’exécute sur .NET Core et utilise des conteneurs Linux.</span><span class="sxs-lookup"><span data-stu-id="f31df-161">This application runs on .NET Core and uses Linux containers.</span></span> <span data-ttu-id="f31df-162">Vous pouvez donc aussi le coder, le générer et l’exécuter sur un Mac ou sur une machine Linux.</span><span class="sxs-lookup"><span data-stu-id="f31df-162">So, you can also code, build, and run it on a Mac or on a Linux machine.</span></span>

<span data-ttu-id="f31df-163">Le fichier *docker-compose.yml* contient des informations sur les images à générer et les conteneurs à lancer.</span><span class="sxs-lookup"><span data-stu-id="f31df-163">The *docker-compose.yml* file contains information about what images to build and what containers to launch.</span></span> <span data-ttu-id="f31df-164">Les modèles spécifient comment générer l’image `eshopweb` et comment lancer les conteneurs de l’application.</span><span class="sxs-lookup"><span data-stu-id="f31df-164">The templates specify how to build the `eshopweb` image and launch the application’s containers.</span></span> <span data-ttu-id="f31df-165">Vous devez ajouter la dépendance de SQL Server en incluant une image pour celui-ci (par exemple `mssql-server-linux`), ainsi qu’un service pour l’image sql.data permettant à Docker de générer et de lancer ce conteneur.</span><span class="sxs-lookup"><span data-stu-id="f31df-165">You need to add the dependency on SQL Server by including an image for it (for example, `mssql-server-linux`), and a service for the sql.data image for Docker to build and launch that container.</span></span> <span data-ttu-id="f31df-166">Ces paramètres sont illustrés dans l’exemple suivant :</span><span class="sxs-lookup"><span data-stu-id="f31df-166">These settings are shown in the following example:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web
    build:
    context: ./eShopWeb
    dockerfile: Dockerfile
    depends_on:
      - sql.data

  sql.data:
    image: microsoft/mssql-server-linux
```

<span data-ttu-id="f31df-167">La directive `depends_on` indique à Docker que l’image eShopWeb dépend de l’image sql.data.</span><span class="sxs-lookup"><span data-stu-id="f31df-167">The `depends_on` directive tells Docker that the eShopWeb image depends on the sql.data image.</span></span> <span data-ttu-id="f31df-168">Les lignes en dessous de `depends_on` sont les instructions pour générer une image étiquetée `sql.data` avec l’image `microsoft/mssql-server-linux`.</span><span class="sxs-lookup"><span data-stu-id="f31df-168">The lines below `depends_on` are the instructions to build an image tagged `sql.data` using the `microsoft/mssql-server-linux` image.</span></span>

<span data-ttu-id="f31df-169">Le projet **docker-compose** affiche les autres fichiers docker-compose sous le nœud principal *docker-compose.yml* pour indiquer visuellement que ces fichiers sont apparentés.</span><span class="sxs-lookup"><span data-stu-id="f31df-169">The **docker-compose** project displays the other docker-compose files under the main *docker-compose.yml* node to provide a visual indication that these files are related.</span></span> <span data-ttu-id="f31df-170">Le fichier *docker-compose-override.yml* contient les paramètres pour les deux services, comme des chaînes de connexion et d’autres paramètres d’application.</span><span class="sxs-lookup"><span data-stu-id="f31df-170">The *docker-compose-override.yml* file contains settings for both services, such as connection strings and other application settings.</span></span>

<span data-ttu-id="f31df-171">L’exemple suivant montre le fichier *docker-compose.vs.debug.yml*, qui contient les paramètres utilisés pour le débogage dans Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f31df-171">The following example shows the *docker-compose.vs.debug.yml* file, which contains settings used for debugging in Visual Studio.</span></span> <span data-ttu-id="f31df-172">Dans ce fichier, la balise dev est ajoutée à l’image eshopweb.</span><span class="sxs-lookup"><span data-stu-id="f31df-172">In that file, the eshopweb image has the dev tag appended to it.</span></span> <span data-ttu-id="f31df-173">Ceci permet de séparer le débogage des images des versions, et de vous éviter ainsi de déployer accidentellement les informations de débogage dans un environnement de production :</span><span class="sxs-lookup"><span data-stu-id="f31df-173">That helps separate debug from release images so that you don't accidentally deploy the debug information to a production environment:</span></span>

```yml
version: '2'

services:
  eshopweb:
    image: eshop/web:dev
    build:
    args:
    source: ${DOCKER_BUILD_SOURCE}
    environment:
      - DOTNET_USE_POLLING_FILE_WATCHER=1
    volumes:
      - ./eShopWeb:/app
      - ~/.nuget/packages:/root/.nuget/packages:ro
      - ~/clrdbg:/clrdbg:ro
    entrypoint: tail -f /dev/null
    labels:
      - "com.microsoft.visualstudio.targetoperatingsystem=linux"
```

<span data-ttu-id="f31df-174">Le dernier fichier ajouté est *docker-compose.ci.build.yml*.</span><span class="sxs-lookup"><span data-stu-id="f31df-174">The last file added is *docker-compose.ci.build.yml*.</span></span> <span data-ttu-id="f31df-175">Il permet de générer le projet à partir d’un serveur CI depuis la ligne de commande.</span><span class="sxs-lookup"><span data-stu-id="f31df-175">This file would be used from the command line to build the project from a CI server.</span></span> <span data-ttu-id="f31df-176">Ce fichier compose démarre un conteneur Docker qui génère les images nécessaires à votre application.</span><span class="sxs-lookup"><span data-stu-id="f31df-176">This compose file starts a Docker container that builds the images needed for your application.</span></span> <span data-ttu-id="f31df-177">L’exemple suivant montre le contenu du fichier *docker-compose.ci.build.yml* :</span><span class="sxs-lookup"><span data-stu-id="f31df-177">The following example shows the contents of the *docker-compose.ci.build.yml* file:</span></span>

```yml
version: '2'

services:
  ci-build:
    image: microsoft/aspnetcore-build:latest
    volumes:
      - .:/src
    working_dir: /src
  command: /bin/bash -c "dotnet restore ./eShopWeb.sln && dotnet publish  ./eShopWeb.sln -c Release -o ./obj/Docker/publish"
```

> [!NOTE]
> <span data-ttu-id="f31df-178">À compter de .NET Core SDK 2.0, la commande [dotnet restore](../../../core/tools/dotnet-restore.md) s’exécute automatiquement quand [dotnet publish](../../../core/tools/dotnet-publish.md) est exécuté.</span><span class="sxs-lookup"><span data-stu-id="f31df-178">Starting with .NET Core SDK 2.0, the [dotnet restore](../../../core/tools/dotnet-restore.md) command executes automatically when [dotnet publish](../../../core/tools/dotnet-publish.md) is executed.</span></span>

<span data-ttu-id="f31df-179">Notez que l’image est une image de build ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="f31df-179">Notice that the image is an ASP.NET Core build image.</span></span> <span data-ttu-id="f31df-180">Cette image comprend le kit SDK et les outils de génération permettant de générer votre application et de créer les images nécessaires.</span><span class="sxs-lookup"><span data-stu-id="f31df-180">That image includes the SDK and build tools to build your application and create the required images.</span></span> <span data-ttu-id="f31df-181">Le fait d’exécuter le projet **docker-composer** avec ce fichier a pour effet de démarrer le conteneur de build à partir de l’image, puis de générer l’image de votre application dans ce conteneur.</span><span class="sxs-lookup"><span data-stu-id="f31df-181">Running the **docker-compose** project using this file starts the build container from the image, then builds your application’s image in that container.</span></span> <span data-ttu-id="f31df-182">Vous spécifiez ce fichier *docker-compose* dans la ligne de commande pour générer votre application dans un conteneur Docker, puis vous la lancez.</span><span class="sxs-lookup"><span data-stu-id="f31df-182">You specify that *docker-compose* file as part of the command line to build your application in a Docker container, then launch it.</span></span>

<span data-ttu-id="f31df-183">Dans Visual Studio, vous pouvez exécuter votre application dans des conteneurs Docker en sélectionnant le projet **docker-composer** comme projet de démarrage, puis en appuyant sur Ctrl+F5 (F5 pour déboguer), comme vous le feriez avec n’importe quelle autre application.</span><span class="sxs-lookup"><span data-stu-id="f31df-183">In Visual Studio, you can run your application in Docker containers by selecting the **docker-compose** project as the startup project, and then pressing Ctrl+F5 (F5 to debug), as you can with any other application.</span></span> <span data-ttu-id="f31df-184">Quand vous démarrez le projet **docker-compose**, Visual Studio exécute **docker-compose** en utilisant le fichier *docker-compose.yml*, le fichier *docker-compose.override.yml* et un des fichiers docker-compose.vs.\*</span><span class="sxs-lookup"><span data-stu-id="f31df-184">When you start the **docker-compose** project, Visual Studio runs **docker-compose** using the *docker-compose.yml* file, the *docker-compose.override.yml* file, and one of the docker-compose.vs.\* files.</span></span> <span data-ttu-id="f31df-185">Une fois que l’application a démarré, Visual Studio lance automatiquement le navigateur.</span><span class="sxs-lookup"><span data-stu-id="f31df-185">Once the application has started, Visual Studio launches the browser for you.</span></span>

<span data-ttu-id="f31df-186">Si vous lancez l’application dans le débogueur, Visual Studio s’attache à l’application en cours d’exécution dans Docker.</span><span class="sxs-lookup"><span data-stu-id="f31df-186">If you launch the application in the debugger, Visual Studio attaches to the running application in Docker.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="f31df-187">Résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="f31df-187">Troubleshooting</span></span>

<span data-ttu-id="f31df-188">Cette section décrit certains problèmes que vous êtes susceptible de rencontrer pendant l’exécution locale de conteneurs et propose des correctifs.</span><span class="sxs-lookup"><span data-stu-id="f31df-188">This section describes a few issues that might arise when your run containers locally and suggests some fixes.</span></span>

### <a name="stop-docker-containers"></a><span data-ttu-id="f31df-189">Arrêter des conteneurs Docker</span><span class="sxs-lookup"><span data-stu-id="f31df-189">Stop Docker containers</span></span>

<span data-ttu-id="f31df-190">Après avoir lancé l’application en conteneur, les conteneurs continuent de s’exécuter, même après avoir arrêté le débogage.</span><span class="sxs-lookup"><span data-stu-id="f31df-190">After you launch the containerized application, the containers continue to run, even after you have stopped debugging.</span></span> <span data-ttu-id="f31df-191">Vous pouvez exécuter la commande `docker ps` depuis la ligne de commande pour voir quels conteneurs s’exécutent.</span><span class="sxs-lookup"><span data-stu-id="f31df-191">You can run the `docker ps` command from the command line to see which containers are running.</span></span> <span data-ttu-id="f31df-192">La commande `docker stop` permet d’arrêter un conteneur en cours d’exécution, comme le montre la figure 6-2.</span><span class="sxs-lookup"><span data-stu-id="f31df-192">The `docker stop` command stops a running container, as shown in Figure 6-2.</span></span>

![](./media/image2.png)

<span data-ttu-id="f31df-193">**Figure 6-2** :</span><span class="sxs-lookup"><span data-stu-id="f31df-193">**Figure 6-2**.</span></span> <span data-ttu-id="f31df-194">affichage et arrêt de conteneurs à l’aide des commandes CLI docker ps et docker stop</span><span class="sxs-lookup"><span data-stu-id="f31df-194">Listing and stopping containers with the docker ps and docker stop CLI commands</span></span>

<span data-ttu-id="f31df-195">Vous pouvez être amené à arrêter les processus en cours d’exécution quand vous basculez d’une configuration à une autre.</span><span class="sxs-lookup"><span data-stu-id="f31df-195">You might need to stop running processes when you switch between different configurations.</span></span> <span data-ttu-id="f31df-196">Sinon, le conteneur qui exécute l’application web utilise le port de votre application (en l’occurrence, le port 5106).</span><span class="sxs-lookup"><span data-stu-id="f31df-196">Otherwise, the container that is running the web application is using the port for your application (5106 in this example).</span></span>

### <a name="add-docker-to-your-projects"></a><span data-ttu-id="f31df-197">Ajout de Docker à vos projets</span><span class="sxs-lookup"><span data-stu-id="f31df-197">Add Docker to your projects</span></span>

<span data-ttu-id="f31df-198">L’Assistant qui ajoute la prise en charge de Docker communique avec le processus Docker en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="f31df-198">The wizard that adds Docker support communicates with the running Docker process.</span></span> <span data-ttu-id="f31df-199">Si Docker n’est pas en cours d’exécution au moment où vous démarrez l’Assistant, celui-ci ne fonctionne pas correctement.</span><span class="sxs-lookup"><span data-stu-id="f31df-199">If Docker isn't running when you start the wizard, the wizard won't run correctly.</span></span> <span data-ttu-id="f31df-200">L’Assistant examine votre choix de conteneur actuel pour ajouter la prise en charge de Docker appropriée.</span><span class="sxs-lookup"><span data-stu-id="f31df-200">The wizard examines your current container choice to add the correct Docker support.</span></span> <span data-ttu-id="f31df-201">Pour ajouter la prise en charge des conteneurs Windows, exécutez l’Assistant pendant que Docker s’exécute avec les conteneurs Windows configurés.</span><span class="sxs-lookup"><span data-stu-id="f31df-201">To add support for Windows Containers, run the wizard while you have Docker running with Windows Containers configured.</span></span> <span data-ttu-id="f31df-202">Pour ajouter la prise en charge des conteneurs Linux, exécutez l’Assistant pendant que Docker s’exécute avec les conteneurs Linux configurés.</span><span class="sxs-lookup"><span data-stu-id="f31df-202">To add support for Linux containers, run the wizard while you have Docker running with Linux containers configured.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="f31df-203">[Précédent](../docker-application-development-process/docker-app-development-workflow.md)
[Suivant](../containerize-net-framework-applications/index.md)</span><span class="sxs-lookup"><span data-stu-id="f31df-203">[Previous](../docker-application-development-process/docker-app-development-workflow.md)
[Next](../containerize-net-framework-applications/index.md)</span></span>
