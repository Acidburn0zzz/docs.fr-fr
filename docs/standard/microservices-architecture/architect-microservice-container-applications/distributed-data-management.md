---
title: "Défis et solutions pour la gestion des données distribuées"
description: "Architecture de Microservices .NET pour les Applications .NET en conteneur | Défis et solutions pour la gestion des données distribuées"
keywords: Docker, microservices, ASP.NET, conteneur
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: f961475b40c74bf448cff1aeae04ae4866360e52
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/22/2017
---
# <a name="challenges-and-solutions-for-distributed-data-management"></a><span data-ttu-id="a80cd-104">Défis et solutions pour la gestion des données distribuées</span><span class="sxs-lookup"><span data-stu-id="a80cd-104">Challenges and solutions for distributed data management</span></span>

## <a name="challenge-1-how-to-define-the-boundaries-of-each-microservice"></a><span data-ttu-id="a80cd-105">Défi \#1 : comment définir les limites de chaque microservice</span><span class="sxs-lookup"><span data-stu-id="a80cd-105">Challenge \#1: How to define the boundaries of each microservice</span></span>

<span data-ttu-id="a80cd-106">Définir les limites de microservice est sans doute le premier test, que toute personne rencontre.</span><span class="sxs-lookup"><span data-stu-id="a80cd-106">Defining microservice boundaries is probably the first challenge anyone encounters.</span></span> <span data-ttu-id="a80cd-107">Chaque microservice doit s’agir d’une partie de votre application et chaque microservice doit être autonome avec tous les avantages et les défis auxquels il transmet.</span><span class="sxs-lookup"><span data-stu-id="a80cd-107">Each microservice has to be a piece of your application and each microservice should be autonomous with all the benefits and challenges that it conveys.</span></span> <span data-ttu-id="a80cd-108">Mais comment identifier ces limites ?</span><span class="sxs-lookup"><span data-stu-id="a80cd-108">But how do you identify those boundaries?</span></span>

<span data-ttu-id="a80cd-109">Tout d’abord, vous devez vous concentrer sur les modèles de domaine logique de l’application et les données associées.</span><span class="sxs-lookup"><span data-stu-id="a80cd-109">First, you need to focus on the application’s logical domain models and related data.</span></span> <span data-ttu-id="a80cd-110">Vous devez essayer d’identifier découplées îlots de données et des contextes différents au sein de la même application.</span><span class="sxs-lookup"><span data-stu-id="a80cd-110">You must try to identify decoupled islands of data and different contexts within the same application.</span></span> <span data-ttu-id="a80cd-111">Chaque contexte peut avoir un langage différent (conditions commerciales).</span><span class="sxs-lookup"><span data-stu-id="a80cd-111">Each context could have a different business language (different business terms).</span></span> <span data-ttu-id="a80cd-112">Les contextes doivent être définis et gérés indépendamment.</span><span class="sxs-lookup"><span data-stu-id="a80cd-112">The contexts should be defined and managed independently.</span></span> <span data-ttu-id="a80cd-113">Les entités utilisées dans ces contextes différents peuvent sembler identiques, mais vous pouvez découvrir que dans un contexte spécifique, un concept métier avec l’un est utilisé à des fins différentes dans un autre contexte et peut-être même un autre nom.</span><span class="sxs-lookup"><span data-stu-id="a80cd-113">The terms and entities used in those different contexts might sound similar, but you might discover that in a particular context, a business concept with one is used for a different purpose in another context, and might even have a different name.</span></span> <span data-ttu-id="a80cd-114">Par exemple, un utilisateur peut être référencé en tant qu’utilisateur dans le contexte d’identité ou l’appartenance, en tant que client dans un contexte CRM, comme un acheteur dans un contexte de tri et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="a80cd-114">For instance, a user can be referred as a user in the identity or membership context, as a customer in a CRM context, as a buyer in an ordering context, and so forth.</span></span>

<span data-ttu-id="a80cd-115">La façon de vous identifiez les limites entre plusieurs contextes d’application avec un domaine différent pour chaque contexte est exactement comment vous pouvez identifier les limites de chaque microservice de l’entreprise et ses données associées données et le modèle de domaine.</span><span class="sxs-lookup"><span data-stu-id="a80cd-115">The way you identify boundaries between multiple application contexts with a different domain for each context is exactly how you can identify the boundaries for each business microservice and its related domain model and data.</span></span> <span data-ttu-id="a80cd-116">Vous tentez de réduire le couplage entre ces microservices toujours.</span><span class="sxs-lookup"><span data-stu-id="a80cd-116">You always attempt to minimize the coupling between those microservices.</span></span> <span data-ttu-id="a80cd-117">Ce guide passe en plus de détails sur cette conception de modèle d’identification et de domaine dans la section [identification des limites de modèle de domaine pour chaque microservice](#identifying-domain-model-boundaries-for-each-microservice) plus tard.</span><span class="sxs-lookup"><span data-stu-id="a80cd-117">This guide goes into more detail about this identification and domain model design in the section [Identifying domain-model boundaries for each microservice](#identifying-domain-model-boundaries-for-each-microservice) later.</span></span>

## <a name="challenge-2-how-to-create-queries-that-retrieve-data-from-several-microservices"></a><span data-ttu-id="a80cd-118">Défi \#2 : comment créer des requêtes qui extraient des données à partir de plusieurs microservices</span><span class="sxs-lookup"><span data-stu-id="a80cd-118">Challenge \#2: How to create queries that retrieve data from several microservices</span></span>

<span data-ttu-id="a80cd-119">Un deuxième consiste à implémenter des requêtes qui récupèrent des données à partir de plusieurs microservices, tout en évitant la communication bavarde à la microservices à partir d’applications de client à distance.</span><span class="sxs-lookup"><span data-stu-id="a80cd-119">A second challenge is how to implement queries that retrieve data from several microservices, while avoiding chatty communication to the microservices from remote client apps.</span></span> <span data-ttu-id="a80cd-120">Un exemple peut être un seul écran à partir d’une application mobile qui a besoin d’afficher les informations utilisateur qui sont détenues par le panier d’achat, le catalogue et microservices d’identité utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a80cd-120">An example could be a single screen from a mobile app that needs to show user information that is owned by the basket, catalog, and user identity microservices.</span></span> <span data-ttu-id="a80cd-121">Un autre exemple consisterait à un rapport complex impliquant plusieurs tables situées dans plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="a80cd-121">Another example would be a complex report involving many tables located in multiple microservices.</span></span> <span data-ttu-id="a80cd-122">La solution dépend de la complexité des requêtes.</span><span class="sxs-lookup"><span data-stu-id="a80cd-122">The right solution depends on the complexity of the queries.</span></span> <span data-ttu-id="a80cd-123">Mais dans tous les cas, vous devrez un moyen pour regrouper les informations si vous souhaitez améliorer l’efficacité dans les communications de votre système.</span><span class="sxs-lookup"><span data-stu-id="a80cd-123">But in any case, you will need a way to aggregate information if you want to improve the efficiency in the communications of your system.</span></span> <span data-ttu-id="a80cd-124">Les solutions les plus populaires sont les suivantes :</span><span class="sxs-lookup"><span data-stu-id="a80cd-124">The most popular solutions are the following.</span></span>

<span data-ttu-id="a80cd-125">**Passerelle API**.</span><span class="sxs-lookup"><span data-stu-id="a80cd-125">**API Gateway**.</span></span> <span data-ttu-id="a80cd-126">Pour l’agrégation de données simple à partir de plusieurs microservices qui possèdent des bases de données différentes, l’approche recommandée est un microservice d’agrégation visé une passerelle API.</span><span class="sxs-lookup"><span data-stu-id="a80cd-126">For simple data aggregation from multiple microservices that own different databases, the recommended approach is an aggregation microservice referred to as an API Gateway.</span></span> <span data-ttu-id="a80cd-127">Toutefois, vous devez faire attention à la mise en œuvre de ce modèle, car il peut être un point d’étranglement dans votre système, et il peut violer le principe d’autonomie de microservice.</span><span class="sxs-lookup"><span data-stu-id="a80cd-127">However, you need to be careful about implementing this pattern, because it can be a choke point in your system, and it can violate the principle of microservice autonomy.</span></span> <span data-ttu-id="a80cd-128">Pour atténuer ce risque, vous pouvez avoir plusieurs passerelles d’API précis pour chaque une en mettant l’accent sur une « tranche » à la verticale ou d’un secteur d’activité du système.</span><span class="sxs-lookup"><span data-stu-id="a80cd-128">To mitigate this possibility, you can have multiple fined-grained API Gateways each one focusing on a vertical “slice” or business area of the system.</span></span> <span data-ttu-id="a80cd-129">Le modèle de la passerelle API est expliqué plus en détail dans la section de l’utilisation une passerelle API ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="a80cd-129">The API Gateway pattern is explained in more detail in the section in the Using an API Gateway later.</span></span>

<span data-ttu-id="a80cd-130">**CQRS avec des tables de la requête/lecture**.</span><span class="sxs-lookup"><span data-stu-id="a80cd-130">**CQRS with query/reads tables**.</span></span> <span data-ttu-id="a80cd-131">Une autre solution pour agréger les données à partir de plusieurs microservices est la [modèle de vue matérialisée](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span><span class="sxs-lookup"><span data-stu-id="a80cd-131">Another solution for aggregating data from multiple microservices is the [Materialized View pattern](https://docs.microsoft.com/azure/architecture/patterns/materialized-view).</span></span> <span data-ttu-id="a80cd-132">Dans cette approche, vous générez, à l’avance (préparer les données dénormalisées avant les requêtes réelles se produisent), une table en lecture seule avec les données appartenant à plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="a80cd-132">In this approach, you generate, in advance (prepare denormalized data before the actual queries happen), a read-only table with the data that is owned by multiple microservices.</span></span> <span data-ttu-id="a80cd-133">La table a un format adapté aux besoins de l’application cliente.</span><span class="sxs-lookup"><span data-stu-id="a80cd-133">The table has a format suited to the client app’s needs.</span></span>

<span data-ttu-id="a80cd-134">Pensez à quelque chose comme l’écran pour une application mobile.</span><span class="sxs-lookup"><span data-stu-id="a80cd-134">Consider something like the screen for a mobile app.</span></span> <span data-ttu-id="a80cd-135">Si vous avez une base de données, vous pourrez rassembler les données de cet écran à l’aide d’une requête SQL qui effectue une jointure complexe impliquant plusieurs tables.</span><span class="sxs-lookup"><span data-stu-id="a80cd-135">If you have a single database, you might pull together the data for that screen using a SQL query that performs a complex join involving multiple tables.</span></span> <span data-ttu-id="a80cd-136">Toutefois, lorsque vous avez plusieurs bases de données, et chaque base de données est détenu par un autre microservice, vous ne peut pas interroger les bases de données et créer une jointure SQL.</span><span class="sxs-lookup"><span data-stu-id="a80cd-136">However, when you have multiple databases, and each database is owned by a different microservice, you cannot query those databases and create a SQL join.</span></span> <span data-ttu-id="a80cd-137">Votre requête complexe devient un défi.</span><span class="sxs-lookup"><span data-stu-id="a80cd-137">Your complex query becomes a challenge.</span></span> <span data-ttu-id="a80cd-138">Vous pouvez traiter la demande à l’aide d’une approche CQRS, vous créez une table dénormalisée dans une autre base de données qui est utilisé pour les requêtes.</span><span class="sxs-lookup"><span data-stu-id="a80cd-138">You can address the requirement using a CQRS approach—you create a denormalized table in a different database that is used just for queries.</span></span> <span data-ttu-id="a80cd-139">La table permettre être conçue spécifiquement pour les données que vous avez besoin pour la requête complexe, avec une relation entre les champs requis par votre écran de l’application et les colonnes dans la table de requête.</span><span class="sxs-lookup"><span data-stu-id="a80cd-139">The table can be designed specifically for the data you need for the complex query, with a one-to-one relationship between fields needed by your application’s screen and the columns in the query table.</span></span> <span data-ttu-id="a80cd-140">Il peut également servir à des fins de création de rapports.</span><span class="sxs-lookup"><span data-stu-id="a80cd-140">It could also serve for reporting purposes.</span></span>

<span data-ttu-id="a80cd-141">Cette approche résout non seulement le problème d’origine (la façon de requêtes et de jointure entre microservices) ; Il améliore également les performances considérablement quand elle est comparée avec une jointure complexe, car vous avez déjà les données nécessaires à l’application dans la table de requête.</span><span class="sxs-lookup"><span data-stu-id="a80cd-141">This approach not only solves the original problem (how to query and join across microservices); it also improves performance considerably when compared with a complex join, because you already have the data that the application needs in the query table.</span></span> <span data-ttu-id="a80cd-142">Bien entendu, à l’aide de la commande et répartition de responsabilité de requête (CQRS) avec des tables de la requête/lecture signifie que le travail de développement supplémentaire, et vous devrez adopter la cohérence éventuelle.</span><span class="sxs-lookup"><span data-stu-id="a80cd-142">Of course, using Command and Query Responsibility Segregation (CQRS) with query/reads tables means additional development work, and you will need to embrace eventual consistency.</span></span> <span data-ttu-id="a80cd-143">Néanmoins, les exigences de performances et haute évolutivité dans [scénarios collaboratifs](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (ou des scénarios de concurrence, en fonction du point de vue) est où vous devez appliquer CQRS avec plusieurs bases de données.</span><span class="sxs-lookup"><span data-stu-id="a80cd-143">Nonetheless, requirements on performance and high scalability in [collaborative scenarios](http://udidahan.com/2011/10/02/why-you-should-be-using-cqrs-almost-everywhere/) (or competitive scenarios, depending on the point of view) is where you should apply CQRS with multiple databases.</span></span>

<span data-ttu-id="a80cd-144">**« Données à froid » dans les bases de données centrales**.</span><span class="sxs-lookup"><span data-stu-id="a80cd-144">**“Cold data” in central databases**.</span></span> <span data-ttu-id="a80cd-145">Pour des rapports complexes et les requêtes qui ne nécessitent pas de données en temps réel, une approche courante consiste à exporter votre » à chaud données » (données transactionnelles à partir de la microservices) en tant que « données à froid » dans les bases de données volumineuses qui sont utilisés uniquement pour le rapport.</span><span class="sxs-lookup"><span data-stu-id="a80cd-145">For complex reports and queries that might not require real-time data, a common approach is to export your “hot data” (transactional data from the microservices) as “cold data” into large databases that are used only for reporting.</span></span> <span data-ttu-id="a80cd-146">Ce système de base de données centrale peut être un système basé sur les données volumineuses, telles que Hadoop, un entrepôt de données comme une basée sur Azure SQL Data Warehouse, ou même une seule base de données SQL utilisée pour les rapports (si la taille ne sera pas un problème).</span><span class="sxs-lookup"><span data-stu-id="a80cd-146">That central database system can be a Big Data-based system, like Hadoop, a data warehouse like one based on Azure SQL Data Warehouse, or even a single SQL database used just for reports (if size will not be an issue).</span></span>

<span data-ttu-id="a80cd-147">Gardez à l’esprit que cette base de données centralisée serait utilisée uniquement pour les requêtes et des rapports qui n’ont pas besoin de données en temps réel.</span><span class="sxs-lookup"><span data-stu-id="a80cd-147">Keep in mind that this centralized database would be used only for queries and reports that do not need real-time data.</span></span> <span data-ttu-id="a80cd-148">Les mises à jour et les transactions, en tant que votre source de vérité, d’origine doivent être dans vos données microservices.</span><span class="sxs-lookup"><span data-stu-id="a80cd-148">The original updates and transactions, as your source of truth, have to be in your microservices data.</span></span> <span data-ttu-id="a80cd-149">La méthode que vous devez synchroniser les données serait à l’aide de communication pilotée par événements (traitée dans les sections suivantes) ou à l’aide d’autres outils d’importation/exportation d’infrastructure de base de données.</span><span class="sxs-lookup"><span data-stu-id="a80cd-149">The way you would synchronize data would be either by using event-driven communication (covered in the next sections) or by using other database infrastructure import/export tools.</span></span> <span data-ttu-id="a80cd-150">Si vous utilisez pilotée par événements de communication, ce processus d’intégration serait similaire à la façon de que propager les données comme décrit précédemment pour les tables de requête CQRS.</span><span class="sxs-lookup"><span data-stu-id="a80cd-150">If you use event-driven communication, that integration process would be similar to the way you propagate data as described earlier for CQRS query tables.</span></span>

<span data-ttu-id="a80cd-151">Toutefois, si la conception de votre application implique l’agrégation en permanence des informations à partir de plusieurs microservices pour les requêtes complexes, il peut être le symptôme d’une conception médiocre, un microservice doit être isolé que possible à partir d’autres microservices.</span><span class="sxs-lookup"><span data-stu-id="a80cd-151">However, if your application design involves constantly aggregating information from multiple microservices for complex queries, it might be a symptom of a bad design—a microservice should be as isolated as possible from other microservices.</span></span> <span data-ttu-id="a80cd-152">(Cela exclut les rapports/analytique qui doit toujours utiliser des bases de données centrales de données à froid). Ce problème persiste souvent peut être une raison de microservices de fusion.</span><span class="sxs-lookup"><span data-stu-id="a80cd-152">(This excludes reports/analytics that always should use cold-data central databases.) Having this problem often might be a reason to merge microservices.</span></span> <span data-ttu-id="a80cd-153">Vous devez équilibrer l’autonomie d’évolution et de déploiement de chaque microservice avec des dépendances fortes, cohésion et agrégation des données.</span><span class="sxs-lookup"><span data-stu-id="a80cd-153">You need to balance the autonomy of evolution and deployment of each microservice with strong dependencies, cohesion, and data aggregation.</span></span>

## <a name="challenge-3-how-to-achieve-consistency-across-multiple-microservices"></a><span data-ttu-id="a80cd-154">Défi \#3 : comment garantir la cohérence entre plusieurs microservices</span><span class="sxs-lookup"><span data-stu-id="a80cd-154">Challenge \#3: How to achieve consistency across multiple microservices</span></span>

<span data-ttu-id="a80cd-155">Comme indiqué précédemment, les données appartienne à chaque microservice sont privées pour ce microservice et est accessible uniquement à l’aide de son API microservice.</span><span class="sxs-lookup"><span data-stu-id="a80cd-155">As stated previously, the data owned by each microservice is private to that microservice and can only be accessed using its microservice API.</span></span> <span data-ttu-id="a80cd-156">Par conséquent, un présentées consiste à implémenter des processus d’entreprise de bout en bout tout en conservant la cohérence entre plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="a80cd-156">Therefore, a challenge presented is how to implement end-to-end business processes while keeping consistency across multiple microservices.</span></span>

<span data-ttu-id="a80cd-157">Pour analyser ce problème, nous allons étudier un exemple de la [eShopOnContainers référencer l’application](http://aka.ms/eshoponcontainers).</span><span class="sxs-lookup"><span data-stu-id="a80cd-157">To analyze this problem, let’s look at an example from the [eShopOnContainers reference application](http://aka.ms/eshoponcontainers).</span></span> <span data-ttu-id="a80cd-158">Le catalogue microservice conserve les informations sur les produits, y compris leur niveau de stock.</span><span class="sxs-lookup"><span data-stu-id="a80cd-158">The Catalog microservice maintains information about all the products, including their stock level.</span></span> <span data-ttu-id="a80cd-159">Le classement microservice gère les commandes et devez vérifier qu’une commande ne dépasse pas le stock de produit du catalogue accessibles à le.</span><span class="sxs-lookup"><span data-stu-id="a80cd-159">The Ordering microservice manages orders and must verify that a new order does not exceed the available catalog product stock.</span></span> <span data-ttu-id="a80cd-160">(Ou le scénario peut impliquer une logique qui gère les autres produits.) Dans la version monolithique hypothétique de cette application, le sous-système de tri peut utiliser simplement de transaction ACID pour vérifier le stock disponible, créez la commande dans la table Orders et mettre à jour le stock disponible dans la table Products.</span><span class="sxs-lookup"><span data-stu-id="a80cd-160">(Or the scenario might involve logic that handles backordered products.) In a hypothetical monolithic version of this application, the ordering subsystem could simply use an ACID transaction to check the available stock, create the order in the Orders table, and update the available stock in the Products table.</span></span>

<span data-ttu-id="a80cd-161">Toutefois, dans une application microservices-, les tables Order et produit appartiennent à leurs microservices respectifs.</span><span class="sxs-lookup"><span data-stu-id="a80cd-161">However, in a microservices- based application, the Order and Product tables are owned by their respective microservices.</span></span> <span data-ttu-id="a80cd-162">Aucun microservice ne doit inclure jamais de bases de données appartenant à un autre microservice dans ses propres transactions ou des requêtes, comme indiqué dans la Figure 4 à 9.</span><span class="sxs-lookup"><span data-stu-id="a80cd-162">No microservice should ever include databases owned by another microservice in its own transactions or queries, as shown in Figure 4-9.</span></span>

![](./media/image9.PNG)

<span data-ttu-id="a80cd-163">**Figure 4-9**.</span><span class="sxs-lookup"><span data-stu-id="a80cd-163">**Figure 4-9**.</span></span> <span data-ttu-id="a80cd-164">Un microservice ne peut pas accéder directement à une table dans une autre microservice</span><span class="sxs-lookup"><span data-stu-id="a80cd-164">A microservice cannot directly access a table in another microservice</span></span>

<span data-ttu-id="a80cd-165">Le classement microservice ne doit pas mettre la table Products directement, car la table Products est détenue par le catalogue microservice.</span><span class="sxs-lookup"><span data-stu-id="a80cd-165">The Ordering microservice should not update the Products table directly, because the Products table is owned by the Catalog microservice.</span></span> <span data-ttu-id="a80cd-166">Pour effectuer une mise à jour pour le catalogue microservice, le classement microservice doit uniquement utiliser des communications asynchrones tels que les événements d’intégration (message et la communication basée sur les événements).</span><span class="sxs-lookup"><span data-stu-id="a80cd-166">To make an update to the Catalog microservice, the Ordering microservice should only ever use asynchronous communication such as integration events (message and event-based communication).</span></span> <span data-ttu-id="a80cd-167">Voici comment la [eShopOnContainers](http://aka.ms/eshoponcontainers) référence application effectue ce type de mise à jour.</span><span class="sxs-lookup"><span data-stu-id="a80cd-167">This is how the [eShopOnContainers](http://aka.ms/eshoponcontainers) reference application performs this type of update.</span></span>

<span data-ttu-id="a80cd-168">Comme indiqué par le [théorème de CAP](https://en.wikipedia.org/wiki/CAP_theorem), vous devez choisir entre la disponibilité et cohérence forte ACID.</span><span class="sxs-lookup"><span data-stu-id="a80cd-168">As stated by the [CAP theorem](https://en.wikipedia.org/wiki/CAP_theorem), you need to choose between availability and ACID strong consistency.</span></span> <span data-ttu-id="a80cd-169">La plupart des scénarios basés sur microservice exigent une disponibilité et une haute évolutivité par opposition à forte cohérence.</span><span class="sxs-lookup"><span data-stu-id="a80cd-169">Most microservice-based scenarios demand availability and high scalability as opposed to strong consistency.</span></span> <span data-ttu-id="a80cd-170">Les applications critiques doivent rester et en cours d’exécution et les développeurs peuvent contourner la cohérence forte à l’aide des techniques pour travailler avec la cohérence éventuelle ou faible.</span><span class="sxs-lookup"><span data-stu-id="a80cd-170">Mission-critical applications must remain up and running, and developers can work around strong consistency by using techniques for working with weak or eventual consistency.</span></span> <span data-ttu-id="a80cd-171">Il s’agit de l’approche adoptée par la plupart des architectures basée sur un microservice.</span><span class="sxs-lookup"><span data-stu-id="a80cd-171">This is the approach taken by most microservice-based architectures.</span></span>

<span data-ttu-id="a80cd-172">En outre, ACID de style ou de transactions de validation en deux phases ne sont pas simplement sur les principes de microservices ; la plupart des bases de données NoSQL (par exemple, la base de données Azure Cosmos, MongoDB, etc.) ne prennent pas en charge les transactions de validation en deux phases.</span><span class="sxs-lookup"><span data-stu-id="a80cd-172">Moreover, ACID-style or two-phase commit transactions are not just against microservices principles; most NoSQL databases (like Azure Cosmos DB, MongoDB, etc.) do not support two-phase commit transactions.</span></span> <span data-ttu-id="a80cd-173">Toutefois, en conservant les données cohérence pour les services et les bases de données est essentielle.</span><span class="sxs-lookup"><span data-stu-id="a80cd-173">However, maintaining data consistency across services and databases is essential.</span></span> <span data-ttu-id="a80cd-174">Cette demande est également liée à la question de la façon de propager les modifications entre plusieurs microservices lorsque certaines données doivent être redondant, par exemple, lorsque vous devez avoir le nom du produit ou une description dans le catalogue microservice et le panier d’achat microservice.</span><span class="sxs-lookup"><span data-stu-id="a80cd-174">This challenge is also related to the question of how to propagate changes across multiple microservices when certain data needs to be redundant—for example, when you need to have the product’s name or description in the Catalog microservice and the Basket microservice.</span></span>

<span data-ttu-id="a80cd-175">Une bonne solution pour résoudre ce problème consiste à utiliser les cohérence éventuelle entre microservices articulé via pilotée par événements de communication et d’un système de publication et d’abonnement.</span><span class="sxs-lookup"><span data-stu-id="a80cd-175">A good solution for this problem is to use eventual consistency between microservices articulated through event-driven communication and a publish-and-subscribe system.</span></span> <span data-ttu-id="a80cd-176">Ces rubriques sont traitées dans la section [une communication asynchrone commandé par événement](#async_event_driven_communication) plus loin dans ce guide.</span><span class="sxs-lookup"><span data-stu-id="a80cd-176">These topics are covered in the section [Asynchronous event-driven communication](#async_event_driven_communication) later in this guide.</span></span>

## <a name="challenge-4-how-to-design-communication-across-microservice-boundaries"></a><span data-ttu-id="a80cd-177">Défi \#4 : comment concevoir la communication au-delà des limites de microservice</span><span class="sxs-lookup"><span data-stu-id="a80cd-177">Challenge \#4: How to design communication across microservice boundaries</span></span>

<span data-ttu-id="a80cd-178">La communication entre microservice limites est un véritable défi.</span><span class="sxs-lookup"><span data-stu-id="a80cd-178">Communicating across microservice boundaries is a real challenge.</span></span> <span data-ttu-id="a80cd-179">Dans ce contexte, communication ne référence pas le protocole que vous devez utiliser (HTTP et REST, AMQP, messagerie, etc.).</span><span class="sxs-lookup"><span data-stu-id="a80cd-179">In this context, communication does not refer to what protocol you should use (HTTP and REST, AMQP, messaging, and so on).</span></span> <span data-ttu-id="a80cd-180">Au lieu de cela, il adresse le style de communication que vous devez utiliser, et en particulier comment couplée votre microservices doit être.</span><span class="sxs-lookup"><span data-stu-id="a80cd-180">Instead, it addresses what communication style you should use, and especially how coupled your microservices should be.</span></span> <span data-ttu-id="a80cd-181">Selon le niveau de couplage, en cas d’échec, l’impact de cette défaillance sur votre système varie considérablement.</span><span class="sxs-lookup"><span data-stu-id="a80cd-181">Depending on the level of coupling, when failure occurs, the impact of that failure on your system will vary significantly.</span></span>

<span data-ttu-id="a80cd-182">Dans un système distribué comme une application basée sur des microservices, des artefacts autant de déplacement et avec des services distribués sur plusieurs serveurs ou ordinateurs hôtes, composants risque d’échouer.</span><span class="sxs-lookup"><span data-stu-id="a80cd-182">In a distributed system like a microservices-based application, with so many artifacts moving around and with distributed services across many servers or hosts, components will eventually fail.</span></span> <span data-ttu-id="a80cd-183">Échec partiel et interruptions supérieures seront produit, vous devez concevoir votre microservices et la communication entre eux en prenant en compte les risques courants dans ce type de système distribué.</span><span class="sxs-lookup"><span data-stu-id="a80cd-183">Partial failure and even larger outages will occur, so you need to design your microservices and the communication across them taking into account the risks common in this type of distributed system.</span></span>

<span data-ttu-id="a80cd-184">Une approche courante consiste à implémenter HTTP (REST)-en fonction de microservices, en raison de leur simplicité.</span><span class="sxs-lookup"><span data-stu-id="a80cd-184">A popular approach is to implement HTTP (REST)- based microservices, due to their simplicity.</span></span> <span data-ttu-id="a80cd-185">Une approche basée sur HTTP est parfaitement acceptable ; le problème ici est lié à l’utilisation.</span><span class="sxs-lookup"><span data-stu-id="a80cd-185">An HTTP-based approach is perfectly acceptable; the issue here is related to how you use it.</span></span> <span data-ttu-id="a80cd-186">Si vous utilisez des requêtes et réponses HTTP simplement pour interagir avec votre microservices à partir d’applications clientes ou à partir des passerelles d’API, qui convient.</span><span class="sxs-lookup"><span data-stu-id="a80cd-186">If you use HTTP requests and responses just to interact with your microservices from client applications or from API Gateways, that is fine.</span></span> <span data-ttu-id="a80cd-187">Mais si vous créez des longues chaînes d’appels HTTP synchrones entre microservices, la communication entre leurs limites comme si les microservices des objets dans une application monolithique, votre application sera finalement rencontrent des problèmes.</span><span class="sxs-lookup"><span data-stu-id="a80cd-187">But if you create long chains of synchronous HTTP calls across microservices, communicating across their boundaries as if the microservices were objects in a monolithic application, your application will eventually run into problems.</span></span>

<span data-ttu-id="a80cd-188">Par exemple, supposons que votre application cliente effectue un appel de API HTTP pour un microservice individuelles telles que le classement de microservice.</span><span class="sxs-lookup"><span data-stu-id="a80cd-188">For instance, imagine that your client application makes an HTTP API call to an individual microservice like the Ordering microservice.</span></span> <span data-ttu-id="a80cd-189">Si le classement microservice appelle à son tour supplémentaire à l’aide de HTTP au sein de la même demande/réponse de microservices cycle, vous créez une chaîne d’appels HTTP.</span><span class="sxs-lookup"><span data-stu-id="a80cd-189">If the Ordering microservice in turn calls additional microservices using HTTP within the same request/response cycle, you are creating a chain of HTTP calls.</span></span> <span data-ttu-id="a80cd-190">Il peut sembler raisonnable initialement.</span><span class="sxs-lookup"><span data-stu-id="a80cd-190">It might sound reasonable initially.</span></span> <span data-ttu-id="a80cd-191">Toutefois, il existe des points importants à prendre en compte lorsque vous passez ce chemin d’accès vers le bas :</span><span class="sxs-lookup"><span data-stu-id="a80cd-191">However, there are important points to consider when going down this path:</span></span>

-   <span data-ttu-id="a80cd-192">Performances de blocage et faible.</span><span class="sxs-lookup"><span data-stu-id="a80cd-192">Blocking and low performance.</span></span> <span data-ttu-id="a80cd-193">En raison de la nature synchrone de HTTP, la demande d’origine ne sera pas obtenir une réponse jusqu'à ce que tous les appels HTTP internes.</span><span class="sxs-lookup"><span data-stu-id="a80cd-193">Due to the synchronous nature of HTTP, the original request will not get a response until all the internal HTTP calls are finished.</span></span> <span data-ttu-id="a80cd-194">Imaginez que si le nombre de ces appels augmente considérablement et en même temps qu’un des intermédiaire HTTP appelle à un microservice est bloqué.</span><span class="sxs-lookup"><span data-stu-id="a80cd-194">Imagine if the number of these calls increases significantly and at the same time one of the intermediate HTTP calls to a microservice is blocked.</span></span> <span data-ttu-id="a80cd-195">Le résultat est que les performances sont affectées et l’évolutivité globale concernée exponentielle en tant qu’augmentation de demandes HTTP supplémentaire.</span><span class="sxs-lookup"><span data-stu-id="a80cd-195">The result is that performance is impacted, and the overall scalability will be exponentially affected as additional HTTP requests increase.</span></span>

-   <span data-ttu-id="a80cd-196">COUPLAGE microservices avec HTTP.</span><span class="sxs-lookup"><span data-stu-id="a80cd-196">Coupling microservices with HTTP.</span></span> <span data-ttu-id="a80cd-197">Entreprise microservices ne doivent pas être associés avec les autres microservices d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="a80cd-197">Business microservices should not be coupled with other business microservices.</span></span> <span data-ttu-id="a80cd-198">Dans l’idéal, ils ne doivent pas » « connaît l’existence d’autres microservices.</span><span class="sxs-lookup"><span data-stu-id="a80cd-198">Ideally, they should not “know” about the existence of other microservices.</span></span> <span data-ttu-id="a80cd-199">Si votre application dépend de couplage microservices comme dans l’exemple, pour parvenir à autonomie par microservice sera pratiquement impossible.</span><span class="sxs-lookup"><span data-stu-id="a80cd-199">If your application relies on coupling microservices as in the example, achieving autonomy per microservice will be almost impossible.</span></span>

-   <span data-ttu-id="a80cd-200">Échec de tout un microservice.</span><span class="sxs-lookup"><span data-stu-id="a80cd-200">Failure in any one microservice.</span></span> <span data-ttu-id="a80cd-201">Si vous avez implémenté une chaîne de microservices liée par les appels HTTP, lorsque de la microservices échoue (et finalement ne pourront pas) la chaîne entière de microservices échoue.</span><span class="sxs-lookup"><span data-stu-id="a80cd-201">If you implemented a chain of microservices linked by HTTP calls, when any of the microservices fails (and eventually they will fail) the whole chain of microservices will fail.</span></span> <span data-ttu-id="a80cd-202">Un système basé sur les microservice doit être conçu pour continuer à utiliser, ainsi que possible lors de défaillances partielles.</span><span class="sxs-lookup"><span data-stu-id="a80cd-202">A microservice-based system should be designed to continue to work as well as possible during partial failures.</span></span> <span data-ttu-id="a80cd-203">Même si vous implémentez la logique du client qui utilise les nouvelles tentatives avec interruption exponentielle ou de mécanismes de disjoncteur, les chaînes d’appel plus complexe HTTP sont, le plus complexe, il est d’implémenter une stratégie de défaillance basée sur HTTP.</span><span class="sxs-lookup"><span data-stu-id="a80cd-203">Even if you implement client logic that uses retries with exponential backoff or circuit breaker mechanisms, the more complex the HTTP call chains are, the more complex it is implement a failure strategy based on HTTP.</span></span>

<span data-ttu-id="a80cd-204">En fait, si votre microservices internes communiquent en créant des chaînes de requêtes HTTP, comme décrit, il peut être avancé que vous disposez d’une application monolithique, mais une basée sur HTTP entre des processus au lieu de mécanismes de communication intraprocess.</span><span class="sxs-lookup"><span data-stu-id="a80cd-204">In fact, if your internal microservices are communicating by creating chains of HTTP requests as described, it could be argued that you have a monolithic application, but one based on HTTP between processes instead of intraprocess communication mechanisms.</span></span>

<span data-ttu-id="a80cd-205">Par conséquent, pour appliquer l’autonomie de microservice et avoir une meilleure résilience, vous devez réduire l’utilisation de chaînes de communication de demande/réponse sur microservices.</span><span class="sxs-lookup"><span data-stu-id="a80cd-205">Therefore, in order to enforce microservice autonomy and have better resiliency, you should minimize the use of chains of request/response communication across microservices.</span></span> <span data-ttu-id="a80cd-206">Il est recommandé d’utiliser interaction asynchrone uniquement pour la communication de microservice entre réseaux virtuels, à l’aide de la communication asynchrone basée sur message et d’événement, ou à l’aide d’interrogation HTTP indépendamment du cycle de demande/réponse HTTP d’origine.</span><span class="sxs-lookup"><span data-stu-id="a80cd-206">It is recommended that you use only asynchronous interaction for inter-microservice communication, either by using asynchronous message- and event-based communication, or by using HTTP polling independently of the original HTTP request/response cycle.</span></span>

<span data-ttu-id="a80cd-207">L’utilisation de la communication asynchrone est expliquée avec des détails supplémentaires plus loin dans ce guide dans les sections [microservice asynchrone applique l’autonomie de microservice](#asynchronous-microservice-integration-enforce-microservices-autonomy) et [asynchrone communication basée sur le message](#asynchronous-message-based-communication).</span><span class="sxs-lookup"><span data-stu-id="a80cd-207">The use of asynchronous communication is explained with additional details later in this guide in the sections [Asynchronous microservice integration enforces microservice’s autonomy](#asynchronous-microservice-integration-enforce-microservices-autonomy) and [Asynchronous message-based communication](#asynchronous-message-based-communication).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="a80cd-208">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="a80cd-208">Additional resources</span></span>

-   <span data-ttu-id="a80cd-209">**Théorème de CAP**
    [*https://en.wikipedia.org/wiki/CAP\_théorème*](https://en.wikipedia.org/wiki/CAP_theorem)</span><span class="sxs-lookup"><span data-stu-id="a80cd-209">**CAP theorem**
[*https://en.wikipedia.org/wiki/CAP\_theorem*](https://en.wikipedia.org/wiki/CAP_theorem)</span></span>

-   <span data-ttu-id="a80cd-210">**Cohérence éventuelle**
    [*https://en.wikipedia.org/wiki/Eventual\_la cohérence*](https://en.wikipedia.org/wiki/Eventual_consistency)</span><span class="sxs-lookup"><span data-stu-id="a80cd-210">**Eventual consistency**
[*https://en.wikipedia.org/wiki/Eventual\_consistency*](https://en.wikipedia.org/wiki/Eventual_consistency)</span></span>

-   <span data-ttu-id="a80cd-211">**Manuel de la cohérence des données**
    [*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx)</span><span class="sxs-lookup"><span data-stu-id="a80cd-211">**Data Consistency Primer**
[*https://msdn.microsoft.com/library/dn589800.aspx*](https://msdn.microsoft.com/library/dn589800.aspx)</span></span>

-   <span data-ttu-id="a80cd-212">**Martin Fowler. CQRS (commande et répartition de responsabilité de requête)**
    [*http://martinfowler.com/bliki/CQRS.html*](http://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="a80cd-212">**Martin Fowler. CQRS (Command and Query Responsibility Segregation)**
[*http://martinfowler.com/bliki/CQRS.html*](http://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="a80cd-213">**Vue matérialisée**
    [*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span><span class="sxs-lookup"><span data-stu-id="a80cd-213">**Materialized View**
[*https://docs.microsoft.com/azure/architecture/patterns/materialized-view*](https://docs.microsoft.com/azure/architecture/patterns/materialized-view)</span></span>

-   <span data-ttu-id="a80cd-214">**Ligne de Charles. Vs ACID. De BASE : Le DEPHASAGE pH de traitement des transactions de base de données**
    [*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/)</span><span class="sxs-lookup"><span data-stu-id="a80cd-214">**Charles Row. ACID vs. BASE: The Shifting pH of Database Transaction Processing**
[*http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/*](http://www.dataversity.net/acid-vs-base-the-shifting-ph-of-database-transaction-processing/)</span></span>

-   <span data-ttu-id="a80cd-215">**Transactions de compensation**
    [*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span><span class="sxs-lookup"><span data-stu-id="a80cd-215">**Compensating Transaction**
[*https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction*](https://docs.microsoft.com/azure/architecture/patterns/compensating-transaction)</span></span>

-   <span data-ttu-id="a80cd-216">**UDI Dahan. Composition d’orientée**
    [*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span><span class="sxs-lookup"><span data-stu-id="a80cd-216">**Udi Dahan. Service Oriented Composition**
[*http://udidahan.com/2014/07/30/service-oriented-composition-with-video/*](http://udidahan.com/2014/07/30/service-oriented-composition-with-video/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="a80cd-217">[Précédente] (logique-et-physique-architecture.md) [suivant] (identifier-microservice-domaine-modèle-boundaries.md)</span><span class="sxs-lookup"><span data-stu-id="a80cd-217">[Previous] (logical-versus-physical-architecture.md) [Next] (identify-microservice-domain-model-boundaries.md)</span></span>
