---
title: "Souveraineté de données par microservice"
description: "Architecture de Microservices .NET pour les Applications .NET en conteneur | Souveraineté de données par microservice"
keywords: Docker, microservices, ASP.NET, conteneur
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: c51daae04215cfa6f5b5b8d2158a8ed1a8949652
ms.sourcegitcommit: c2e216692ef7576a213ae16af2377cd98d1a67fa
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/22/2017
---
# <a name="data-sovereignty-per-microservice"></a><span data-ttu-id="805c9-104">Souveraineté de données par microservice</span><span class="sxs-lookup"><span data-stu-id="805c9-104">Data sovereignty per microservice</span></span>

<span data-ttu-id="805c9-105">Une règle importante pour l’architecture de microservices est que chaque microservice doit posséder ses données de domaine et de la logique.</span><span class="sxs-lookup"><span data-stu-id="805c9-105">An important rule for microservices architecture is that each microservice must own its domain data and logic.</span></span> <span data-ttu-id="805c9-106">Tout comme une application complète possède sa logique et les données, par conséquent, doit chaque microservice posséder sa logique et les données sous un cycle de vie autonome, avec un déploiement indépendant par microservice.</span><span class="sxs-lookup"><span data-stu-id="805c9-106">Just as a full application owns its logic and data, so must each microservice own its logic and data under an autonomous lifecycle, with independent deployment per microservice.</span></span>

<span data-ttu-id="805c9-107">Cela signifie que le modèle conceptuel du domaine varient entre les sous-systèmes ou microservices.</span><span class="sxs-lookup"><span data-stu-id="805c9-107">This means that the conceptual model of the domain will differ between subsystems or microservices.</span></span> <span data-ttu-id="805c9-108">Envisagez d’applications d’entreprise, où la relation (CRM) de gestion des applications client transactionnelles acheter sous-systèmes et client prise en charge de chaque appel sur les attributs d’entité client unique et des données et chacune utilise un autre Limite de contexte (BC).</span><span class="sxs-lookup"><span data-stu-id="805c9-108">Consider enterprise applications, where customer relationship management (CRM) applications, transactional purchase subsystems, and customer support subsystems each call on unique customer entity attributes and data, and where each employs a different Bounded Context (BC).</span></span>

<span data-ttu-id="805c9-109">Ce principe est similaire dans [conception domaine (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), où chaque [limitées de contexte](https://martinfowler.com/bliki/BoundedContext.html) ou sous-système autonome ou un service doit être propriétaire de son modèle de domaine (données plus logique et le comportement).</span><span class="sxs-lookup"><span data-stu-id="805c9-109">This principle is similar in [Domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design), where each [Bounded Context](https://martinfowler.com/bliki/BoundedContext.html) or autonomous subsystem or service must own its domain model (data plus logic and behavior).</span></span> <span data-ttu-id="805c9-110">Chaque contexte de délimitée DDD correspond à une entreprise microservice (un ou plusieurs services).</span><span class="sxs-lookup"><span data-stu-id="805c9-110">Each DDD Bounded Context correlates to one business microservice (one or several services).</span></span> <span data-ttu-id="805c9-111">(Nous développer sur ce point sur le modèle limitées de contexte dans la section suivante).</span><span class="sxs-lookup"><span data-stu-id="805c9-111">(We expand on this point about the Bounded Context pattern in the next section.)</span></span>

<span data-ttu-id="805c9-112">En revanche, l’approche traditionnelle (données monolithique) utilisé dans de nombreuses applications est ayant quelques bases de données ou d’une base de données centralisée.</span><span class="sxs-lookup"><span data-stu-id="805c9-112">On the other hand, the traditional (monolithic data) approach used in many applications is to have a single centralized database or just a few databases.</span></span> <span data-ttu-id="805c9-113">Il s’agit souvent une base de données SQL normalisée qui est utilisé pour l’ensemble de l’application et de ses sous-systèmes internes, comme indiqué dans la Figure 4-7.</span><span class="sxs-lookup"><span data-stu-id="805c9-113">This is often a normalized SQL database that is used for the whole application and all its internal subsystems, as shown in Figure 4-7.</span></span>

![](./media/image7.png)

<span data-ttu-id="805c9-114">**Figure 4-7**.</span><span class="sxs-lookup"><span data-stu-id="805c9-114">**Figure 4-7**.</span></span> <span data-ttu-id="805c9-115">Comparaison de données souveraineté : base de données monolithique pour microservices</span><span class="sxs-lookup"><span data-stu-id="805c9-115">Data sovereignty comparison: monolithic database versus microservices</span></span>

<span data-ttu-id="805c9-116">Initialement, l’approche de la base de données centralisée semble plus simple et semble pour permettre la réutilisation des entités dans les différents sous-systèmes pour rendre tous les éléments cohérent.</span><span class="sxs-lookup"><span data-stu-id="805c9-116">The centralized database approach initially looks simpler and seems to enable reuse of entities in different subsystems to make everything consistent.</span></span> <span data-ttu-id="805c9-117">Mais la réalité est que vous vous retrouvez avec grandes tables qui font Office de nombreux différents sous-systèmes et qui incluent des attributs et des colonnes qui ne sont pas nécessaires dans la plupart des cas.</span><span class="sxs-lookup"><span data-stu-id="805c9-117">But the reality is you end up with huge tables that serve many different subsystems, and that include attributes and columns that are not needed in most cases.</span></span> <span data-ttu-id="805c9-118">C’est comme une tentative d’utilisation de la même carte physique pour une piste courte de randonnée, en prenant un voyage de voiture de la journée et apprendre geography.</span><span class="sxs-lookup"><span data-stu-id="805c9-118">it is like trying to use the same physical map for hiking a short trail, taking a day-long car trip, and learning geography.</span></span>

<span data-ttu-id="805c9-119">Une application monolithique généralement une base de données relationnelles présente deux avantages essentiels : [les transactions ACID](https://en.wikipedia.org/wiki/ACID) et le langage SQL, les deux travaille avec toutes les tables et les données relatives à votre application.</span><span class="sxs-lookup"><span data-stu-id="805c9-119">A monolithic application with typically a single relational database has two important benefits: [ACID transactions](https://en.wikipedia.org/wiki/ACID) and the SQL language, both working across all the tables and data related to your application.</span></span> <span data-ttu-id="805c9-120">Cette approche vous permet d’écrire facilement une requête qui combine les données provenant de plusieurs tables.</span><span class="sxs-lookup"><span data-stu-id="805c9-120">This approach provides a way to easily write a query that combines data from multiple tables.</span></span>

<span data-ttu-id="805c9-121">Cependant, l’accès aux données devient beaucoup plus complexe lorsque vous déplacez vers une architecture microservices.</span><span class="sxs-lookup"><span data-stu-id="805c9-121">However, data access becomes much more complex when you move to a microservices architecture.</span></span> <span data-ttu-id="805c9-122">Mais même lorsque les transactions ACID peuvent ou doivent être utilisées dans un contexte de limitées ou de microservice, les données appartenant à chaque microservice sont privées pour ce microservice et sont accessibles via son API microservice.</span><span class="sxs-lookup"><span data-stu-id="805c9-122">But even when ACID transactions can or should be used within a microservice or Bounded Context, the data owned by each microservice is private to that microservice and can only be accessed via its microservice API.</span></span> <span data-ttu-id="805c9-123">En encapsulant les données garantit que les microservices sont faiblement couplés et peuvent évoluer indépendamment les unes des autres.</span><span class="sxs-lookup"><span data-stu-id="805c9-123">Encapsulating the data ensures that the microservices are loosely coupled and can evolve independently of one another.</span></span> <span data-ttu-id="805c9-124">Si plusieurs services ont été l’accès aux mêmes données, mises à jour de schéma nécessiterait la coordination des mises à jour à tous les services.</span><span class="sxs-lookup"><span data-stu-id="805c9-124">If multiple services were accessing the same data, schema updates would require coordinated updates to all the services.</span></span> <span data-ttu-id="805c9-125">Cela compromettrait l’autonomie de cycle de vie de microservice.</span><span class="sxs-lookup"><span data-stu-id="805c9-125">This would break the microservice lifecycle autonomy.</span></span> <span data-ttu-id="805c9-126">Mais les structures de données distribuées signifient que vous ne pouvez effectuer une seule transaction ACID sur microservices.</span><span class="sxs-lookup"><span data-stu-id="805c9-126">But distributed data structures mean that you cannot make a single ACID transaction across microservices.</span></span> <span data-ttu-id="805c9-127">À son tour, cela signifie que lorsqu’un processus d’entreprise s’étend sur plusieurs microservices, vous devez utiliser la cohérence éventuelle.</span><span class="sxs-lookup"><span data-stu-id="805c9-127">This in turn means you must use eventual consistency when a business process spans multiple microservices.</span></span> <span data-ttu-id="805c9-128">Cela est beaucoup plus difficile à implémenter que les jointures SQL simples ; de même, de nombreuses autres fonctionnalités de base de données relationnelle ne sont pas disponibles sur plusieurs microservices.</span><span class="sxs-lookup"><span data-stu-id="805c9-128">This is much harder to implement than simple SQL joins; similarly, many other relational database features are not available across multiple microservices.</span></span>

<span data-ttu-id="805c9-129">Même aller microservices différents utilisent souvent différents *types* des bases de données.</span><span class="sxs-lookup"><span data-stu-id="805c9-129">Going even further, different microservices often use different *kinds* of databases.</span></span> <span data-ttu-id="805c9-130">Magasin d’applications modernes et processus différents types de données et une base de données relationnelle n’est pas toujours le meilleur choix.</span><span class="sxs-lookup"><span data-stu-id="805c9-130">Modern applications store and process diverse kinds of data, and a relational database is not always the best choice.</span></span> <span data-ttu-id="805c9-131">Pour certains cas d’usage, d’une base de données NoSQL comme Azure DocumentDB ou MongoDB peut disposer d’un modèle de données plus pratique et offrent de meilleures performances et évolutivité à une base de données SQL telle que SQL Server ou de la base de données SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="805c9-131">For some use cases, a NoSQL database such as Azure DocumentDB or MongoDB might have a more convenient data model and offer better performance and scalability than a SQL database like SQL Server or Azure SQL Database.</span></span> <span data-ttu-id="805c9-132">Dans d’autres cas, une base de données relationnelle est toujours la meilleure approche.</span><span class="sxs-lookup"><span data-stu-id="805c9-132">In other cases, a relational database is still the best approach.</span></span> <span data-ttu-id="805c9-133">Par conséquent, les applications basées sur des microservices utilisent souvent un mélange de bases de données SQL et NoSQL, qui est parfois appelé le [polyglot persistance](http://martinfowler.com/bliki/PolyglotPersistence.html) approche.</span><span class="sxs-lookup"><span data-stu-id="805c9-133">Therefore, microservices-based applications often use a mixture of SQL and NoSQL databases, which is sometimes called the [polyglot persistence](http://martinfowler.com/bliki/PolyglotPersistence.html) approach.</span></span>

<span data-ttu-id="805c9-134">Une architecture partitionnée, polyglot persistant pour le stockage de données présente de nombreux avantages.</span><span class="sxs-lookup"><span data-stu-id="805c9-134">A partitioned, polyglot-persistent architecture for data storage has many benefits.</span></span> <span data-ttu-id="805c9-135">Notamment les services faiblement couplés et de meilleures performances, l’évolutivité, les coûts et facilité de gestion.</span><span class="sxs-lookup"><span data-stu-id="805c9-135">These include loosely coupled services and better performance, scalability, costs, and manageability.</span></span> <span data-ttu-id="805c9-136">Toutefois, il peut introduire des défis de gestion des données distribuées, comme nous allons expliquer dans «[identification des limites de domaine en mode](#identifying-domain-model-boundaries-for-each-microservice)» plus loin dans ce chapitre.</span><span class="sxs-lookup"><span data-stu-id="805c9-136">However, it can introduce some distributed data management challenges, as we will explain in “[Identifying domain-model boundaries](#identifying-domain-model-boundaries-for-each-microservice)” later in this chapter.</span></span>

## <a name="the-relationship-between-microservices-and-the-bounded-context-pattern"></a><span data-ttu-id="805c9-137">La relation entre microservices et le modèle limitées de contexte</span><span class="sxs-lookup"><span data-stu-id="805c9-137">The relationship between microservices and the Bounded Context pattern</span></span>

<span data-ttu-id="805c9-138">Le concept de microservice dérive le [modèle de contexte délimité (BC)](http://martinfowler.com/bliki/BoundedContext.html) dans [conception domaine (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span><span class="sxs-lookup"><span data-stu-id="805c9-138">The concept of microservice derives from the [Bounded Context (BC) pattern](http://martinfowler.com/bliki/BoundedContext.html) in [domain-driven design (DDD)](https://en.wikipedia.org/wiki/Domain-driven_design).</span></span> <span data-ttu-id="805c9-139">DDD porte sur les modèles volumineux en distinguant plusieurs BCs et soient explicites sur leurs limites.</span><span class="sxs-lookup"><span data-stu-id="805c9-139">DDD deals with large models by dividing them into multiple BCs and being explicit about their boundaries.</span></span> <span data-ttu-id="805c9-140">Chaque BC doit avoir son propre modèle et la base de données ; de même, chaque microservice possède ses données associées.</span><span class="sxs-lookup"><span data-stu-id="805c9-140">Each BC must have its own model and database; likewise, each microservice owns its related data.</span></span> <span data-ttu-id="805c9-141">En outre, chaque BC généralement possède son propre [langage omniprésent](http://martinfowler.com/bliki/UbiquitousLanguage.html) permettant la communication entre les développeurs de logiciels et des experts du domaine.</span><span class="sxs-lookup"><span data-stu-id="805c9-141">In addition, each BC usually has its own [ubiquitous language](http://martinfowler.com/bliki/UbiquitousLanguage.html) to help communication between software developers and domain experts.</span></span>

<span data-ttu-id="805c9-142">Ces termes (principalement les entités de domaine) dans le langage omniprésent peuvent avoir différents noms dans différents contextes limitées, même lorsque l’autre domaine entités partagent la même identité (autrement dit, l’ID unique est utilisé pour lire l’entité à partir du stockage).</span><span class="sxs-lookup"><span data-stu-id="805c9-142">Those terms (mainly domain entities) in the ubiquitous language can have different names in different Bounded Contexts, even when different domain entities share the same identity (that is, the unique ID that is used to read the entity from storage).</span></span> <span data-ttu-id="805c9-143">Par exemple, dans un contexte délimité de profil utilisateur, l’entité de domaine d’utilisateur susceptibles de partager identité avec l’entité de domaine de l’acheteur dans le contexte délimité tri.</span><span class="sxs-lookup"><span data-stu-id="805c9-143">For instance, in a user-profile Bounded Context, the User domain entity might share identity with the Buyer domain entity in the ordering Bounded Context.</span></span>

<span data-ttu-id="805c9-144">Un microservice est par conséquent similaire à un contexte délimité, mais il indique également qu’il est un service distribué.</span><span class="sxs-lookup"><span data-stu-id="805c9-144">A microservice is therefore like a Bounded Context, but it also specifies that it is a distributed service.</span></span> <span data-ttu-id="805c9-145">Il est construit comme un processus séparé pour chaque contexte délimité, et il doit utiliser les protocoles distribuées indiquées précédemment, tels que HTTP/HTTPS, WebSockets, ou [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span><span class="sxs-lookup"><span data-stu-id="805c9-145">It is built as a separate process for each Bounded Context, and it must use the distributed protocols noted earlier, like HTTP/HTTPS, WebSockets, or [AMQP](https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol).</span></span> <span data-ttu-id="805c9-146">Le modèle limitées de contexte, toutefois, ne spécifie pas si le contexte délimité est un service distribué ou s’il est simplement une limite logique (par exemple, un sous-système générique) dans une application de déploiement monolithique.</span><span class="sxs-lookup"><span data-stu-id="805c9-146">The Bounded Context pattern, however, does not specify whether the Bounded Context is a distributed service or if it is simply a logical boundary (such as a generic subsystem) within a monolithic-deployment application.</span></span>

<span data-ttu-id="805c9-147">Il est important de souligner que la définition d’un service pour chaque contexte délimité est un bon point de départ.</span><span class="sxs-lookup"><span data-stu-id="805c9-147">It is important to highlight that defining a service for each Bounded Context is a good place to start.</span></span> <span data-ttu-id="805c9-148">Mais il est inutile limiter votre conception à celui-ci.</span><span class="sxs-lookup"><span data-stu-id="805c9-148">But you do not have to constrain your design to it.</span></span> <span data-ttu-id="805c9-149">Parfois, vous devez concevoir un contexte délimité ou business microservice composé de plusieurs services physiques.</span><span class="sxs-lookup"><span data-stu-id="805c9-149">Sometimes you must design a Bounded Context or business microservice composed of several physical services.</span></span> <span data-ttu-id="805c9-150">Mais en fin de compte, les deux modèles : limitées de contexte et microservice — sont étroitement liés.</span><span class="sxs-lookup"><span data-stu-id="805c9-150">But ultimately, both patterns—Bounded Context and microservice—are closely related.</span></span>

<span data-ttu-id="805c9-151">DDD bénéficie des microservices en obtenant les limites réelles sous la forme de microservices distribuée.</span><span class="sxs-lookup"><span data-stu-id="805c9-151">DDD benefits from microservices by getting real boundaries in the form of distributed microservices.</span></span> <span data-ttu-id="805c9-152">Mais les idées à ne pas partager le modèle entre microservices sont ce que vous souhaitez également dans un contexte délimité.</span><span class="sxs-lookup"><span data-stu-id="805c9-152">But ideas like not sharing the model between microservices are what you also want in a Bounded Context.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="805c9-153">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="805c9-153">Additional resources</span></span>

-   <span data-ttu-id="805c9-154">**Chris Richardson. Modèle : La base de données par le service**
    [*http://microservices.io/patterns/data/database-per-service.html*](http://microservices.io/patterns/data/database-per-service.html)</span><span class="sxs-lookup"><span data-stu-id="805c9-154">**Chris Richardson. Pattern: Database per service**
[*http://microservices.io/patterns/data/database-per-service.html*](http://microservices.io/patterns/data/database-per-service.html)</span></span>

-   <span data-ttu-id="805c9-155">**Martin Fowler. BoundedContext**
    [*http://martinfowler.com/bliki/BoundedContext.html*](http://martinfowler.com/bliki/BoundedContext.html)</span><span class="sxs-lookup"><span data-stu-id="805c9-155">**Martin Fowler. BoundedContext**
[*http://martinfowler.com/bliki/BoundedContext.html*](http://martinfowler.com/bliki/BoundedContext.html)</span></span>

-   <span data-ttu-id="805c9-156">**Martin Fowler. PolyglotPersistence**
    [*http://martinfowler.com/bliki/PolyglotPersistence.html*](http://martinfowler.com/bliki/PolyglotPersistence.html)</span><span class="sxs-lookup"><span data-stu-id="805c9-156">**Martin Fowler. PolyglotPersistence**
[*http://martinfowler.com/bliki/PolyglotPersistence.html*](http://martinfowler.com/bliki/PolyglotPersistence.html)</span></span>

-   <span data-ttu-id="805c9-157">**Blog d’Alberto Brandolini. Stratégique Domain Driven Design avec le mappage de contexte**
    [*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span><span class="sxs-lookup"><span data-stu-id="805c9-157">**Alberto Brandolini. Strategic Domain Driven Design with Context Mapping**
[*https://www.infoq.com/articles/ddd-contextmapping*](https://www.infoq.com/articles/ddd-contextmapping)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="805c9-158">[Précédente] (microservices-architecture.md) [suivant] (logique-et-physique-architecture.md)</span><span class="sxs-lookup"><span data-stu-id="805c9-158">[Previous] (microservices-architecture.md) [Next] (logical-versus-physical-architecture.md)</span></span>
