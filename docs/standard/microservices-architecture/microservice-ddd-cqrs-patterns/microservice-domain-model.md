---
title: "Vous concevez un modèle de domaine microservice"
description: "Architecture de Microservices .NET pour les Applications .NET en conteneur | Vous concevez un modèle de domaine microservice"
keywords: Docker, microservices, ASP.NET, conteneur
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.openlocfilehash: 455a2c5a39fb9b765b557610ab108f8c75882dbd
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/18/2017
---
# <a name="designing-a-microservice-domain-model"></a><span data-ttu-id="33e71-104">Vous concevez un modèle de domaine microservice</span><span class="sxs-lookup"><span data-stu-id="33e71-104">Designing a microservice domain model</span></span>

<span data-ttu-id="33e71-105">*Définir un modèle de domaine complet pour chaque entreprise microservice ou d’un contexte de limitées*</span><span class="sxs-lookup"><span data-stu-id="33e71-105">*Define one rich domain model for each business microservice or Bounded Context*</span></span>

<span data-ttu-id="33e71-106">Votre objectif est de créer un modèle de domaine cohésif unique pour chaque entreprise microservice ou un contexte délimité (BC).</span><span class="sxs-lookup"><span data-stu-id="33e71-106">Your goal is to create a single cohesive domain model for each business microservice or Bounded Context (BC).</span></span> <span data-ttu-id="33e71-107">Sachez, toutefois, qu’un BC ou business microservice peut parfois être composé de plusieurs services physiques qui partagent un modèle de domaine unique.</span><span class="sxs-lookup"><span data-stu-id="33e71-107">Keep in mind, however, that a BC or business microservice could sometimes be composed of several physical services that share a single domain model.</span></span> <span data-ttu-id="33e71-108">Le modèle de domaine doit capturer les règles, le comportement, langage de l’entreprise et contraintes du seul contexte délimité ou microservice entreprise qu’elle représente.</span><span class="sxs-lookup"><span data-stu-id="33e71-108">The domain model must capture the rules, behavior, business language, and constraints of the single Bounded Context or business microservice that it represents.</span></span>

## <a name="the-domain-entity-pattern"></a><span data-ttu-id="33e71-109">Le modèle d’entité de domaine</span><span class="sxs-lookup"><span data-stu-id="33e71-109">The Domain Entity pattern</span></span>

<span data-ttu-id="33e71-110">Les entités représentent des objets de domaine et sont principalement définies par leur identité, la continuité des activités et la persistance au fil du temps et pas uniquement par les attributs qui les composent.</span><span class="sxs-lookup"><span data-stu-id="33e71-110">Entities represent domain objects and are primarily defined by their identity, continuity, and persistence over time, and not only by the attributes that comprise them.</span></span> <span data-ttu-id="33e71-111">Comme le dit, Eric Evans « objet principalement défini par son identité est appelé une entité ».</span><span class="sxs-lookup"><span data-stu-id="33e71-111">As Eric Evans says, “an object primarily defined by its identity is called an Entity.”</span></span> <span data-ttu-id="33e71-112">Entités sont très importantes dans le modèle de domaine, car elles sont la base d’un modèle.</span><span class="sxs-lookup"><span data-stu-id="33e71-112">Entities are very important in the domain model, since they are the base for a model.</span></span> <span data-ttu-id="33e71-113">Par conséquent, vous devez identifier et concevoir soigneusement.</span><span class="sxs-lookup"><span data-stu-id="33e71-113">Therefore, you should identify and design them carefully.</span></span>

<span data-ttu-id="33e71-114">*Identité de l’entité peut traverser plusieurs microservices ou limitées de contextes.*</span><span class="sxs-lookup"><span data-stu-id="33e71-114">*An entity’s identity can cross multiple microservices or Bounded Contexts.*</span></span>

<span data-ttu-id="33e71-115">La même identité (mais pas la même entité) peuvent être modélisées dans plusieurs contextes de limitées ou microservices.</span><span class="sxs-lookup"><span data-stu-id="33e71-115">The same identity (though not the same entity) can be modeled across multiple Bounded Contexts or microservices.</span></span> <span data-ttu-id="33e71-116">Toutefois, qui n’implique pas que la même entité, avec les mêmes attributs et logique serait être implémentée dans plusieurs contextes limitées.</span><span class="sxs-lookup"><span data-stu-id="33e71-116">However, that does not imply that the same entity, with the same attributes and logic would be implemented in multiple Bounded Contexts.</span></span> <span data-ttu-id="33e71-117">Au lieu de cela, les entités dans chaque contexte délimité limitent ses attributs et les comportements à ceux requis dans le domaine de ce contexte limitées.</span><span class="sxs-lookup"><span data-stu-id="33e71-117">Instead, entities in each Bounded Context limit their attributes and behaviors to those required in that Bounded Context’s domain.</span></span>

<span data-ttu-id="33e71-118">Par exemple, l’entité de l’acheteur peut-être la plupart des attributs d’une personne qui sont définis dans l’entité d’utilisateur dans le microservice profil ou d’identité, y compris l’identité.</span><span class="sxs-lookup"><span data-stu-id="33e71-118">For instance, the buyer entity might have most of a person’s attributes that are defined in the user entity in the profile or identity microservice, including the identity.</span></span> <span data-ttu-id="33e71-119">Mais l’entité de l’acheteur dans l’ordre de tri microservice peut avoir moins d’attributs, car seules certaines données de l’acheteur sont associées au processus de commande.</span><span class="sxs-lookup"><span data-stu-id="33e71-119">But the buyer entity in the ordering microservice might have fewer attributes, because only certain buyer data is related to the order process.</span></span> <span data-ttu-id="33e71-120">Le contexte de chaque microservice ou limitées affecte son modèle de domaine.</span><span class="sxs-lookup"><span data-stu-id="33e71-120">The context of each microservice or Bounded Context impacts its domain model.</span></span>

<span data-ttu-id="33e71-121">*Entités de domaine doivent implémenter le comportement en plus d’implémenter des attributs de données*</span><span class="sxs-lookup"><span data-stu-id="33e71-121">*Domain entities must implement behavior in addition to implementing data attributes*</span></span>

<span data-ttu-id="33e71-122">Une entité de domaine dans DDD doit implémenter la logique de domaine ou le comportement lié aux données d’entité (l’objet accédé dans la mémoire).</span><span class="sxs-lookup"><span data-stu-id="33e71-122">A domain entity in DDD must implement the domain logic or behavior related to the entity data (the object accessed in memory).</span></span> <span data-ttu-id="33e71-123">Par exemple, dans le cadre d’une classe d’entité order vous devez disposer d’une logique métier et des opérations implémentées en tant que méthodes pour des tâches telles que l’ajout d’un élément de commande, la validation des données et le calcul du total.</span><span class="sxs-lookup"><span data-stu-id="33e71-123">For example, as part of an order entity class you must have business logic and operations implemented as methods for tasks such as adding an order item, data validation, and total calculation.</span></span> <span data-ttu-id="33e71-124">Les méthodes de l’entité, prenez soin des invariants et les règles de l’entité au lieu d’avoir ces règles réparties sur la couche application.</span><span class="sxs-lookup"><span data-stu-id="33e71-124">The entity’s methods take care of the invariants and rules of the entity instead of having those rules spread across the application layer.</span></span>

<span data-ttu-id="33e71-125">Figure 9-8 illustre une entité de domaine qui implémente non seulement des attributs de données, mais des opérations ou des méthodes avec une logique de domaine connexes.</span><span class="sxs-lookup"><span data-stu-id="33e71-125">Figure 9-8 shows a domain entity that implements not only data attributes but operations or methods with related domain logic.</span></span>

![](./media/image9.png)

<span data-ttu-id="33e71-126">**Figure 9-8**.</span><span class="sxs-lookup"><span data-stu-id="33e71-126">**Figure 9-8**.</span></span> <span data-ttu-id="33e71-127">Exemple d’une entité de domaine concevoir l’implémentation de données plus de comportement</span><span class="sxs-lookup"><span data-stu-id="33e71-127">Example of a domain entity design implementing data plus behavior</span></span>

<span data-ttu-id="33e71-128">Bien entendu, vous pouvez parfois avoir les entités qui n’implémentent pas une logique dans le cadre de la classe d’entité.</span><span class="sxs-lookup"><span data-stu-id="33e71-128">Of course, sometimes you can have entities that do not implement any logic as part of the entity class.</span></span> <span data-ttu-id="33e71-129">Cela peut se produire dans les entités enfants au sein d’un agrégat si l’entité enfant n’a pas une logique spéciale, car la plupart de la logique est défini à la racine d’agrégation.</span><span class="sxs-lookup"><span data-stu-id="33e71-129">This can happen in child entities within an aggregate if the child entity does not have any special logic because most of the logic is defined in the aggregate root.</span></span> <span data-ttu-id="33e71-130">Si vous avez un microservice complexe qui contient beaucoup de logique implémentée dans les classes de service au lieu de dans les entités de domaine, vous pourriez tomber dans le modèle de domaine anemic, expliqué dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="33e71-130">If you have a complex microservice that has a lot of logic implemented in the service classes instead of in the domain entities, you could be falling into the anemic domain model, explained in the following section.</span></span>

### <a name="rich-domain-model-versus-anemic-domain-model"></a><span data-ttu-id="33e71-131">Modèle de domaine riche et le modèle de domaine anemic</span><span class="sxs-lookup"><span data-stu-id="33e71-131">Rich domain model versus anemic domain model</span></span>

<span data-ttu-id="33e71-132">Dans son emploi [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler décrit un modèle de domaine anemic de cette façon :</span><span class="sxs-lookup"><span data-stu-id="33e71-132">In his post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler describes an anemic domain model this way:</span></span>

<span data-ttu-id="33e71-133">Le problème de base d’un modèle de domaine Anemic est qu’à première vue il ressemble à la réalité.</span><span class="sxs-lookup"><span data-stu-id="33e71-133">The basic symptom of an Anemic Domain Model is that at first blush it looks like the real thing.</span></span> <span data-ttu-id="33e71-134">Il existe des objets, nombreux nommée d’après les noms dans l’espace de noms et ces objets sont connectés avec les relations riches et de la structure qui ont des modèles de domaine true.</span><span class="sxs-lookup"><span data-stu-id="33e71-134">There are objects, many named after the nouns in the domain space, and these objects are connected with the rich relationships and structure that true domain models have.</span></span> <span data-ttu-id="33e71-135">Catch est fourni lorsque vous examinez le comportement, et vous Sachez qu’il y a aucun comportement de ces objets, ce qui les rend peu plus de sacs d’accesseurs Get et Set.</span><span class="sxs-lookup"><span data-stu-id="33e71-135">The catch comes when you look at the behavior, and you realize that there is hardly any behavior on these objects, making them little more than bags of getters and setters.</span></span>

<span data-ttu-id="33e71-136">Bien entendu, lorsque vous utilisez un modèle de domaine anemic, ces modèles de données utilisées à partir d’un ensemble d’objets de service (généralement nommé le *couche métier*) qui capture toute la logique de domaine ou d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="33e71-136">Of course, when you use an anemic domain model, those data models will be used from a set of service objects (traditionally named the *business layer*) which capture all the domain or business logic.</span></span> <span data-ttu-id="33e71-137">La couche métier reposant sur le modèle de données et utilise le modèle de données comme données.</span><span class="sxs-lookup"><span data-stu-id="33e71-137">The business layer sits on top of the data model and uses the data model just as data.</span></span>

<span data-ttu-id="33e71-138">Le modèle de domaine anemic est simplement une conception de style procédurale.</span><span class="sxs-lookup"><span data-stu-id="33e71-138">The anemic domain model is just a procedural style design.</span></span> <span data-ttu-id="33e71-139">Objets d’entité anemic ne sont pas des objets réels, car ils ne disposent pas de comportement (méthodes).</span><span class="sxs-lookup"><span data-stu-id="33e71-139">Anemic entity objects are not real objects because they lack behavior (methods).</span></span> <span data-ttu-id="33e71-140">Elles contiennent uniquement des propriétés de données et il est donc pas conception orientée objet.</span><span class="sxs-lookup"><span data-stu-id="33e71-140">They only hold data properties and thus it is not object-oriented design.</span></span> <span data-ttu-id="33e71-141">En plaçant le comportement de tous les charge dans des objets de service (la couche métier) vous essentiellement au final [code spaghetti](https://en.wikipedia.org/wiki/Spaghetti_code) ou [des scripts de transaction](https://martinfowler.com/eaaCatalog/transactionScript.html), et par conséquent, vous perdez les avantages un modèle de domaine fournit.</span><span class="sxs-lookup"><span data-stu-id="33e71-141">By putting all the behavior out into service objects (the business layer) you essentially end up with [spaghetti code](https://en.wikipedia.org/wiki/Spaghetti_code) or [transaction scripts](https://martinfowler.com/eaaCatalog/transactionScript.html), and therefore you lose the advantages that a domain model provides.</span></span>

<span data-ttu-id="33e71-142">Peu importe, si votre contexte de limitées ou de microservice est très simple (un service CRUD), le modèle de domaine anemic sous la forme d’objets d’entité avec seulement les propriétés de données peut être suffisante, et il peut être intéressant d’implémenter des modèles DDD plus complexes.</span><span class="sxs-lookup"><span data-stu-id="33e71-142">Regardless, if your microservice or Bounded Context is very simple (a CRUD service), the anemic domain model in the form of entity objects with just data properties might be good enough, and it might not be worth implementing more complex DDD patterns.</span></span> <span data-ttu-id="33e71-143">Dans ce cas, il sera simplement un modèle de persistance, car vous avez intentionnellement créé une entité uniquement les données à des fins CRUD.</span><span class="sxs-lookup"><span data-stu-id="33e71-143">In that case, it will be simply a persistence model, because you have intentionally created an entity with only data for CRUD purposes.</span></span>

<span data-ttu-id="33e71-144">C’est pourquoi les architectures microservices sont parfaites pour une approche architecturale multiples en fonction de chaque contexte délimité.</span><span class="sxs-lookup"><span data-stu-id="33e71-144">That is why microservices architectures are perfect for a multi-architectural approach depending on each Bounded Context.</span></span> <span data-ttu-id="33e71-145">Par exemple, dans eShopOnContainers, le tri microservice implémente les modèles DDD, mais le catalogue microservice, qui est un service CRUD simple, n’est pas.</span><span class="sxs-lookup"><span data-stu-id="33e71-145">For instance, in eShopOnContainers, the ordering microservice implements DDD patterns, but the catalog microservice, which is a simple CRUD service, does not.</span></span>

<span data-ttu-id="33e71-146">Certaines personnes dire que le modèle de domaine anemic est un anti-modèle.</span><span class="sxs-lookup"><span data-stu-id="33e71-146">Some people say that the anemic domain model is an anti-pattern.</span></span> <span data-ttu-id="33e71-147">Il dépend vraiment ce que vous implémentez.</span><span class="sxs-lookup"><span data-stu-id="33e71-147">It really depends on what you are implementing.</span></span> <span data-ttu-id="33e71-148">Si le microservice que vous créez est très simple (par exemple, un service CRUD), suivant le modèle de domaine anemic n’est pas un anti-modèle.</span><span class="sxs-lookup"><span data-stu-id="33e71-148">If the microservice you are creating is simple enough (for example, a CRUD service), following the anemic domain model it is not an anti-pattern.</span></span> <span data-ttu-id="33e71-149">Toutefois, si vous avez besoin attaquer la complexité du domaine d’un microservice qui possède un grand nombre de règles d’entreprise en constante évolution, le modèle de domaine anemic peut être un anti-modèle pour ce microservice ou d’un contexte de limitées.</span><span class="sxs-lookup"><span data-stu-id="33e71-149">However, if you need to tackle the complexity of a microservice’s domain that has a lot of ever-changing business rules, the anemic domain model might be an anti-pattern for that microservice or Bounded Context.</span></span> <span data-ttu-id="33e71-150">Dans ce cas, de la conception en tant qu’une riche modèle avec les entités contenant des données plus comportement ainsi que pour implémenter des modèles DDD supplémentaires (agrégats, les objets de valeur, etc.) peut offrir des avantages significatifs pour le succès à long terme d’une telle microservice.</span><span class="sxs-lookup"><span data-stu-id="33e71-150">In that case, designing it as a rich model with entities containing data plus behavior as well as implementing additional DDD patterns (aggregates, value objects, etc.) might have huge benefits for the long-term success of such a microservice.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="33e71-151">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="33e71-151">Additional resources</span></span>

-   <span data-ttu-id="33e71-152">**DevIQ. Entité de domaine**
    [*http://deviq.com/entity/*](http://deviq.com/entity/)</span><span class="sxs-lookup"><span data-stu-id="33e71-152">**DevIQ. Domain Entity**
[*http://deviq.com/entity/*](http://deviq.com/entity/)</span></span>

-   <span data-ttu-id="33e71-153">**Martin Fowler. Le modèle de domaine**
    [*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span><span class="sxs-lookup"><span data-stu-id="33e71-153">**Martin Fowler. The Domain Model**
[*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span></span>

-   <span data-ttu-id="33e71-154">**Martin Fowler. Le modèle de domaine Anemic**</span><span class="sxs-lookup"><span data-stu-id="33e71-154">**Martin Fowler. The Anemic Domain Model**</span></span>

    <span data-ttu-id="33e71-155"><https://martinfowler.com/bliki/AnemicDomainModel.HTML></span><span class="sxs-lookup"><span data-stu-id="33e71-155"><https://martinfowler.com/bliki/AnemicDomainModel.html></span></span>

### <a name="the-value-object-pattern"></a><span data-ttu-id="33e71-156">Le modèle d’objet de valeur</span><span class="sxs-lookup"><span data-stu-id="33e71-156">The Value Object pattern</span></span>

<span data-ttu-id="33e71-157">Notée Eric Evans, « nombre d’objets n’aient pas conceptuelle identité.</span><span class="sxs-lookup"><span data-stu-id="33e71-157">As Eric Evans has noted, “Many objects do not have conceptual identity.</span></span> <span data-ttu-id="33e71-158">Ces objets décrivent certaines caractéristiques d’une chose ».</span><span class="sxs-lookup"><span data-stu-id="33e71-158">These objects describe certain characteristics of a thing.”</span></span>

<span data-ttu-id="33e71-159">Une entité requiert une identité, mais il existe de nombreux objets dans un système qui ne le faites pas, comme le modèle d’objet de valeur.</span><span class="sxs-lookup"><span data-stu-id="33e71-159">An entity requires an identity, but there are many objects in a system that do not, like the Value Object pattern.</span></span> <span data-ttu-id="33e71-160">Un objet de valeur est un objet avec aucune identité conceptuel qui décrit un aspect de domaine.</span><span class="sxs-lookup"><span data-stu-id="33e71-160">A value object is an object with no conceptual identity that describes a domain aspect.</span></span> <span data-ttu-id="33e71-161">Ce sont des objets que vous instancier pour représenter des éléments de conception qui seulement vous concernent temporairement.</span><span class="sxs-lookup"><span data-stu-id="33e71-161">These are objects that you instantiate to represent design elements that only concern you temporarily.</span></span> <span data-ttu-id="33e71-162">Vous vous souciez *que* pas qu’ils sont *qui* qu’ils le sont.</span><span class="sxs-lookup"><span data-stu-id="33e71-162">You care about *what* they are, not *who* they are.</span></span> <span data-ttu-id="33e71-163">Exemples incluent des nombres et les chaînes, mais peuvent être également les concepts de niveau supérieur tels que les groupes d’attributs.</span><span class="sxs-lookup"><span data-stu-id="33e71-163">Examples include numbers and strings, but can also be higher-level concepts like groups of attributes.</span></span>

<span data-ttu-id="33e71-164">Un élément qui est une entité dans un microservice peut-être pas une entité dans un autre microservice, étant donné que dans le deuxième cas, le contexte délimité peut avoir une signification différente.</span><span class="sxs-lookup"><span data-stu-id="33e71-164">Something that is an entity in a microservice might not be an entity in another microservice, because in the second case, the Bounded Context might have a different meaning.</span></span> <span data-ttu-id="33e71-165">Par exemple, une adresse dans une application de commerce électronique peut-être pas une identité, car il peut représenter uniquement un groupe d’attributs de profil du client pour une personne ou une entreprise.</span><span class="sxs-lookup"><span data-stu-id="33e71-165">For example, an address in an e-commerce application might not have an identity at all, since it might only represent a group of attributes of the customer’s profile for a person or company.</span></span> <span data-ttu-id="33e71-166">Dans ce cas, l’adresse doit être classé comme un objet de valeur.</span><span class="sxs-lookup"><span data-stu-id="33e71-166">In this case, the address should be classified as a value object.</span></span> <span data-ttu-id="33e71-167">Toutefois, dans une application pour une société d’énergie électrique, l’adresse du client peut être important pour le domaine d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="33e71-167">However, in an application for an electric power utility company, the customer address could be important for the business domain.</span></span> <span data-ttu-id="33e71-168">Par conséquent, l’adresse doit avoir une identité pour le système de facturation peut être lié directement à l’adresse.</span><span class="sxs-lookup"><span data-stu-id="33e71-168">Therefore, the address must have an identity so the billing system can be directly linked to the address.</span></span> <span data-ttu-id="33e71-169">Dans ce cas, une adresse doit être classée comme une entité de domaine.</span><span class="sxs-lookup"><span data-stu-id="33e71-169">In that case, an address should be classified as a domain entity.</span></span>

<span data-ttu-id="33e71-170">Une personne avec un nom et le nom de famille est généralement une entité, car une personne possède une identité, même si le nom et le nom de famille coïncident avec un autre ensemble de valeurs, par exemple si ces noms fait également référence à une autre personne.</span><span class="sxs-lookup"><span data-stu-id="33e71-170">A person with a name and surname is usually an entity because a person has identity, even if the name and surname coincide with another set of values, such as if those names also refers to a different person.</span></span>

<span data-ttu-id="33e71-171">Les objets de valeur sont difficiles à gérer dans les bases de données relationnelles et ORM comme EF, tandis que dans le document orientée services qu’ils sont plus faciles à implémenter et utiliser des bases de données.</span><span class="sxs-lookup"><span data-stu-id="33e71-171">Value objects are hard to manage in relational databases and ORMs like EF, whereas in document oriented databases they are easier to implement and use.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="33e71-172">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="33e71-172">Additional resources</span></span>

-   <span data-ttu-id="33e71-173">**Martin Fowler. Modèle d’objet de valeur**
    [*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span><span class="sxs-lookup"><span data-stu-id="33e71-173">**Martin Fowler. Value Object pattern**
[*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span></span>

-   <span data-ttu-id="33e71-174">**Valeur d’objet**
    [*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span><span class="sxs-lookup"><span data-stu-id="33e71-174">**Value Object**
[*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span></span>

-   <span data-ttu-id="33e71-175">**Valeur des objets dans le développement piloté par tests**
    [*https://leanpub.com/tdd-ebook/read\#objets leanpub-auto-valeur*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span><span class="sxs-lookup"><span data-stu-id="33e71-175">**Value Objects in Test-Driven Development**
[*https://leanpub.com/tdd-ebook/read\#leanpub-auto-value-objects*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span></span>

-   <span data-ttu-id="33e71-176">**Eric Evans. Conception domaine : Tackling Complexity in the Heart of Software.**</span><span class="sxs-lookup"><span data-stu-id="33e71-176">**Eric Evans. Domain-Driven Design: Tackling Complexity in the Heart of Software.**</span></span> <span data-ttu-id="33e71-177">(Livre et en savoir plus sur les objets de valeur) [ *https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span><span class="sxs-lookup"><span data-stu-id="33e71-177">(Book; includes a discussion of value objects) [*https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span></span>

### <a name="the-aggregate-pattern"></a><span data-ttu-id="33e71-178">Le modèle d’agrégation</span><span class="sxs-lookup"><span data-stu-id="33e71-178">The Aggregate pattern</span></span>

<span data-ttu-id="33e71-179">Un modèle de domaine contient des clusters des entités de données différentes et des processus qui peuvent contrôler une zone importante de fonctionnalités, telles que son traitement ou de l’inventaire.</span><span class="sxs-lookup"><span data-stu-id="33e71-179">A domain model contains clusters of different data entities and processes that can control a significant area of functionality, such as order fulfilment or inventory.</span></span> <span data-ttu-id="33e71-180">Une unité DDD plus affinée est l’agrégation, qui décrit un cluster ou un groupe d’entités et les comportements qui peuvent être traitées comme une unité cohésive.</span><span class="sxs-lookup"><span data-stu-id="33e71-180">A more fine-grained DDD unit is the aggregate, which describes a cluster or group of entities and behaviors that can be treated as a cohesive unit.</span></span>

<span data-ttu-id="33e71-181">Vous définissez généralement un agrégat basé sur les transactions dont vous avez besoin.</span><span class="sxs-lookup"><span data-stu-id="33e71-181">You usually define an aggregate based on the transactions that you need.</span></span> <span data-ttu-id="33e71-182">Un exemple classique est une commande qui contient également une liste d’éléments de la commande.</span><span class="sxs-lookup"><span data-stu-id="33e71-182">A classic example is an order that also contains a list of order items.</span></span> <span data-ttu-id="33e71-183">Un élément de commande seront généralement une entité.</span><span class="sxs-lookup"><span data-stu-id="33e71-183">An order item will usually be an entity.</span></span> <span data-ttu-id="33e71-184">Mais il s’agit d’une entité enfant au sein de l’agrégat de commande qui contient également l’entité order comme son entité racine, généralement appelée une racine d’agrégat.</span><span class="sxs-lookup"><span data-stu-id="33e71-184">But it will be a child entity within the order aggregate, which will also contain the order entity as its root entity, typically called an aggregate root.</span></span>

<span data-ttu-id="33e71-185">Identification des agrégats peut être difficile.</span><span class="sxs-lookup"><span data-stu-id="33e71-185">Identifying aggregates can be hard.</span></span> <span data-ttu-id="33e71-186">Un agrégat est un groupe d’objets qui doivent être cohérentes entre eux, mais vous ne peut pas simplement de sélectionner un groupe d’objets et de les étiqueter un agrégat.</span><span class="sxs-lookup"><span data-stu-id="33e71-186">An aggregate is a group of objects that must be consistent together, but you cannot just pick a group of objects and label them an aggregate.</span></span> <span data-ttu-id="33e71-187">Vous devez commencer par un concept de domaine et de réflexion sur les entités qui sont utilisées dans les transactions les plus courantes liées à ce concept.</span><span class="sxs-lookup"><span data-stu-id="33e71-187">You must start with a domain concept and think about the entities that are used in the most common transactions related to that concept.</span></span> <span data-ttu-id="33e71-188">Les entités qui doivent être cohérentes sont ce qui constitue un agrégat.</span><span class="sxs-lookup"><span data-stu-id="33e71-188">Those entities that need to be transactionally consistent are what forms an aggregate.</span></span> <span data-ttu-id="33e71-189">Concernant les opérations de la transaction est probablement la meilleure façon d’identifier des agrégats.</span><span class="sxs-lookup"><span data-stu-id="33e71-189">Thinking about transaction operations is probably the best way to identify aggregates.</span></span>

### <a name="the-aggregate-root-or-root-entity-pattern"></a><span data-ttu-id="33e71-190">Le modèle racine d’agrégation ou d’entité racine</span><span class="sxs-lookup"><span data-stu-id="33e71-190">The Aggregate Root or Root Entity pattern</span></span>

<span data-ttu-id="33e71-191">Un agrégat est composé d’au moins une entité : la racine d’agrégation, également appelée entité racine ou ientity principal.</span><span class="sxs-lookup"><span data-stu-id="33e71-191">An aggregate is composed of at least one entity: the aggregate root, also called root entity or primary ientity.</span></span> <span data-ttu-id="33e71-192">En outre, il peut avoir plusieurs entités enfants et des objets de valeur, avec toutes les entités et les objets fonctionnent conjointement pour implémenter des transactions et le comportement requis.</span><span class="sxs-lookup"><span data-stu-id="33e71-192">Additionally, it can have multiple child entities and value objects, with all entities and objects working together to implement required behavior and transactions.</span></span>

<span data-ttu-id="33e71-193">Une racine d’agrégat vise à garantir la cohérence de l’agrégat ; Il doit être le seul point d’entrée pour les mises à jour de l’agrégat via les méthodes ou les opérations dans l’agrégat des classe racine.</span><span class="sxs-lookup"><span data-stu-id="33e71-193">The purpose of an aggregate root is to ensure the consistency of the aggregate; it should be the only entry point for updates to the aggregate through methods or operations in the aggregate root class.</span></span> <span data-ttu-id="33e71-194">Vous devez apporter des modifications aux entités au sein de l’agrégat uniquement via la racine d’agrégation.</span><span class="sxs-lookup"><span data-stu-id="33e71-194">You should make changes to entities within the aggregate only via the aggregate root.</span></span> <span data-ttu-id="33e71-195">Il est guardian de cohérence de l’agrégat, compte tenu de tous les invariants et vous pouvez avoir besoin pour se conformer à votre regroupement de règles de cohérence.</span><span class="sxs-lookup"><span data-stu-id="33e71-195">It is the aggregate’s consistency guardian, taking into account all the invariants and consistency rules you might need to comply with in your aggregate.</span></span> <span data-ttu-id="33e71-196">Si vous modifiez un objet d’entité ou une valeur enfant indépendamment, la racine d’agrégation ne peut pas garantir que l’agrégat est dans un état valide.</span><span class="sxs-lookup"><span data-stu-id="33e71-196">If you change a child entity or value object independently, the aggregate root cannot ensure that the aggregate is in a valid state.</span></span> <span data-ttu-id="33e71-197">Il serait telles qu’une table avec une section libre.</span><span class="sxs-lookup"><span data-stu-id="33e71-197">It would be like a table with a loose leg.</span></span> <span data-ttu-id="33e71-198">Mise à jour de la cohérence est la principale utilité de la racine d’agrégation.</span><span class="sxs-lookup"><span data-stu-id="33e71-198">Maintaining consistency is the main purpose of the aggregate root.</span></span>

<span data-ttu-id="33e71-199">Dans la Figure 9-9, vous pouvez voir des agrégats d’exemple à l’acheteur d’agrégation, qui contient une seule entité (la racine d’agrégation acheteur).</span><span class="sxs-lookup"><span data-stu-id="33e71-199">In Figure 9-9, you can see sample aggregates like the buyer aggregate, which contains a single entity (the aggregate root Buyer).</span></span> <span data-ttu-id="33e71-200">L’agrégat de commande contient plusieurs entités et un objet de valeur.</span><span class="sxs-lookup"><span data-stu-id="33e71-200">The order aggregate contains multiple entities and a value object.</span></span>

![](./media/image10.png)

<span data-ttu-id="33e71-201">**Figure 9-9**.</span><span class="sxs-lookup"><span data-stu-id="33e71-201">**Figure 9-9**.</span></span> <span data-ttu-id="33e71-202">Exemple d’agrégats avec plusieurs ou unique des entités</span><span class="sxs-lookup"><span data-stu-id="33e71-202">Example of aggregates with multiple or single entities</span></span>

<span data-ttu-id="33e71-203">Notez que l’agrégat de l’acheteur peut avoir des entités enfants supplémentaires, en fonction de votre domaine, comme dans l’ordre de tri microservice dans l’application de référence eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="33e71-203">Note that the Buyer aggregate could have additional child entities, depending on your domain, as it does in the ordering microservice in the eShopOnContainers reference application.</span></span> <span data-ttu-id="33e71-204">Figure 9-9 illustre simplement un cas dans lequel l’acheteur dispose d’une entité unique, par exemple, pour un agrégat qui contient uniquement une racine d’agrégat.</span><span class="sxs-lookup"><span data-stu-id="33e71-204">Figure 9-9 just illustrates a case in which the buyer has a single entity, as an example of an aggregate that contains only an aggregate root.</span></span>

<span data-ttu-id="33e71-205">Afin de maintenir la séparation des agrégats et conserver des limites claires entre eux, il est conseillé dans un modèle de domaine DDD pour interdire la navigation directe entre les agrégats et uniquement avec le champ de clé étrangère (FK), tel qu’implémenté dans le [ Classement du modèle de domaine microservice](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) dans eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="33e71-205">In order to maintain separation of aggregates and keep clear boundaries between them, it is a good practice in a DDD domain model to disallow direct navigation between aggregates and only having the foreign key (FK) field, as implemented in the [Ordering microservice domain model](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) in eShopOnContainers.</span></span> <span data-ttu-id="33e71-206">L’entité Order a uniquement un champ FK pour l’acheteur, mais pas une propriété de navigation EF Core, comme indiqué dans le code suivant :</span><span class="sxs-lookup"><span data-stu-id="33e71-206">The Order entity only has a FK field for the buyer, but not an EF Core navigation property, as shown in the following code:</span></span>

```csharp
public class Order : Entity, IAggregateRoot
{
    private DateTime _orderDate;
    public Address Address { get; private set; }
    private int? _buyerId; //FK pointing to a different aggregate root
    public OrderStatus OrderStatus { get; private set; }
}
```

<span data-ttu-id="33e71-207">Identification et l’utilisation d’agrégats nécessitent la recherche et l’expérience.</span><span class="sxs-lookup"><span data-stu-id="33e71-207">Identifying and working with aggregates requires research and experience.</span></span> <span data-ttu-id="33e71-208">Pour plus d’informations, consultez la liste des ressources supplémentaires suivantes.</span><span class="sxs-lookup"><span data-stu-id="33e71-208">For more information, see the following Additional resources list.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="33e71-209">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="33e71-209">Additional resources</span></span>

-   <span data-ttu-id="33e71-210">**Vaughn Vernon. Conception d’agrégation efficace - partie i : un agrégat unique de modélisation**
    [*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_Communauté\_essai\_ AGRÉGATS\_partie\_pdf de 1.*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span><span class="sxs-lookup"><span data-stu-id="33e71-210">**Vaughn Vernon. Effective Aggregate Design - Part I: Modeling a Single Aggregate**
[*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_COMMUNITY\_ESSAY\_AGGREGATES\_PART\_1.pdf*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span></span>

-   <span data-ttu-id="33e71-211">**Vaughn Vernon. Conception d’agrégation efficace - la partie II : Fabrication agrégats fonctionnent ensemble**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf>*</span><span class="sxs-lookup"><span data-stu-id="33e71-211">**Vaughn Vernon. Effective Aggregate Design - Part II: Making Aggregates Work Together**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf> *</span></span>

-   <span data-ttu-id="33e71-212">**Vaughn Vernon. Conception d’agrégation efficace - partie III : Obtenir des informations via la détection**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf>*</span><span class="sxs-lookup"><span data-stu-id="33e71-212">**Vaughn Vernon. Effective Aggregate Design - Part III: Gaining Insight Through Discovery**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf> *</span></span>

-   <span data-ttu-id="33e71-213">**Sergey Grybniak. Modèles de conception tactiques DDD**
    [*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span><span class="sxs-lookup"><span data-stu-id="33e71-213">**Sergey Grybniak. DDD Tactical Design Patterns**
[*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span></span>

-   <span data-ttu-id="33e71-214">**Chris Richardson. Développement de Microservices transactionnelle à l’aide d’agrégats**
    [*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span><span class="sxs-lookup"><span data-stu-id="33e71-214">**Chris Richardson. Developing Transactional Microservices Using Aggregates**
[*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span></span>

-   <span data-ttu-id="33e71-215">**DevIQ. Le modèle d’agrégation**
    [*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span><span class="sxs-lookup"><span data-stu-id="33e71-215">**DevIQ. The Aggregate pattern**
[*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="33e71-216">[Précédente] (ddd-orientée-microservice.md) [suivant] (net-core-microservice-domaine-model.md)</span><span class="sxs-lookup"><span data-stu-id="33e71-216">[Previous] (ddd-oriented-microservice.md) [Next] (net-core-microservice-domain-model.md)</span></span>
