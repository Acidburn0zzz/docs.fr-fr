---
title: Application des approches CQRS et CQS dans un microservice DDD dans eShopOnContainers
description: Architecture des microservices .NET pour les applications .NET en conteneur | Application des approches CQRS et CQS dans un microservice DDD dans eShopOnContainers
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 05/26/2017
ms.openlocfilehash: 6be8b52f42e3e37ff03e561af45c46f4dd283d9e
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/04/2018
---
# <a name="applying-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="1bef0-103">Application des approches CQRS et CQS dans un microservice DDD dans eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="1bef0-103">Applying CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="1bef0-104">La conception du microservice de commandes au niveau de l’application de référence eShopOnContainers est basée sur les principes CQRS.</span><span class="sxs-lookup"><span data-stu-id="1bef0-104">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="1bef0-105">Toutefois, elle utilise l’approche la plus simple, qui consiste simplement à séparer les requêtes des commandes et à utiliser la même base de données pour les deux actions.</span><span class="sxs-lookup"><span data-stu-id="1bef0-105">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="1bef0-106">Le concept essentiel de ces modèles, et le point important ici, est que les requêtes sont idempotentes : quel que soit le nombre de fois où vous interrogez un système, l’état de ce système ne change pas. Vous pouvez même utiliser un modèle de données « lectures » différent de la logique transactionnelle « écritures », bien que le microservice de commandes utilise la même base de données.</span><span class="sxs-lookup"><span data-stu-id="1bef0-106">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system will not change You could even use a different “reads” data model than the transactional logic “writes” domain model, although the ordering microservices is using the same database.</span></span> <span data-ttu-id="1bef0-107">Par conséquent, il s’agit d’une approche CQRS simplifiée.</span><span class="sxs-lookup"><span data-stu-id="1bef0-107">Hence this is a simplified CQRS approach.</span></span>

<span data-ttu-id="1bef0-108">En revanche, les commandes qui déclenchent des transactions et mises à jour de données changent l’état du système.</span><span class="sxs-lookup"><span data-stu-id="1bef0-108">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="1bef0-109">Avec les commandes, vous devez être prudent quand vous abordez le problème de la complexité et les règles métier en constante évolution.</span><span class="sxs-lookup"><span data-stu-id="1bef0-109">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="1bef0-110">C’est là où vous souhaitez appliquer des techniques DDD pour obtenir un système mieux modélisé.</span><span class="sxs-lookup"><span data-stu-id="1bef0-110">This is the where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="1bef0-111">Les modèles DDD présentés dans ce guide ne doivent pas être appliqués de manière universelle.</span><span class="sxs-lookup"><span data-stu-id="1bef0-111">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="1bef0-112">Ils introduisent des contraintes dans votre conception.</span><span class="sxs-lookup"><span data-stu-id="1bef0-112">They introduce constraints on your design.</span></span> <span data-ttu-id="1bef0-113">Ces contraintes présentent des avantages, notamment une meilleure qualité au fil du temps, en particulier dans les commandes et tout code qui modifie l’état du système.</span><span class="sxs-lookup"><span data-stu-id="1bef0-113">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="1bef0-114">Toutefois, ces contraintes augmentent la complexité avec moins d’avantages pour la lecture et l’interrogation des données.</span><span class="sxs-lookup"><span data-stu-id="1bef0-114">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="1bef0-115">Un modèle de ce type est le modèle Agrégat, que nous examinerons plus en détail dans les sections suivantes.</span><span class="sxs-lookup"><span data-stu-id="1bef0-115">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="1bef0-116">Brièvement, dans le modèle Agrégat, vous traitez un grand nombre d’objets de domaine comme un seul ensemble en raison de leur relation dans le domaine.</span><span class="sxs-lookup"><span data-stu-id="1bef0-116">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="1bef0-117">Il est possible que vous n’obteniez pas toujours des avantages avec ce modèle dans les requêtes, car celui-ci peut augmenter la complexité de la logique de requête.</span><span class="sxs-lookup"><span data-stu-id="1bef0-117">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="1bef0-118">Pour les requêtes en lecture seule, vous n’obtenez pas les avantages de traitement de plusieurs objets comme un seul agrégat,</span><span class="sxs-lookup"><span data-stu-id="1bef0-118">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="1bef0-119">juste la complexité.</span><span class="sxs-lookup"><span data-stu-id="1bef0-119">You only get the complexity.</span></span>

<span data-ttu-id="1bef0-120">Comme indiqué dans la figure 9-2, ce guide propose d’utiliser des modèles DDD uniquement dans la zone transactionnelle/de mises à jour de votre microservice (autrement dit, avec un déclenchement par des commandes).</span><span class="sxs-lookup"><span data-stu-id="1bef0-120">As shown in Figure 9-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="1bef0-121">Les requêtes peuvent suivre une approche plus simple et doivent être séparées des commandes, suite à une approche CQRS.</span><span class="sxs-lookup"><span data-stu-id="1bef0-121">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="1bef0-122">Pour implémenter le « côté requêtes », vous pouvez choisir entre plusieurs méthodes, à partir de votre ORM complet comme EF Core, des projections AutoMapper, des procédures stockées, des vues, des vues matérialisées ou un micro-ORM.</span><span class="sxs-lookup"><span data-stu-id="1bef0-122">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="1bef0-123">Dans ce guide et dans eShopOnContainers (en particulier le microservice de commandes), nous avons choisi d’implémenter des requêtes simples à l’aide d’un micro-ORM comme [Dapper](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="1bef0-123">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="1bef0-124">Cela vous permet d’implémenter toute requête basée sur des instructions SQL pour obtenir des performances optimales, grâce à un framework léger avec très peu de surcharge.</span><span class="sxs-lookup"><span data-stu-id="1bef0-124">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="1bef0-125">Notez que, quand vous utilisez cette approche, toutes les mises à jour apportées à votre modèle qui affectent le mode de persistance des entités dans une base de données SQL nécessitent également des mises à jour distinctes pour les requêtes SQL utilisées par Dapper ou toutes les autres approches (non-EF) distinctes pour l’interrogation.</span><span class="sxs-lookup"><span data-stu-id="1bef0-125">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="1bef0-126">Les modèles CQRS et DDD ne sont pas des architectures de niveau supérieur</span><span class="sxs-lookup"><span data-stu-id="1bef0-126">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="1bef0-127">Il est important de comprendre que CQRS et la plupart des modèles DDD (comme les couches DDD ou un modèle de domaine avec des agrégats) ne sont pas des styles architecturaux, mais uniquement des modèles d’architecture.</span><span class="sxs-lookup"><span data-stu-id="1bef0-127">It important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="1bef0-128">Les microservices, SOA et l’architecture pilotée par événements (EDA) sont des exemples de styles architecturaux.</span><span class="sxs-lookup"><span data-stu-id="1bef0-128">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="1bef0-129">Ils décrivent un système de nombreux composants, tels que de nombreux microservices.</span><span class="sxs-lookup"><span data-stu-id="1bef0-129">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="1bef0-130">Les modèles CQRS et DDD décrivent un élément à l’intérieur d’un système ou composant unique, dans ce cas un élément à l’intérieur d’un microservice.</span><span class="sxs-lookup"><span data-stu-id="1bef0-130">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="1bef0-131">Des contextes délimités différents vont utiliser différents modèles.</span><span class="sxs-lookup"><span data-stu-id="1bef0-131">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="1bef0-132">Ils ont des responsabilités diverses, ce qui aboutit à différentes solutions.</span><span class="sxs-lookup"><span data-stu-id="1bef0-132">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="1bef0-133">Il est important de souligner que le fait d’imposer le même modèle partout entraîne un échec.</span><span class="sxs-lookup"><span data-stu-id="1bef0-133">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="1bef0-134">N’utilisez pas les modèles CQRS et DDD partout.</span><span class="sxs-lookup"><span data-stu-id="1bef0-134">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="1bef0-135">De nombreux sous-systèmes, contextes délimités ou microservices sont plus simples et peuvent être implémentés plus facilement à l’aide de services CRUD de base ou d’une autre approche.</span><span class="sxs-lookup"><span data-stu-id="1bef0-135">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="1bef0-136">Il n’existe qu’une seule architecture des applications : l’architecture de l’application système ou de bout en bout que vous concevez (par exemple, l’architecture de microservices).</span><span class="sxs-lookup"><span data-stu-id="1bef0-136">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="1bef0-137">Toutefois, la conception de chaque contexte délimité ou microservice au sein de cette application reflète ses propres compromis et décisions de conception interne à un niveau de modèles d’architecture.</span><span class="sxs-lookup"><span data-stu-id="1bef0-137">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="1bef0-138">N’essayez pas d’appliquer les mêmes modèles d’architecture CQRS ou DDD partout.</span><span class="sxs-lookup"><span data-stu-id="1bef0-138">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

####  <a name="additional-resources"></a><span data-ttu-id="1bef0-139">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="1bef0-139">Additional resources</span></span>

-   <span data-ttu-id="1bef0-140">**Martin Fowler. CQRS**
    [*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span><span class="sxs-lookup"><span data-stu-id="1bef0-140">**Martin Fowler. CQRS**
[*https://martinfowler.com/bliki/CQRS.html*](https://martinfowler.com/bliki/CQRS.html)</span></span>

-   <span data-ttu-id="1bef0-141">**Greg Young. CQS vs. CQRS**
    [*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span><span class="sxs-lookup"><span data-stu-id="1bef0-141">**Greg Young. CQS vs. CQRS**
[*http://codebetter.com/gregyoung/2009/08/13/command-query-separation/*](http://codebetter.com/gregyoung/2009/08/13/command-query-separation/)</span></span>

-   <span data-ttu-id="1bef0-142">**Greg Young. CQRS Documents**
    [*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span><span class="sxs-lookup"><span data-stu-id="1bef0-142">**Greg Young. CQRS Documents**
[*https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf*](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)</span></span>

-   <span data-ttu-id="1bef0-143">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
    [*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span><span class="sxs-lookup"><span data-stu-id="1bef0-143">**Greg Young. CQRS, Task Based UIs and Event Sourcing**
[*http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/*](http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/)</span></span>

-   <span data-ttu-id="1bef0-144">**Udi Dahan. Clarified CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="1bef0-144">**Udi Dahan. Clarified CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="1bef0-145">**CQRS**
    [*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span><span class="sxs-lookup"><span data-stu-id="1bef0-145">**CQRS**
[*http://udidahan.com/2009/12/09/clarified-cqrs/*](http://udidahan.com/2009/12/09/clarified-cqrs/)</span></span>

-   <span data-ttu-id="1bef0-146">**Event-Sourcing (ES)**
    [*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span><span class="sxs-lookup"><span data-stu-id="1bef0-146">**Event-Sourcing (ES)**
[*http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/*](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="1bef0-147">[Précédent] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Suivant] (cqrs-microservice-reads.md)</span><span class="sxs-lookup"><span data-stu-id="1bef0-147">[Previous] (apply-simplified-microservice-cqrs-ddd-patterns.md) [Next] (cqrs-microservice-reads.md)</span></span>
