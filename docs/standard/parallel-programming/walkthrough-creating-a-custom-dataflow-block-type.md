---
title: "Procédure pas à pas : création d'un type de bloc de flux de données personnalisé"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, creating custom dataflow blocks
- dataflow blocks, creating custom in TPL
ms.assetid: a6147146-0a6a-4d9b-ab0f-237b3c1ac691
caps.latest.revision: "8"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 809b21fa6e1470890011604792d849998dd03ede
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/18/2017
---
# <a name="walkthrough-creating-a-custom-dataflow-block-type"></a><span data-ttu-id="e6fca-102">Procédure pas à pas : création d'un type de bloc de flux de données personnalisé</span><span class="sxs-lookup"><span data-stu-id="e6fca-102">Walkthrough: Creating a Custom Dataflow Block Type</span></span>
<span data-ttu-id="e6fca-103">Bien que la bibliothèque de flux de données TPL fournit plusieurs types de blocs de flux de données qui permettent une gamme de fonctionnalités, vous pouvez également créer des types de blocs personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e6fca-103">Although the TPL Dataflow Library provides several dataflow block types that enable a variety of functionality, you can also create custom block types.</span></span> <span data-ttu-id="e6fca-104">Ce document décrit comment créer un type de bloc de flux de données qui implémente un comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e6fca-104">This document describes how to create a dataflow block type that implements custom behavior.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="e6fca-105">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="e6fca-105">Prerequisites</span></span>  
 <span data-ttu-id="e6fca-106">Lecture [flux de données](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) avant de lire ce document.</span><span class="sxs-lookup"><span data-stu-id="e6fca-106">Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you read this document.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="e6fca-107">La bibliothèque de flux de données TPL (espace de noms <xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType>) n'est pas distribuée avec le [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="e6fca-107">The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span></span> <span data-ttu-id="e6fca-108">Pour installer l'espace de noms <xref:System.Threading.Tasks.Dataflow>, ouvrez votre projet dans [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], dans le menu Projet choisissez **Gérer les packages NuGet**, puis recherchez en ligne le package `Microsoft.Tpl.Dataflow`.</span><span class="sxs-lookup"><span data-stu-id="e6fca-108">To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.</span></span>  
  
## <a name="defining-the-sliding-window-dataflow-block"></a><span data-ttu-id="e6fca-109">Définition du bloc de flux de données de fenêtre glissante</span><span class="sxs-lookup"><span data-stu-id="e6fca-109">Defining the Sliding Window Dataflow Block</span></span>  
 <span data-ttu-id="e6fca-110">Imaginez une application de flux de données qui exige que les valeurs d’entrée est mis en mémoire tampon, puis de sortie d’une manière de fenêtre glissante.</span><span class="sxs-lookup"><span data-stu-id="e6fca-110">Consider a dataflow application that requires that input values be buffered and then output in a sliding window manner.</span></span> <span data-ttu-id="e6fca-111">Par exemple, pour les valeurs d’entrée {0, 1, 2, 3, 4, 5} et une taille de fenêtre de trois, un bloc de flux de données de fenêtre glissante génère les tableaux de sortie {0, 1, 2}, {1, 2, 3}, {2, 3, 4,} et {3, 4, 5}.</span><span class="sxs-lookup"><span data-stu-id="e6fca-111">For example, for the input values {0, 1, 2, 3, 4, 5} and a window size of three, a sliding window dataflow block produces the output arrays {0, 1, 2}, {1, 2, 3}, {2, 3, 4}, and {3, 4, 5}.</span></span> <span data-ttu-id="e6fca-112">Les sections suivantes décrivent deux façons de créer un type de bloc de flux de données qui implémente ce comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e6fca-112">The following sections describe two ways to create a dataflow block type that implements this custom behavior.</span></span> <span data-ttu-id="e6fca-113">La première technique utilise le <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> méthode pour combiner les fonctionnalités d’un <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> objet et un <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> bloc un propagateur objet.</span><span class="sxs-lookup"><span data-stu-id="e6fca-113">The first technique uses the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> method to combine the functionality of an <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601> object and an <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> object into one propagator block.</span></span> <span data-ttu-id="e6fca-114">La seconde technique définit une classe qui dérive de <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> et combine les fonctionnalités existantes pour exécuter le comportement personnalisé.</span><span class="sxs-lookup"><span data-stu-id="e6fca-114">The second technique defines a class that derives from <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> and combines existing functionality to perform custom behavior.</span></span>  
  
## <a name="using-the-encapsulate-method-to-define-the-sliding-window-dataflow-block"></a><span data-ttu-id="e6fca-115">À l’aide de l’encapsuler la méthode pour définir le bloc de flux de fenêtre glissante</span><span class="sxs-lookup"><span data-stu-id="e6fca-115">Using the Encapsulate Method to Define the Sliding Window Dataflow Block</span></span>  
 <span data-ttu-id="e6fca-116">L’exemple suivant utilise la <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> méthode pour créer un bloc propagateur à partir d’une source et une cible.</span><span class="sxs-lookup"><span data-stu-id="e6fca-116">The following example uses the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Encapsulate%2A> method to create a propagator block from a target and a source.</span></span> <span data-ttu-id="e6fca-117">Un bloc propagateur permet à un bloc source et un bloc cible pour agir en tant que destinataire et expéditeur des données.</span><span class="sxs-lookup"><span data-stu-id="e6fca-117">A propagator block enables a source block and a target block to act as a receiver and sender of data.</span></span>  
  
 <span data-ttu-id="e6fca-118">Cette technique est utile lorsque vous avez besoin des fonctionnalités de flux de données personnalisé, mais vous ne nécessitent pas de type qui fournit d’autres méthodes, propriétés ou champs.</span><span class="sxs-lookup"><span data-stu-id="e6fca-118">This technique is useful when you require custom dataflow functionality, but you do not require a type that provides additional methods, properties, or fields.</span></span>  
  
 [!code-csharp[TPLDataflow_SlidingWindowBlock#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_slidingwindowblock/cs/slidingwindowblock.cs#1)]
 [!code-vb[TPLDataflow_SlidingWindowBlock#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_slidingwindowblock/vb/slidingwindowblock.vb#1)]  
  
## <a name="deriving-from-ipropagatorblock-to-define-the-sliding-window-dataflow-block"></a><span data-ttu-id="e6fca-119">Dérivation à partir de IPropagatorBlock pour définir le bloc de flux de données de fenêtre glissante</span><span class="sxs-lookup"><span data-stu-id="e6fca-119">Deriving from IPropagatorBlock to Define the Sliding Window Dataflow Block</span></span>  
 <span data-ttu-id="e6fca-120">L’exemple suivant illustre la `SlidingWindowBlock` classe.</span><span class="sxs-lookup"><span data-stu-id="e6fca-120">The following example shows the `SlidingWindowBlock` class.</span></span> <span data-ttu-id="e6fca-121">Cette classe dérive <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> afin qu’il puisse agir comme une source et une cible de données.</span><span class="sxs-lookup"><span data-stu-id="e6fca-121">This class derives from <xref:System.Threading.Tasks.Dataflow.IPropagatorBlock%602> so that it can act as both a source and a target of data.</span></span> <span data-ttu-id="e6fca-122">Comme dans l’exemple précédent, la `SlidingWindowBlock` classe repose sur les types de blocs de flux de données existants.</span><span class="sxs-lookup"><span data-stu-id="e6fca-122">As in the previous example, the `SlidingWindowBlock` class is built on existing dataflow block types.</span></span> <span data-ttu-id="e6fca-123">Toutefois, le `SlidingWindowBlock` classe implémente également les méthodes qui sont requis par le <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>, et <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> interfaces.</span><span class="sxs-lookup"><span data-stu-id="e6fca-123">However, the `SlidingWindowBlock` class also implements the methods that are required by the <xref:System.Threading.Tasks.Dataflow.ISourceBlock%601>, <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601>, and <xref:System.Threading.Tasks.Dataflow.IDataflowBlock> interfaces.</span></span> <span data-ttu-id="e6fca-124">Tous les transférer ces méthodes fonctionnent pour les membres de type de bloc de flux de données prédéfinis.</span><span class="sxs-lookup"><span data-stu-id="e6fca-124">These methods all forward work to the predefined dataflow block type members.</span></span> <span data-ttu-id="e6fca-125">Par exemple, le `Post` méthode diffère le travail à la `m_target` membre de données, qui est également un <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> objet.</span><span class="sxs-lookup"><span data-stu-id="e6fca-125">For example, the `Post` method defers work to the `m_target` data member, which is also an <xref:System.Threading.Tasks.Dataflow.ITargetBlock%601> object.</span></span>  
  
 <span data-ttu-id="e6fca-126">Cette technique est utile lorsque vous nécessitent les fonctionnalités de flux de données personnalisé et également exiger un type qui fournit d’autres méthodes, propriétés ou champs.</span><span class="sxs-lookup"><span data-stu-id="e6fca-126">This technique is useful when you require custom dataflow functionality, and also require a type that provides additional methods, properties, or fields.</span></span> <span data-ttu-id="e6fca-127">Par exemple, le `SlidingWindowBlock` classe dérive également de <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601> afin qu’il puisse fournir le <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> et <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceiveAll%2A> méthodes.</span><span class="sxs-lookup"><span data-stu-id="e6fca-127">For example, the `SlidingWindowBlock` class also derives from <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601> so that it can provide the <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceive%2A> and <xref:System.Threading.Tasks.Dataflow.IReceivableSourceBlock%601.TryReceiveAll%2A> methods.</span></span> <span data-ttu-id="e6fca-128">Le `SlidingWindowBlock` classe illustre également d’extensibilité en fournissant le `WindowSize` propriété, qui Récupère le nombre d’éléments dans la fenêtre glissante.</span><span class="sxs-lookup"><span data-stu-id="e6fca-128">The `SlidingWindowBlock` class also demonstrates extensibility by providing the `WindowSize` property, which retrieves the number of elements in the sliding window.</span></span>  
  
 [!code-csharp[TPLDataflow_SlidingWindowBlock#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_slidingwindowblock/cs/slidingwindowblock.cs#2)]
 [!code-vb[TPLDataflow_SlidingWindowBlock#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_slidingwindowblock/vb/slidingwindowblock.vb#2)]  
  
## <a name="the-complete-example"></a><span data-ttu-id="e6fca-129">Exemple complet</span><span class="sxs-lookup"><span data-stu-id="e6fca-129">The Complete Example</span></span>  
 <span data-ttu-id="e6fca-130">L'exemple suivant présente le code complet pour cette visite.</span><span class="sxs-lookup"><span data-stu-id="e6fca-130">The following example shows the complete code for this walkthrough.</span></span> <span data-ttu-id="e6fca-131">Il montre également comment utiliser les deux blocs de fenêtre glissante dans une méthode qui écrit dans le bloc, lit à partir de celui-ci et imprime les résultats dans la console.</span><span class="sxs-lookup"><span data-stu-id="e6fca-131">It also demonstrates how to use the both sliding window blocks in a method that writes to the block, reads from it, and prints the results to the console.</span></span>  
  
 [!code-csharp[TPLDataflow_SlidingWindowBlock#100](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_slidingwindowblock/cs/slidingwindowblock.cs#100)]
 [!code-vb[TPLDataflow_SlidingWindowBlock#100](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_slidingwindowblock/vb/slidingwindowblock.vb#100)]  
  
## <a name="compiling-the-code"></a><span data-ttu-id="e6fca-132">Compilation du code</span><span class="sxs-lookup"><span data-stu-id="e6fca-132">Compiling the Code</span></span>  
 <span data-ttu-id="e6fca-133">Copiez l’exemple de code et collez-le dans un projet Visual Studio ou collez-le dans un fichier nommé `SlidingWindowBlock.cs` (`SlidingWindowBlock.vb` pour [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), puis exécutez la commande suivante dans une fenêtre d’invite de commandes Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="e6fca-133">Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `SlidingWindowBlock.cs` (`SlidingWindowBlock.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) and then run the following command in a Visual Studio Command Prompt window.</span></span>  
  
 [!INCLUDE[csprcs](../../../includes/csprcs-md.md)]  
  
 <span data-ttu-id="e6fca-134">**csc.exe /r:System.Threading.Tasks.Dataflow.dll SlidingWindowBlock.cs**</span><span class="sxs-lookup"><span data-stu-id="e6fca-134">**csc.exe /r:System.Threading.Tasks.Dataflow.dll SlidingWindowBlock.cs**</span></span>  
  
 [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]  
  
 <span data-ttu-id="e6fca-135">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll SlidingWindowBlock.vb**</span><span class="sxs-lookup"><span data-stu-id="e6fca-135">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll SlidingWindowBlock.vb**</span></span>  
  
## <a name="next-steps"></a><span data-ttu-id="e6fca-136">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="e6fca-136">Next Steps</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e6fca-137">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="e6fca-137">See Also</span></span>  
 [<span data-ttu-id="e6fca-138">Le flux de données</span><span class="sxs-lookup"><span data-stu-id="e6fca-138">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
