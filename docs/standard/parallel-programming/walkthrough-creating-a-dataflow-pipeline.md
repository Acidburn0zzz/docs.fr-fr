---
title: "Procédure pas à pas : création d'un pipeline de flux de données"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-standard
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- dataflow pipelines, creating with TPL
- Task Parallel Library, dataflows
- TPL dataflow library, creating dataflow pipeline
ms.assetid: 69308f82-aa22-4ac5-833d-e748533b58e8
caps.latest.revision: "11"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: d63fb872382bfc0a3ba3b8637c7357ab65c58fbf
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/18/2017
---
# <a name="walkthrough-creating-a-dataflow-pipeline"></a><span data-ttu-id="f19d7-102">Procédure pas à pas : création d'un pipeline de flux de données</span><span class="sxs-lookup"><span data-stu-id="f19d7-102">Walkthrough: Creating a Dataflow Pipeline</span></span>
<span data-ttu-id="f19d7-103">Bien que vous puissiez utiliser le <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A?displayProperty=nameWithType>, et <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A?displayProperty=nameWithType> méthodes de recevoir des messages des blocs sources, vous pouvez également connecter des blocs de messages pour former un *pipeline de flux de données*.</span><span class="sxs-lookup"><span data-stu-id="f19d7-103">Although you can use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Receive%2A?displayProperty=nameWithType>, <xref:System.Threading.Tasks.Dataflow.DataflowBlock.ReceiveAsync%2A?displayProperty=nameWithType>, and <xref:System.Threading.Tasks.Dataflow.DataflowBlock.TryReceive%2A?displayProperty=nameWithType> methods to receive messages from source blocks, you can also connect message blocks to form a *dataflow pipeline*.</span></span> <span data-ttu-id="f19d7-104">Un pipeline de flux de données est une série de composants, ou *les blocs de flux de données*, qui effectuent chacun une tâche spécifique qui contribue à un plus grand objectif.</span><span class="sxs-lookup"><span data-stu-id="f19d7-104">A dataflow pipeline is a series of components, or *dataflow blocks*, each of which performs a specific task that contributes to a larger goal.</span></span> <span data-ttu-id="f19d7-105">Chaque bloc de flux de données d'un pipeline de flux de données effectue un travail lorsqu'il reçoit un message d'un autre bloc de flux de données.</span><span class="sxs-lookup"><span data-stu-id="f19d7-105">Every dataflow block in a dataflow pipeline performs work when it receives a message from another dataflow block.</span></span> <span data-ttu-id="f19d7-106">Ce processus s'apparente à une chaîne de montage en construction automobile.</span><span class="sxs-lookup"><span data-stu-id="f19d7-106">An analogy to this is an assembly line for automobile manufacturing.</span></span> <span data-ttu-id="f19d7-107">Comme chaque véhicule passe via la ligne de montage, un poste assemble le châssis, le suivant installe le moteur, et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="f19d7-107">As each vehicle passes through the assembly line, one station assembles the frame, the next one installs the engine, and so on.</span></span> <span data-ttu-id="f19d7-108">Étant donné qu'une ligne d'assemblage permet à plusieurs véhicules d'être assemblés en même temps, cela fournit une productivité supérieure à l'assemblage un par un des véhicules.</span><span class="sxs-lookup"><span data-stu-id="f19d7-108">Because an assembly line enables multiple vehicles to be assembled at the same time, it provides better throughput than assembling complete vehicles one at a time.</span></span>  
  
> [!TIP]
>  <span data-ttu-id="f19d7-109">La bibliothèque de flux de données TPL (espace de noms <xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType>) n'est pas distribuée avec le [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f19d7-109">The TPL Dataflow Library (<xref:System.Threading.Tasks.Dataflow?displayProperty=nameWithType> namespace) is not distributed with the [!INCLUDE[net_v45](../../../includes/net-v45-md.md)].</span></span> <span data-ttu-id="f19d7-110">Pour installer l'espace de noms <xref:System.Threading.Tasks.Dataflow>, ouvrez votre projet dans [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], dans le menu Projet choisissez **Gérer les packages NuGet**, puis recherchez en ligne le package `Microsoft.Tpl.Dataflow`.</span><span class="sxs-lookup"><span data-stu-id="f19d7-110">To install the <xref:System.Threading.Tasks.Dataflow> namespace, open your project in [!INCLUDE[vs_dev11_long](../../../includes/vs-dev11-long-md.md)], choose **Manage NuGet Packages** from the Project menu, and search online for the `Microsoft.Tpl.Dataflow` package.</span></span>  
  
 <span data-ttu-id="f19d7-111">Ce document montre un pipeline de flux de données qui télécharge le livre *l’Iliade d’Homère* à partir d’un site Web et recherche le texte à rechercher des mots individuels avec des mots qui inverse caractères du premier mot.</span><span class="sxs-lookup"><span data-stu-id="f19d7-111">This document demonstrates a dataflow pipeline that downloads the book *The Iliad of Homer* from a website and searches the text to match individual words with words that reverse the first word's characters.</span></span> <span data-ttu-id="f19d7-112">La formation du pipeline de flux de données dans ce document comprend les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="f19d7-112">The formation of the dataflow pipeline in this document consists of the following steps:</span></span>  
  
1.  <span data-ttu-id="f19d7-113">Créez des blocs de flux de données qui participent au pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-113">Create the dataflow blocks that participate in the pipeline.</span></span>  
  
2.  <span data-ttu-id="f19d7-114">Connectez chaque bloc de flux de données au bloc suivant dans le pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-114">Connect each dataflow block to the next block in the pipeline.</span></span> <span data-ttu-id="f19d7-115">Chaque bloc reçoit comme entrée la sortie du bloc précédent du pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-115">Each block receives as input the output of the previous block in the pipeline.</span></span>  
  
3.  <span data-ttu-id="f19d7-116">Pour chaque bloc de flux de données, créez une tâche de continuation qui définit le bloc suivant à l'état arrêté après que le bloc précédent ait terminé.</span><span class="sxs-lookup"><span data-stu-id="f19d7-116">For each dataflow block, create a continuation task that sets the next block to the completed state after the previous block finishes.</span></span>  
  
4.  <span data-ttu-id="f19d7-117">Publiez les données au début du pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-117">Post data to the head of the pipeline.</span></span>  
  
5.  <span data-ttu-id="f19d7-118">Marquez le début du pipeline comme terminé.</span><span class="sxs-lookup"><span data-stu-id="f19d7-118">Mark the head of the pipeline as completed.</span></span>  
  
6.  <span data-ttu-id="f19d7-119">Attendez que le pipeline termine tous les travaux.</span><span class="sxs-lookup"><span data-stu-id="f19d7-119">Wait for the pipeline to complete all work.</span></span>  
  
## <a name="prerequisites"></a><span data-ttu-id="f19d7-120">Conditions préalables</span><span class="sxs-lookup"><span data-stu-id="f19d7-120">Prerequisites</span></span>  
 <span data-ttu-id="f19d7-121">Lisez la rubrique [Flux de données](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) avant de démarrer cette procédure pas à pas.</span><span class="sxs-lookup"><span data-stu-id="f19d7-121">Read [Dataflow](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md) before you start this walkthrough.</span></span>  
  
## <a name="creating-a-console-application"></a><span data-ttu-id="f19d7-122">Création d'une application console</span><span class="sxs-lookup"><span data-stu-id="f19d7-122">Creating a Console Application</span></span>  
 <span data-ttu-id="f19d7-123">Dans [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], créez un projet d'application console [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] ou [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f19d7-123">In [!INCLUDE[vsprvs](../../../includes/vsprvs-md.md)], create a [!INCLUDE[csprcs](../../../includes/csprcs-md.md)] or [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)] Console Application project.</span></span> <span data-ttu-id="f19d7-124">Ajoutez une référence à System.Threading.Tasks.Dataflow.dll.</span><span class="sxs-lookup"><span data-stu-id="f19d7-124">Add a reference to System.Threading.Tasks.Dataflow.dll.</span></span>  
  
 <span data-ttu-id="f19d7-125">Vous pouvez également créer un fichier et nommez-le `ReverseWords.cs` (`ReverseWords.vb` pour [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), puis exécutez la commande suivante dans une fenêtre d’invite de commandes Visual Studio pour compiler le projet.</span><span class="sxs-lookup"><span data-stu-id="f19d7-125">Alternatively, create a file and name it `ReverseWords.cs` (`ReverseWords.vb` for [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]), and then run the following command in a Visual Studio Command Prompt window to compile the project.</span></span>  
  
 [!INCLUDE[csprcs](../../../includes/csprcs-md.md)]  
  
 <span data-ttu-id="f19d7-126">**csc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.cs**</span><span class="sxs-lookup"><span data-stu-id="f19d7-126">**csc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.cs**</span></span>  
  
 [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]  
  
 <span data-ttu-id="f19d7-127">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.vb**</span><span class="sxs-lookup"><span data-stu-id="f19d7-127">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll ReverseWords.vb**</span></span>  
  
 <span data-ttu-id="f19d7-128">Ajoutez le code suivant à votre projet pour créer l'application de base.</span><span class="sxs-lookup"><span data-stu-id="f19d7-128">Add the following code to your project to create the basic application.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#2](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#2)]
 [!code-vb[TPLDataflow_Palindromes#2](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#2)]  
  
## <a name="creating-the-dataflow-blocks"></a><span data-ttu-id="f19d7-129">Création des blocs de flux de données</span><span class="sxs-lookup"><span data-stu-id="f19d7-129">Creating the Dataflow Blocks</span></span>  
 <span data-ttu-id="f19d7-130">Ajoutez le code suivant à la méthode `Main` pour créer des blocs de flux de données qui participent au pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-130">Add the following code to the `Main` method to create the dataflow blocks that participate in the pipeline.</span></span> <span data-ttu-id="f19d7-131">Le tableau suivant résume le rôle de chaque membre du pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-131">The table that follows summarizes the role of each member of the pipeline.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#3](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#3)]
 [!code-vb[TPLDataflow_Palindromes#3](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#3)]  
  
|<span data-ttu-id="f19d7-132">Membre</span><span class="sxs-lookup"><span data-stu-id="f19d7-132">Member</span></span>|<span data-ttu-id="f19d7-133">Type</span><span class="sxs-lookup"><span data-stu-id="f19d7-133">Type</span></span>|<span data-ttu-id="f19d7-134">Description</span><span class="sxs-lookup"><span data-stu-id="f19d7-134">Description</span></span>|  
|------------|----------|-----------------|  
|`downloadString`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="f19d7-135">Télécharge le texte du livre depuis le Web.</span><span class="sxs-lookup"><span data-stu-id="f19d7-135">Downloads the book text from the Web.</span></span>|  
|`createWordList`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="f19d7-136">Sépare le texte du livre dans un tableau de mots.</span><span class="sxs-lookup"><span data-stu-id="f19d7-136">Separates the book text into an array of words.</span></span>|  
|`filterWordList`|<xref:System.Threading.Tasks.Dataflow.TransformBlock%602>|<span data-ttu-id="f19d7-137">Supprime les mots courts du tableau de mots, classe les mots obtenus par ordre alphabétique, et supprime les doublons.</span><span class="sxs-lookup"><span data-stu-id="f19d7-137">Removes short words from the word array, orders the resulting words alphabetically, and remove duplicates.</span></span>|  
|`findReversedWords`|<xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602>|<span data-ttu-id="f19d7-138">Recherche tous les mots dans la collection filtrée de tableau de mots dont le changement se produit également dans le tableau de mots.</span><span class="sxs-lookup"><span data-stu-id="f19d7-138">Finds all words in the filtered word array collection whose reverse also occurs in the word array.</span></span>|  
|`printReversedWords`|<xref:System.Threading.Tasks.Dataflow.ActionBlock%601>|<span data-ttu-id="f19d7-139">Affiche les mots et les mots inversés correspondants dans la console.</span><span class="sxs-lookup"><span data-stu-id="f19d7-139">Displays words and the corresponding reverse words to the console.</span></span>|  
  
 <span data-ttu-id="f19d7-140">Bien que vous puissiez combiner plusieurs étapes de cet exemple dans le pipeline de flux de données en une étape, l'exemple illustre le concept de composition de plusieurs tâches distinctes de flux de données pour effectuer une plus grande tâche.</span><span class="sxs-lookup"><span data-stu-id="f19d7-140">Although you could combine multiple steps in the dataflow pipeline in this example into one step, the example illustrates the concept of composing multiple independent dataflow tasks to perform a larger task.</span></span> <span data-ttu-id="f19d7-141">L'exemple utilise <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> pour permettre à chaque membre du pipeline d'exécuter une opération sur les données d'entrée et d'envoyer les résultats à l'étape suivante dans le pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-141">The example uses <xref:System.Threading.Tasks.Dataflow.TransformBlock%602> to enable each member of the pipeline to perform an operation on its input data and send the results to the next step in the pipeline.</span></span> <span data-ttu-id="f19d7-142">Le membre `findReversedWords` du pipeline est un objet <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> car il génère des sorties multiples indépendantes pour chaque entrée.</span><span class="sxs-lookup"><span data-stu-id="f19d7-142">The `findReversedWords` member of the pipeline is a <xref:System.Threading.Tasks.Dataflow.TransformManyBlock%602> object because it produces multiple independent outputs for each input.</span></span> <span data-ttu-id="f19d7-143">La queue du pipeline, `printReversedWords`, est un objet <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> car elle exécute une action sur son entrée, et ne produit aucun résultat.</span><span class="sxs-lookup"><span data-stu-id="f19d7-143">The tail of the pipeline, `printReversedWords`, is a <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object because it performs an action on its input, and does not produce a result.</span></span>  
  
## <a name="forming-the-pipeline"></a><span data-ttu-id="f19d7-144">Formation du pipeline</span><span class="sxs-lookup"><span data-stu-id="f19d7-144">Forming the Pipeline</span></span>  
 <span data-ttu-id="f19d7-145">Ajoutez le code suivant pour adapter chaque bloc au bloc suivant dans le pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-145">Add the following code to connect each block to the next block in the pipeline.</span></span>  
  
 <span data-ttu-id="f19d7-146">Lorsque vous appelez la méthode <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> pour adapter un bloc source de flux de données à un bloc cible de flux de données, le bloc source de flux de données se propage au bloc cible lorsque les données sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="f19d7-146">When you call the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method to connect a source dataflow block to a target dataflow block, the source dataflow block propagates data to the target block as data becomes available.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#4](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#4)]
 [!code-vb[TPLDataflow_Palindromes#4](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#4)]  
  
## <a name="creating-the-completion-tasks"></a><span data-ttu-id="f19d7-147">Création des tâches d’exécution</span><span class="sxs-lookup"><span data-stu-id="f19d7-147">Creating the Completion Tasks</span></span>  
 <span data-ttu-id="f19d7-148">Ajoutez le code suivant pour permettre à chaque bloc de flux de données d'effectuer une mesure finale une fois qu'il a traité les données.</span><span class="sxs-lookup"><span data-stu-id="f19d7-148">Add the following code to enable each dataflow block to perform a final action after it processes all data.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#5](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#5)]
 [!code-vb[TPLDataflow_Palindromes#5](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#5)]  
  
 <span data-ttu-id="f19d7-149">Pour propager l’exécution via le pipeline, chaque tâche d’exécution définit le bloc de flux de données suivant sur l’état arrêté.</span><span class="sxs-lookup"><span data-stu-id="f19d7-149">To propagate completion through the pipeline, each completion task sets the next dataflow block to the completed state.</span></span> <span data-ttu-id="f19d7-150">Par exemple, lorsque le début du pipeline est défini sur l'état achevé, il traite tous les messages restants de mise en mémoire tampon, puis exécute la tâche d'exécution, qui définit le deuxième membre du pipeline sur l'état achevé.</span><span class="sxs-lookup"><span data-stu-id="f19d7-150">For example, when the head of the pipeline is set to the completed state, it processes any remaining buffered messages and then runs its completion task, which sets the second member of the pipeline to the completed state.</span></span> <span data-ttu-id="f19d7-151">Le deuxième membre du pipeline traite ensuite tous les messages restants de mise en mémoire tampon, puis effectue la tâche d'exécution, qui définit le troisième membre du pipeline sur l'état achevé.</span><span class="sxs-lookup"><span data-stu-id="f19d7-151">The second member of the pipeline in turn processes any remaining buffered messages and then runs its completion task, which sets the third member of the pipeline to the completed state.</span></span> <span data-ttu-id="f19d7-152">Ce processus se poursuit jusqu'à ce que tous les membres du pipeline se terminent.</span><span class="sxs-lookup"><span data-stu-id="f19d7-152">This process continues until all members of the pipeline finish.</span></span> <span data-ttu-id="f19d7-153">Cet exemple utilise le mot clé `delegate` (`Function` dans [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) pour définir les tâches de continuation.</span><span class="sxs-lookup"><span data-stu-id="f19d7-153">This example uses the `delegate` keyword (`Function` in [!INCLUDE[vbprvb](../../../includes/vbprvb-md.md)]) to define the continuation tasks.</span></span>  
  
## <a name="posting-data-to-the-pipeline"></a><span data-ttu-id="f19d7-154">Publication des données du pipeline</span><span class="sxs-lookup"><span data-stu-id="f19d7-154">Posting Data to the Pipeline</span></span>  
 <span data-ttu-id="f19d7-155">Ajoutez le code suivant pour valider l’URL du livre *l’Iliade d’Homère* au début du pipeline de flux de données.</span><span class="sxs-lookup"><span data-stu-id="f19d7-155">Add the following code to post the URL of the book *The Iliad of Homer* to the head of the dataflow pipeline.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#6](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#6)]
 [!code-vb[TPLDataflow_Palindromes#6](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#6)]  
  
 <span data-ttu-id="f19d7-156">Cet exemple utilise <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A?displayProperty=nameWithType> pour envoyer des données de façon synchrone au début du pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-156">This example uses <xref:System.Threading.Tasks.Dataflow.DataflowBlock.Post%2A?displayProperty=nameWithType> to synchronously send data to the head of the pipeline.</span></span> <span data-ttu-id="f19d7-157">Utilisez la méthode <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> lorsque vous devez envoyer de manière asynchrone des données à un nœud de flux de données.</span><span class="sxs-lookup"><span data-stu-id="f19d7-157">Use the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.SendAsync%2A?displayProperty=nameWithType> method when you must asynchronously send data to a dataflow node.</span></span>  
  
## <a name="completing-pipeline-activity"></a><span data-ttu-id="f19d7-158">Fermeture de l'activité du pipeline</span><span class="sxs-lookup"><span data-stu-id="f19d7-158">Completing Pipeline Activity</span></span>  
 <span data-ttu-id="f19d7-159">Ajoutez le code suivant pour indiquer que le début du pipeline est terminé.</span><span class="sxs-lookup"><span data-stu-id="f19d7-159">Add the following code to mark the head of the pipeline as completed.</span></span> <span data-ttu-id="f19d7-160">Le début du pipeline exécute la tâche de continuation lorsqu'il a traité tous les messages de mise en mémoire tampon.</span><span class="sxs-lookup"><span data-stu-id="f19d7-160">The head of the pipeline runs its continuation task after it processes all buffered messages.</span></span> <span data-ttu-id="f19d7-161">Cette tâche de continuation propage l’état achevé via le pipeline.</span><span class="sxs-lookup"><span data-stu-id="f19d7-161">This continuation task propagates the completed state through the pipeline.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#7](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#7)]
 [!code-vb[TPLDataflow_Palindromes#7](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#7)]  
  
 <span data-ttu-id="f19d7-162">Cet exemple envoie une URL via le pipeline de flux de données à traiter.</span><span class="sxs-lookup"><span data-stu-id="f19d7-162">This example sends one URL through the dataflow pipeline to be processed.</span></span> <span data-ttu-id="f19d7-163">Si vous devez envoyer plusieurs entrées par un pipeline, appelez la méthode <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A?displayProperty=nameWithType> après avoir soumis toutes les entrées.</span><span class="sxs-lookup"><span data-stu-id="f19d7-163">If you send more than one input through a pipeline, call the <xref:System.Threading.Tasks.Dataflow.IDataflowBlock.Complete%2A?displayProperty=nameWithType> method after you submit all the input.</span></span> <span data-ttu-id="f19d7-164">Vous pouvez omettre cette étape si votre application n'a pas de points bien définis à partir desquels les données ne sont plus disponibles ou si l'application n'a pas à attendre que le pipeline se termine.</span><span class="sxs-lookup"><span data-stu-id="f19d7-164">You can omit this step if your application has no well-defined point at which data is no longer available or the application does not have to wait for the pipeline to finish.</span></span>  
  
## <a name="waiting-for-the-pipeline-to-finish"></a><span data-ttu-id="f19d7-165">Attente de la fermeture du pipeline</span><span class="sxs-lookup"><span data-stu-id="f19d7-165">Waiting for the Pipeline to Finish</span></span>  
 <span data-ttu-id="f19d7-166">Ajoutez le code suivant pour attendre que le pipeline se termine.</span><span class="sxs-lookup"><span data-stu-id="f19d7-166">Add the following code to wait for the pipeline to finish.</span></span> <span data-ttu-id="f19d7-167">Étant donné que cet exemple utilise des tâches de continuation pour envoyer l’exécution via le pipeline, l’opération d’agrégation est terminée lorsque la fin du pipeline se termine.</span><span class="sxs-lookup"><span data-stu-id="f19d7-167">Because this example uses continuation tasks to propagate completion through the pipeline, the overall operation is finished when the tail of the pipeline finishes.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#8](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#8)]
 [!code-vb[TPLDataflow_Palindromes#8](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#8)]  
  
 <span data-ttu-id="f19d7-168">Vous pouvez attendre la fin de flux de données de tous les threads ou de plusieurs threads simultanément.</span><span class="sxs-lookup"><span data-stu-id="f19d7-168">You can wait for dataflow completion from any thread or from multiple threads at the same time.</span></span>  
  
## <a name="the-complete-example"></a><span data-ttu-id="f19d7-169">Exemple complet</span><span class="sxs-lookup"><span data-stu-id="f19d7-169">The Complete Example</span></span>  
 <span data-ttu-id="f19d7-170">L'exemple suivant présente le code complet pour cette visite.</span><span class="sxs-lookup"><span data-stu-id="f19d7-170">The following example shows the complete code for this walkthrough.</span></span>  
  
 [!code-csharp[TPLDataflow_Palindromes#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_palindromes/cs/dataflowpalindromes.cs#1)]
 [!code-vb[TPLDataflow_Palindromes#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_palindromes/vb/dataflowpalindromes.vb#1)]  
  
## <a name="next-steps"></a><span data-ttu-id="f19d7-171">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="f19d7-171">Next Steps</span></span>  
 <span data-ttu-id="f19d7-172">Cet exemple envoie une URL à traiter via le pipeline de flux de données.</span><span class="sxs-lookup"><span data-stu-id="f19d7-172">This example sends one URL to process through the dataflow pipeline.</span></span> <span data-ttu-id="f19d7-173">Si vous devez envoyer plusieurs valeurs d'entrée via le pipeline, vous pouvez introduire un forme de parallélisme dans votre application similaire à la façon dont des parties peuvent parcourir une fabrique d'automobiles.</span><span class="sxs-lookup"><span data-stu-id="f19d7-173">If you send more than one input value through a pipeline, you can introduce a form of parallelism into your application that resembles how parts might move through an automobile factory.</span></span> <span data-ttu-id="f19d7-174">Lorsque le premier membre du pipeline envoie son résultat au deuxième membre, il peut traiter un autre élément en parallèle alors que le deuxième membre traite le premier résultat.</span><span class="sxs-lookup"><span data-stu-id="f19d7-174">When the first member of the pipeline sends its result to the second member, it can process another item in parallel as the second member processes the first result.</span></span>  
  
 <span data-ttu-id="f19d7-175">Le parallélisme qui est effectué à l’aide de pipelines de flux de données est appelé *parallélisme de granularité grossière* parce qu’il comprend généralement moins, des tâches plus complexes.</span><span class="sxs-lookup"><span data-stu-id="f19d7-175">The parallelism that is achieved by using dataflow pipelines is known as *coarse-grained parallelism* because it typically consists of fewer, larger tasks.</span></span> <span data-ttu-id="f19d7-176">Vous pouvez également utiliser plus *un parallélisme affiné* de petites tâches d’exécution courte dans un pipeline de flux de données.</span><span class="sxs-lookup"><span data-stu-id="f19d7-176">You can also use a more *fine-grained parallelism* of smaller, short-running tasks in a dataflow pipeline.</span></span> <span data-ttu-id="f19d7-177">Dans cet exemple, le membre `findReversedWords` du pipeline utilise la méthode <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> pour traiter plusieurs éléments dans la liste des travaux en parallèle.</span><span class="sxs-lookup"><span data-stu-id="f19d7-177">In this example, the `findReversedWords` member of the pipeline uses the <xref:System.Threading.Tasks.Parallel.ForEach%2A?displayProperty=nameWithType> method to process multiple items in the work list in parallel.</span></span> <span data-ttu-id="f19d7-178">L'utilisation du parallélisme de granularité fine dans un pipeline de granularité grossière peut améliorer le débit global.</span><span class="sxs-lookup"><span data-stu-id="f19d7-178">The use of fine-grained parallelism in a coarse-grained pipeline can improve overall throughput.</span></span>  
  
 <span data-ttu-id="f19d7-179">Vous pouvez également connecter un bloc de flux de données source vers plusieurs blocs cibles pour créer un *de flux de données réseau*.</span><span class="sxs-lookup"><span data-stu-id="f19d7-179">You can also connect a source dataflow block to multiple target blocks to create a *dataflow network*.</span></span> <span data-ttu-id="f19d7-180">La version surchargée de la méthode <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> accepte un objet <xref:System.Predicate%601> qui définit si le bloc cible reçoit les messages en fonction de sa valeur.</span><span class="sxs-lookup"><span data-stu-id="f19d7-180">The overloaded version of the <xref:System.Threading.Tasks.Dataflow.DataflowBlock.LinkTo%2A> method takes a <xref:System.Predicate%601> object that defines whether the target block accepts each message based on its value.</span></span> <span data-ttu-id="f19d7-181">La plupart des types de bloc de flux de données qui agissent comme sources envoient des messages à toutes les blocs cibles connectés, dans l'ordre dans lequel ils ont été connectés, jusqu'à ce que l'un des blocs reçoive ce message.</span><span class="sxs-lookup"><span data-stu-id="f19d7-181">Most dataflow block types that act as sources offer messages to all connected target blocks, in the order in which they were connected, until one of the blocks accepts that message.</span></span> <span data-ttu-id="f19d7-182">En utilisant ce mécanisme de filtrage, vous pouvez créer des systèmes de blocs de flux de données connectés qui dirigent certaines données via un seul tracé et d’autres données via un autre tracé.</span><span class="sxs-lookup"><span data-stu-id="f19d7-182">By using this filtering mechanism, you can create systems of connected dataflow blocks that direct certain data through one path and other data through another path.</span></span> <span data-ttu-id="f19d7-183">Pour obtenir un exemple qui utilise le filtrage pour créer un réseau de flux de données, consultez [procédure pas à pas : utilisation de flux de données dans une Application Windows Forms](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).</span><span class="sxs-lookup"><span data-stu-id="f19d7-183">For an example that uses filtering to create a dataflow network, see [Walkthrough: Using Dataflow in a Windows Forms Application](../../../docs/standard/parallel-programming/walkthrough-using-dataflow-in-a-windows-forms-application.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f19d7-184">Voir aussi</span><span class="sxs-lookup"><span data-stu-id="f19d7-184">See Also</span></span>  
 [<span data-ttu-id="f19d7-185">Le flux de données</span><span class="sxs-lookup"><span data-stu-id="f19d7-185">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
