---
title: Test ASP.NET Core les applications MVC
description: Architecture des Applications Web avec ASP.NET Core et Azure | Test ASP.NET Core les applications MVC
author: ardalis
ms.author: wiwagn
ms.date: 10/08/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.openlocfilehash: 4611ffa8334e124946e849306d3281b695830eb1
ms.sourcegitcommit: bbde43da655ae7bea1977f7af7345eb87bd7fd5f
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 10/21/2017
---
# <a name="test-aspnet-core-mvc-apps"></a><span data-ttu-id="55a26-103">Test ASP.NET Core les applications MVC</span><span class="sxs-lookup"><span data-stu-id="55a26-103">Test ASP.NET Core MVC Apps</span></span>

> <span data-ttu-id="55a26-104">_« Si vous n’aimez pas votre produit de tests unitaires, très probablement vos clients ne sont pas tels que pour le tester, soit. »_</span><span class="sxs-lookup"><span data-stu-id="55a26-104">_"If you don't like unit testing your product, most likely your customers won't like to test it, either."_</span></span>
> <span data-ttu-id="55a26-105">_ - Anonyme -</span><span class="sxs-lookup"><span data-stu-id="55a26-105">_- Anonymous-</span></span>

## <a name="summary"></a><span data-ttu-id="55a26-106">Résumé</span><span class="sxs-lookup"><span data-stu-id="55a26-106">Summary</span></span>

<span data-ttu-id="55a26-107">Logiciels complexes peuvent échouer de façon inattendue en réponse aux modifications.</span><span class="sxs-lookup"><span data-stu-id="55a26-107">Software of any complexity can fail in unexpected ways in response to changes.</span></span> <span data-ttu-id="55a26-108">Par conséquent, il est requis pour toutes les applications plus anecdotiques (ou moins critiques) de test après avoir apporté des modifications.</span><span class="sxs-lookup"><span data-stu-id="55a26-108">Thus, testing after making changes is required for all but the most trivial (or least critical) applications.</span></span> <span data-ttu-id="55a26-109">Un test manuel est la plus lente, façon moins fiable, la plus coûteuse pour tester un logiciel.</span><span class="sxs-lookup"><span data-stu-id="55a26-109">Manual testing is the slowest, least reliable, most expensive way to test software.</span></span> <span data-ttu-id="55a26-110">Malheureusement, si les applications ne sont pas conçues pour être testable, il peut être la seule méthode disponible.</span><span class="sxs-lookup"><span data-stu-id="55a26-110">Unfortunately, if applications are not designed to be testable, it can be the only means available.</span></span> <span data-ttu-id="55a26-111">Les applications écrites suit les principes d’architecture présentés dans le chapitre X doivent être unité testable, et les applications ASP.NET Core prennent en charge l’intégration automatisée et également les tests fonctionnels.</span><span class="sxs-lookup"><span data-stu-id="55a26-111">Applications written following the architectural principles laid out in chapter X should be unit testable, and ASP.NET Core applications support automated integration and functional testing as well.</span></span>

## <a name="kinds-of-automated-tests"></a><span data-ttu-id="55a26-112">Types de Tests automatisés</span><span class="sxs-lookup"><span data-stu-id="55a26-112">Kinds of Automated Tests</span></span>

<span data-ttu-id="55a26-113">Il existe de nombreux types de tests automatisés pour les applications logicielles.</span><span class="sxs-lookup"><span data-stu-id="55a26-113">There are many kinds of automated tests for software applications.</span></span> <span data-ttu-id="55a26-114">La plus simple, test au niveau le plus bas est le test unitaire.</span><span class="sxs-lookup"><span data-stu-id="55a26-114">The simplest, lowest level test is the unit test.</span></span> <span data-ttu-id="55a26-115">À un niveau légèrement supérieur des tests d’intégration et les tests fonctionnels.</span><span class="sxs-lookup"><span data-stu-id="55a26-115">At a slightly higher level there are integration tests and functional tests.</span></span> <span data-ttu-id="55a26-116">Autres types de tests, tels que les tests, les tests de charge, les tests de contrainte et tests de détection de fumée, l’interface utilisateur n’entrent pas dans le cadre de ce document.</span><span class="sxs-lookup"><span data-stu-id="55a26-116">Other kinds of tests, like UI tests, load tests, stress tests, and smoke tests, are beyond the scope of this document.</span></span>

### <a name="unit-tests"></a><span data-ttu-id="55a26-117">Tests unitaires</span><span class="sxs-lookup"><span data-stu-id="55a26-117">Unit Tests</span></span>

<span data-ttu-id="55a26-118">Un test unitaire teste une seule partie de la logique de votre application.</span><span class="sxs-lookup"><span data-stu-id="55a26-118">A unit test tests a single part of your application's logic.</span></span> <span data-ttu-id="55a26-119">Un peut décrire plus précisément en répertoriant les éléments dont il n’est pas.</span><span class="sxs-lookup"><span data-stu-id="55a26-119">One can further describe it by listing some of the things that it isn't.</span></span> <span data-ttu-id="55a26-120">Un test unitaire ne teste pas comment votre code fonctionne avec des dépendances ou d’infrastructure – ce que l’intégration des tests est destinés.</span><span class="sxs-lookup"><span data-stu-id="55a26-120">A unit test doesn't test how your code works with dependencies or infrastructure – that's what integration tests are for.</span></span> <span data-ttu-id="55a26-121">Un test unitaire ne teste pas le cadre de sur que votre code est écrit : vous partez du principe qu’il fonctionne ou, si vous trouvez qu’il ne, signaler un bogue et une solution de contournement du code.</span><span class="sxs-lookup"><span data-stu-id="55a26-121">A unit test doesn't test the framework your code is written on – you should assume it works or, if you find it doesn't, file a bug and code a workaround.</span></span> <span data-ttu-id="55a26-122">Un test unitaire s’exécute entièrement en mémoire et dans le processus.</span><span class="sxs-lookup"><span data-stu-id="55a26-122">A unit test runs completely in memory and in process.</span></span> <span data-ttu-id="55a26-123">Elle ne communique pas avec le système de fichiers, le réseau ou une base de données.</span><span class="sxs-lookup"><span data-stu-id="55a26-123">It doesn't communicate with the file system, the network, or a database.</span></span> <span data-ttu-id="55a26-124">Tests unitaires doivent uniquement tester votre code.</span><span class="sxs-lookup"><span data-stu-id="55a26-124">Unit tests should only test your code.</span></span>

<span data-ttu-id="55a26-125">Les tests unitaires, du fait qu’elle teste uniquement une seule unité de votre code, sans dépendances externes, doivent s’exécuter très rapidement.</span><span class="sxs-lookup"><span data-stu-id="55a26-125">Unit tests, by virtue of the fact that they test only a single unit of your code, with no external dependencies, should execute extremely quickly.</span></span> <span data-ttu-id="55a26-126">Par conséquent, vous devez pouvoir exécuter des suites de tests de centaines de tests unitaires dans quelques secondes.</span><span class="sxs-lookup"><span data-stu-id="55a26-126">Thus, you should be able to run test suites of hundreds of unit tests in a few seconds.</span></span> <span data-ttu-id="55a26-127">Exécuter fréquemment, idéalement avant chaque par émission de données à un référentiel de contrôle de code source partagé et certainement avec chaque build automatisée sur votre serveur de builds.</span><span class="sxs-lookup"><span data-stu-id="55a26-127">Run them frequently, ideally before every push to a shared source control repository, and certainly with every automated build on your build server.</span></span>

### <a name="integration-tests"></a><span data-ttu-id="55a26-128">Tests d’intégration</span><span class="sxs-lookup"><span data-stu-id="55a26-128">Integration Tests</span></span>

<span data-ttu-id="55a26-129">Même s’il est judicieux d’encapsuler votre code qui interagit avec l’infrastructure, notamment les bases de données et les systèmes de fichiers, vous devez toujours partie de ce code, et vous aurez probablement besoin de le tester.</span><span class="sxs-lookup"><span data-stu-id="55a26-129">Although it's a good idea to encapsulate your code that interacts with infrastructure like databases and file systems, you will still have some of that code, and you will probably want to test it.</span></span> <span data-ttu-id="55a26-130">En outre, vous devez vérifier que les couches de votre code interagissent comme prévu lorsque les dépendances de votre application sont entièrement résolus.</span><span class="sxs-lookup"><span data-stu-id="55a26-130">Additionally, you should verify that your code's layers interact as you expect when your application's dependencies are fully resolved.</span></span> <span data-ttu-id="55a26-131">Il s’agit de la responsabilité des tests d’intégration.</span><span class="sxs-lookup"><span data-stu-id="55a26-131">This is the responsibility of integration tests.</span></span> <span data-ttu-id="55a26-132">Tests d’intégration ont tendance à être plus lent et plus difficile à configurer que les tests unitaires, car ils dépendent souvent infrastructure et des dépendances externes.</span><span class="sxs-lookup"><span data-stu-id="55a26-132">Integration tests tend to be slower and more difficult to set up than unit tests, because they often depend on external dependencies and infrastructure.</span></span> <span data-ttu-id="55a26-133">Par conséquent, vous devez éviter d’éléments qui peuvent être des tests avec des tests unitaires dans les tests d’intégration de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-133">Thus, you should avoid testing things that could be tests with unit tests in integration tests.</span></span> <span data-ttu-id="55a26-134">Si vous pouvez tester un scénario donné avec un test unitaire, vous devez la tester avec un test unitaire.</span><span class="sxs-lookup"><span data-stu-id="55a26-134">If you can test a given scenario with a unit test, you should test it with a unit test.</span></span> <span data-ttu-id="55a26-135">Si vous ne pouvez pas le cas, envisagez d’utiliser un test d’intégration.</span><span class="sxs-lookup"><span data-stu-id="55a26-135">If you can't, then consider using an integration test.</span></span>

<span data-ttu-id="55a26-136">Tests d’intégration ont souvent le programme d’installation plus complexe et les procédures de démontage que les tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="55a26-136">Integration tests will often have more complex setup and teardown procedures than unit tests.</span></span> <span data-ttu-id="55a26-137">Par exemple, un test d’intégration qui passe par rapport à une base de données réelle devez un moyen de retourner la base de données à un état connu avant chaque série de tests.</span><span class="sxs-lookup"><span data-stu-id="55a26-137">For example, an integration test that goes against an actual database will need a way to return the database to a known state before each test run.</span></span> <span data-ttu-id="55a26-138">Comme de nouveaux tests sont ajoutés et le schéma de base de données de production évolue, ces scripts auront tendance à croître en taille et la complexité de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-138">As new tests are added and the production database schema evolves, these test scripts will tend to grow in size and complexity.</span></span> <span data-ttu-id="55a26-139">Dans de nombreux systèmes de grande taille, il est peu pratique d’exécuter les suites de tests d’intégration complètes sur les stations de travail de développement avant d’archiver les modifications apportées au contrôle de code source partagé.</span><span class="sxs-lookup"><span data-stu-id="55a26-139">In many large systems, it is impractical to run full suites of integration tests on developer workstations before checking in changes to shared source control.</span></span> <span data-ttu-id="55a26-140">Dans ces cas, les tests d’intégration peuvent être exécutées sur un serveur de builds.</span><span class="sxs-lookup"><span data-stu-id="55a26-140">In these cases, integration tests may be run on a build server.</span></span>

<span data-ttu-id="55a26-141">La classe d’implémentation LocalFileImageService implémente la logique de l’extraction et renvoyer les octets d’un fichier image à partir d’un dossier spécifique, un id donné :</span><span class="sxs-lookup"><span data-stu-id="55a26-141">The LocalFileImageService implementation class implements the logic for fetching and returning the bytes of an image file from a particular folder given an id:</span></span>

```cs
public class LocalFileImageService : IImageService
{
    private readonly IHostingEnvironment _env;
    public LocalFileImageService(IHostingEnvironment env)
    {
        _env = env;
    }
    public byte[] GetImageBytesById(int id)
    {
        try
        {
            var contentRoot = _env.ContentRootPath + "//Pics";
            var path = Path.Combine(contentRoot, id + ".png");
            return File.ReadAllBytes(path);
```

### <a name="functional-tests"></a><span data-ttu-id="55a26-142">Tests fonctionnels</span><span class="sxs-lookup"><span data-stu-id="55a26-142">Functional Tests</span></span>

<span data-ttu-id="55a26-143">Tests d’intégration sont écrites du point de vue du développeur, pour vérifier que certains composants du système fonctionnent correctement ensemble.</span><span class="sxs-lookup"><span data-stu-id="55a26-143">Integration tests are written from the perspective of the developer, to verify that some components of the system work correctly together.</span></span> <span data-ttu-id="55a26-144">Les tests fonctionnels sont écrites du point de vue de l’utilisateur et vérifiez l’exactitude du système en fonction de ses besoins.</span><span class="sxs-lookup"><span data-stu-id="55a26-144">Functional tests are written from the perspective of the user, and verify the correctness of the system based on its requirements.</span></span> <span data-ttu-id="55a26-145">L’extrait suivant offre une analogie utile pour savoir comment tenir compte des tests fonctionnels, par rapport aux tests unitaires :</span><span class="sxs-lookup"><span data-stu-id="55a26-145">The following excerpt offers a useful analogy for how to think about functional tests, compared to unit tests:</span></span>

> <span data-ttu-id="55a26-146">« Nombre de fois où le développement d’un système est comparée à la création d’une maison.</span><span class="sxs-lookup"><span data-stu-id="55a26-146">"Many times the development of a system is likened to the building of a house.</span></span> <span data-ttu-id="55a26-147">Alors que cette analogie n’est pas tout à fait correcte, nous pouvons l’étendre pour mieux comprendre la différence entre les unités et les tests fonctionnels.</span><span class="sxs-lookup"><span data-stu-id="55a26-147">While this analogy isn't quite correct, we can extend it for the purposes of understanding the difference between unit and functional tests.</span></span> <span data-ttu-id="55a26-148">Test unitaire est analogue à un inspecteur de construction sur site de construction d’une maison.</span><span class="sxs-lookup"><span data-stu-id="55a26-148">Unit testing is analogous to a building inspector visiting a house's construction site.</span></span> <span data-ttu-id="55a26-149">Il se concentre sur les différents systèmes internes de la maison, la Fondation, reformulation, électrique, plomberie et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="55a26-149">He is focused on the various internal systems of the house, the foundation, framing, electrical, plumbing, and so on.</span></span> <span data-ttu-id="55a26-150">Il garantit (tests) que les parties de la maison seront fonctionne correctement et en toute sécurité, autrement dit, répondent à la génération code.</span><span class="sxs-lookup"><span data-stu-id="55a26-150">He ensures (tests) that the parts of the house will work correctly and safely, that is, meet the building code.</span></span> <span data-ttu-id="55a26-151">Dans ce scénario, les tests fonctionnels sont analogues au propriétaire sur ce même site de construction.</span><span class="sxs-lookup"><span data-stu-id="55a26-151">Functional tests in this scenario are analogous to the homeowner visiting this same construction site.</span></span> <span data-ttu-id="55a26-152">Il part du principe que les systèmes internes seront comporte de manière appropriée, que l’inspecteur de construction effectue sa tâche.</span><span class="sxs-lookup"><span data-stu-id="55a26-152">He assumes that the internal systems will behave appropriately, that the building inspector is performing his task.</span></span> <span data-ttu-id="55a26-153">Le propriétaire est axé sur ce que ce sera comme de vie de cette maison.</span><span class="sxs-lookup"><span data-stu-id="55a26-153">The homeowner is focused on what it will be like to live in this house.</span></span> <span data-ttu-id="55a26-154">Il concerne à quoi ressemble la maison, sont les différentes salles de conversation d’une taille à l’aise, la maison besoins de la famille, sont les fenêtres dans une zone correcte pour intercepter le soleil matin.</span><span class="sxs-lookup"><span data-stu-id="55a26-154">He is concerned with how the house looks, are the various rooms a comfortable size, does the house fit the family's needs, are the windows in a good spot to catch the morning sun.</span></span> <span data-ttu-id="55a26-155">Le propriétaire exécute les tests fonctionnels sur la maison.</span><span class="sxs-lookup"><span data-stu-id="55a26-155">The homeowner is performing functional tests on the house.</span></span> <span data-ttu-id="55a26-156">Il dispose de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="55a26-156">He has the user's perspective.</span></span> <span data-ttu-id="55a26-157">L’inspecteur de génération en exécution des tests unitaires sur la maison.</span><span class="sxs-lookup"><span data-stu-id="55a26-157">The building inspector is performing unit tests on the house.</span></span> <span data-ttu-id="55a26-158">Il dispose du point de vue du générateur. »</span><span class="sxs-lookup"><span data-stu-id="55a26-158">He has the builder's perspective."</span></span>

<span data-ttu-id="55a26-159">Source : [unité de test et les Tests fonctionnels](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span><span class="sxs-lookup"><span data-stu-id="55a26-159">Source: [Unit Testing versus Functional Tests](http://www.softwaretestingtricks.com/2007/01/unit-testing-versus-functional-tests.html)</span></span>

<span data-ttu-id="55a26-160">J’aime » en tant que développeurs, nous échouer de deux manières : nous créons la chose incorrecte ou que nous créons un objet erroné. »</span><span class="sxs-lookup"><span data-stu-id="55a26-160">I'm fond of saying "As developers, we fail in two ways: we build the thing wrong, or we build the wrong thing."</span></span> <span data-ttu-id="55a26-161">Tests unitaires Assurez-vous que vous travaillez sur la droite chose ; les tests fonctionnels Vérifiez que vous générez l’attitude.</span><span class="sxs-lookup"><span data-stu-id="55a26-161">Unit tests ensure you are building the thing right; functional tests ensure you are building the right thing.</span></span>

<span data-ttu-id="55a26-162">Étant donné que les tests fonctionnels fonctionnent au niveau du système, ils peuvent nécessitent un certain degré d’automatisation de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="55a26-162">Since functional tests operate at the system level, they may require some degree of UI automation.</span></span> <span data-ttu-id="55a26-163">Comme tests d’intégration, ils fonctionnent généralement avec un type de l’infrastructure de test ainsi.</span><span class="sxs-lookup"><span data-stu-id="55a26-163">Like integration tests, they usually work with some kind of test infrastructure as well.</span></span> <span data-ttu-id="55a26-164">Cela les rend plus lent et plus fragile que les tests unitaires et l’intégration.</span><span class="sxs-lookup"><span data-stu-id="55a26-164">This makes them slower and more brittle than unit and integration tests.</span></span> <span data-ttu-id="55a26-165">Vous devez avoir uniquement des tests fonctionnels autant que nécessaire pour être certain que le système se comporte comme les utilisateurs s’y attendre.</span><span class="sxs-lookup"><span data-stu-id="55a26-165">You should have only as many functional tests as you need to be confident the system is behaving as users expect.</span></span>

### <a name="testing-pyramid"></a><span data-ttu-id="55a26-166">Test en pyramide</span><span class="sxs-lookup"><span data-stu-id="55a26-166">Testing Pyramid</span></span>

<span data-ttu-id="55a26-167">Martin Fowler a écrit sur la test en pyramide, un exemple de ce qui est indiqué dans la Figure 9-1.</span><span class="sxs-lookup"><span data-stu-id="55a26-167">Martin Fowler wrote about the testing pyramid, an example of which is shown in Figure 9-1.</span></span>

![](./media/image9-1.png)

<span data-ttu-id="55a26-168">La figure 9-1 test en pyramide</span><span class="sxs-lookup"><span data-stu-id="55a26-168">Figure 9-1 Testing Pyramid</span></span>

<span data-ttu-id="55a26-169">Les différentes couches de la pyramide et leurs tailles relatives, représentent par différents types de tests et le nombre, vous devez écrire pour votre application.</span><span class="sxs-lookup"><span data-stu-id="55a26-169">The different layers of the pyramid, and their relative sizes, represent different kinds of tests and how many you should write for your application.</span></span> <span data-ttu-id="55a26-170">Comme vous pouvez le voir, la recommandation consiste à disposer d’une grande base de tests unitaires, pris en charge par une couche inférieure de tests d’intégration, avec une couche plus petite de tests fonctionnels.</span><span class="sxs-lookup"><span data-stu-id="55a26-170">As you can see, the recommendation is to have a large base of unit tests, supported by a smaller layer of integration tests, with an even smaller layer of functional tests.</span></span> <span data-ttu-id="55a26-171">Chaque couche dans l’idéal, ne doit avoir des tests qui ne peut pas être effectuée correctement sur une couche inférieure.</span><span class="sxs-lookup"><span data-stu-id="55a26-171">Each layer should ideally only have tests in it that cannot be performed adequately at a lower layer.</span></span> <span data-ttu-id="55a26-172">Gardez à l’esprit la pyramide test lorsque vous essayez de déterminer le type de test que vous avez besoin pour un scénario particulier.</span><span class="sxs-lookup"><span data-stu-id="55a26-172">Keep the testing pyramid in mind when you are trying to decide which kind of test you need for a particular scenario.</span></span>

### <a name="what-to-test"></a><span data-ttu-id="55a26-173">Que se passe-t-il au Test</span><span class="sxs-lookup"><span data-stu-id="55a26-173">What to Test</span></span>

<span data-ttu-id="55a26-174">Un problème courant pour les développeurs peu familiarisés avec l’écriture de tests automatisés arrive avec les éléments à tester.</span><span class="sxs-lookup"><span data-stu-id="55a26-174">A common problem for developers who are inexperienced with writing automated tests is coming up with what to test.</span></span> <span data-ttu-id="55a26-175">Il est un bon point de départ pour tester la logique conditionnelle.</span><span class="sxs-lookup"><span data-stu-id="55a26-175">A good starting point is to test conditional logic.</span></span> <span data-ttu-id="55a26-176">Partout où vous avez une méthode avec un comportement qui change en fonction d’une instruction conditionnelle (if-else, de basculer, etc.), vous devez être en mesure de proposer au moins deux des tests qui confirment que le comportement approprié à certaines conditions.</span><span class="sxs-lookup"><span data-stu-id="55a26-176">Anywhere you have a method with behavior that changes based on a conditional statement (if-else, switch, etc.), you should be able to come up at least a couple of tests that confirm the correct behavior for certain conditions.</span></span> <span data-ttu-id="55a26-177">Si votre code a des conditions d’erreur, il est judicieux d’écrire d’au moins un test pour le chemin « bon » via le code (avec aucune erreur) et au moins un test pour le « chemin d’accès sad » (avec des erreurs ou des résultats atypiques) pour confirmer que votre application se comporte comme prévu en cas d’erreurs.</span><span class="sxs-lookup"><span data-stu-id="55a26-177">If your code has error conditions, it's good to write at least one test for the "happy path" through the code (with no errors), and at least one test for the "sad path" (with errors or atypical results) to confirm your application behaves as expected in the face of errors.</span></span> <span data-ttu-id="55a26-178">Enfin, essayez de vous concentrer sur les éléments qui peuvent échouer de test, plutôt que de vous concentrer sur des métriques telles que la couverture du code.</span><span class="sxs-lookup"><span data-stu-id="55a26-178">Finally, try to focus on testing things that can fail, rather than focusing on metrics like code coverage.</span></span> <span data-ttu-id="55a26-179">Plus de couverture du code est inférieure, en général.</span><span class="sxs-lookup"><span data-stu-id="55a26-179">More code coverage is better than less, generally.</span></span> <span data-ttu-id="55a26-180">Toutefois, l’écriture quelques tests plus d’une méthode très complexe et critique d’entreprise est généralement une meilleure utilisation de temps que l’écriture de tests pour des propriétés automatiques simplement optimiser les métriques de couverture du code de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-180">However, writing a few more tests of a very complex and business-critical method is usually a better use of time than writing tests for auto-properties just to improve test code coverage metrics.</span></span>

## <a name="organizing-test-projects"></a><span data-ttu-id="55a26-181">Organisation des projets de Test</span><span class="sxs-lookup"><span data-stu-id="55a26-181">Organizing Test Projects</span></span>

<span data-ttu-id="55a26-182">Pour organiser des projets de test mais fonctionne mieux pour vous.</span><span class="sxs-lookup"><span data-stu-id="55a26-182">Test projects can be organized however works best for you.</span></span> <span data-ttu-id="55a26-183">Il est judicieux de séparer les tests par type (test unitaire, test d’intégration) et par qu’ils testent (par projet, espace de noms).</span><span class="sxs-lookup"><span data-stu-id="55a26-183">It's a good idea to separate tests by type (unit test, integration test) and by what they are testing (by project, by namespace).</span></span> <span data-ttu-id="55a26-184">Si cette séparation est constituée des dossiers au sein d’un projet de test ou de plusieurs projets de test, est une décision de conception.</span><span class="sxs-lookup"><span data-stu-id="55a26-184">Whether this separation consists of folders within a single test project, or multiple test projects, is a design decision.</span></span> <span data-ttu-id="55a26-185">Un projet est la plus simple, mais pour les projets volumineux avec le nombre de tests ou pour exécuter plus facilement les différents ensembles de tests, vous pouvez avoir plusieurs projets de test différentes.</span><span class="sxs-lookup"><span data-stu-id="55a26-185">One project is simplest, but for large projects with many tests, or in order to more easily run different sets of tests, you might want to have several different test projects.</span></span> <span data-ttu-id="55a26-186">De nombreuses équipes organiser les projets de test basés sur le projet que testez, qui, pour les applications avec plusieurs projets, peut entraîner un grand nombre de projets de test, en particulier si vous toujours décomposez ces selon quels sont les types de tests dans chaque projet.</span><span class="sxs-lookup"><span data-stu-id="55a26-186">Many teams organize test projects based on the project they are testing, which for applications with more than a few projects can result in a large number of test projects, especially if you still break these down according to what kind of tests are in each project.</span></span> <span data-ttu-id="55a26-187">Une approche de compromis consiste à disposer d’un projet par type de test, par application, avec les dossiers contenus dans les projets de test pour indiquer le projet (et la classe) en cours de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-187">A compromise approach is to have one project per kind of test, per application, with folders inside the test projects to indicate the project (and class) being tested.</span></span>

<span data-ttu-id="55a26-188">Une approche courante consiste à organiser les projets d’application dans un dossier 'src' et les projets de test de l’application dans un dossier « tests » parallèle.</span><span class="sxs-lookup"><span data-stu-id="55a26-188">A common approach is to organize the application projects under a ‘src' folder, and the application's test projects under a parallel ‘tests' folder.</span></span> <span data-ttu-id="55a26-189">Vous pouvez créer des dossiers de solution correspondant dans Visual Studio, si vous trouvez cette organisation utile.</span><span class="sxs-lookup"><span data-stu-id="55a26-189">You can create matching solution folders in Visual Studio, if you find this organization useful.</span></span>

![](./media/image9-2.png)

<span data-ttu-id="55a26-190">Organisation de Test de la figure 9-2 dans votre solution</span><span class="sxs-lookup"><span data-stu-id="55a26-190">Figure 9-2 Test organization in your solution</span></span>

<span data-ttu-id="55a26-191">Vous pouvez utiliser quelle que soit l’infrastructure de test que vous préférez.</span><span class="sxs-lookup"><span data-stu-id="55a26-191">You can use whichever test framework you prefer.</span></span> <span data-ttu-id="55a26-192">L’infrastructure xUnit fonctionne bien et ce que tous les tests ASP.NET Core et EF Core sont écrits.</span><span class="sxs-lookup"><span data-stu-id="55a26-192">The xUnit framework works well and is what all of the ASP.NET Core and EF Core tests are written in.</span></span> <span data-ttu-id="55a26-193">Vous pouvez ajouter un projet de test xUnit dans Visual Studio en utilisant le modèle indiqué dans la Figure 9-3, ou à partir de l’interface CLI à l’aide de xunit de nouveau dotnet.</span><span class="sxs-lookup"><span data-stu-id="55a26-193">You can add an xUnit test project in Visual Studio using the template shown in Figure 9-3, or from the CLI using dotnet new xunit.</span></span>

![](./media/image9-3.png)

<span data-ttu-id="55a26-194">Figure 9-3 Ajouter un projet de Test xUnit dans Visual Studio</span><span class="sxs-lookup"><span data-stu-id="55a26-194">Figure 9-3 Add an xUnit Test Project in Visual Studio</span></span>

### <a name="test-naming"></a><span data-ttu-id="55a26-195">Test d’affectation de noms</span><span class="sxs-lookup"><span data-stu-id="55a26-195">Test Naming</span></span>

<span data-ttu-id="55a26-196">Vous devez nommer vos tests de façon cohérente, avec des noms qui indiquent la signification de chaque test.</span><span class="sxs-lookup"><span data-stu-id="55a26-196">You should name your tests in a consistent fashion, with names that indicate what each test does.</span></span> <span data-ttu-id="55a26-197">J’ai un grand succès avec consiste à des classes de test de nom en fonction de la classe et la méthode qu'ils testent.</span><span class="sxs-lookup"><span data-stu-id="55a26-197">One approach I've had great success with is to name test classes according to the class and method they are testing.</span></span> <span data-ttu-id="55a26-198">Il en résulte dans de nombreuses classes de test peu, mais il rend extrêmement effacer ce que chaque test est responsable.</span><span class="sxs-lookup"><span data-stu-id="55a26-198">This results in many small test classes, but it makes it extremely clear what each test is responsible for.</span></span> <span data-ttu-id="55a26-199">Avec le nom de classe de test configuré pour identifier la classe et la méthode à tester, le nom de la méthode de test peut être utilisé pour spécifier le comportement qui est testé.</span><span class="sxs-lookup"><span data-stu-id="55a26-199">With the test class name set up to identify the class and method to be tested, the test method name can be used to specify the behavior being tested.</span></span> <span data-ttu-id="55a26-200">Cela doit inclure le comportement attendu et des entrées ou des hypothèses sur lesquelles doivent atteindre ce comportement.</span><span class="sxs-lookup"><span data-stu-id="55a26-200">This should include the expected behavior and any inputs or assumptions that should yield this behavior.</span></span> <span data-ttu-id="55a26-201">Certains exemples de noms de test :</span><span class="sxs-lookup"><span data-stu-id="55a26-201">Some example test names:</span></span>

-   <span data-ttu-id="55a26-202">CatalogControllerGetImage.CallsImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="55a26-202">CatalogControllerGetImage.CallsImageServiceWithId</span></span>

-   <span data-ttu-id="55a26-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="55a26-203">CatalogControllerGetImage.LogsWarningGivenImageMissingException</span></span>

-   <span data-ttu-id="55a26-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span><span class="sxs-lookup"><span data-stu-id="55a26-204">CatalogControllerGetImage.ReturnsFileResultWithBytesGivenSuccess</span></span>

-   <span data-ttu-id="55a26-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="55a26-205">CatalogControllerGetImage.ReturnsNotFoundResultGivenImageMissingException</span></span>

<span data-ttu-id="55a26-206">Une variante de cette approche termine chaque nom de classe de test avec « Doit » et modifie la conjugaison légèrement :</span><span class="sxs-lookup"><span data-stu-id="55a26-206">A variation of this approach ends each test class name with "Should" and modifies the tense slightly:</span></span>

-   <span data-ttu-id="55a26-207">CatalogControllerGetImage**doit**. **Appelez**ImageServiceWithId</span><span class="sxs-lookup"><span data-stu-id="55a26-207">CatalogControllerGetImage**Should**.**Call**ImageServiceWithId</span></span>

-   <span data-ttu-id="55a26-208">CatalogControllerGetImage**doit**. **Journal**WarningGivenImageMissingException</span><span class="sxs-lookup"><span data-stu-id="55a26-208">CatalogControllerGetImage**Should**.**Log**WarningGivenImageMissingException</span></span>

<span data-ttu-id="55a26-209">Certaines équipes de recherchent la deuxième approche d’affectation des noms plus claire, bien que légèrement plus détaillée.</span><span class="sxs-lookup"><span data-stu-id="55a26-209">Some teams find the second naming approach clearer, though slightly more verbose.</span></span> <span data-ttu-id="55a26-210">Dans tous les cas, essayez d’utiliser une convention d’affectation de noms qui permet de comprendre le comportement de test, afin que lorsqu’un ou plusieurs tests échouent, il est évident au vu de leurs noms, les cas qui ont échoué.</span><span class="sxs-lookup"><span data-stu-id="55a26-210">In any case, try to use a naming convention that provides insight into test behavior, so that when one or more tests fail, it's obvious from their names what cases have failed.</span></span> <span data-ttu-id="55a26-211">Éviter de nommer vous tests vaguement, telles que ControllerTests.Test1, car ceux-ci n’offrent aucune valeur lorsque vous les voyez dans les résultats des tests.</span><span class="sxs-lookup"><span data-stu-id="55a26-211">Avoid naming you tests vaguely, such as ControllerTests.Test1, as these offer no value when you see them in test results.</span></span>

<span data-ttu-id="55a26-212">Si vous suivez une convention d’affectation de noms comme celle ci-dessus qui génère des classes de test peu nombreuses, il est judicieux pour organiser davantage vos tests à l’aide des dossiers et des espaces de noms.</span><span class="sxs-lookup"><span data-stu-id="55a26-212">If you follow a naming convention like the one above that produces many small test classes, it's a good idea to further organize your tests using folders and namespaces.</span></span> <span data-ttu-id="55a26-213">Figure 9-4 présente une approche pour organiser des tests par dossier au sein de plusieurs projets de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-213">Figure 9-4 shows one approach to organizing tests by folder within several test projects.</span></span>

![](./media/image9-4.png)

<span data-ttu-id="55a26-214">**Figure 9-4.**</span><span class="sxs-lookup"><span data-stu-id="55a26-214">**Figure 9-4.**</span></span> <span data-ttu-id="55a26-215">Organisation des classes de test par dossier en fonction de la classe en cours de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-215">Organizing test classes by folder based on class being tested.</span></span>

<span data-ttu-id="55a26-216">Bien entendu, si une classe d’application particulier possède de nombreuses méthodes testées (et par conséquent, plusieurs classes de test), il peut être judicieux de le placer dans un dossier correspondant à la classe d’application.</span><span class="sxs-lookup"><span data-stu-id="55a26-216">Of course, if a particular application class has many methods being tested (and thus many test classes), it may make sense to place these in a folder corresponding to the application class.</span></span> <span data-ttu-id="55a26-217">Cette organisation n’est pas différente de la façon dont vous pouvez organiser les fichiers dans des dossiers ailleurs.</span><span class="sxs-lookup"><span data-stu-id="55a26-217">This organization is no different than how you might organize files into folders elsewhere.</span></span> <span data-ttu-id="55a26-218">Si vous avez plus de trois ou quatre fichiers associés dans un dossier contenant de nombreux autres fichiers, il est souvent utile de les déplacer vers leur propre sous-dossier.</span><span class="sxs-lookup"><span data-stu-id="55a26-218">If you have more than three or four related files in a folder containing many other files, it's often helpful to move them into their own subfolder.</span></span>

## <a name="unit-testing-aspnet-core-apps"></a><span data-ttu-id="55a26-219">Unité de test des applications ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="55a26-219">Unit Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="55a26-220">Dans une application ASP.NET Core bien conçue, la majeure partie de la complexité et la logique métier sera encapsulée dans les entités commerciales et une variété de services.</span><span class="sxs-lookup"><span data-stu-id="55a26-220">In a well-designed ASP.NET Core application, most of the complexity and business logic will be encapsulated in business entities and a variety of services.</span></span> <span data-ttu-id="55a26-221">L’application ASP.NET MVC de base, avec ses contrôleurs, de filtres, ViewModel et vues, doit nécessitent très peu de tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="55a26-221">The ASP.NET Core MVC app itself, with its controllers, filters, viewmodels, and views, should require very few unit tests.</span></span> <span data-ttu-id="55a26-222">Une grande partie de la fonctionnalité d’une action donnée se trouve en dehors de la méthode d’action.</span><span class="sxs-lookup"><span data-stu-id="55a26-222">Much of the functionality of a given action lies outside the action method itself.</span></span> <span data-ttu-id="55a26-223">Tester si le routage fonctionne correctement ou la gestion des erreurs global, ne peut pas être effectuée efficacement avec un test unitaire.</span><span class="sxs-lookup"><span data-stu-id="55a26-223">Testing whether routing works correctly, or global error handling, cannot be done effectively with a unit test.</span></span> <span data-ttu-id="55a26-224">De même, les filtres, notamment l’authentification et la validation du modèle et les filtres d’autorisation, ne peut pas être des tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="55a26-224">Likewise, any filters, including model validation and authentication and authorization filters, cannot be unit tested.</span></span> <span data-ttu-id="55a26-225">Sans ces sources de comportement, la plupart des méthodes d’action doivent être plus simplement petites, la majeure partie de leur travail à des services qui peuvent être testés indépendant du contrôleur qui les utilise la délégation.</span><span class="sxs-lookup"><span data-stu-id="55a26-225">Without these sources of behavior, most action methods should be trivially small, delegating the bulk of their work to services that can be tested independent of the controller that uses them.</span></span>

<span data-ttu-id="55a26-226">Vous devez parfois à refactoriser votre code dans le test unitaire son ordre.</span><span class="sxs-lookup"><span data-stu-id="55a26-226">Sometimes you'll need to refactor your code in order to unit test it.</span></span> <span data-ttu-id="55a26-227">Cela implique souvent identifier des abstractions et à l’aide de l’injection de dépendances pour accéder à l’abstraction dans le code que vous souhaitez tester, plutôt que directement sur l’infrastructure de codage.</span><span class="sxs-lookup"><span data-stu-id="55a26-227">Frequently this involves identifying abstractions and using dependency injection to access the abstraction in the code you'd like to test, rather than coding directly against infrastructure.</span></span> <span data-ttu-id="55a26-228">Par exemple, considérez cette méthode d’action simple pour afficher des images :</span><span class="sxs-lookup"><span data-stu-id="55a26-228">For example, consider this simple action method for displaying images:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")]
public IActionResult GetImage(int id)
{
    var contentRoot = _env.ContentRootPath + "//Pics";
    var path = Path.Combine(contentRoot, id + ".png");
    Byte[] b = System.IO.File.ReadAllBytes(path);
    return File(b, "image/png");
}
```

<span data-ttu-id="55a26-229">Cette méthode de test unitaire est rendue difficile par sa dépendance directe vis-à-vis System.IO.File, qu’il utilise pour lire à partir du système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="55a26-229">Unit testing this method is made difficult by its direct dependency on System.IO.File, which it uses to read from the file system.</span></span> <span data-ttu-id="55a26-230">Vous pouvez tester ce comportement pour vous assurer qu’il fonctionne comme prévu, mais avec des fichiers réels est un test d’intégration.</span><span class="sxs-lookup"><span data-stu-id="55a26-230">You can test this behavior to ensure it works as expected, but doing so with real files is an integration test.</span></span> <span data-ttu-id="55a26-231">Il est important de noter vous ne pouvez pas tester les itinéraires de cette méthode, vous allez apprendre à effectuer cette opération avec un test fonctionnel dans quelques instants.</span><span class="sxs-lookup"><span data-stu-id="55a26-231">It's worth noting you can't test this method's route – you'll see how to do this with a functional test shortly.</span></span>

<span data-ttu-id="55a26-232">Si vous ne pouvez pas le test unitaire le comportement de système de fichiers directement, et vous ne pouvez pas tester l’itinéraire, ce qui est il à tester ?</span><span class="sxs-lookup"><span data-stu-id="55a26-232">If you can't unit test the file system behavior directly, and you can't test the route, what is there to test?</span></span> <span data-ttu-id="55a26-233">Ainsi, après la refactorisation pour faire des tests unitaires, vous risquez de découvrir des cas de test et le comportement manquante, telles que la gestion des erreurs.</span><span class="sxs-lookup"><span data-stu-id="55a26-233">Well, after refactoring to make unit testing possible, you may discover some test cases and missing behavior, such as error handling.</span></span> <span data-ttu-id="55a26-234">Quelle est la méthode ? lorsqu’un fichier n’est pas trouvé.</span><span class="sxs-lookup"><span data-stu-id="55a26-234">What does the method do when a file isn't found?</span></span> <span data-ttu-id="55a26-235">Ce qu’il doit faire ?</span><span class="sxs-lookup"><span data-stu-id="55a26-235">What should it do?</span></span> <span data-ttu-id="55a26-236">Dans cet exemple, la méthode refactorisée ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="55a26-236">In this example, the refactored method looks like this:</span></span>

```cs
[HttpGet("[controller]/pic/{id}")\]
public IActionResult GetImage(int id)
{
    byte[] imageBytes;
    try
    {
        imageBytes = _imageService.GetImageBytesById(id);
    }
    catch (CatalogImageMissingException ex)
    {
        _logger.LogWarning($"No image found for id: {id}");
        return NotFound();
    }
    return File(imageBytes, "image/png");
}
```

<span data-ttu-id="55a26-237">Le \_enregistreur d’événements et \_imageService sont injectées en tant que dépendances.</span><span class="sxs-lookup"><span data-stu-id="55a26-237">The \_logger and \_imageService are both injected as dependencies.</span></span> <span data-ttu-id="55a26-238">Maintenant vous pouvez tester que le même id qui est passé à la méthode d’action est transmis à la \_imageService, et que les octets obtenus sont retournées dans le cadre de la FileResult.</span><span class="sxs-lookup"><span data-stu-id="55a26-238">Now you can test that the same id that is passed to the action method is passed to the \_imageService, and that the resulting bytes are returned as part of the FileResult.</span></span> <span data-ttu-id="55a26-239">Vous pouvez également tester que l’enregistrement des erreurs qui se passe comme prévu, et qu’un résultat introuvable est retourné si l’image est manquante, en supposant que ce soit le comportement de l’application importante (autrement dit, pas simplement code temporaire le développeur ajouté afin de diagnostiquer un problème).</span><span class="sxs-lookup"><span data-stu-id="55a26-239">You can also test that error logging is happening as expected, and that a NotFound result is returned if the image is missing, assuming this is important application behavior (that is, not just temporary code the developer added to diagnose an issue).</span></span> <span data-ttu-id="55a26-240">La logique de fichier réel a été déplacé dans un service de mise en œuvre distincte et qu’il a été augmentée pour retourner une exception spécifique à l’application dans le cas d’un fichier manquant.</span><span class="sxs-lookup"><span data-stu-id="55a26-240">The actual file logic has moved into a separate implementation service, and has been augmented to return an application-specific exception for the case of a missing file.</span></span> <span data-ttu-id="55a26-241">Vous pouvez tester cette implémentation indépendamment, à l’aide d’un test d’intégration.</span><span class="sxs-lookup"><span data-stu-id="55a26-241">You can test this implementation independently, using an integration test.</span></span>

## <a name="integration-testing-aspnet-core-apps"></a><span data-ttu-id="55a26-242">Intégration de test des applications ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="55a26-242">Integration Testing ASP.NET Core Apps</span></span>

```cs
    }
        catch (FileNotFoundException ex)
        {
            throw new CatalogImageMissingException(ex);
        }
    }
}
```

<span data-ttu-id="55a26-243">Ce service utilise le IHostingEnvironment, tout comme le CatalogController code fait avant, il a été refactorisé dans un service distinct.</span><span class="sxs-lookup"><span data-stu-id="55a26-243">This service uses the IHostingEnvironment, just as the CatalogController code did before it was refactored into a separate service.</span></span> <span data-ttu-id="55a26-244">Étant donné que c’était le seul code dans le contrôleur qui utilisé IHostingEnvironment, cette dépendance a été supprimée de constructeur de CatalogController.</span><span class="sxs-lookup"><span data-stu-id="55a26-244">Since this was the only code in the controller that used IHostingEnvironment, that dependency was removed from CatalogController's constructor.</span></span>

<span data-ttu-id="55a26-245">Pour vérifier que ce service fonctionne correctement, vous devez créer un fichier d’image de test connus et vérifiez que le service retourne donné une entrée spécifique.</span><span class="sxs-lookup"><span data-stu-id="55a26-245">To test that this service works correctly, you need to create a known test image file and verify that the service returns it given a specific input.</span></span> <span data-ttu-id="55a26-246">Vous devez prendre soin afin de ne pas pour utiliser d’objets fictifs sur le comportement que vous souhaitez tester (dans ce cas, la lecture du système de fichiers).</span><span class="sxs-lookup"><span data-stu-id="55a26-246">You should take care not to use mock objects on the behavior you actually want to test (in this case, reading from the file system).</span></span> <span data-ttu-id="55a26-247">Toutefois, objets fictifs peuvent toujours être utiles de définir des tests d’intégration.</span><span class="sxs-lookup"><span data-stu-id="55a26-247">However, mock objects may still be useful to set up integration tests.</span></span> <span data-ttu-id="55a26-248">Dans ce cas, vous pouvez simuler IHostingEnvironment afin que ses ContentRootPath pointe vers le dossier que vous allez utiliser pour votre image de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-248">In this case, you can mock IHostingEnvironment so that its ContentRootPath points to the folder you're going to use for your test image.</span></span> <span data-ttu-id="55a26-249">La classe de test d’intégration travail terminé est illustrée ici :</span><span class="sxs-lookup"><span data-stu-id="55a26-249">The complete working integration test class is shown here:</span></span>

```cs
public class LocalFileImageServiceGetImageBytesById
{
    private byte[] _testBytes = new byte[] { 0x01, 0x02, 0x03 };
    private readonly Mock<IHostingEnvironment> _mockEnvironment = new Mock<IHostingEnvironment>();
    private int _testImageId = 123;
    private string _testFileName = "123.png";
    public LocalFileImageServiceGetImageBytesById()
    {
        // create folder if necessary
        Directory.CreateDirectory(Path.Combine(GetFileDirectory(), "Pics"));
        string filePath = GetFilePath(_testFileName);
        System.IO.File.WriteAllBytes(filePath, _testBytes);
        _mockEnvironment.SetupGet<string>(m => m.ContentRootPath).Returns(GetFileDirectory());
    }
    private string GetFilePath(string fileName)
    {
        return Path.Combine(GetFileDirectory(), "Pics", fileName);
        }
            private string GetFileDirectory()
        {
            var location = System.Reflection.Assembly.GetEntryAssembly().Location;
            return Path.GetDirectoryName(location);
        }

        [Fact]
        public void ReturnsFileContentResultGivenValidId()
        {
            var fileService = new LocalFileImageService(_mockEnvironment.Object);
            var result = fileService.GetImageBytesById(_testImageId);
            Assert.Equal(_testBytes, result);
        }
    }
```

> [!NOTE]
> <span data-ttu-id="55a26-250">que le test lui-même est très simple : la majeure partie du code est nécessaire pour configurer le système et de créer l’infrastructure de test (dans ce cas, un fichier à lire à partir du disque).</span><span class="sxs-lookup"><span data-stu-id="55a26-250">that the test itself is very simple – the bulk of the code is necessary to configure the system and create the testing infrastructure (in this case, an actual file to be read from disk).</span></span> <span data-ttu-id="55a26-251">Cela est courant pour les tests d’intégration, qui nécessitent généralement des tâches de configuration plus complexe que les tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="55a26-251">This is typical for integration tests, which often require more complex setup work than unit tests.</span></span>

## <a name="functional-testing-aspnet-core-apps"></a><span data-ttu-id="55a26-252">Applications ASP.NET Core tests fonctionnelles</span><span class="sxs-lookup"><span data-stu-id="55a26-252">Functional Testing ASP.NET Core Apps</span></span>

<span data-ttu-id="55a26-253">Pour les applications ASP.NET Core, la classe TestServer rend les tests fonctionnels relativement facile à écrire.</span><span class="sxs-lookup"><span data-stu-id="55a26-253">For ASP.NET Core applications, the TestServer class makes functional tests fairly easy to write.</span></span> <span data-ttu-id="55a26-254">Vous configurez un TestServer à l’aide d’un WebHostBuilder, comme vous le feriez normalement pour votre application.</span><span class="sxs-lookup"><span data-stu-id="55a26-254">You configure a TestServer using a WebHostBuilder, just as you normally do for your application.</span></span> <span data-ttu-id="55a26-255">Cette WebHostBuilder doit être configuré comme hôte réel de votre application, mais vous pouvez modifier les aspects qui faciliter le test.</span><span class="sxs-lookup"><span data-stu-id="55a26-255">This WebHostBuilder should be configured just like your application's real host, but you can modify any aspects of it that make testing easier.</span></span> <span data-ttu-id="55a26-256">La plupart du temps, vous allez réutiliser le même TestServer pour plusieurs cas de test, donc vous pouvez l’encapsuler dans une méthode réutilisable (peut-être dans une classe de base) :</span><span class="sxs-lookup"><span data-stu-id="55a26-256">Most of the time, you'll reuse the same TestServer for many test cases, so you can encapsulate it in a reusable method (perhaps in a base class):</span></span>

```cs
public abstract class BaseWebTest
{
    protected readonly HttpClient _client;
    protected string _contentRoot;

    public BaseWebTest()
    {
        _client = GetClient();
    }
    
    protected HttpClient GetClient()
    {
        var startupAssembly = typeof(Startup).GetTypeInfo().Assembly;
        _contentRoot = GetProjectPath("src", startupAssembly);
        var builder = new WebHostBuilder()
        .UseContentRoot(_contentRoot)
        .UseStartup&lt;Startup&gt;();
        var server = new TestServer(builder);
        var client = server.CreateClient();
        return client;
    }
}
```

<span data-ttu-id="55a26-257">La méthode GetProjectPath retourne simplement le chemin d’accès physique au projet web (exemple de solution téléchargement).</span><span class="sxs-lookup"><span data-stu-id="55a26-257">The GetProjectPath method simply returns the physical path to the web project (download sample solution).</span></span> <span data-ttu-id="55a26-258">Le WebHostBuilder dans ce cas simplement spécifie où est la racine du contenu de l’application web et fait référence à la même classe de démarrage, que l’application web réelle utilise.</span><span class="sxs-lookup"><span data-stu-id="55a26-258">The WebHostBuilder in this case simply specifies where the content root for the web application is, and references the same Startup class the real web application uses.</span></span> <span data-ttu-id="55a26-259">Pour travailler avec le TestServer, vous utilisez le type System.Net.HttpClient standard pour effectuer des demandes à ce dernier.</span><span class="sxs-lookup"><span data-stu-id="55a26-259">To work with the TestServer, you use the standard System.Net.HttpClient type to make requests to it.</span></span> <span data-ttu-id="55a26-260">TestServer expose une méthode CreateClient utile qui fournit un client préconfiguré qui est prêt à effectuer des demandes à l’application en cours d’exécution sur le TestServer.</span><span class="sxs-lookup"><span data-stu-id="55a26-260">TestServer exposes a helpful CreateClient method that provides a pre-configured client that is ready to make requests to the application running on the TestServer.</span></span> <span data-ttu-id="55a26-261">Vous utilisez ce client (valeur protégé \_membre de client sur le test de base ci-dessus) lors de l’écriture des tests fonctionnels pour votre application ASP.NET Core :</span><span class="sxs-lookup"><span data-stu-id="55a26-261">You use this client (set to the protected \_client member on the base test above) when writing functional tests for your ASP.NET Core application:</span></span>

```cs
public class CatalogControllerGetImage : BaseWebTest
{
    [Fact]
    public async Task ReturnsFileContentResultGivenValidId()
    {
        var testFilePath = Path.Combine(_contentRoot, "pics//1.png");
        var expectedFileBytes = File.ReadAllBytes(testFilePath);
        var response = await _client.GetAsync("/catalog/pic/1");
        response.EnsureSuccessStatusCode();
        var streamResponse = await response.Content.ReadAsStreamAsync();
        byte[] byteResult;
        using (var ms = new MemoryStream())
        {
            streamResponse.CopyTo(ms);
            byteResult = ms.ToArray();
        }
        Assert.Equal(expectedFileBytes, byteResult);
    }
}
```

<span data-ttu-id="55a26-262">Ce test fonctionnel teste la pile complète d’applications ASP.NET MVC de base, y compris tous les intergiciels (middleware), filtres, classeurs, etc. qui peuvent être en place.</span><span class="sxs-lookup"><span data-stu-id="55a26-262">This functional test exercises the full ASP.NET Core MVC application stack, including all middleware, filters, binders, etc. that may be in place.</span></span> <span data-ttu-id="55a26-263">Il vérifie si un compte tenu de l’itinéraire (« / catalogue/pic/1 ») retourne le tableau d’octets attendus pour un fichier dans un emplacement connu.</span><span class="sxs-lookup"><span data-stu-id="55a26-263">It verifies that a given route ("/catalog/pic/1") returns the expected byte array for a file in a known location.</span></span> <span data-ttu-id="55a26-264">Il fait sans avoir configuré un serveur web réel et évite une grande partie de la fragilité qui peut rencontrer des serveur de test (par exemple, les problèmes liés aux paramètres de pare-feu) à l’aide d’un site web réel.</span><span class="sxs-lookup"><span data-stu-id="55a26-264">It does so without setting up a real web server, and so avoids much of the brittleness that using a real web server for testing can experience (for example, problems with firewall settings).</span></span> <span data-ttu-id="55a26-265">Les tests fonctionnels qui s’exécutent sur TestServer sont généralement plus lents que l’intégration et des tests unitaires, mais il sont beaucoup plus rapides que les tests qui sont exécute sur le réseau à un serveur web de test.</span><span class="sxs-lookup"><span data-stu-id="55a26-265">Functional tests that run against TestServer are usually slower than integration and unit tests, but are much faster than tests that would run over the network to a test web server.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="55a26-266">[Précédente] (work-with-data-in-asp-net-core-apps.md) [suivant] (développement-processus-de-azure.md)</span><span class="sxs-lookup"><span data-stu-id="55a26-266">[Previous] (work-with-data-in-asp-net-core-apps.md) [Next] (development-process-for-azure.md)</span></span>
